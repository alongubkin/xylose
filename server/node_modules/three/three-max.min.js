
var window = window || {};
var self = self || {};

// High-resulution counter: emulate window.performance.now() for THREE.CLOCK
if( window.performance === undefined ) {

	window.performance = { };

}

if( window.performance.now === undefined ) {

	window.performance.now = function () {

		var time = process.hrtime();
		return ( time[0] + time[1] / 1e9 ) * 1000;

	};

}
function getHttpRequest(e,t,i){var r={load:function(e){t(o,e)},progress:function(e){i(o,e)}},o=new XMLHttpRequest;addListeners(o,r),o.open("GET",e,!0),o.send(null)}function getJsonRequest(e,t){getHttpRequest(e,function(e){t(JSON.parse(e.responseText))},function(){})}function addListeners(e,t){for(var i in t)e.addEventListener(i,t[i])}var THREE=THREE||{REVISION:"56"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},THREE.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),r=0,o=i.length;o>r;r++){var a=i[r];Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}else{var n={}.hasOwnProperty;for(var a in t)n.call(t,a)&&(e[a]=t[a])}return e},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;t.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var i=Date.now(),r=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+r)},r);return e=i+r,o}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return void 0!==e&&this.set(e),this},THREE.extend(THREE.Color.prototype,{r:1,g:1,b:1,set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){return console.log("DEPRECATED: Color's .setHSV() will be removed. Use .setHSL( h, s, l ) instead."),this.setHSL(e,t*i/(1>(e=(2-t)*i)?e:2-e),e/2)},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var r=function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e},o=.5>=i?i*(1+t):i+t-i*t,a=2*i-o;this.r=r(a,o,e+1/3),this.g=r(a,o,e),this.b=r(a,o,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(THREE.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,i,r=this.r,o=this.g,a=this.b,n=Math.max(r,o,a),s=Math.min(r,o,a),h=(s+n)/2;if(s===n)t=0,i=0;else{var l=n-s;switch(i=.5>=h?l/(n+s):l/(2-n-s),n){case r:t=(o-a)/l+(a>o?6:0);break;case o:t=(a-r)/l+2;break;case a:t=(r-o)/l+4}t/=6}return e.h=t,e.s=i,e.l=h,e}}(),getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}}),THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},THREE.extend(THREE.Quaternion.prototype,{set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),r=Math.cos(e.y/2),o=Math.cos(e.z/2),a=Math.sin(e.x/2),n=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=a*r*o+i*n*s,this.y=i*n*o-a*r*s,this.z=i*r*s+a*n*o,this.w=i*r*o-a*n*s):"YXZ"===t?(this.x=a*r*o+i*n*s,this.y=i*n*o-a*r*s,this.z=i*r*s-a*n*o,this.w=i*r*o+a*n*s):"ZXY"===t?(this.x=a*r*o-i*n*s,this.y=i*n*o+a*r*s,this.z=i*r*s+a*n*o,this.w=i*r*o-a*n*s):"ZYX"===t?(this.x=a*r*o-i*n*s,this.y=i*n*o+a*r*s,this.z=i*r*s-a*n*o,this.w=i*r*o+a*n*s):"YZX"===t?(this.x=a*r*o+i*n*s,this.y=i*n*o+a*r*s,this.z=i*r*s-a*n*o,this.w=i*r*o-a*n*s):"XZY"===t&&(this.x=a*r*o-i*n*s,this.y=i*n*o-a*r*s,this.z=i*r*s+a*n*o,this.w=i*r*o+a*n*s),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],o=i[4],a=i[8],n=i[1],s=i[5],h=i[9],l=i[2],c=i[6],u=i[10],p=r+s+u;return p>0?(t=.5/Math.sqrt(p+1),this.w=.25/t,this.x=(c-h)*t,this.y=(a-l)*t,this.z=(n-o)*t):r>s&&r>u?(t=2*Math.sqrt(1+r-s-u),this.w=(c-h)/t,this.x=.25*t,this.y=(o+n)/t,this.z=(a+l)/t):s>u?(t=2*Math.sqrt(1+s-r-u),this.w=(a-l)/t,this.x=(o+n)/t,this.y=.25*t,this.z=(h+c)/t):(t=2*Math.sqrt(1+u-r-s),this.w=(n-o)/t,this.x=(a+l)/t,this.y=(h+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,o=e.z,a=e.w,n=t.x,s=t.y,h=t.z,l=t.w;return this.x=i*l+a*n+r*h-o*s,this.y=r*l+a*s+o*n-i*h,this.z=o*l+a*h+i*s-r*n,this.w=a*l-i*n-r*s-o*h,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,r=this.y,o=this.z,a=this.w,n=a*e.w+i*e.x+r*e.y+o*e.z;if(0>n?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,n=-n):this.copy(e),n>=1)return this.w=a,this.x=i,this.y=r,this.z=o,this;var s=Math.acos(n),h=Math.sqrt(1-n*n);if(.001>Math.abs(h))return this.w=.5*(a+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(o+this.z),this;var l=Math.sin((1-t)*s)/h,c=Math.sin(t*s)/h;return this.w=a*l+this.w*c,this.x=i*l+this.x*c,this.y=r*l+this.y*c,this.z=o*l+this.z*c,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}}),THREE.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.extend(THREE.Vector2.prototype,{set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),this},clamp:function(e,t){return e.x>this.x?this.x=e.x:this.x>t.x&&(this.x=t.x),e.y>this.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}}),THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.extend(THREE.Vector3.prototype,{set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12],this.y=o[1]*t+o[5]*i+o[9]*r+o[13],this.z=o[2]*t+o[6]*i+o[10]*r+o[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,o=e.elements,a=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*a,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*a,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*a,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,o=e.x,a=e.y,n=e.z,s=e.w,h=s*t+a*r-n*i,l=s*i+n*t-o*r,c=s*r+o*i-a*t,u=-o*t-a*i-n*r;return this.x=h*s+u*-o+l*-n-c*-a,this.y=l*s+u*-a+c*-o-h*-n,this.z=c*s+u*-n+h*-a-l*-o,this},applyEuler:function(){var e=new THREE.Quaternion;return function(t,i){var r=e.setFromEuler(t,i);return this.applyQuaternion(r),this}}(),applyAxisAngle:function(){var e=new THREE.Quaternion;return function(t,i){var r=e.setFromAxisAngle(t,i);return this.applyQuaternion(r),this}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),this},clamp:function(e,t){return e.x>this.x?this.x=e.x:this.x>t.x&&(this.x=t.x),e.y>this.y?this.y=e.y:this.y>t.y&&(this.y=t.y),e.z>this.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,o=this.z;return this.x=r*e.z-o*e.y,this.y=o*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},projectOnVector:function(){var e=new THREE.Vector3;return function(t){e.copy(t).normalize();var i=this.dot(e);return this.copy(e).multiplyScalar(i)}}(),projectOnPlane:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,o=r[0],a=r[4],n=r[8],s=r[1],h=r[5],l=r[9],c=r[2],u=r[6],p=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(i(n)),.99999>Math.abs(n)?(this.x=Math.atan2(-l,p),this.z=Math.atan2(-a,o)):(this.x=Math.atan2(u,h),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(l)),.99999>Math.abs(l)?(this.y=Math.atan2(n,p),this.z=Math.atan2(s,h)):(this.y=Math.atan2(-c,o),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(u)),.99999>Math.abs(u)?(this.y=Math.atan2(-c,p),this.z=Math.atan2(-a,h)):(this.y=0,this.z=Math.atan2(s,o))):"ZYX"===t?(this.y=Math.asin(-i(c)),.99999>Math.abs(c)?(this.x=Math.atan2(u,p),this.z=Math.atan2(s,o)):(this.x=0,this.z=Math.atan2(-a,h))):"YZX"===t?(this.z=Math.asin(i(s)),.99999>Math.abs(s)?(this.x=Math.atan2(-l,h),this.y=Math.atan2(-c,o)):(this.x=0,this.y=Math.atan2(n,p))):"XZY"===t&&(this.z=Math.asin(-i(a)),.99999>Math.abs(a)?(this.x=Math.atan2(u,h),this.y=Math.atan2(n,o)):(this.x=Math.atan2(-l,p),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,o=e.y*e.y,a=e.z*e.z,n=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),n-r-o+a),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),n+r-o-a)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),n-r-o+a),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),n-r+o-a)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),n-r-o+a),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),n-r+o-a)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),n-r-o+a),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),n+r-o-a)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),n-r+o-a),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),n+r-o-a),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),n-r+o-a),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),n+r-o-a),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}}),THREE.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},THREE.extend(THREE.Vector4.prototype,{set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*o,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*o,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*o,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*o,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,o,a=.01,n=.1,s=e.elements,h=s[0],l=s[4],c=s[8],u=s[1],p=s[5],f=s[9],d=s[2],m=s[6],E=s[10];if(a>Math.abs(l-u)&&a>Math.abs(c-d)&&a>Math.abs(f-m)){if(n>Math.abs(l+u)&&n>Math.abs(c+d)&&n>Math.abs(f+m)&&n>Math.abs(h+p+E-3))return this.set(1,0,0,0),this;t=Math.PI;var v=(h+1)/2,g=(p+1)/2,y=(E+1)/2,T=(l+u)/4,R=(c+d)/4,x=(f+m)/4;return v>g&&v>y?a>v?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(v),r=T/i,o=R/i):g>y?a>g?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(g),i=T/r,o=x/r):a>y?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(y),i=R/o,r=x/o),this.set(i,r,o,t),this}var H=Math.sqrt((m-f)*(m-f)+(c-d)*(c-d)+(u-l)*(u-l));return.001>Math.abs(H)&&(H=1),this.x=(m-f)/H,this.y=(c-d)/H,this.z=(u-l)/H,this.w=Math.acos((h+p+E-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},clamp:function(e,t){return e.x>this.x?this.x=e.x:this.x>t.x&&(this.x=t.x),e.y>this.y?this.y=e.y:this.y>t.y&&(this.y=t.y),e.z>this.z?this.z=e.z:this.z>t.z&&(this.z=t.z),e.w>this.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}}),THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.extend(THREE.Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;r>i;i++)t=e[i],this.min.x>t.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),this.min.y>t.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.min.x>this.max.x||this.min.y>this.max.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return this.min.x>e.x||e.x>this.max.x||this.min.y>e.y||e.y>this.max.y?!1:!0},containsBox:function(e){return e.min.x>=this.min.x&&this.max.x>=e.max.x&&e.min.y>=this.min.y&&this.max.y>=e.max.y?!0:!1},getParameter:function(e){return new THREE.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return this.min.x>e.max.x||e.min.x>this.max.x||this.min.y>e.max.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var i=t||new THREE.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}}),THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.extend(THREE.Box3.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;r>i;i++)t=e[i],this.min.x>t.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),this.min.y>t.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),this.min.z>t.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return this.min.x>e.x||e.x>this.max.x||this.min.y>e.y||e.y>this.max.y||this.min.z>e.z||e.z>this.max.z?!1:!0},containsBox:function(e){return e.min.x>=this.min.x&&this.max.x>=e.max.x&&e.min.y>=this.min.y&&this.max.y>=e.max.y&&e.min.z>=this.min.z&&this.max.z>=e.max.z?!0:!1},getParameter:function(e){return new THREE.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return this.min.x>e.max.x||e.min.x>this.max.x||this.min.y>e.max.y||e.min.y>this.max.y||this.min.z>e.max.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var i=t||new THREE.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()
}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var i=t||new THREE.Sphere;return i.center=this.center(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}}),THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.extend(THREE.Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,r){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var o=t.dot(t),a=t.dot(e),n=a/o;return r&&(n=THREE.Math.clamp(n,0,1)),n}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),o=i||new THREE.Vector3;return this.delta(o).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}}),THREE.Matrix3=function(e,t,i,r,o,a,n,s,h){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,r||0,void 0!==o?o:1,a||0,n||0,s||0,void 0!==h?h:1)},THREE.extend(THREE.Matrix3.prototype,{set:function(e,t,i,r,o,a,n,s,h){var l=this.elements;return l[0]=e,l[3]=t,l[6]=i,l[1]=r,l[4]=o,l[7]=a,l[2]=n,l[5]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var i=0,r=t.length;r>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix3(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],a=e[4],n=e[5],s=e[6],h=e[7],l=e[8];return t*a*l-t*n*h-i*o*l+i*n*s+r*o*h-r*a*s},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var o=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===o){var a="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw Error(a);return console.warn(a),this.identity(),this}return this.multiplyScalar(1/o),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}}),THREE.Matrix4=function(e,t,i,r,o,a,n,s,h,l,c,u,p,f,d,m){var E=this.elements=new Float32Array(16);E[0]=void 0!==e?e:1,E[4]=t||0,E[8]=i||0,E[12]=r||0,E[1]=o||0,E[5]=void 0!==a?a:1,E[9]=n||0,E[13]=s||0,E[2]=h||0,E[6]=l||0,E[10]=void 0!==c?c:1,E[14]=u||0,E[3]=p||0,E[7]=f||0,E[11]=d||0,E[15]=void 0!==m?m:1},THREE.extend(THREE.Matrix4.prototype,{set:function(e,t,i,r,o,a,n,s,h,l,c,u,p,f,d,m){var E=this.elements;return E[0]=e,E[4]=t,E[8]=i,E[12]=r,E[1]=o,E[5]=a,E[9]=n,E[13]=s,E[2]=h,E[6]=l,E[10]=c,E[14]=u,E[3]=p,E[7]=f,E[11]=d,E[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,t){var i=this.elements,r=e.x,o=e.y,a=e.z,n=Math.cos(r),s=Math.sin(r),h=Math.cos(o),l=Math.sin(o),c=Math.cos(a),u=Math.sin(a);if(void 0===t||"XYZ"===t){var p=n*c,f=n*u,d=s*c,m=s*u;i[0]=h*c,i[4]=-h*u,i[8]=l,i[1]=f+d*l,i[5]=p-m*l,i[9]=-s*h,i[2]=m-p*l,i[6]=d+f*l,i[10]=n*h}else if("YXZ"===t){var E=h*c,v=h*u,g=l*c,y=l*u;i[0]=E+y*s,i[4]=g*s-v,i[8]=n*l,i[1]=n*u,i[5]=n*c,i[9]=-s,i[2]=v*s-g,i[6]=y+E*s,i[10]=n*h}else if("ZXY"===t){var E=h*c,v=h*u,g=l*c,y=l*u;i[0]=E-y*s,i[4]=-n*u,i[8]=g+v*s,i[1]=v+g*s,i[5]=n*c,i[9]=y-E*s,i[2]=-n*l,i[6]=s,i[10]=n*h}else if("ZYX"===t){var p=n*c,f=n*u,d=s*c,m=s*u;i[0]=h*c,i[4]=d*l-f,i[8]=p*l+m,i[1]=h*u,i[5]=m*l+p,i[9]=f*l-d,i[2]=-l,i[6]=s*h,i[10]=n*h}else if("YZX"===t){var T=n*h,R=n*l,x=s*h,H=s*l;i[0]=h*c,i[4]=H-T*u,i[8]=x*u+R,i[1]=u,i[5]=n*c,i[9]=-s*c,i[2]=-l*c,i[6]=R*u+x,i[10]=T-H*u}else if("XZY"===t){var T=n*h,R=n*l,x=s*h,H=s*l;i[0]=h*c,i[4]=-u,i[8]=l*c,i[1]=T*u+H,i[5]=n*c,i[9]=R*u-x,i[2]=x*u-R,i[6]=s*c,i[10]=H*u+T}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z,a=e.w,n=i+i,s=r+r,h=o+o,l=i*n,c=i*s,u=i*h,p=r*s,f=r*h,d=o*h,m=a*n,E=a*s,v=a*h;return t[0]=1-(p+d),t[4]=c-v,t[8]=u+E,t[1]=c+v,t[5]=1-(l+d),t[9]=f-m,t[2]=u-E,t[6]=f+m,t[10]=1-(l+p),this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(r,o,a){var n=this.elements;return i.subVectors(r,o).normalize(),0===i.length()&&(i.z=1),e.crossVectors(a,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(a,i).normalize()),t.crossVectors(i,e),n[0]=e.x,n[4]=t.x,n[8]=i.x,n[1]=e.y,n[5]=t.y,n[9]=i.y,n[2]=e.z,n[6]=t.z,n[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,o=this.elements,a=i[0],n=i[4],s=i[8],h=i[12],l=i[1],c=i[5],u=i[9],p=i[13],f=i[2],d=i[6],m=i[10],E=i[14],v=i[3],g=i[7],y=i[11],T=i[15],R=r[0],x=r[4],H=r[8],w=r[12],b=r[1],M=r[5],S=r[9],_=r[13],C=r[2],A=r[6],P=r[10],D=r[14],L=r[3],z=r[7],F=r[11],V=r[15];return o[0]=a*R+n*b+s*C+h*L,o[4]=a*x+n*M+s*A+h*z,o[8]=a*H+n*S+s*P+h*F,o[12]=a*w+n*_+s*D+h*V,o[1]=l*R+c*b+u*C+p*L,o[5]=l*x+c*M+u*A+p*z,o[9]=l*H+c*S+u*P+p*F,o[13]=l*w+c*_+u*D+p*V,o[2]=f*R+d*b+m*C+E*L,o[6]=f*x+d*M+m*A+E*z,o[10]=f*H+d*S+m*P+E*F,o[14]=f*w+d*_+m*D+E*V,o[3]=v*R+g*b+y*C+T*L,o[7]=v*x+g*M+y*A+T*z,o[11]=v*H+g*S+y*P+T*F,o[15]=v*w+g*_+y*D+T*V,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var i=0,r=t.length;r>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z;return e.x=i*t[0]+r*t[4]+o*t[8],e.y=i*t[1]+r*t[5]+o*t[9],e.z=i*t[2]+r*t[6]+o*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new THREE.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],a=e[1],n=e[5],s=e[9],h=e[13],l=e[2],c=e[6],u=e[10],p=e[14],f=e[3],d=e[7],m=e[11],E=e[15];return f*(+o*s*c-r*h*c-o*n*u+i*h*u+r*n*p-i*s*p)+d*(+t*s*p-t*h*u+o*a*u-r*a*p+r*h*l-o*s*l)+m*(+t*h*c-t*n*p-o*a*c+i*a*p+o*n*l-i*h*l)+E*(-r*n*l-t*s*c+t*n*u+r*a*c-i*a*u+i*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,o=r[0],a=r[4],n=r[8],s=r[12],h=r[1],l=r[5],c=r[9],u=r[13],p=r[2],f=r[6],d=r[10],m=r[14],E=r[3],v=r[7],g=r[11],y=r[15];i[0]=c*m*v-u*d*v+u*f*g-l*m*g-c*f*y+l*d*y,i[4]=s*d*v-n*m*v-s*f*g+a*m*g+n*f*y-a*d*y,i[8]=n*u*v-s*c*v+s*l*g-a*u*g-n*l*y+a*c*y,i[12]=s*c*f-n*u*f-s*l*d+a*u*d+n*l*m-a*c*m,i[1]=u*d*E-c*m*E-u*p*g+h*m*g+c*p*y-h*d*y,i[5]=n*m*E-s*d*E+s*p*g-o*m*g-n*p*y+o*d*y,i[9]=s*c*E-n*u*E-s*h*g+o*u*g+n*h*y-o*c*y,i[13]=n*u*p-s*c*p+s*h*d-o*u*d-n*h*m+o*c*m,i[2]=l*m*E-u*f*E+u*p*v-h*m*v-l*p*y+h*f*y,i[6]=s*f*E-a*m*E-s*p*v+o*m*v+a*p*y-o*f*y,i[10]=a*u*E-s*l*E+s*h*v-o*u*v-a*h*y+o*l*y,i[14]=s*l*p-a*u*p-s*h*f+o*u*f+a*h*m-o*l*m,i[3]=c*f*E-l*d*E-c*p*v+h*d*v+l*p*g-h*f*g,i[7]=a*d*E-n*f*E+n*p*v-o*d*v-a*p*g+o*f*g,i[11]=n*l*E-a*c*E-n*h*v+o*c*v+a*h*g-o*l*g,i[15]=a*c*p-n*l*p+n*h*f-o*c*f-a*h*d+o*l*d;var T=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==T){var R="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw Error(R);return console.warn(R),this.identity(),this}return this.multiplyScalar(1/T),this},compose:function(){var e=new THREE.Matrix4,t=new THREE.Matrix4;return function(i,r,o){var a=this.elements;return e.identity(),e.setRotationFromQuaternion(r),t.makeScale(o.x,o.y,o.z),this.multiplyMatrices(e,t),a[12]=i.x,a[13]=i.y,a[14]=i.z,this}}(),decompose:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Matrix4;return function(o,a,n){var s=this.elements;return e.set(s[0],s[1],s[2]),t.set(s[4],s[5],s[6]),i.set(s[8],s[9],s[10]),o=o instanceof THREE.Vector3?o:new THREE.Vector3,a=a instanceof THREE.Quaternion?a:new THREE.Quaternion,n=n instanceof THREE.Vector3?n:new THREE.Vector3,n.x=e.length(),n.y=t.length(),n.z=i.length(),o.x=s[12],o.y=s[13],o.z=s[14],r.copy(this),r.elements[0]/=n.x,r.elements[1]/=n.x,r.elements[2]/=n.x,r.elements[4]/=n.y,r.elements[5]/=n.y,r.elements[6]/=n.y,r.elements[8]/=n.z,r.elements[9]/=n.z,r.elements[10]/=n.z,a.setFromRotationMatrix(r),[o,a,n]}}(),extractPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var i=this.elements,r=t.elements,o=1/e.set(r[0],r[1],r[2]).length(),a=1/e.set(r[4],r[5],r[6]).length(),n=1/e.set(r[8],r[9],r[10]).length();return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[4]=r[4]*a,i[5]=r[5]*a,i[6]=r[6]*a,i[8]=r[8]*n,i[9]=r[9]*n,i[10]=r[10]*n,this}}(),translate:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z;return t[12]=t[0]*i+t[4]*r+t[8]*o+t[12],t[13]=t[1]*i+t[5]*r+t[9]*o+t[13],t[14]=t[2]*i+t[6]*r+t[10]*o+t[14],t[15]=t[3]*i+t[7]*r+t[11]*o+t[15],this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],o=t[6],a=t[7],n=t[8],s=t[9],h=t[10],l=t[11],c=Math.cos(e),u=Math.sin(e);return t[4]=c*i+u*n,t[5]=c*r+u*s,t[6]=c*o+u*h,t[7]=c*a+u*l,t[8]=c*n-u*i,t[9]=c*s-u*r,t[10]=c*h-u*o,t[11]=c*l-u*a,this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],o=t[2],a=t[3],n=t[8],s=t[9],h=t[10],l=t[11],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i-u*n,t[1]=c*r-u*s,t[2]=c*o-u*h,t[3]=c*a-u*l,t[8]=c*n+u*i,t[9]=c*s+u*r,t[10]=c*h+u*o,t[11]=c*l+u*a,this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],o=t[2],a=t[3],n=t[4],s=t[5],h=t[6],l=t[7],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i+u*n,t[1]=c*r+u*s,t[2]=c*o+u*h,t[3]=c*a+u*l,t[4]=c*n-u*i,t[5]=c*s-u*r,t[6]=c*h-u*o,t[7]=c*l-u*a,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,o=e.y,a=e.z,n=Math.sqrt(r*r+o*o+a*a);r/=n,o/=n,a/=n;var s=r*r,h=o*o,l=a*a,c=Math.cos(t),u=Math.sin(t),p=1-c,f=r*o*p,d=r*a*p,m=o*a*p,E=r*u,v=o*u,g=a*u,y=s+(1-s)*c,T=f+g,R=d-v,x=f-g,H=h+(1-h)*c,w=m+E,b=d+v,M=m-E,S=l+(1-l)*c,_=i[0],C=i[1],A=i[2],P=i[3],D=i[4],L=i[5],z=i[6],F=i[7],V=i[8],U=i[9],N=i[10],B=i[11];return i[0]=y*_+T*D+R*V,i[1]=y*C+T*L+R*U,i[2]=y*A+T*z+R*N,i[3]=y*P+T*F+R*B,i[4]=x*_+H*D+w*V,i[5]=x*C+H*L+w*U,i[6]=x*A+H*z+w*N,i[7]=x*P+H*F+w*B,i[8]=b*_+M*D+S*V,i[9]=b*C+M*L+S*U,i[10]=b*A+M*z+S*N,i[11]=b*P+M*F+S*B,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z;return t[0]*=i,t[4]*=r,t[8]*=o,t[1]*=i,t[5]*=r,t[9]*=o,t[2]*=i,t[6]*=r,t[10]*=o,t[3]*=i,t[7]*=r,t[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),o=1-i,a=e.x,n=e.y,s=e.z,h=o*a,l=o*n;return this.set(h*a+i,h*n-r*s,h*s+r*n,0,h*n+r*s,l*n+i,l*s-r*a,0,h*s-r*n,l*s+r*a,o*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,r,o,a){var n=this.elements,s=2*o/(t-e),h=2*o/(r-i),l=(t+e)/(t-e),c=(r+i)/(r-i),u=-(a+o)/(a-o),p=-2*a*o/(a-o);return n[0]=s,n[4]=0,n[8]=l,n[12]=0,n[1]=0,n[5]=h,n[9]=c,n[13]=0,n[2]=0,n[6]=0,n[10]=u,n[14]=p,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this},makePerspective:function(e,t,i,r){var o=i*Math.tan(THREE.Math.degToRad(.5*e)),a=-o,n=a*t,s=o*t;return this.makeFrustum(n,s,a,o,i,r)},makeOrthographic:function(e,t,i,r,o,a){var n=this.elements,s=t-e,h=i-r,l=a-o,c=(t+e)/s,u=(i+r)/h,p=(a+o)/l;return n[0]=2/s,n[4]=0,n[8]=0,n[12]=-c,n[1]=0,n[5]=2/h,n[9]=0,n[13]=-u,n[2]=0,n[6]=0,n[10]=-2/l,n[14]=-p,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}}),THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.extend(THREE.Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var i=t||new THREE.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(t)}}(),isIntersectionSphere:function(e){return e.radius>=this.distanceToPoint(e.center)},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);return 0!=t?!0:0==e.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:void 0;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return void 0===i?void 0:this.at(i,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}}),THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.extend(THREE.Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,r=0,o=t.length;o>r;r++){var a=e.distanceToSquared(t[r]);i=Math.max(i,a)}return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return this.radius*this.radius>=e.distanceToSquared(this.center)},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return t*t>=e.center.distanceToSquared(this.center)},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new THREE.Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}}),THREE.Frustum=function(e,t,i,r,o,a){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==o?o:new THREE.Plane,void 0!==a?a:new THREE.Plane]},THREE.extend(THREE.Frustum.prototype,{set:function(e,t,i,r,o,a){var n=this.planes;return n[0].copy(e),n[1].copy(t),n[2].copy(i),n[3].copy(r),n[4].copy(o),n[5].copy(a),this},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],o=i[1],a=i[2],n=i[3],s=i[4],h=i[5],l=i[6],c=i[7],u=i[8],p=i[9],f=i[10],d=i[11],m=i[12],E=i[13],v=i[14],g=i[15];return t[0].setComponents(n-r,c-s,d-u,g-m).normalize(),t[1].setComponents(n+r,c+s,d+u,g+m).normalize(),t[2].setComponents(n+o,c+h,d+p,g+E).normalize(),t[3].setComponents(n-o,c-h,d-p,g-E).normalize(),t[4].setComponents(n-a,c-l,d-f,g-v).normalize(),t[5].setComponents(n+a,c+l,d+f,g+v).normalize(),this},intersectsObject:function(){var e=new THREE.Vector3;return function(t){var i=t.matrixWorld,r=this.planes,o=-t.geometry.boundingSphere.radius*i.getMaxScaleOnAxis();e.getPositionFromMatrix(i);for(var a=0;6>a;a++){var n=r[a].distanceToPoint(e);if(o>n)return!1}return!0}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,o=0;6>o;o++){var a=t[o].distanceToPoint(i);if(r>a)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}}),THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.extend(THREE.Plane.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,r,o){var a=e.subVectors(o,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,i),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e),r=t||new THREE.Vector3;return r.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return 0>t&&i>0||0>i&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,i){var r=i||new THREE.Vector3,o=t.delta(e),a=this.normal.dot(o);if(0==a)return 0==this.distanceToPoint(t.start)?r.copy(t.start):void 0;var n=-(t.start.dot(this.normal)+this.constant)/a;return 0>n||n>1?void 0:r.copy(o).multiplyScalar(n).add(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,r){r=r||(new THREE.Matrix3).getInverse(i).transpose();var o=e.copy(this.normal).applyMatrix3(r),a=this.coplanarPoint(t);return a.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(o,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}}),THREE.Math={clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,r,o){return r+(e-t)*(o-r)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},THREE.Spline=function(e){function t(e,t,i,r,o,a,n){var s=.5*(i-e),h=.5*(r-t);return(2*(t-i)+s+h)*n+(-3*(t-i)-2*s-h)*a+s*o+t}this.points=e;var i,r,o,a,n,s,h,l,c,u=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;e.length>t;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,r=Math.floor(i),o=i-r,u[0]=0===r?r:r-1,u[1]=r,u[2]=r>this.points.length-2?this.points.length-1:r+1,u[3]=r>this.points.length-3?this.points.length-1:r+2,s=this.points[u[0]],h=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],a=o*o,n=o*a,p.x=t(s.x,h.x,l.x,c.x,o,a,n),p.y=t(s.y,h.y,l.y,c.y,o,a,n),p.z=t(s.z,h.z,l.z,c.z,o,a,n),p},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;i>e;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,o,a=0,n=0,s=0,h=new THREE.Vector3,l=new THREE.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),r=this.points.length*e,h.copy(this.points[0]),t=1;r>t;t++)i=t/r,o=this.getPoint(i),l.copy(o),u+=l.distanceTo(h),h.copy(o),a=(this.points.length-1)*i,n=Math.floor(a),n!=s&&(c[n]=u,s=n);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,i,r,o,a,n,s,h,l=[],c=new THREE.Vector3,u=this.getLength();for(l.push(c.copy(this.points[0]).clone()),t=1;this.points.length>t;t++){for(n=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*n/u.total),o=(t-1)/(this.points.length-1),a=t/(this.points.length-1),i=1;s-1>i;i++)r=o+i*(1/s)*(a-o),h=this.getPoint(r),l.push(c.copy(h).clone());l.push(c.copy(this.points[t]).clone())}this.points=l}},THREE.Triangle=function(e,t,i){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==i?i:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,i,r,o){var a=o||new THREE.Vector3;a.subVectors(r,i),e.subVectors(t,i),a.cross(e);var n=a.lengthSq();return n>0?a.multiplyScalar(1/Math.sqrt(n)):a.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(r,o,a,n,s){e.subVectors(n,o),t.subVectors(a,o),i.subVectors(r,o);var h=e.dot(e),l=e.dot(t),c=e.dot(i),u=t.dot(t),p=t.dot(i),f=h*u-l*l,d=s||new THREE.Vector3;if(0==f)return d.set(-2,-1,-1);var m=1/f,E=(u*c-l*p)*m,v=(h*p-l*c)*m;return d.set(1-E-v,v,E)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,i,r,o){var a=THREE.Triangle.barycoordFromPoint(t,i,r,o,e);return a.x>=0&&a.y>=0&&1>=a.x+a.y}}(),THREE.extend(THREE.Triangle.prototype,{constructor:THREE.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}}),THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.extend(THREE.Clock.prototype,{start:function(){this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}}),THREE.EventDispatcher=function(){var e={};this.addEventListener=function(t,i){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)},this.removeEventListener=function(t,i){var r=e[t].indexOf(i);-1!==r&&e[t].splice(r,1)},this.dispatchEvent=function(t){var i=e[t.type];if(void 0!==i){t.target=this;for(var r=0,o=i.length;o>r;r++)i[r].call(this,t)}}},function(e){e.Raycaster=function(t,i,r,o){this.ray=new e.Ray(t,i),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=r||0,this.far=o||1/0};var t=new e.Sphere,i=new e.Ray,r=new e.Plane,o=new e.Vector3,a=new e.Vector3,n=new e.Matrix4,s=function(e,t){return e.distance-t.distance},h=function(s,h,l){if(s instanceof e.Particle){a.getPositionFromMatrix(s.matrixWorld);var c=h.ray.distanceToPoint(a);if(c>s.scale.x)return l;l.push({distance:c,point:s.position,face:null,object:s})}else if(s instanceof e.Mesh){if(a.getPositionFromMatrix(s.matrixWorld),t.set(a,s.geometry.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),!h.ray.isIntersectionSphere(t))return l;var u,p,f,d,m=s.geometry,E=m.vertices,v=s.material instanceof e.MeshFaceMaterial,g=v===!0?s.material.materials:null,y=s.material.side,T=h.precision;s.matrixRotationWorld.extractRotation(s.matrixWorld),n.getInverse(s.matrixWorld),i.copy(h.ray).applyMatrix4(n);for(var R=0,x=m.faces.length;x>R;R++){var H=m.faces[R],w=v===!0?g[H.materialIndex]:s.material;if(void 0!==w){r.setFromNormalAndCoplanarPoint(H.normal,E[H.a]);var b=i.distanceToPlane(r);if(!(T>Math.abs(b)||0>b)){if(y=w.side,y!==e.DoubleSide){var M=i.direction.dot(r.normal);if(!(y===e.FrontSide?0>M:M>0))continue}if(!(h.near>b||b>h.far)){if(o=i.at(b,o),H instanceof e.Face3){if(u=E[H.a],p=E[H.b],f=E[H.c],!e.Triangle.containsPoint(o,u,p,f))continue}else{if(!(H instanceof e.Face4))throw Error("face type not supported");if(u=E[H.a],p=E[H.b],f=E[H.c],d=E[H.d],!e.Triangle.containsPoint(o,u,p,d)&&!e.Triangle.containsPoint(o,p,f,d))continue}l.push({distance:b,point:h.ray.at(b),face:H,faceIndex:R,object:s})}}}}}},l=function(e,t,i){for(var r=e.getDescendants(),o=0,a=r.length;a>o;o++)h(r[o],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),this.ray.direction.length()>0&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return t===!0&&l(e,this,i),h(e,this,i),i.sort(s),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],r=0,o=e.length;o>r;r++)h(e[r],this,i),t===!0&&l(e[r],this,i);return i.sort(s),i}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder=THREE.Object3D.defaultEulerOrder,this.scale=new THREE.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3
},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix);var t=(new THREE.Matrix4).extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.add(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(THREE.Object3D.__m1.getInverse(this.matrixWorld))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},add:function(e){if(e===this)return console.warn("THREE.Object3D.add: An object can't be added as a child of itself."),void 0;if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof THREE.Scene&&i.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getChildByName:function(e,t){for(var i=0,r=this.children.length;r>i;i++){var o=this.children[i];if(o.name===e)return o;if(t===!0&&(o=o.getChildByName(e,t),void 0!==o))return o}return void 0},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){void 0===e&&(e=new THREE.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof THREE.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled;for(var t=0;this.children.length>t;t++){var i=this.children[t];e.add(i.clone())}return e}},THREE.Object3D.__m1=new THREE.Matrix4,THREE.Object3D.defaultEulerOrder="XYZ",THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(l===R){var e=new THREE.RenderableObject;return T.push(e),R++,l++,e}return T[l++]}function t(){if(u===H){var e=new THREE.RenderableVertex;return x.push(e),H++,u++,e}return x[u++]}function i(){if(f===b){var e=new THREE.RenderableFace3;return w.push(e),b++,f++,e}return w[f++]}function r(){if(d===S){var e=new THREE.RenderableFace4;return M.push(e),S++,d++,e}return M[d++]}function o(){if(E===C){var e=new THREE.RenderableLine;return _.push(e),C++,E++,e}return _[E++]}function a(){if(g===P){var e=new THREE.RenderableParticle;return A.push(e),P++,g++,e}return A[g++]}function n(e,t){return t.z-e.z}function s(e,t){var i=0,r=1,o=e.z+e.w,a=t.z+t.w,n=-e.z+e.w,s=-t.z+t.w;return o>=0&&a>=0&&n>=0&&s>=0?!0:0>o&&0>a||0>n&&0>s?!1:(0>o?i=Math.max(i,o/(o-a)):0>a&&(r=Math.min(r,o/(o-a))),0>n?i=Math.max(i,n/(n-s)):0>s&&(r=Math.min(r,n/(n-s))),i>r?!1:(e.lerp(t,i),t.lerp(e,1-r),!0))}var h,l,c,u,p,f,d,m,E,v,g,y,T=[],R=0,x=[],H=0,w=[],b=0,M=[],S=0,_=[],C=0,A=[],P=0,D={objects:[],sprites:[],lights:[],elements:[]},L=new THREE.Vector3,z=new THREE.Vector4,F=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),V=new THREE.Box3,U=Array(3),N=Array(4),B=new THREE.Matrix4,I=new THREE.Matrix4,O=new THREE.Matrix4,k=new THREE.Matrix3,G=new THREE.Matrix3,j=new THREE.Vector3,W=new THREE.Frustum,X=new THREE.Vector4,Y=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),I.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(I)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),I.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(I)},this.pickingRay=function(e,t){e.z=-1;var i=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new THREE.Raycaster(e,i)};var q=function(t,i){l=0,D.objects.length=0,D.sprites.length=0,D.lights.length=0;var r=function(t){for(var i=0,o=t.children.length;o>i;i++){var a=t.children[i];a.visible!==!1&&(a instanceof THREE.Light?D.lights.push(a):a instanceof THREE.Mesh||a instanceof THREE.Line?(a.frustumCulled===!1||W.intersectsObject(a)===!0)&&(h=e(),h.object=a,null!==a.renderDepth?h.z=a.renderDepth:(L.getPositionFromMatrix(a.matrixWorld),L.applyProjection(I),h.z=L.z),D.objects.push(h)):a instanceof THREE.Sprite||a instanceof THREE.Particle?(h=e(),h.object=a,null!==a.renderDepth?h.z=a.renderDepth:(L.getPositionFromMatrix(a.matrixWorld),L.applyProjection(I),h.z=L.z),D.sprites.push(h)):(h=e(),h.object=a,null!==a.renderDepth?h.z=a.renderDepth:(L.getPositionFromMatrix(a.matrixWorld),L.applyProjection(I),h.z=L.z),D.objects.push(h)),r(a))}};return r(t),i===!0&&D.objects.sort(n),D};this.projectScene=function(e,h,l,T){var R,H,w,b,M,S,_,C,A,P,L,K,Z,Q,J,$,et,tt,it,rt,ot,at,nt,st,ht,lt,ct=!1;for(f=0,d=0,E=0,g=0,D.elements.length=0,e.updateMatrixWorld(),void 0===h.parent&&h.updateMatrixWorld(),B.copy(h.matrixWorldInverse.getInverse(h.matrixWorld)),I.multiplyMatrices(h.projectionMatrix,B),G.getInverse(B),G.transpose(),W.setFromMatrix(I),D=q(e,l),R=0,H=D.objects.length;H>R;R++)if(Z=D.objects[R].object,y=Z.matrixWorld,u=0,Z instanceof THREE.Mesh){for(Q=Z.geometry,J=Q.vertices,$=Q.faces,it=Q.faceVertexUvs,k.getInverse(y),k.transpose(),ht=Z.material instanceof THREE.MeshFaceMaterial,lt=ht===!0?Z.material:null,w=0,b=J.length;b>w;w++)c=t(),c.positionWorld.copy(J[w]).applyMatrix4(y),c.positionScreen.copy(c.positionWorld).applyMatrix4(I),c.positionScreen.x/=c.positionScreen.w,c.positionScreen.y/=c.positionScreen.w,c.positionScreen.z/=c.positionScreen.w,c.visible=!(-1>c.positionScreen.x||c.positionScreen.x>1||-1>c.positionScreen.y||c.positionScreen.y>1||-1>c.positionScreen.z||c.positionScreen.z>1);for(M=0,S=$.length;S>M;M++){et=$[M];var ut=ht===!0?lt.materials[et.materialIndex]:Z.material;if(void 0!==ut){var pt=ut.side;if(et instanceof THREE.Face3){if(ot=x[et.a],at=x[et.b],nt=x[et.c],U[0]=ot.positionScreen,U[1]=at.positionScreen,U[2]=nt.positionScreen,ot.visible!==!0&&at.visible!==!0&&nt.visible!==!0&&!F.isIntersectionBox(V.setFromPoints(U)))continue;if(ct=0>(nt.positionScreen.x-ot.positionScreen.x)*(at.positionScreen.y-ot.positionScreen.y)-(nt.positionScreen.y-ot.positionScreen.y)*(at.positionScreen.x-ot.positionScreen.x),pt!==THREE.DoubleSide&&ct!==(pt===THREE.FrontSide))continue;p=i(),p.v1.copy(ot),p.v2.copy(at),p.v3.copy(nt)}else if(et instanceof THREE.Face4){if(ot=x[et.a],at=x[et.b],nt=x[et.c],st=x[et.d],N[0]=ot.positionScreen,N[1]=at.positionScreen,N[2]=nt.positionScreen,N[3]=st.positionScreen,ot.visible!==!0&&at.visible!==!0&&nt.visible!==!0&&st.visible!==!0&&!F.isIntersectionBox(V.setFromPoints(N)))continue;if(ct=0>(st.positionScreen.x-ot.positionScreen.x)*(at.positionScreen.y-ot.positionScreen.y)-(st.positionScreen.y-ot.positionScreen.y)*(at.positionScreen.x-ot.positionScreen.x)||0>(at.positionScreen.x-nt.positionScreen.x)*(st.positionScreen.y-nt.positionScreen.y)-(at.positionScreen.y-nt.positionScreen.y)*(st.positionScreen.x-nt.positionScreen.x),pt!==THREE.DoubleSide&&ct!==(pt===THREE.FrontSide))continue;p=r(),p.v1.copy(ot),p.v2.copy(at),p.v3.copy(nt),p.v4.copy(st)}for(p.normalModel.copy(et.normal),ct!==!1||pt!==THREE.BackSide&&pt!==THREE.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(k).normalize(),p.normalModelView.copy(p.normalModel).applyMatrix3(G),p.centroidModel.copy(et.centroid).applyMatrix4(y),tt=et.vertexNormals,_=0,C=tt.length;C>_;_++){var ft=p.vertexNormalsModel[_];ft.copy(tt[_]),ct!==!1||pt!==THREE.BackSide&&pt!==THREE.DoubleSide||ft.negate(),ft.applyMatrix3(k).normalize();var dt=p.vertexNormalsModelView[_];dt.copy(ft).applyMatrix3(G)}for(p.vertexNormalsLength=tt.length,A=0,P=it.length;P>A;A++)if(rt=it[A][M],void 0!==rt)for(L=0,K=rt.length;K>L;L++)p.uvs[A][L]=rt[L];p.color=et.color,p.material=ut,j.copy(p.centroidModel).applyProjection(I),p.z=j.z,D.elements.push(p)}}}else if(Z instanceof THREE.Line){O.multiplyMatrices(I,y),J=Z.geometry.vertices,ot=t(),ot.positionScreen.copy(J[0]).applyMatrix4(O);var mt=Z.type===THREE.LinePieces?2:1;for(w=1,b=J.length;b>w;w++)ot=t(),ot.positionScreen.copy(J[w]).applyMatrix4(O),(w+1)%mt>0||(at=x[u-2],X.copy(ot.positionScreen),Y.copy(at.positionScreen),s(X,Y)===!0&&(X.multiplyScalar(1/X.w),Y.multiplyScalar(1/Y.w),m=o(),m.v1.positionScreen.copy(X),m.v2.positionScreen.copy(Y),m.z=Math.max(X.z,Y.z),m.material=Z.material,D.elements.push(m)))}for(R=0,H=D.sprites.length;H>R;R++)Z=D.sprites[R].object,y=Z.matrixWorld,Z instanceof THREE.Particle&&(z.set(y.elements[12],y.elements[13],y.elements[14],1),z.applyMatrix4(I),z.z/=z.w,z.z>0&&1>z.z&&(v=a(),v.object=Z,v.x=z.x/z.w,v.y=z.y/z.w,v.z=z.z,v.rotation=Z.rotation.z,v.scale.x=Z.scale.x*Math.abs(v.x-(z.x+h.projectionMatrix.elements[0])/(z.w+h.projectionMatrix.elements[12])),v.scale.y=Z.scale.y*Math.abs(v.y-(z.y+h.projectionMatrix.elements[5])/(z.w+h.projectionMatrix.elements[13])),v.material=Z.material,D.elements.push(v)));return T===!0&&D.elements.sort(n),D}},THREE.Face3=function(e,t,i,r,o,a){this.a=e,this.b=t,this.c=i,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,i,r,o,a,n){this.a=e,this.b=t,this.c=i,this.d=r,this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=a instanceof THREE.Color?a:new THREE.Color,this.vertexColors=a instanceof Array?a:[],this.vertexTangents=[],this.materialIndex=void 0!==n?n:0,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Geometry=function(){THREE.EventDispatcher.call(this),this.id=THREE.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getInverse(e).transpose(),i=0,r=this.vertices.length;r>i;i++){var o=this.vertices[i];o.applyMatrix4(e)}for(var i=0,r=this.faces.length;r>i;i++){var a=this.faces[i];a.normal.applyMatrix3(t).normalize();for(var n=0,s=a.vertexNormals.length;s>n;n++)a.vertexNormals[n].applyMatrix3(t).normalize();a.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i.centroid.set(0,0,0),i instanceof THREE.Face3?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof THREE.Face4&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,i=0,r=this.faces.length;r>i;i++){var o=this.faces[i],a=this.vertices[o.a],n=this.vertices[o.b],s=this.vertices[o.c];e.subVectors(s,n),t.subVectors(a,n),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,o,a,n;if(void 0===this.__tmpVertices){for(this.__tmpVertices=Array(this.vertices.length),n=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)n[t]=new THREE.Vector3;for(r=0,o=this.faces.length;o>r;r++)a=this.faces[r],a instanceof THREE.Face3?a.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:a instanceof THREE.Face4&&(a.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(n=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)n[t].set(0,0,0);if(e){var s,h,l,c,u=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3;for(r=0,o=this.faces.length;o>r;r++)a=this.faces[r],a instanceof THREE.Face3?(s=this.vertices[a.a],h=this.vertices[a.b],l=this.vertices[a.c],u.subVectors(l,h),p.subVectors(s,h),u.cross(p),n[a.a].add(u),n[a.b].add(u),n[a.c].add(u)):a instanceof THREE.Face4&&(s=this.vertices[a.a],h=this.vertices[a.b],l=this.vertices[a.c],c=this.vertices[a.d],f.subVectors(c,h),p.subVectors(s,h),f.cross(p),n[a.a].add(f),n[a.b].add(f),n[a.d].add(f),d.subVectors(c,l),m.subVectors(h,l),d.cross(m),n[a.b].add(d),n[a.c].add(d),n[a.d].add(d))}else for(r=0,o=this.faces.length;o>r;r++)a=this.faces[r],a instanceof THREE.Face3?(n[a.a].add(a.normal),n[a.b].add(a.normal),n[a.c].add(a.normal)):a instanceof THREE.Face4&&(n[a.a].add(a.normal),n[a.b].add(a.normal),n[a.c].add(a.normal),n[a.d].add(a.normal));for(t=0,i=this.vertices.length;i>t;t++)n[t].normalize();for(r=0,o=this.faces.length;o>r;r++)a=this.faces[r],a instanceof THREE.Face3?(a.vertexNormals[0].copy(n[a.a]),a.vertexNormals[1].copy(n[a.b]),a.vertexNormals[2].copy(n[a.c])):a instanceof THREE.Face4&&(a.vertexNormals[0].copy(n[a.a]),a.vertexNormals[1].copy(n[a.b]),a.vertexNormals[2].copy(n[a.c]),a.vertexNormals[3].copy(n[a.d]))},computeMorphNormals:function(){var e,t,i,r,o;for(i=0,r=this.faces.length;r>i;i++)for(o=this.faces[i],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;t>e;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var a=new THREE.Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var n,s,h=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;r>i;i++)o=this.faces[i],n=new THREE.Vector3,s=o instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},h.push(n),l.push(s)}var c=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var n,s;for(i=0,r=this.faces.length;r>i;i++)o=this.faces[i],n=c.faceNormals[i],s=c.vertexNormals[i],n.copy(o.normal),o instanceof THREE.Face3?(s.a.copy(o.vertexNormals[0]),s.b.copy(o.vertexNormals[1]),s.c.copy(o.vertexNormals[2])):(s.a.copy(o.vertexNormals[0]),s.b.copy(o.vertexNormals[1]),s.c.copy(o.vertexNormals[2]),s.d.copy(o.vertexNormals[3]))}for(i=0,r=this.faces.length;r>i;i++)o=this.faces[i],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function e(e,t,i,r,o,a,n){l=e.vertices[t],c=e.vertices[i],u=e.vertices[r],p=h[o],f=h[a],d=h[n],m=c.x-l.x,E=u.x-l.x,v=c.y-l.y,g=u.y-l.y,y=c.z-l.z,T=u.z-l.z,R=f.x-p.x,x=d.x-p.x,H=f.y-p.y,w=d.y-p.y,b=1/(R*w-x*H),P.set((w*m-H*E)*b,(w*v-H*g)*b,(w*y-H*T)*b),D.set((R*E-x*m)*b,(R*g-x*v)*b,(R*T-x*y)*b),C[t].add(P),C[i].add(P),C[r].add(P),A[t].add(D),A[i].add(D),A[r].add(D)}var t,i,r,o,a,n,s,h,l,c,u,p,f,d,m,E,v,g,y,T,R,x,H,w,b,M,S,_,C=[],A=[],P=new THREE.Vector3,D=new THREE.Vector3,L=new THREE.Vector3,z=new THREE.Vector3,F=new THREE.Vector3;for(r=0,o=this.vertices.length;o>r;r++)C[r]=new THREE.Vector3,A[r]=new THREE.Vector3;for(t=0,i=this.faces.length;i>t;t++)s=this.faces[t],h=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.d,0,1,3),e(this,s.b,s.c,s.d,1,2,3));var V=["a","b","c","d"];for(t=0,i=this.faces.length;i>t;t++)for(s=this.faces[t],a=0;s.vertexNormals.length>a;a++)F.copy(s.vertexNormals[a]),n=s[V[a]],M=C[n],L.copy(M),L.sub(F.multiplyScalar(F.dot(M))).normalize(),z.crossVectors(s.vertexNormals[a],M),S=z.dot(A[n]),_=0>S?-1:1,s.vertexTangents[a]=new THREE.Vector4(L.x,L.y,L.z,_);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;r>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e,t,i,r,o,a,n,s,h,l={},c=[],u=[],p=4,f=Math.pow(10,p);for(this.__tmpVertices=void 0,i=0,r=this.vertices.length;r>i;i++)e=this.vertices[i],t=[Math.round(e.x*f),Math.round(e.y*f),Math.round(e.z*f)].join("_"),void 0===l[t]?(l[t]=i,c.push(this.vertices[i]),u[i]=c.length-1):u[i]=u[l[t]];var d=[];for(i=0,r=this.faces.length;r>i;i++)if(o=this.faces[i],o instanceof THREE.Face3){o.a=u[o.a],o.b=u[o.b],o.c=u[o.c],a=[o.a,o.b,o.c];for(var m=-1,E=0;3>E;E++)if(a[E]==a[(E+1)%3]){m=E,d.push(i);break}}else if(o instanceof THREE.Face4){o.a=u[o.a],o.b=u[o.b],o.c=u[o.c],o.d=u[o.d],a=[o.a,o.b,o.c,o.d];for(var m=-1,E=0;4>E;E++)a[E]==a[(E+1)%4]&&(m>=0&&d.push(i),m=E);if(m>=0){a.splice(m,1);var v=new THREE.Face3(a[0],a[1],a[2],o.normal,o.color,o.materialIndex);for(n=0,s=this.faceVertexUvs.length;s>n;n++)h=this.faceVertexUvs[n][i],h&&h.splice(m,1);o.vertexNormals&&o.vertexNormals.length>0&&(v.vertexNormals=o.vertexNormals,v.vertexNormals.splice(m,1)),o.vertexColors&&o.vertexColors.length>0&&(v.vertexColors=o.vertexColors,v.vertexColors.splice(m,1)),this.faces[i]=v}}for(i=d.length-1;i>=0;i--)for(this.faces.splice(i,1),n=0,s=this.faceVertexUvs.length;s>n;n++)this.faceVertexUvs[n].splice(i,1);var g=this.vertices.length-c.length;return this.vertices=c,g},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,i=0,r=t.length;r>i;i++)e.vertices.push(t[i].clone());for(var o=this.faces,i=0,r=o.length;r>i;i++)e.faces.push(o[i].clone());for(var a=this.faceVertexUvs[0],i=0,r=a.length;r>i;i++){for(var n=a[i],s=[],h=0,l=n.length;l>h;h++)s.push(new THREE.Vector2(n[h].x,n[h].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){THREE.EventDispatcher.call(this),this.id=THREE.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(e){var t,i;if(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i){var r=new THREE.Matrix3;r.getInverse(e).transpose(),r.multiplyVector3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t,i,r,o=this.boundingBox;e.length>=3&&(o.min.x=o.max.x=e[0],o.min.y=o.max.y=e[1],o.min.z=o.max.z=e[2]);for(var a=3,n=e.length;n>a;a+=3)t=e[a],i=e[a+1],r=e[a+2],o.min.x>t?o.min.x=t:t>o.max.x&&(o.max.x=t),o.min.y>i?o.min.y=i:i>o.max.y&&(o.max.y=i),o.min.z>r?o.min.z=r:r>o.max.z&&(o.max.z=r)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array;if(e){for(var t,i,r,o,a=0,n=0,s=e.length;s>n;n+=3)i=e[n],r=e[n+1],o=e[n+2],t=i*i+r*r+o*o,t>a&&(a=t);this.boundingSphere.radius=Math.sqrt(a)}},computeVertexNormals:function(){if(this.attributes.position){var e,t,i,r,o=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(o),numItems:o};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var a,n,s,h,l,c,u=this.attributes.position.array,p=this.attributes.normal.array,f=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,E=new THREE.Vector3,v=new THREE.Vector3;if(this.attributes.index){var g=this.attributes.index.array,y=this.offsets;for(i=0,r=y.length;r>i;++i){var T=y[i].start,R=y[i].count,x=y[i].index;for(e=T,t=T+R;t>e;e+=3)a=x+g[e],n=x+g[e+1],s=x+g[e+2],h=u[3*a],l=u[3*a+1],c=u[3*a+2],f.set(h,l,c),h=u[3*n],l=u[3*n+1],c=u[3*n+2],d.set(h,l,c),h=u[3*s],l=u[3*s+1],c=u[3*s+2],m.set(h,l,c),E.subVectors(m,d),v.subVectors(f,d),E.cross(v),p[3*a]+=E.x,p[3*a+1]+=E.y,p[3*a+2]+=E.z,p[3*n]+=E.x,p[3*n+1]+=E.y,p[3*n+2]+=E.z,p[3*s]+=E.x,p[3*s+1]+=E.y,p[3*s+2]+=E.z}}else for(e=0,t=u.length;t>e;e+=9)h=u[e],l=u[e+1],c=u[e+2],f.set(h,l,c),h=u[e+3],l=u[e+4],c=u[e+5],d.set(h,l,c),h=u[e+6],l=u[e+7],c=u[e+8],m.set(h,l,c),E.subVectors(m,d),v.subVectors(f,d),E.cross(v),p[e]=E.x,p[e+1]=E.y,p[e+2]=E.z,p[e+3]=E.x,p[e+4]=E.y,p[e+5]=E.z,p[e+6]=E.x,p[e+7]=E.y,p[e+8]=E.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,r,o=this.attributes.normal.array,a=0,n=o.length;n>a;a+=3)e=o[a],t=o[a+1],i=o[a+2],r=1/Math.sqrt(e*e+t*t+i*i),o[a]*=r,o[a+1]*=r,o[a+2]*=r},computeTangents:function(){function e(e,t,i){p=r[3*e],f=r[3*e+1],d=r[3*e+2],m=r[3*t],E=r[3*t+1],v=r[3*t+2],g=r[3*i],y=r[3*i+1],T=r[3*i+2],R=a[2*e],x=a[2*e+1],H=a[2*t],w=a[2*t+1],b=a[2*i],M=a[2*i+1],S=m-p,_=g-p,C=E-f,A=y-f,P=v-d,D=T-d,L=H-R,z=b-R,F=w-x,V=M-x,U=1/(L*V-z*F),W.set((V*S-F*_)*U,(V*C-F*A)*U,(V*P-F*D)*U),X.set((L*_-z*S)*U,(L*A-z*C)*U,(L*D-z*P)*U),l[e].add(W),l[t].add(W),l[i].add(W),c[e].add(X),c[t].add(X),c[i].add(X)}function t(e){it.x=o[3*e],it.y=o[3*e+1],it.z=o[3*e+2],rt.copy(it),J=l[e],et.copy(J),et.sub(it.multiplyScalar(it.dot(J))).normalize(),tt.crossVectors(rt,J),$=tt.dot(c[e]),Q=0>$?-1:1,h[4*e]=et.x,h[4*e+1]=et.y,h[4*e+2]=et.z,h[4*e+3]=Q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()"),void 0;var i=this.attributes.index.array,r=this.attributes.position.array,o=this.attributes.normal.array,a=this.attributes.uv.array,n=r.length/3;if(void 0===this.attributes.tangent){var s=4*n;this.attributes.tangent={itemSize:4,array:new Float32Array(s),numItems:s}}for(var h=this.attributes.tangent.array,l=[],c=[],u=0;n>u;u++)l[u]=new THREE.Vector3,c[u]=new THREE.Vector3;var p,f,d,m,E,v,g,y,T,R,x,H,w,b,M,S,_,C,A,P,D,L,z,F,V,U,N,B,I,O,k,G,j,W=new THREE.Vector3,X=new THREE.Vector3,Y=this.offsets;for(I=0,O=Y.length;O>I;++I){var q=Y[I].start,K=Y[I].count,Z=Y[I].index;for(N=q,B=q+K;B>N;N+=3)k=Z+i[N],G=Z+i[N+1],j=Z+i[N+2],e(k,G,j)}var Q,J,$,et=new THREE.Vector3,tt=new THREE.Vector3,it=new THREE.Vector3,rt=new THREE.Vector3;for(I=0,O=Y.length;O>I;++I){var q=Y[I].start,K=Y[I].count,Z=Y[I].index;for(N=q,B=q+K;B>N;N+=3)k=Z+i[N],G=Z+i[N+1],j=Z+i[N+2],t(k),t(G),t(j)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate===!0&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},THREE.OrthographicCamera=function(e,t,i,r,o,a){THREE.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,i,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,o,a){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=o,this.height=a,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,i=-t,r=e*i,o=e*t,a=Math.abs(o-r),n=Math.abs(t-i);this.projectionMatrix.makeFrustum(r+this.x*a/this.fullWidth,r+(this.x+this.width)*a/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight=function(e,t,i){THREE.Light.call(this,e),this.groundColor=new THREE.Color(t),this.position=new THREE.Vector3(0,100,0),this.intensity=void 0!==i?i:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight=function(e,t,i,r,o){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/2,this.exponent=void 0!==o?o:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.Loader=function(e){this.showStatus=e,this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(1>t.length?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var i=[],r=0;e.length>r;++r)i[r]=THREE.Loader.prototype.createMaterial(e[r],t);return i},needsTangents:function(e){for(var t=0,i=e.length;i>t;t++){var r=e[t];if(r instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function i(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function o(e,t){var o=new Image;o.onload=function(){if(i(this.width)&&i(this.height))e.image=this;
else{var t=r(this.width),o=r(this.height);e.image.width=t,e.image.height=o,e.image.getContext("2d").drawImage(this,0,0,t,o)}e.needsUpdate=!0},o.crossOrigin=s.crossOrigin,o.src=t}function a(e,i,r,a,n,s,h){var l=/\.dds$/i.test(r),c=t+"/"+r;if(l){var u=THREE.ImageUtils.loadCompressedTexture(c);e[i]=u}else{var u=document.createElement("canvas");e[i]=new THREE.Texture(u)}if(e[i].sourceFile=r,a&&(e[i].repeat.set(a[0],a[1]),1!==a[0]&&(e[i].wrapS=THREE.RepeatWrapping),1!==a[1]&&(e[i].wrapT=THREE.RepeatWrapping)),n&&e[i].offset.set(n[0],n[1]),s){var p={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==p[s[0]]&&(e[i].wrapS=p[s[0]]),void 0!==p[s[1]]&&(e[i].wrapT=p[s[1]])}h&&(e[i].anisotropy=h),l||o(e[i],c)}function n(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,h="MeshLambertMaterial",l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var c=e.shading.toLowerCase();"phong"===c?h="MeshPhongMaterial":"basic"===c&&(h="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==THREE[e.blending]&&(l.blending=THREE[e.blending]),(void 0!==e.transparent||1>e.opacity)&&(l.transparent=e.transparent),void 0!==e.depthTest&&(l.depthTest=e.depthTest),void 0!==e.depthWrite&&(l.depthWrite=e.depthWrite),void 0!==e.visible&&(l.visible=e.visible),void 0!==e.flipSided&&(l.side=THREE.BackSide),void 0!==e.doubleSided&&(l.side=THREE.DoubleSide),void 0!==e.wireframe&&(l.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?l.vertexColors=THREE.FaceColors:e.vertexColors&&(l.vertexColors=THREE.VertexColors)),e.colorDiffuse?l.color=n(e.colorDiffuse):e.DbgColor&&(l.color=e.DbgColor),e.colorSpecular&&(l.specular=n(e.colorSpecular)),e.colorAmbient&&(l.ambient=n(e.colorAmbient)),e.transparency&&(l.opacity=e.transparency),e.specularCoef&&(l.shininess=e.specularCoef),e.mapDiffuse&&t&&a(l,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&a(l,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&a(l,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&a(l,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&a(l,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(l.bumpScale=e.mapBumpScale),e.mapNormal){var u=THREE.ShaderLib.normalmap,p=THREE.UniformsUtils.clone(u.uniforms);p.tNormal.value=l.normalMap,e.mapNormalFactor&&p.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),l.map&&(p.tDiffuse.value=l.map,p.enableDiffuse.value=!0),l.specularMap&&(p.tSpecular.value=l.specularMap,p.enableSpecular.value=!0),l.lightMap&&(p.tAO.value=l.lightMap,p.enableAO.value=!0),p.uDiffuseColor.value.setHex(l.color),p.uSpecularColor.value.setHex(l.specular),p.uAmbientColor.value.setHex(l.ambient),p.uShininess.value=l.shininess,void 0!==l.opacity&&(p.uOpacity.value=l.opacity);var f={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:p,lights:!0,fog:!0},d=new THREE.ShaderMaterial(f);l.transparent&&(d.transparent=!0)}else var d=new THREE[h](l);return void 0!==e.DbgName&&(d.name=e.DbgName),d}},THREE.ImageLoader=function(){THREE.EventDispatcher.call(this),this.crossOrigin=null},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t){var i=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.src=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,o){var a=new XMLHttpRequest,n=0;a.onreadystatechange=function(){if(a.readyState===a.DONE)if(200===a.status||0===a.status){if(a.responseText){var s=JSON.parse(a.responseText);e.createModel(s,i,r)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+a.status+"]");else a.readyState===a.LOADING?o&&(0===n&&(n=a.getResponseHeader("Content-Length")),o({total:n,loaded:a.responseText.length})):a.readyState===a.HEADERS_RECEIVED&&(n=a.getResponseHeader("Content-Length"))},a.open("GET",t,!0),a.withCredentials=this.withCredentials,a.send(null)},THREE.JSONLoader.prototype.createModel=function(e,t,i){function r(t){function i(e,t){return e&1<<t}var r,o,a,s,h,l,c,u,p,f,d,m,E,v,g,y,T,R,x,H,w,b,M,S,_,C,A,P=e.faces,D=e.vertices,L=e.normals,z=e.colors,F=0;for(r=0;e.uvs.length>r;r++)e.uvs[r].length&&F++;for(r=0;F>r;r++)n.faceUvs[r]=[],n.faceVertexUvs[r]=[];for(s=0,h=D.length;h>s;)H=new THREE.Vector3,H.x=D[s++]*t,H.y=D[s++]*t,H.z=D[s++]*t,n.vertices.push(H);for(s=0,h=P.length;h>s;){if(d=P[s++],m=i(d,0),E=i(d,1),v=i(d,2),g=i(d,3),y=i(d,4),T=i(d,5),R=i(d,6),x=i(d,7),m?(w=new THREE.Face4,w.a=P[s++],w.b=P[s++],w.c=P[s++],w.d=P[s++],l=4):(w=new THREE.Face3,w.a=P[s++],w.b=P[s++],w.c=P[s++],l=3),E&&(f=P[s++],w.materialIndex=f),a=n.faces.length,v)for(r=0;F>r;r++)S=e.uvs[r],p=P[s++],C=S[2*p],A=S[2*p+1],n.faceUvs[r][a]=new THREE.Vector2(C,A);if(g)for(r=0;F>r;r++){for(S=e.uvs[r],_=[],o=0;l>o;o++)p=P[s++],C=S[2*p],A=S[2*p+1],_[o]=new THREE.Vector2(C,A);n.faceVertexUvs[r][a]=_}if(y&&(u=3*P[s++],M=new THREE.Vector3,M.x=L[u++],M.y=L[u++],M.z=L[u],w.normal=M),T)for(r=0;l>r;r++)u=3*P[s++],M=new THREE.Vector3,M.x=L[u++],M.y=L[u++],M.z=L[u],w.vertexNormals.push(M);if(R&&(c=P[s++],b=new THREE.Color(z[c]),w.color=b),x)for(r=0;l>r;r++)c=P[s++],b=new THREE.Color(z[c]),w.vertexColors.push(b);n.faces.push(w)}}function o(){var t,i,r,o,a,s,h,l,c,u;if(e.skinWeights)for(t=0,i=e.skinWeights.length;i>t;t+=2)r=e.skinWeights[t],o=e.skinWeights[t+1],a=0,s=0,n.skinWeights.push(new THREE.Vector4(r,o,a,s));if(e.skinIndices)for(t=0,i=e.skinIndices.length;i>t;t+=2)h=e.skinIndices[t],l=e.skinIndices[t+1],c=0,u=0,n.skinIndices.push(new THREE.Vector4(h,l,c,u));n.bones=e.bones,n.animation=e.animation}function a(t){if(void 0!==e.morphTargets){var i,r,o,a,s,h;for(i=0,r=e.morphTargets.length;r>i;i++)for(n.morphTargets[i]={},n.morphTargets[i].name=e.morphTargets[i].name,n.morphTargets[i].vertices=[],s=n.morphTargets[i].vertices,h=e.morphTargets[i].vertices,o=0,a=h.length;a>o;o+=3){var l=new THREE.Vector3;l.x=h[o]*t,l.y=h[o+1]*t,l.z=h[o+2]*t,s.push(l)}}if(void 0!==e.morphColors){var i,r,c,u,p,f,d;for(i=0,r=e.morphColors.length;r>i;i++)for(n.morphColors[i]={},n.morphColors[i].name=e.morphColors[i].name,n.morphColors[i].colors=[],p=n.morphColors[i].colors,f=e.morphColors[i].colors,c=0,u=f.length;u>c;c+=3)d=new THREE.Color(16755200),d.setRGB(f[c],f[c+1],f[c+2]),p.push(d)}}var n=new THREE.Geometry,s=void 0!==e.scale?1/e.scale:1;r(s),o(),a(s),n.computeCentroids(),n.computeFaceNormals();var h=this.initMaterials(e.materials,i);this.needsTangents(h)&&n.computeTangents(),t(n,h)},THREE.LoadingMonitor=function(){THREE.EventDispatcher.call(this);var e=this,t=0,i=0,r=function(){t++,e.dispatchEvent({type:"progress",loaded:t,total:i}),t===i&&e.dispatchEvent({type:"load"})};this.add=function(e){i++,e.addEventListener("load",r,!1)}},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var i=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var o=JSON.parse(r.responseText);i.parse(o,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.send(null)},THREE.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.parse=function(e,t,i){function r(e,t){return"relativeToHTML"==t?e:_+"/"+e}function o(){a(M.scene,A.objects)}function a(e,t){var i,o,n,s,h,c;for(var u in t)if(void 0===M.objects[u]){var p=t[u],E=null;if(p.type&&p.type in S.hierarchyHandlerMap){if(void 0===p.loading){var v={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,properties:1,skin:1,morph:1,mirroredLoop:1,duration:1},g={};for(var x in p)x in v||(g[x]=p[x]);d=M.materials[p.material],p.loading=!0;var H=S.hierarchyHandlerMap[p.type].loaderObject;H.options?H.load(r(p.url,A.urlBaseType),l(u,e,d,p)):H.load(r(p.url,A.urlBaseType),l(u,e,d,p),g)}}else if(void 0!==p.geometry){if(f=M.geometries[p.geometry]){var w=!1;if(d=M.materials[p.material],w=d instanceof THREE.ShaderMaterial,n=p.position,s=p.rotation,h=p.scale,i=p.matrix,c=p.quaternion,p.material||(d=new THREE.MeshFaceMaterial(M.face_materials[p.geometry])),d instanceof THREE.MeshFaceMaterial&&0===d.materials.length&&(d=new THREE.MeshFaceMaterial(M.face_materials[p.geometry])),d instanceof THREE.MeshFaceMaterial)for(var b=0;d.materials.length>b;b++)w=w||d.materials[b]instanceof THREE.ShaderMaterial;w&&f.computeTangents(),p.skin?E=new THREE.SkinnedMesh(f,d):p.morph?(E=new THREE.MorphAnimMesh(f,d),void 0!==p.duration&&(E.duration=p.duration),void 0!==p.time&&(E.time=p.time),void 0!==p.mirroredLoop&&(E.mirroredLoop=p.mirroredLoop),d.morphNormals&&f.computeMorphNormals()):E=new THREE.Mesh(f,d),E.name=u,i?(E.matrixAutoUpdate=!1,E.matrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])):(E.position.set(n[0],n[1],n[2]),c?(E.quaternion.set(c[0],c[1],c[2],c[3]),E.useQuaternion=!0):E.rotation.set(s[0],s[1],s[2]),E.scale.set(h[0],h[1],h[2])),E.visible=p.visible,E.castShadow=p.castShadow,E.receiveShadow=p.receiveShadow,e.add(E),M.objects[u]=E}}else"DirectionalLight"===p.type||"PointLight"===p.type||"AmbientLight"===p.type?(T=void 0!==p.color?p.color:16777215,R=void 0!==p.intensity?p.intensity:1,"DirectionalLight"===p.type?(n=p.direction,y=new THREE.DirectionalLight(T,R),y.position.set(n[0],n[1],n[2]),p.target&&(C.push({object:y,targetName:p.target}),y.target=null)):"PointLight"===p.type?(n=p.position,o=p.distance,y=new THREE.PointLight(T,R,o),y.position.set(n[0],n[1],n[2])):"AmbientLight"===p.type&&(y=new THREE.AmbientLight(T)),e.add(y),y.name=u,M.lights[u]=y,M.objects[u]=y):"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?("PerspectiveCamera"===p.type?m=new THREE.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(m=new THREE.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),n=p.position,m.position.set(n[0],n[1],n[2]),e.add(m),m.name=u,M.cameras[u]=m,M.objects[u]=m):(n=p.position,s=p.rotation,h=p.scale,c=p.quaternion,E=new THREE.Object3D,E.name=u,E.position.set(n[0],n[1],n[2]),c?(E.quaternion.set(c[0],c[1],c[2],c[3]),E.useQuaternion=!0):E.rotation.set(s[0],s[1],s[2]),E.scale.set(h[0],h[1],h[2]),E.visible=void 0!==p.visible?p.visible:!1,e.add(E),M.objects[u]=E,M.empties[u]=E);if(E){if(void 0!==p.properties)for(var _ in p.properties){var P=p.properties[_];E.properties[_]=P}if(void 0!==p.groups)for(var b=0;p.groups.length>b;b++){var D=p.groups[b];void 0===M.groups[D]&&(M.groups[D]=[]),M.groups[D].push(u)}void 0!==p.children&&a(E,p.children)}}}function n(e,t,i){M.geometries[i]=e,M.face_materials[i]=t,o()}function s(e,t,i,r,a){var n=a.position,s=a.rotation,h=a.quaternion,l=a.scale;e.position.set(n[0],n[1],n[2]),h?(e.quaternion.set(h[0],h[1],h[2],h[3]),e.useQuaternion=!0):e.rotation.set(s[0],s[1],s[2]),e.scale.set(l[0],l[1],l[2]),r&&e.traverse(function(e){e.material=r});var c=void 0!==a.visible?a.visible:!0;e.traverse(function(e){e.visible=c}),i.add(e),e.name=t,M.objects[t]=e,o()}function h(e){return function(t,i){n(t,i,e),x-=1,S.onLoadComplete(),u()}}function l(e,t,i,r){return function(o){var a;a=o.content?o.content:o.dae?o.scene:o,s(a,e,t,i,r),x-=1,S.onLoadComplete(),u()}}function c(e){return function(t,i){M.geometries[e]=t,M.face_materials[e]=i}}function u(){var e={totalModels:w,totalTextures:b,loadedModels:w-x,loadedTextures:b-H};S.callbackProgress(e,M),S.onLoadProgress(),0===x&&0===H&&(p(),t(M))}function p(){for(var e=0;C.length>e;e++){var t=C[e],i=M.objects[t.targetName];i?t.object.target=i:(t.object.target=new THREE.Object3D,M.scene.add(t.object.target)),t.object.target.properties.targetInverse=t.object}}var f,d,m,E,v,g,y,T,R,x,H,w,b,M,S=this,_=THREE.Loader.prototype.extractUrlBase(i),C=[],A=e;for(var P in this.geometryHandlerMap){var D=this.geometryHandlerMap[P].loaderClass;this.geometryHandlerMap[P].loaderObject=new D}for(var P in this.hierarchyHandlerMap){var D=this.hierarchyHandlerMap[P].loaderClass;this.hierarchyHandlerMap[P].loaderObject=new D}if(x=0,H=0,M={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},A.transform){var L=A.transform.position,z=A.transform.rotation,F=A.transform.scale;L&&M.scene.position.set(L[0],L[1],L[2]),z&&M.scene.rotation.set(z[0],z[1],z[2]),F&&M.scene.scale.set(F[0],F[1],F[2]),(L||z||F)&&(M.scene.updateMatrix(),M.scene.updateMatrixWorld())}var V,U,N=function(e){H-=e,u(),S.onLoadComplete()},B=function(e){return function(){N(e)}};for(V in A.fogs)U=A.fogs[V],"linear"===U.type?E=new THREE.Fog(0,U.near,U.far):"exp2"===U.type&&(E=new THREE.FogExp2(0,U.density)),g=U.color,E.color.setRGB(g[0],g[1],g[2]),M.fogs[V]=E;var I,O;for(I in A.geometries)O=A.geometries[I],O.type in this.geometryHandlerMap&&(x+=1,S.onLoadStart());var k,G;for(k in A.objects)G=A.objects[k],G.type&&G.type in this.hierarchyHandlerMap&&(x+=1,S.onLoadStart());w=x;for(I in A.geometries)if(O=A.geometries[I],"cube"===O.type)f=new THREE.CubeGeometry(O.width,O.height,O.depth,O.widthSegments,O.heightSegments,O.depthSegments),M.geometries[I]=f;else if("plane"===O.type)f=new THREE.PlaneGeometry(O.width,O.height,O.widthSegments,O.heightSegments),M.geometries[I]=f;else if("sphere"===O.type)f=new THREE.SphereGeometry(O.radius,O.widthSegments,O.heightSegments),M.geometries[I]=f;else if("cylinder"===O.type)f=new THREE.CylinderGeometry(O.topRad,O.botRad,O.height,O.radSegs,O.heightSegs),M.geometries[I]=f;else if("torus"===O.type)f=new THREE.TorusGeometry(O.radius,O.tube,O.segmentsR,O.segmentsT),M.geometries[I]=f;else if("icosahedron"===O.type)f=new THREE.IcosahedronGeometry(O.radius,O.subdivisions),M.geometries[I]=f;else if(O.type in this.geometryHandlerMap){var j={};for(var W in O)"type"!==W&&"url"!==W&&(j[W]=O[W]);var X=this.geometryHandlerMap[O.type].loaderObject;X.load(r(O.url,A.urlBaseType),h(I),j)}else if("embedded"===O.type){var Y=A.embeds[O.id],q="";if(Y.metadata=A.metadata,Y){var K=this.geometryHandlerMap.ascii.loaderObject;K.createModel(Y,c(I),q)}}var Z,Q;for(Z in A.textures)if(Q=A.textures[Z],Q.url instanceof Array){H+=Q.url.length;for(var J=0;Q.url.length>J;J++)S.onLoadStart()}else H+=1,S.onLoadStart();b=H;for(Z in A.textures){if(Q=A.textures[Z],void 0!==Q.mapping&&void 0!==THREE[Q.mapping]&&(Q.mapping=new THREE[Q.mapping]),Q.url instanceof Array){for(var $=Q.url.length,et=[],tt=0;$>tt;tt++)et[tt]=r(Q.url[tt],A.urlBaseType);var it=/\.dds$/i.test(et[0]);v=it?THREE.ImageUtils.loadCompressedTextureCube(et,Q.mapping,B($)):THREE.ImageUtils.loadTextureCube(et,Q.mapping,B($))}else{var it=/\.dds$/i.test(Q.url),rt=r(Q.url,A.urlBaseType),ot=B(1);if(v=it?THREE.ImageUtils.loadCompressedTexture(rt,Q.mapping,ot):THREE.ImageUtils.loadTexture(rt,Q.mapping,ot),void 0!==THREE[Q.minFilter]&&(v.minFilter=THREE[Q.minFilter]),void 0!==THREE[Q.magFilter]&&(v.magFilter=THREE[Q.magFilter]),Q.anisotropy&&(v.anisotropy=Q.anisotropy),Q.repeat&&(v.repeat.set(Q.repeat[0],Q.repeat[1]),1!==Q.repeat[0]&&(v.wrapS=THREE.RepeatWrapping),1!==Q.repeat[1]&&(v.wrapT=THREE.RepeatWrapping)),Q.offset&&v.offset.set(Q.offset[0],Q.offset[1]),Q.wrap){var at={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==at[Q.wrap[0]]&&(v.wrapS=at[Q.wrap[0]]),void 0!==at[Q.wrap[1]]&&(v.wrapT=at[Q.wrap[1]])}}M.textures[Z]=v}var nt,st,ht;for(nt in A.materials){st=A.materials[nt];for(ht in st.parameters)if("envMap"===ht||"map"===ht||"lightMap"===ht||"bumpMap"===ht)st.parameters[ht]=M.textures[st.parameters[ht]];else if("shading"===ht)st.parameters[ht]="flat"===st.parameters[ht]?THREE.FlatShading:THREE.SmoothShading;else if("side"===ht)st.parameters[ht]="double"==st.parameters[ht]?THREE.DoubleSide:"back"==st.parameters[ht]?THREE.BackSide:THREE.FrontSide;else if("blending"===ht)st.parameters[ht]=st.parameters[ht]in THREE?THREE[st.parameters[ht]]:THREE.NormalBlending;else if("combine"===ht)st.parameters[ht]=st.parameters[ht]in THREE?THREE[st.parameters[ht]]:THREE.MultiplyOperation;else if("vertexColors"===ht)"face"==st.parameters[ht]?st.parameters[ht]=THREE.FaceColors:st.parameters[ht]&&(st.parameters[ht]=THREE.VertexColors);else if("wrapRGB"===ht){var lt=st.parameters[ht];st.parameters[ht]=new THREE.Vector3(lt[0],lt[1],lt[2])}if(void 0!==st.parameters.opacity&&1>st.parameters.opacity&&(st.parameters.transparent=!0),st.parameters.normalMap){var ct=THREE.ShaderLib.normalmap,ut=THREE.UniformsUtils.clone(ct.uniforms),pt=st.parameters.color,ft=st.parameters.specular,dt=st.parameters.ambient,mt=st.parameters.shininess;ut.tNormal.value=M.textures[st.parameters.normalMap],st.parameters.normalScale&&ut.uNormalScale.value.set(st.parameters.normalScale[0],st.parameters.normalScale[1]),st.parameters.map&&(ut.tDiffuse.value=st.parameters.map,ut.enableDiffuse.value=!0),st.parameters.envMap&&(ut.tCube.value=st.parameters.envMap,ut.enableReflection.value=!0,ut.uReflectivity.value=st.parameters.reflectivity),st.parameters.lightMap&&(ut.tAO.value=st.parameters.lightMap,ut.enableAO.value=!0),st.parameters.specularMap&&(ut.tSpecular.value=M.textures[st.parameters.specularMap],ut.enableSpecular.value=!0),st.parameters.displacementMap&&(ut.tDisplacement.value=M.textures[st.parameters.displacementMap],ut.enableDisplacement.value=!0,ut.uDisplacementBias.value=st.parameters.displacementBias,ut.uDisplacementScale.value=st.parameters.displacementScale),ut.uDiffuseColor.value.setHex(pt),ut.uSpecularColor.value.setHex(ft),ut.uAmbientColor.value.setHex(dt),ut.uShininess.value=mt,st.parameters.opacity&&(ut.uOpacity.value=st.parameters.opacity);var Et={fragmentShader:ct.fragmentShader,vertexShader:ct.vertexShader,uniforms:ut,lights:!0,fog:!0};d=new THREE.ShaderMaterial(Et)}else d=new THREE[st.type](st.parameters);M.materials[nt]=d}for(nt in A.materials)if(st=A.materials[nt],st.parameters.materials){for(var vt=[],tt=0;st.parameters.materials.length>tt;tt++){var gt=st.parameters.materials[tt];vt.push(M.materials[gt])}M.materials[nt].materials=vt}o(),M.cameras&&A.defaults.camera&&(M.currentCamera=M.cameras[A.defaults.camera]),M.fogs&&A.defaults.fog&&(M.scene.fog=M.fogs[A.defaults.fog]),S.callbackSync(M),u()},THREE.TextureLoader=function(){THREE.EventDispatcher.call(this),this.crossOrigin=null},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e){var t=this,i=new Image;i.addEventListener("load",function(){var e=new THREE.Texture(i);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(i.crossOrigin=t.crossOrigin),i.src=e}},THREE.Material=function(){THREE.EventDispatcher.call(this),this.id=THREE.MaterialIdCount++,this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},THREE.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var r=this[t];r instanceof THREE.Color&&i instanceof THREE.Color?r.copy(i):r instanceof THREE.Color?r.set(i):r instanceof THREE.Vector3&&i instanceof THREE.Vector3?r.copy(i):this[t]=i}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},THREE.Material.prototype.clone=function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},THREE.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleBasicMaterial.prototype.clone=function(){var e=new THREE.ParticleBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleCanvasMaterial.prototype.clone=function(){var e=new THREE.ParticleCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=new THREE.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=THREE.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Texture=function(e,t,i,r,o,a,n,s,h){THREE.EventDispatcher.call(this),this.id=THREE.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:THREE.LinearFilter,this.minFilter=void 0!==a?a:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==n?n:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null
},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,i,r,o,a,n,s,h,l,c){THREE.Texture.call(this,null,a,n,s,h,l,r,o,c),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,i,r,o,a,n,s,h,l,c){THREE.Texture.call(this,null,a,n,s,h,l,r,o,c),this.image={data:e,width:t,height:i}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=Object.create(THREE.Object3D.prototype),THREE.Particle.prototype.clone=function(e){return void 0===e&&(e=new THREE.Particle(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),void 0!==this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,r=this.children.length;for(i=0;r>i;i++)this.children[i].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,i){THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0!==i?i:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var r,o,a,n,s,h;if(this.geometry&&void 0!==this.geometry.bones){for(r=0;this.geometry.bones.length>r;r++)a=this.geometry.bones[r],n=a.pos,s=a.rotq,h=a.scl,o=this.addBone(),o.name=a.name,o.position.set(n[0],n[1],n[2]),o.quaternion.set(s[0],s[1],s[2],s[3]),o.useQuaternion=!0,void 0!==h?o.scale.set(h[0],h[1],h[2]):o.scale.set(1,1,1);for(r=0;this.bones.length>r;r++)a=this.geometry.bones[r],o=this.bones[r],-1===a.parent?this.add(o):this.bones[a.parent].add(o);var l=this.bones.length;if(this.useVertexTexture){var c;c=l>256?64:l>64?32:l>16?16:8,this.boneTextureWidth=c,this.boneTextureHeight=c,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*l);this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++){var r=this.children[t];r instanceof THREE.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var o=0,a=this.bones.length;a>o;o++){var n=new THREE.Matrix4;n.getInverse(this.bones[o].skinMatrix),this.boneInverses.push(n)}}for(var o=0,a=this.bones.length;a>o;o++)THREE.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[o].skinMatrix,this.boneInverses[o]),THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*o);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;this.geometry.skinIndices.length>e;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4,THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,r=/([a-z]+)(\d+)/,o=0,a=e.morphTargets.length;a>o;o++){var n=e.morphTargets[o],s=n.name.match(r);if(s&&s.length>1){var h=s[1];s[2],i[h]||(i[h]={start:1/0,end:-1/0});var l=i[h];l.start>o&&(l.start=o),o>l.end&&(l.end=o),t||(t=h)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,0>this.time&&(this.time+=this.duration));var i=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var r=this.time%t/t;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype),THREE.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new THREE.Ribbon(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;this.LODs.length>i&&!(this.LODs[i].visibleAtDistance>t);i++);this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld);var t=e.matrixWorldInverse,i=-(t.elements[2]*this.matrixWorld.elements[12]+t.elements[6]*this.matrixWorld.elements[13]+t.elements[10]*this.matrixWorld.elements[14]+t.elements[14]);this.LODs[0].object3D.visible=!0;for(var r=1;this.LODs.length>r&&i>=this.LODs[r].visibleAtDistance;r++)this.LODs[r-1].object3D.visible=!1,this.LODs[r].object3D.visible=!0;for(;this.LODs.length>r;r++)this.LODs[r].object3D.visible=!1}},THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(e){THREE.Object3D.call(this),this.material=void 0!==e?e:new THREE.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var i=0;e.children.length>i;i++)this.__addObject(e.children[i])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else if(!(e instanceof THREE.Camera)){var t=this.__objects.indexOf(e);if(-1!==t){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var i=this.__objectsAdded.indexOf(e);-1!==i&&this.__objectsAdded.splice(i,1)}}for(var r=0;e.children.length>r;r++)this.__removeObject(e.children[r])},THREE.Fog=function(e,t,i){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(e){tt!==e&&(J.globalAlpha=e,tt=e)}function i(e){it!==e&&(e===THREE.NormalBlending?J.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?J.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(J.globalCompositeOperation="darker"),it=e)}function r(e){at!==e&&(J.lineWidth=e,at=e)}function o(e){nt!==e&&(J.lineCap=e,nt=e)}function a(e){st!==e&&(J.lineJoin=e,st=e)}function n(e){rt!==e&&(J.strokeStyle=e,rt=e)}function s(e){ot!==e&&(J.fillStyle=e,ot=e)}function h(e,t){(ht!==e||lt!==t)&&(J.setLineDash([e,t]),ht=e,lt=t)}console.log("THREE.CanvasRenderer",THREE.REVISION);var l=THREE.Math.smoothstep;e=e||{};var c,u,p,f,d,m,E,v,g,y,T,R,x,H,w,b,M,S,_,C,A,P,D,L,z,F,V,U,N,B,I,O,k,G,j,W,X,Y,q,K=this,Z=new THREE.Projector,Q=void 0!==e.canvas?e.canvas:document.createElement("canvas"),J=Q.getContext("2d"),$=new THREE.Color(0),et=0,tt=1,it=0,rt=null,ot=null,at=null,nt=null,st=null,ht=null,lt=0,ct=new THREE.RenderableVertex,ut=new THREE.RenderableVertex,pt=new THREE.Color,ft=new THREE.Color,dt=new THREE.Color,mt=new THREE.Color,Et=new THREE.Color,vt=new THREE.Color,gt=new THREE.Color,yt=new THREE.Color,Tt={},Rt={},xt=new THREE.Box2,Ht=new THREE.Box2,wt=new THREE.Box2,bt=!1,Mt=new THREE.Color,St=new THREE.Color,_t=new THREE.Color,Ct=new THREE.Vector3,At=16;G=document.createElement("canvas"),G.width=G.height=2,j=G.getContext("2d"),j.fillStyle="rgba(0,0,0,1)",j.fillRect(0,0,2,2),W=j.getImageData(0,0,2,2),X=W.data,Y=document.createElement("canvas"),Y.width=Y.height=At,q=Y.getContext("2d"),q.translate(-At/2,-At/2),q.scale(At,At),At--,void 0===J.setLineDash&&(J.setLineDash=void 0!==J.mozDash?function(e){J.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=Q,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t){f=e*this.devicePixelRatio,d=t*this.devicePixelRatio,m=Math.floor(f/2),E=Math.floor(d/2),Q.width=f,Q.height=d,Q.style.width=e+"px",Q.style.height=t+"px",xt.set(new THREE.Vector2(-m,-E),new THREE.Vector2(m,E)),Ht.set(new THREE.Vector2(-m,-E),new THREE.Vector2(m,E)),tt=1,it=0,rt=null,ot=null,at=null,nt=null,st=null},this.setClearColor=function(e,t){$.copy(e),et=void 0!==t?t:1,Ht.set(new THREE.Vector2(-m,-E),new THREE.Vector2(m,E))},this.setClearColorHex=function(e,t){$.setHex(e),et=void 0!==t?t:1,Ht.set(new THREE.Vector2(-m,-E),new THREE.Vector2(m,E))},this.getMaxAnisotropy=function(){return 0},this.clear=function(){J.setTransform(1,0,0,-1,m,E),Ht.empty()===!1&&(Ht.intersect(xt),Ht.expandByScalar(2),1>et&&J.clearRect(0|Ht.min.x,0|Ht.min.y,0|Ht.max.x-Ht.min.x,0|Ht.max.y-Ht.min.y),et>0&&(i(THREE.NormalBlending),t(1),s("rgba("+Math.floor(255*$.r)+","+Math.floor(255*$.g)+","+Math.floor(255*$.b)+","+et+")"),J.fillRect(0|Ht.min.x,0|Ht.min.y,0|Ht.max.x-Ht.min.x,0|Ht.max.y-Ht.min.y)),Ht.makeEmpty())},this.render=function(e,f){function d(){Mt.setRGB(0,0,0),St.setRGB(0,0,0),_t.setRGB(0,0,0);for(var e=0,t=p.length;t>e;e++){var i=p[e],r=i.color;i instanceof THREE.AmbientLight?Mt.add(r):i instanceof THREE.DirectionalLight?St.add(r):i instanceof THREE.PointLight&&_t.add(r)}}function Q(e,t,i){for(var r=0,o=p.length;o>r;r++){var a=p[r];if(yt.copy(a.color),a instanceof THREE.DirectionalLight){var n=Ct.getPositionFromMatrix(a.matrixWorld).normalize(),s=t.dot(n);if(0>=s)continue;s*=a.intensity,i.add(yt.multiplyScalar(s))}else if(a instanceof THREE.PointLight){var n=Ct.getPositionFromMatrix(a.matrixWorld),s=t.dot(Ct.subVectors(n,e).normalize());if(0>=s)continue;if(s*=0==a.distance?1:1-Math.min(e.distanceTo(n)/a.distance,1),0==s)continue;s*=a.intensity,i.add(yt.multiplyScalar(s))}}}function $(e,r,o){t(o.opacity),i(o.blending);var a,h,l,c,u,p,f;if(o instanceof THREE.ParticleBasicMaterial)if(null===o.map){if(l=r.object.scale.x,c=r.object.scale.y,l*=r.scale.x*m,c*=r.scale.y*E,wt.min.set(e.x-l,e.y-c),wt.max.set(e.x+l,e.y+c),xt.isIntersectionBox(wt)===!1)return;s(o.color.getStyle()),J.save(),J.translate(e.x,e.y),J.rotate(-r.rotation),J.scale(l,c),J.fillRect(-1,-1,2,2),J.restore()}else{if(u=o.map.image,p=u.width>>1,f=u.height>>1,l=r.scale.x*m,c=r.scale.y*E,a=l*p,h=c*f,wt.min.set(e.x-a,e.y-h),wt.max.set(e.x+a,e.y+h),xt.isIntersectionBox(wt)===!1)return;J.save(),J.translate(e.x,e.y),J.rotate(-r.rotation),J.scale(l,-c),J.translate(-p,-f),J.drawImage(u,0,0),J.restore()}else if(o instanceof THREE.ParticleCanvasMaterial){if(a=r.scale.x*m,h=r.scale.y*E,wt.min.set(e.x-a,e.y-h),wt.max.set(e.x+a,e.y+h),xt.isIntersectionBox(wt)===!1)return;n(o.color.getStyle()),s(o.color.getStyle()),J.save(),J.translate(e.x,e.y),J.rotate(-r.rotation),J.scale(a,h),o.program(J),J.restore()}}function et(e,s,l,c){t(c.opacity),i(c.blending),J.beginPath(),J.moveTo(e.positionScreen.x,e.positionScreen.y),J.lineTo(s.positionScreen.x,s.positionScreen.y),c instanceof THREE.LineBasicMaterial?(r(c.linewidth),o(c.linecap),a(c.linejoin),n(c.color.getStyle()),h(null,null),J.stroke(),wt.expandByScalar(2*c.linewidth)):c instanceof THREE.LineDashedMaterial&&(r(c.linewidth),o(c.linecap),a(c.linejoin),n(c.color.getStyle()),h(c.dashSize,c.gapSize),J.stroke(),wt.expandByScalar(2*c.linewidth))}function tt(e,r,o,a,n,s,h,c){if(K.info.render.vertices+=3,K.info.render.faces++,t(c.opacity),i(c.blending),R=e.positionScreen.x,x=e.positionScreen.y,H=r.positionScreen.x,w=r.positionScreen.y,b=o.positionScreen.x,M=o.positionScreen.y,rt(R,x,H,w,b,M),(c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial)&&null===c.map)vt.copy(c.color),gt.copy(c.emissive),c.vertexColors===THREE.FaceColors&&vt.multiply(h.color),bt===!0?c.wireframe===!1&&c.shading==THREE.SmoothShading&&3==h.vertexNormalsLength?(ft.copy(Mt),dt.copy(Mt),mt.copy(Mt),Q(h.v1.positionWorld,h.vertexNormalsModel[0],ft),Q(h.v2.positionWorld,h.vertexNormalsModel[1],dt),Q(h.v3.positionWorld,h.vertexNormalsModel[2],mt),ft.multiply(vt).add(gt),dt.multiply(vt).add(gt),mt.multiply(vt).add(gt),Et.addColors(dt,mt).multiplyScalar(.5),F=lt(ft,dt,mt,Et),ht(R,x,H,w,b,M,0,0,1,0,0,1,F)):(pt.copy(Mt),Q(h.centroidModel,h.normalModel,pt),pt.multiply(vt).add(gt),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt)):c.wireframe===!0?at(c.color,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(c.color);else if(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial)null!==c.map?c.map.mapping instanceof THREE.UVMapping&&(V=h.uvs[0],st(R,x,H,w,b,M,V[a].x,V[a].y,V[n].x,V[n].y,V[s].x,V[s].y,c.map)):null!==c.envMap?c.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(Ct.copy(h.vertexNormalsModelView[a]),U=.5*Ct.x+.5,N=.5*Ct.y+.5,Ct.copy(h.vertexNormalsModelView[n]),B=.5*Ct.x+.5,I=.5*Ct.y+.5,Ct.copy(h.vertexNormalsModelView[s]),O=.5*Ct.x+.5,k=.5*Ct.y+.5,st(R,x,H,w,b,M,U,N,B,I,O,k,c.envMap)):(pt.copy(c.color),c.vertexColors===THREE.FaceColors&&pt.multiply(h.color),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt));else if(c instanceof THREE.MeshDepthMaterial)L=f.near,z=f.far,ft.r=ft.g=ft.b=1-l(e.positionScreen.z*e.positionScreen.w,L,z),dt.r=dt.g=dt.b=1-l(r.positionScreen.z*r.positionScreen.w,L,z),mt.r=mt.g=mt.b=1-l(o.positionScreen.z*o.positionScreen.w,L,z),Et.addColors(dt,mt).multiplyScalar(.5),F=lt(ft,dt,mt,Et),ht(R,x,H,w,b,M,0,0,1,0,0,1,F);else if(c instanceof THREE.MeshNormalMaterial){var u;c.shading==THREE.FlatShading?(u=h.normalModelView,pt.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt)):c.shading==THREE.SmoothShading&&(u=h.vertexNormalsModelView[a],ft.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=h.vertexNormalsModelView[n],dt.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=h.vertexNormalsModelView[s],mt.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),Et.addColors(dt,mt).multiplyScalar(.5),F=lt(ft,dt,mt,Et),ht(R,x,H,w,b,M,0,0,1,0,0,1,F))}}function it(e,r,o,a,n,s,h,c){if(K.info.render.vertices+=4,K.info.render.faces++,t(c.opacity),i(c.blending),void 0!==c.map&&null!==c.map||void 0!==c.envMap&&null!==c.envMap)return tt(e,r,a,0,1,3,h,c),tt(n,o,s,1,2,3,h,c),void 0;if(R=e.positionScreen.x,x=e.positionScreen.y,H=r.positionScreen.x,w=r.positionScreen.y,b=o.positionScreen.x,M=o.positionScreen.y,S=a.positionScreen.x,_=a.positionScreen.y,C=n.positionScreen.x,A=n.positionScreen.y,P=s.positionScreen.x,D=s.positionScreen.y,c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial)vt.copy(c.color),gt.copy(c.emissive),c.vertexColors===THREE.FaceColors&&vt.multiply(h.color),bt===!0?c.wireframe===!1&&c.shading==THREE.SmoothShading&&4==h.vertexNormalsLength?(ft.copy(Mt),dt.copy(Mt),mt.copy(Mt),Et.copy(Mt),Q(h.v1.positionWorld,h.vertexNormalsModel[0],ft),Q(h.v2.positionWorld,h.vertexNormalsModel[1],dt),Q(h.v4.positionWorld,h.vertexNormalsModel[3],mt),Q(h.v3.positionWorld,h.vertexNormalsModel[2],Et),ft.multiply(vt).add(gt),dt.multiply(vt).add(gt),mt.multiply(vt).add(gt),Et.multiply(vt).add(gt),F=lt(ft,dt,mt,Et),rt(R,x,H,w,S,_),ht(R,x,H,w,S,_,0,0,1,0,0,1,F),rt(C,A,b,M,P,D),ht(C,A,b,M,P,D,1,0,1,1,0,1,F)):(pt.copy(Mt),Q(h.centroidModel,h.normalModel,pt),pt.multiply(vt).add(gt),ot(R,x,H,w,b,M,S,_),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt)):(pt.addColors(vt,gt),ot(R,x,H,w,b,M,S,_),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt));else if(c instanceof THREE.MeshBasicMaterial)pt.copy(c.color),c.vertexColors===THREE.FaceColors&&pt.multiply(h.color),ot(R,x,H,w,b,M,S,_),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt);else if(c instanceof THREE.MeshNormalMaterial){var u;c.shading==THREE.FlatShading?(u=h.normalModelView,pt.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),ot(R,x,H,w,b,M,S,_),c.wireframe===!0?at(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt)):c.shading==THREE.SmoothShading&&(u=h.vertexNormalsModelView[0],ft.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=h.vertexNormalsModelView[1],dt.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=h.vertexNormalsModelView[3],mt.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=h.vertexNormalsModelView[2],Et.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),F=lt(ft,dt,mt,Et),rt(R,x,H,w,S,_),ht(R,x,H,w,S,_,0,0,1,0,0,1,F),rt(C,A,b,M,P,D),ht(C,A,b,M,P,D,1,0,1,1,0,1,F))}else c instanceof THREE.MeshDepthMaterial&&(L=f.near,z=f.far,ft.r=ft.g=ft.b=1-l(e.positionScreen.z*e.positionScreen.w,L,z),dt.r=dt.g=dt.b=1-l(r.positionScreen.z*r.positionScreen.w,L,z),mt.r=mt.g=mt.b=1-l(a.positionScreen.z*a.positionScreen.w,L,z),Et.r=Et.g=Et.b=1-l(o.positionScreen.z*o.positionScreen.w,L,z),F=lt(ft,dt,mt,Et),rt(R,x,H,w,S,_),ht(R,x,H,w,S,_,0,0,1,0,0,1,F),rt(C,A,b,M,P,D),ht(C,A,b,M,P,D,1,0,1,1,0,1,F))}function rt(e,t,i,r,o,a){J.beginPath(),J.moveTo(e,t),J.lineTo(i,r),J.lineTo(o,a),J.closePath()}function ot(e,t,i,r,o,a,n,s){J.beginPath(),J.moveTo(e,t),J.lineTo(i,r),J.lineTo(o,a),J.lineTo(n,s),J.closePath()}function at(e,t,i,s){r(t),o(i),a(s),n(e.getStyle()),J.stroke(),wt.expandByScalar(2*t)}function nt(e){s(e.getStyle()),J.fill()}function st(e,t,i,r,o,a,n,h,l,c,u,p,f){if(!(f instanceof THREE.DataTexture||void 0===f.image||0==f.image.width)){if(f.needsUpdate===!0){var d=f.wrapS==THREE.RepeatWrapping,m=f.wrapT==THREE.RepeatWrapping;Tt[f.id]=J.createPattern(f.image,d===!0&&m===!0?"repeat":d===!0&&m===!1?"repeat-x":d===!1&&m===!0?"repeat-y":"no-repeat"),f.needsUpdate=!1}void 0===Tt[f.id]?s("rgba(0,0,0,1)"):s(Tt[f.id]);var E,v,g,y,T,R,x,H,w=f.offset.x/f.repeat.x,b=f.offset.y/f.repeat.y,M=f.image.width*f.repeat.x,S=f.image.height*f.repeat.y;if(n=(n+w)*M,h=(1-h+b)*S,l=(l+w)*M,c=(1-c+b)*S,u=(u+w)*M,p=(1-p+b)*S,i-=e,r-=t,o-=e,a-=t,l-=n,c-=h,u-=n,p-=h,x=l*p-u*c,0===x){if(void 0===Rt[f.id]){var _=document.createElement("canvas");_.width=f.image.width,_.height=f.image.height;var C=_.getContext("2d");C.drawImage(f.image,0,0),Rt[f.id]=C.getImageData(0,0,f.image.width,f.image.height).data}var A=Rt[f.id],P=4*(Math.floor(n)+Math.floor(h)*f.image.width);return pt.setRGB(A[P]/255,A[P+1]/255,A[P+2]/255),nt(pt),void 0}H=1/x,E=(p*i-c*o)*H,v=(p*r-c*a)*H,g=(l*o-u*i)*H,y=(l*a-u*r)*H,T=e-E*n-g*h,R=t-v*n-y*h,J.save(),J.transform(E,v,g,y,T,R),J.fill(),J.restore()}}function ht(e,t,i,r,o,a,n,s,h,l,c,u,p){var f,d,m,E,v,g,y,T,R=p.width-1,x=p.height-1;n*=R,s*=x,h*=R,l*=x,c*=R,u*=x,i-=e,r-=t,o-=e,a-=t,h-=n,l-=s,c-=n,u-=s,y=h*u-c*l,T=1/y,f=(u*i-l*o)*T,d=(u*r-l*a)*T,m=(h*o-c*i)*T,E=(h*a-c*r)*T,v=e-f*n-m*s,g=t-d*n-E*s,J.save(),J.transform(f,d,m,E,v,g),J.clip(),J.drawImage(p,0,0),J.restore()}function lt(e,t,i,r){return X[0]=0|255*e.r,X[1]=0|255*e.g,X[2]=0|255*e.b,X[4]=0|255*t.r,X[5]=0|255*t.g,X[6]=0|255*t.b,X[8]=0|255*i.r,X[9]=0|255*i.g,X[10]=0|255*i.b,X[12]=0|255*r.r,X[13]=0|255*r.g,X[14]=0|255*r.b,j.putImageData(W,0,0),q.drawImage(G,0,0),Y}function At(e,t){var i,r=t.x-e.x,o=t.y-e.y,a=r*r+o*o;0!==a&&(i=1/Math.sqrt(a),r*=i,o*=i,t.x+=r,t.y+=o,e.x-=r,e.y-=o)}if(f instanceof THREE.Camera==!1)return console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera."),void 0;this.autoClear===!0&&this.clear(),J.setTransform(1,0,0,-1,m,E),K.info.render.vertices=0,K.info.render.faces=0,c=Z.projectScene(e,f,this.sortObjects,this.sortElements),u=c.elements,p=c.lights,bt=p.length>0,bt===!0&&d();for(var Pt=0,Dt=u.length;Dt>Pt;Pt++){var Lt=u[Pt],zt=Lt.material;if(void 0!==zt&&zt.visible!==!1){if(wt.makeEmpty(),Lt instanceof THREE.RenderableParticle)v=Lt,v.x*=m,v.y*=E,$(v,Lt,zt);else if(Lt instanceof THREE.RenderableLine)v=Lt.v1,g=Lt.v2,v.positionScreen.x*=m,v.positionScreen.y*=E,g.positionScreen.x*=m,g.positionScreen.y*=E,wt.setFromPoints([v.positionScreen,g.positionScreen]),xt.isIntersectionBox(wt)===!0&&et(v,g,Lt,zt);else if(Lt instanceof THREE.RenderableFace3){if(v=Lt.v1,g=Lt.v2,y=Lt.v3,-1>v.positionScreen.z||v.positionScreen.z>1)continue;if(-1>g.positionScreen.z||g.positionScreen.z>1)continue;if(-1>y.positionScreen.z||y.positionScreen.z>1)continue;v.positionScreen.x*=m,v.positionScreen.y*=E,g.positionScreen.x*=m,g.positionScreen.y*=E,y.positionScreen.x*=m,y.positionScreen.y*=E,zt.overdraw===!0&&(At(v.positionScreen,g.positionScreen),At(g.positionScreen,y.positionScreen),At(y.positionScreen,v.positionScreen)),wt.setFromPoints([v.positionScreen,g.positionScreen,y.positionScreen]),tt(v,g,y,0,1,2,Lt,zt)}else if(Lt instanceof THREE.RenderableFace4){if(v=Lt.v1,g=Lt.v2,y=Lt.v3,T=Lt.v4,-1>v.positionScreen.z||v.positionScreen.z>1)continue;if(-1>g.positionScreen.z||g.positionScreen.z>1)continue;if(-1>y.positionScreen.z||y.positionScreen.z>1)continue;if(-1>T.positionScreen.z||T.positionScreen.z>1)continue;v.positionScreen.x*=m,v.positionScreen.y*=E,g.positionScreen.x*=m,g.positionScreen.y*=E,y.positionScreen.x*=m,y.positionScreen.y*=E,T.positionScreen.x*=m,T.positionScreen.y*=E,ct.positionScreen.copy(g.positionScreen),ut.positionScreen.copy(T.positionScreen),zt.overdraw===!0&&(At(v.positionScreen,g.positionScreen),At(g.positionScreen,T.positionScreen),At(T.positionScreen,v.positionScreen),At(y.positionScreen,ct.positionScreen),At(y.positionScreen,ut.positionScreen)),wt.setFromPoints([v.positionScreen,g.positionScreen,y.positionScreen,T.positionScreen]),it(v,g,y,T,ct,ut,Lt,zt,e)}Ht.union(wt)}}J.setTransform(1,0,0,1,0,0)}},THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},THREE.UniformsUtils={merge:function(e){var t,i,r,o={};
for(t=0;e.length>t;t++){r=this.clone(e[t]);for(i in r)o[i]=r[i]}return o},clone:function(e){var t,i,r,o={};for(t in e){o[t]={};for(i in e[t])r=e[t][i],o[t][i]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r}return o}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Nt.createBuffer(),e.__webglColorBuffer=Nt.createBuffer(),Gt.info.memory.geometries++}function i(e){e.__webglVertexBuffer=Nt.createBuffer(),e.__webglColorBuffer=Nt.createBuffer(),e.__webglLineDistanceBuffer=Nt.createBuffer(),Gt.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Nt.createBuffer(),e.__webglColorBuffer=Nt.createBuffer(),e.__webglNormalBuffer=Nt.createBuffer(),Gt.info.memory.geometries++}function o(e){e.__webglVertexBuffer=Nt.createBuffer(),e.__webglNormalBuffer=Nt.createBuffer(),e.__webglTangentBuffer=Nt.createBuffer(),e.__webglColorBuffer=Nt.createBuffer(),e.__webglUVBuffer=Nt.createBuffer(),e.__webglUV2Buffer=Nt.createBuffer(),e.__webglSkinIndicesBuffer=Nt.createBuffer(),e.__webglSkinWeightsBuffer=Nt.createBuffer(),e.__webglFaceBuffer=Nt.createBuffer(),e.__webglLineBuffer=Nt.createBuffer();var t,i;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;i>t;t++)e.__webglMorphTargetsBuffers.push(Nt.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;i>t;t++)e.__webglMorphNormalsBuffers.push(Nt.createBuffer());Gt.info.memory.geometries++}function a(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Nt.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function n(e,t){var i=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var o in r.attributes){var a=r.attributes[o];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=!0;var n=1;"v2"===a.type?n=2:"v3"===a.type?n=3:"v4"===a.type?n=4:"c"===a.type&&(n=3),a.size=n,a.array=new Float32Array(i*n),a.buffer=Nt.createBuffer(),a.buffer.belongsToAttribute=o,a.needsUpdate=!0}e.__webglCustomAttributesList.push(a)}}}function s(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i,n(e,t)}function h(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,n(e,t)}function l(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__webglVertexCount=i,n(e,t)}function c(e,t){var i=t.geometry,r=e.faces3,o=e.faces4,a=3*r.length+4*o.length,n=1*r.length+2*o.length,s=3*r.length+4*o.length,h=u(t,e),l=m(h),c=f(h),p=d(h);e.__vertexArray=new Float32Array(3*a),c&&(e.__normalArray=new Float32Array(3*a)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*a)),p&&(e.__colorArray=new Float32Array(3*a)),l&&((i.faceUvs.length>0||i.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*a)),(i.faceUvs.length>1||i.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*a))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*a),e.__skinWeightArray=new Float32Array(4*a)),e.__faceArray=new Uint16Array(3*n),e.__lineArray=new Uint16Array(2*s);var E,v;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],E=0,v=e.numMorphTargets;v>E;E++)e.__morphTargetsArrays.push(new Float32Array(3*a));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],E=0,v=e.numMorphNormals;v>E;E++)e.__morphNormalsArrays.push(new Float32Array(3*a));if(e.__webglFaceCount=3*n,e.__webglLineCount=2*s,h.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var g in h.attributes){var y=h.attributes[g],T={};for(var R in y)T[R]=y[R];if(!T.__webglInitialized||T.createUniqueBuffers){T.__webglInitialized=!0;var x=1;"v2"===T.type?x=2:"v3"===T.type?x=3:"v4"===T.type?x=4:"c"===T.type&&(x=3),T.size=x,T.array=new Float32Array(a*x),T.buffer=Nt.createBuffer(),T.buffer.belongsToAttribute=g,y.needsUpdate=!0,T.__original=y}e.__webglCustomAttributesList.push(T)}}e.__inittedArrays=!0}function u(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function p(e){return e&&void 0!==e.shading&&e.shading===THREE.SmoothShading}function f(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:p(e)?THREE.SmoothShading:THREE.FlatShading}function d(e){return e.vertexColors?e.vertexColors:!1}function m(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function E(e){var t,i,r;for(t in e.attributes)r="index"===t?Nt.ELEMENT_ARRAY_BUFFER:Nt.ARRAY_BUFFER,i=e.attributes[t],i.buffer=Nt.createBuffer(),Nt.bindBuffer(r,i.buffer),Nt.bufferData(r,i.array,Nt.STATIC_DRAW)}function v(e,t,i){var r,o,a,n,s,h,l,c,u,p,f,d,m=e.vertices,E=m.length,v=e.colors,g=v.length,y=e.__vertexArray,T=e.__colorArray,R=e.__sortArray,x=e.verticesNeedUpdate,H=(e.elementsNeedUpdate,e.colorsNeedUpdate),w=e.__webglCustomAttributesList;
if(i.sortParticles){for(Ti.copy(yi),Ti.multiply(i.matrixWorld),r=0;E>r;r++)a=m[r],Ri.copy(a),Ri.applyProjection(Ti),R[r]=[Ri.z,r];for(R.sort(M),r=0;E>r;r++)a=m[R[r][1]],n=3*r,y[n]=a.x,y[n+1]=a.y,y[n+2]=a.z;for(o=0;g>o;o++)n=3*o,h=v[R[o][1]],T[n]=h.r,T[n+1]=h.g,T[n+2]=h.b;if(w)for(l=0,c=w.length;c>l;l++)if(d=w[l],void 0===d.boundTo||"vertices"===d.boundTo)if(n=0,p=d.value.length,1===d.size)for(u=0;p>u;u++)s=R[u][1],d.array[u]=d.value[s];else if(2===d.size)for(u=0;p>u;u++)s=R[u][1],f=d.value[s],d.array[n]=f.x,d.array[n+1]=f.y,n+=2;else if(3===d.size)if("c"===d.type)for(u=0;p>u;u++)s=R[u][1],f=d.value[s],d.array[n]=f.r,d.array[n+1]=f.g,d.array[n+2]=f.b,n+=3;else for(u=0;p>u;u++)s=R[u][1],f=d.value[s],d.array[n]=f.x,d.array[n+1]=f.y,d.array[n+2]=f.z,n+=3;else if(4===d.size)for(u=0;p>u;u++)s=R[u][1],f=d.value[s],d.array[n]=f.x,d.array[n+1]=f.y,d.array[n+2]=f.z,d.array[n+3]=f.w,n+=4}else{if(x)for(r=0;E>r;r++)a=m[r],n=3*r,y[n]=a.x,y[n+1]=a.y,y[n+2]=a.z;if(H)for(o=0;g>o;o++)h=v[o],n=3*o,T[n]=h.r,T[n+1]=h.g,T[n+2]=h.b;if(w)for(l=0,c=w.length;c>l;l++)if(d=w[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo))if(p=d.value.length,n=0,1===d.size)for(u=0;p>u;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;p>u;u++)f=d.value[u],d.array[n]=f.x,d.array[n+1]=f.y,n+=2;else if(3===d.size)if("c"===d.type)for(u=0;p>u;u++)f=d.value[u],d.array[n]=f.r,d.array[n+1]=f.g,d.array[n+2]=f.b,n+=3;else for(u=0;p>u;u++)f=d.value[u],d.array[n]=f.x,d.array[n+1]=f.y,d.array[n+2]=f.z,n+=3;else if(4===d.size)for(u=0;p>u;u++)f=d.value[u],d.array[n]=f.x,d.array[n+1]=f.y,d.array[n+2]=f.z,d.array[n+3]=f.w,n+=4}if((x||i.sortParticles)&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,y,t)),(H||i.sortParticles)&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,T,t)),w)for(l=0,c=w.length;c>l;l++)d=w[l],(d.needsUpdate||i.sortParticles)&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,d.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,d.array,t))}function g(e,t){var i,r,o,a,n,s,h,l,c,u,p,f,d=e.vertices,m=e.colors,E=e.lineDistances,v=d.length,g=m.length,y=E.length,T=e.__vertexArray,R=e.__colorArray,x=e.__lineDistanceArray,H=e.verticesNeedUpdate,w=e.colorsNeedUpdate,b=e.lineDistancesNeedUpdate,M=e.__webglCustomAttributesList;if(H){for(i=0;v>i;i++)a=d[i],n=3*i,T[n]=a.x,T[n+1]=a.y,T[n+2]=a.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,T,t)}if(w){for(r=0;g>r;r++)s=m[r],n=3*r,R[n]=s.r,R[n+1]=s.g,R[n+2]=s.b;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,R,t)}if(b){for(o=0;y>o;o++)x[o]=E[o];Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,x,t)}if(M)for(h=0,l=M.length;l>h;h++)if(f=M[h],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(n=0,u=f.value.length,1===f.size)for(c=0;u>c;c++)f.array[c]=f.value[c];else if(2===f.size)for(c=0;u>c;c++)p=f.value[c],f.array[n]=p.x,f.array[n+1]=p.y,n+=2;else if(3===f.size)if("c"===f.type)for(c=0;u>c;c++)p=f.value[c],f.array[n]=p.r,f.array[n+1]=p.g,f.array[n+2]=p.b,n+=3;else for(c=0;u>c;c++)p=f.value[c],f.array[n]=p.x,f.array[n+1]=p.y,f.array[n+2]=p.z,n+=3;else if(4===f.size)for(c=0;u>c;c++)p=f.value[c],f.array[n]=p.x,f.array[n+1]=p.y,f.array[n+2]=p.z,f.array[n+3]=p.w,n+=4;Nt.bindBuffer(Nt.ARRAY_BUFFER,f.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,f.array,t)}}function y(e,t){var i,r,o,a,n,s,h,l,c,u,p,f,d,m=e.vertices,E=e.colors,v=e.normals,g=m.length,y=E.length,T=v.length,R=e.__vertexArray,x=e.__colorArray,H=e.__normalArray,w=e.verticesNeedUpdate,b=e.colorsNeedUpdate,M=e.normalsNeedUpdate,S=e.__webglCustomAttributesList;if(w){for(i=0;g>i;i++)a=m[i],n=3*i,R[n]=a.x,R[n+1]=a.y,R[n+2]=a.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,R,t)}if(b){for(r=0;y>r;r++)s=E[r],n=3*r,x[n]=s.r,x[n+1]=s.g,x[n+2]=s.b;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,x,t)}if(M){for(o=0;T>o;o++)h=v[o],n=3*o,H[n]=h.x,H[n+1]=h.y,H[n+2]=h.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglNormalBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,H,t)}if(S)for(l=0,c=S.length;c>l;l++)if(f=S[l],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(n=0,p=f.value.length,1===f.size)for(u=0;p>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;p>u;u++)d=f.value[u],f.array[n]=d.x,f.array[n+1]=d.y,n+=2;else if(3===f.size)if("c"===f.type)for(u=0;p>u;u++)d=f.value[u],f.array[n]=d.r,f.array[n+1]=d.g,f.array[n+2]=d.b,n+=3;else for(u=0;p>u;u++)d=f.value[u],f.array[n]=d.x,f.array[n+1]=d.y,f.array[n+2]=d.z,n+=3;else if(4===f.size)for(u=0;p>u;u++)d=f.value[u],f.array[n]=d.x,f.array[n+1]=d.y,f.array[n+2]=d.z,f.array[n+3]=d.w,n+=4;Nt.bindBuffer(Nt.ARRAY_BUFFER,f.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,f.array,t)}}function T(e,t,i,r,o){if(e.__inittedArrays){var a,n,s,h,l,c,u,p,E,v,g,y,T,R,x,H,w,b,M,S,_,C,A,P,D,L,z,F,V,U,N,B,I,O,k,G,j,W,X,Y,q,K,Z,Q,J,$,et,tt,it=f(o),rt=d(o),ot=m(o),at=it===THREE.SmoothShading,nt=0,st=0,ht=0,lt=0,ct=0,ut=0,pt=0,ft=0,dt=0,mt=0,Et=0,vt=0,gt=0,yt=e.__vertexArray,Tt=e.__uvArray,Rt=e.__uv2Array,xt=e.__normalArray,Ht=e.__tangentArray,wt=e.__colorArray,bt=e.__skinIndexArray,Mt=e.__skinWeightArray,St=e.__morphTargetsArrays,_t=e.__morphNormalsArrays,Ct=e.__webglCustomAttributesList,At=e.__faceArray,Pt=e.__lineArray,Dt=t.geometry,Lt=Dt.verticesNeedUpdate,zt=Dt.elementsNeedUpdate,Ft=Dt.uvsNeedUpdate,Vt=Dt.normalsNeedUpdate,Ut=Dt.tangentsNeedUpdate,Bt=Dt.colorsNeedUpdate,It=Dt.morphTargetsNeedUpdate,Ot=Dt.vertices,kt=e.faces3,Gt=e.faces4,jt=Dt.faces,Wt=Dt.faceVertexUvs[0],Xt=Dt.faceVertexUvs[1],Yt=(Dt.colors,Dt.skinIndices),qt=Dt.skinWeights,Kt=Dt.morphTargets,Zt=Dt.morphNormals;if(Lt){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],y=Ot[h.a],T=Ot[h.b],R=Ot[h.c],yt[st]=y.x,yt[st+1]=y.y,yt[st+2]=y.z,yt[st+3]=T.x,yt[st+4]=T.y,yt[st+5]=T.z,yt[st+6]=R.x,yt[st+7]=R.y,yt[st+8]=R.z,st+=9;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],y=Ot[h.a],T=Ot[h.b],R=Ot[h.c],x=Ot[h.d],yt[st]=y.x,yt[st+1]=y.y,yt[st+2]=y.z,yt[st+3]=T.x,yt[st+4]=T.y,yt[st+5]=T.z,yt[st+6]=R.x,yt[st+7]=R.y,yt[st+8]=R.z,yt[st+9]=x.x,yt[st+10]=x.y,yt[st+11]=x.z,st+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,yt,i)}if(It)for(q=0,K=Kt.length;K>q;q++){for(Et=0,a=0,n=kt.length;n>a;a++)J=kt[a],h=jt[J],y=Kt[q].vertices[h.a],T=Kt[q].vertices[h.b],R=Kt[q].vertices[h.c],Z=St[q],Z[Et]=y.x,Z[Et+1]=y.y,Z[Et+2]=y.z,Z[Et+3]=T.x,Z[Et+4]=T.y,Z[Et+5]=T.z,Z[Et+6]=R.x,Z[Et+7]=R.y,Z[Et+8]=R.z,o.morphNormals&&(at?($=Zt[q].vertexNormals[J],S=$.a,_=$.b,C=$.c):(S=Zt[q].faceNormals[J],_=S,C=S),Q=_t[q],Q[Et]=S.x,Q[Et+1]=S.y,Q[Et+2]=S.z,Q[Et+3]=_.x,Q[Et+4]=_.y,Q[Et+5]=_.z,Q[Et+6]=C.x,Q[Et+7]=C.y,Q[Et+8]=C.z),Et+=9;for(a=0,n=Gt.length;n>a;a++)J=Gt[a],h=jt[J],y=Kt[q].vertices[h.a],T=Kt[q].vertices[h.b],R=Kt[q].vertices[h.c],x=Kt[q].vertices[h.d],Z=St[q],Z[Et]=y.x,Z[Et+1]=y.y,Z[Et+2]=y.z,Z[Et+3]=T.x,Z[Et+4]=T.y,Z[Et+5]=T.z,Z[Et+6]=R.x,Z[Et+7]=R.y,Z[Et+8]=R.z,Z[Et+9]=x.x,Z[Et+10]=x.y,Z[Et+11]=x.z,o.morphNormals&&(at?($=Zt[q].vertexNormals[J],S=$.a,_=$.b,C=$.c,A=$.d):(S=Zt[q].faceNormals[J],_=S,C=S,A=S),Q=_t[q],Q[Et]=S.x,Q[Et+1]=S.y,Q[Et+2]=S.z,Q[Et+3]=_.x,Q[Et+4]=_.y,Q[Et+5]=_.z,Q[Et+6]=C.x,Q[Et+7]=C.y,Q[Et+8]=C.z,Q[Et+9]=A.x,Q[Et+10]=A.y,Q[Et+11]=A.z),Et+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[q]),Nt.bufferData(Nt.ARRAY_BUFFER,St[q],i),o.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[q]),Nt.bufferData(Nt.ARRAY_BUFFER,_t[q],i))}if(qt.length){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],F=qt[h.a],V=qt[h.b],U=qt[h.c],Mt[mt]=F.x,Mt[mt+1]=F.y,Mt[mt+2]=F.z,Mt[mt+3]=F.w,Mt[mt+4]=V.x,Mt[mt+5]=V.y,Mt[mt+6]=V.z,Mt[mt+7]=V.w,Mt[mt+8]=U.x,Mt[mt+9]=U.y,Mt[mt+10]=U.z,Mt[mt+11]=U.w,B=Yt[h.a],I=Yt[h.b],O=Yt[h.c],bt[mt]=B.x,bt[mt+1]=B.y,bt[mt+2]=B.z,bt[mt+3]=B.w,bt[mt+4]=I.x,bt[mt+5]=I.y,bt[mt+6]=I.z,bt[mt+7]=I.w,bt[mt+8]=O.x,bt[mt+9]=O.y,bt[mt+10]=O.z,bt[mt+11]=O.w,mt+=12;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],F=qt[h.a],V=qt[h.b],U=qt[h.c],N=qt[h.d],Mt[mt]=F.x,Mt[mt+1]=F.y,Mt[mt+2]=F.z,Mt[mt+3]=F.w,Mt[mt+4]=V.x,Mt[mt+5]=V.y,Mt[mt+6]=V.z,Mt[mt+7]=V.w,Mt[mt+8]=U.x,Mt[mt+9]=U.y,Mt[mt+10]=U.z,Mt[mt+11]=U.w,Mt[mt+12]=N.x,Mt[mt+13]=N.y,Mt[mt+14]=N.z,Mt[mt+15]=N.w,B=Yt[h.a],I=Yt[h.b],O=Yt[h.c],k=Yt[h.d],bt[mt]=B.x,bt[mt+1]=B.y,bt[mt+2]=B.z,bt[mt+3]=B.w,bt[mt+4]=I.x,bt[mt+5]=I.y,bt[mt+6]=I.z,bt[mt+7]=I.w,bt[mt+8]=O.x,bt[mt+9]=O.y,bt[mt+10]=O.z,bt[mt+11]=O.w,bt[mt+12]=k.x,bt[mt+13]=k.y,bt[mt+14]=k.z,bt[mt+15]=k.w,mt+=16;mt>0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,bt,i),Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Mt,i))}if(Bt&&rt){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],u=h.vertexColors,p=h.color,3===u.length&&rt===THREE.VertexColors?(P=u[0],D=u[1],L=u[2]):(P=p,D=p,L=p),wt[dt]=P.r,wt[dt+1]=P.g,wt[dt+2]=P.b,wt[dt+3]=D.r,wt[dt+4]=D.g,wt[dt+5]=D.b,wt[dt+6]=L.r,wt[dt+7]=L.g,wt[dt+8]=L.b,dt+=9;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],u=h.vertexColors,p=h.color,4===u.length&&rt===THREE.VertexColors?(P=u[0],D=u[1],L=u[2],z=u[3]):(P=p,D=p,L=p,z=p),wt[dt]=P.r,wt[dt+1]=P.g,wt[dt+2]=P.b,wt[dt+3]=D.r,wt[dt+4]=D.g,wt[dt+5]=D.b,wt[dt+6]=L.r,wt[dt+7]=L.g,wt[dt+8]=L.b,wt[dt+9]=z.r,wt[dt+10]=z.g,wt[dt+11]=z.b,dt+=12;dt>0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,wt,i))}if(Ut&&Dt.hasTangents){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],E=h.vertexTangents,H=E[0],w=E[1],b=E[2],Ht[pt]=H.x,Ht[pt+1]=H.y,Ht[pt+2]=H.z,Ht[pt+3]=H.w,Ht[pt+4]=w.x,Ht[pt+5]=w.y,Ht[pt+6]=w.z,Ht[pt+7]=w.w,Ht[pt+8]=b.x,Ht[pt+9]=b.y,Ht[pt+10]=b.z,Ht[pt+11]=b.w,pt+=12;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],E=h.vertexTangents,H=E[0],w=E[1],b=E[2],M=E[3],Ht[pt]=H.x,Ht[pt+1]=H.y,Ht[pt+2]=H.z,Ht[pt+3]=H.w,Ht[pt+4]=w.x,Ht[pt+5]=w.y,Ht[pt+6]=w.z,Ht[pt+7]=w.w,Ht[pt+8]=b.x,Ht[pt+9]=b.y,Ht[pt+10]=b.z,Ht[pt+11]=b.w,Ht[pt+12]=M.x,Ht[pt+13]=M.y,Ht[pt+14]=M.z,Ht[pt+15]=M.w,pt+=16;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglTangentBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Ht,i)}if(Vt&&it){for(a=0,n=kt.length;n>a;a++)if(h=jt[kt[a]],l=h.vertexNormals,c=h.normal,3===l.length&&at)for(G=0;3>G;G++)W=l[G],xt[ut]=W.x,xt[ut+1]=W.y,xt[ut+2]=W.z,ut+=3;else for(G=0;3>G;G++)xt[ut]=c.x,xt[ut+1]=c.y,xt[ut+2]=c.z,ut+=3;for(a=0,n=Gt.length;n>a;a++)if(h=jt[Gt[a]],l=h.vertexNormals,c=h.normal,4===l.length&&at)for(G=0;4>G;G++)W=l[G],xt[ut]=W.x,xt[ut+1]=W.y,xt[ut+2]=W.z,ut+=3;else for(G=0;4>G;G++)xt[ut]=c.x,xt[ut+1]=c.y,xt[ut+2]=c.z,ut+=3;Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglNormalBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,xt,i)}if(Ft&&Wt&&ot){for(a=0,n=kt.length;n>a;a++)if(s=kt[a],v=Wt[s],void 0!==v)for(G=0;3>G;G++)X=v[G],Tt[ht]=X.x,Tt[ht+1]=X.y,ht+=2;for(a=0,n=Gt.length;n>a;a++)if(s=Gt[a],v=Wt[s],void 0!==v)for(G=0;4>G;G++)X=v[G],Tt[ht]=X.x,Tt[ht+1]=X.y,ht+=2;ht>0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglUVBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Tt,i))}if(Ft&&Xt&&ot){for(a=0,n=kt.length;n>a;a++)if(s=kt[a],g=Xt[s],void 0!==g)for(G=0;3>G;G++)Y=g[G],Rt[lt]=Y.x,Rt[lt+1]=Y.y,lt+=2;for(a=0,n=Gt.length;n>a;a++)if(s=Gt[a],g=Xt[s],void 0!==g)for(G=0;4>G;G++)Y=g[G],Rt[lt]=Y.x,Rt[lt+1]=Y.y,lt+=2;lt>0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglUV2Buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Rt,i))}if(zt){for(a=0,n=kt.length;n>a;a++)At[ct]=nt,At[ct+1]=nt+1,At[ct+2]=nt+2,ct+=3,Pt[ft]=nt,Pt[ft+1]=nt+1,Pt[ft+2]=nt,Pt[ft+3]=nt+2,Pt[ft+4]=nt+1,Pt[ft+5]=nt+2,ft+=6,nt+=3;for(a=0,n=Gt.length;n>a;a++)At[ct]=nt,At[ct+1]=nt+1,At[ct+2]=nt+3,At[ct+3]=nt+1,At[ct+4]=nt+2,At[ct+5]=nt+3,ct+=6,Pt[ft]=nt,Pt[ft+1]=nt+1,Pt[ft+2]=nt,Pt[ft+3]=nt+3,Pt[ft+4]=nt+1,Pt[ft+5]=nt+2,Pt[ft+6]=nt+2,Pt[ft+7]=nt+3,ft+=8,nt+=4;Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,At,i),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,Pt,i)}if(Ct)for(G=0,j=Ct.length;j>G;G++)if(tt=Ct[G],tt.__original.needsUpdate){if(vt=0,gt=0,1===tt.size){if(void 0===tt.boundTo||"vertices"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],tt.array[vt]=tt.value[h.a],tt.array[vt+1]=tt.value[h.b],tt.array[vt+2]=tt.value[h.c],vt+=3;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],tt.array[vt]=tt.value[h.a],tt.array[vt+1]=tt.value[h.b],tt.array[vt+2]=tt.value[h.c],tt.array[vt+3]=tt.value[h.d],vt+=4}else if("faces"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)et=tt.value[kt[a]],tt.array[vt]=et,tt.array[vt+1]=et,tt.array[vt+2]=et,vt+=3;for(a=0,n=Gt.length;n>a;a++)et=tt.value[Gt[a]],tt.array[vt]=et,tt.array[vt+1]=et,tt.array[vt+2]=et,tt.array[vt+3]=et,vt+=4}}else if(2===tt.size){if(void 0===tt.boundTo||"vertices"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],y=tt.value[h.a],T=tt.value[h.b],R=tt.value[h.c],tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=T.x,tt.array[vt+3]=T.y,tt.array[vt+4]=R.x,tt.array[vt+5]=R.y,vt+=6;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],y=tt.value[h.a],T=tt.value[h.b],R=tt.value[h.c],x=tt.value[h.d],tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=T.x,tt.array[vt+3]=T.y,tt.array[vt+4]=R.x,tt.array[vt+5]=R.y,tt.array[vt+6]=x.x,tt.array[vt+7]=x.y,vt+=8}else if("faces"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)et=tt.value[kt[a]],y=et,T=et,R=et,tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=T.x,tt.array[vt+3]=T.y,tt.array[vt+4]=R.x,tt.array[vt+5]=R.y,vt+=6;for(a=0,n=Gt.length;n>a;a++)et=tt.value[Gt[a]],y=et,T=et,R=et,x=et,tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=T.x,tt.array[vt+3]=T.y,tt.array[vt+4]=R.x,tt.array[vt+5]=R.y,tt.array[vt+6]=x.x,tt.array[vt+7]=x.y,vt+=8}}else if(3===tt.size){var Qt;if(Qt="c"===tt.type?["r","g","b"]:["x","y","z"],void 0===tt.boundTo||"vertices"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],y=tt.value[h.a],T=tt.value[h.b],R=tt.value[h.c],tt.array[vt]=y[Qt[0]],tt.array[vt+1]=y[Qt[1]],tt.array[vt+2]=y[Qt[2]],tt.array[vt+3]=T[Qt[0]],tt.array[vt+4]=T[Qt[1]],tt.array[vt+5]=T[Qt[2]],tt.array[vt+6]=R[Qt[0]],tt.array[vt+7]=R[Qt[1]],tt.array[vt+8]=R[Qt[2]],vt+=9;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],y=tt.value[h.a],T=tt.value[h.b],R=tt.value[h.c],x=tt.value[h.d],tt.array[vt]=y[Qt[0]],tt.array[vt+1]=y[Qt[1]],tt.array[vt+2]=y[Qt[2]],tt.array[vt+3]=T[Qt[0]],tt.array[vt+4]=T[Qt[1]],tt.array[vt+5]=T[Qt[2]],tt.array[vt+6]=R[Qt[0]],tt.array[vt+7]=R[Qt[1]],tt.array[vt+8]=R[Qt[2]],tt.array[vt+9]=x[Qt[0]],tt.array[vt+10]=x[Qt[1]],tt.array[vt+11]=x[Qt[2]],vt+=12}else if("faces"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)et=tt.value[kt[a]],y=et,T=et,R=et,tt.array[vt]=y[Qt[0]],tt.array[vt+1]=y[Qt[1]],tt.array[vt+2]=y[Qt[2]],tt.array[vt+3]=T[Qt[0]],tt.array[vt+4]=T[Qt[1]],tt.array[vt+5]=T[Qt[2]],tt.array[vt+6]=R[Qt[0]],tt.array[vt+7]=R[Qt[1]],tt.array[vt+8]=R[Qt[2]],vt+=9;for(a=0,n=Gt.length;n>a;a++)et=tt.value[Gt[a]],y=et,T=et,R=et,x=et,tt.array[vt]=y[Qt[0]],tt.array[vt+1]=y[Qt[1]],tt.array[vt+2]=y[Qt[2]],tt.array[vt+3]=T[Qt[0]],tt.array[vt+4]=T[Qt[1]],tt.array[vt+5]=T[Qt[2]],tt.array[vt+6]=R[Qt[0]],tt.array[vt+7]=R[Qt[1]],tt.array[vt+8]=R[Qt[2]],tt.array[vt+9]=x[Qt[0]],tt.array[vt+10]=x[Qt[1]],tt.array[vt+11]=x[Qt[2]],vt+=12}else if("faceVertices"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)et=tt.value[kt[a]],y=et[0],T=et[1],R=et[2],tt.array[vt]=y[Qt[0]],tt.array[vt+1]=y[Qt[1]],tt.array[vt+2]=y[Qt[2]],tt.array[vt+3]=T[Qt[0]],tt.array[vt+4]=T[Qt[1]],tt.array[vt+5]=T[Qt[2]],tt.array[vt+6]=R[Qt[0]],tt.array[vt+7]=R[Qt[1]],tt.array[vt+8]=R[Qt[2]],vt+=9;for(a=0,n=Gt.length;n>a;a++)et=tt.value[Gt[a]],y=et[0],T=et[1],R=et[2],x=et[3],tt.array[vt]=y[Qt[0]],tt.array[vt+1]=y[Qt[1]],tt.array[vt+2]=y[Qt[2]],tt.array[vt+3]=T[Qt[0]],tt.array[vt+4]=T[Qt[1]],tt.array[vt+5]=T[Qt[2]],tt.array[vt+6]=R[Qt[0]],tt.array[vt+7]=R[Qt[1]],tt.array[vt+8]=R[Qt[2]],tt.array[vt+9]=x[Qt[0]],tt.array[vt+10]=x[Qt[1]],tt.array[vt+11]=x[Qt[2]],vt+=12}}else if(4===tt.size)if(void 0===tt.boundTo||"vertices"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)h=jt[kt[a]],y=tt.value[h.a],T=tt.value[h.b],R=tt.value[h.c],tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=y.z,tt.array[vt+3]=y.w,tt.array[vt+4]=T.x,tt.array[vt+5]=T.y,tt.array[vt+6]=T.z,tt.array[vt+7]=T.w,tt.array[vt+8]=R.x,tt.array[vt+9]=R.y,tt.array[vt+10]=R.z,tt.array[vt+11]=R.w,vt+=12;for(a=0,n=Gt.length;n>a;a++)h=jt[Gt[a]],y=tt.value[h.a],T=tt.value[h.b],R=tt.value[h.c],x=tt.value[h.d],tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=y.z,tt.array[vt+3]=y.w,tt.array[vt+4]=T.x,tt.array[vt+5]=T.y,tt.array[vt+6]=T.z,tt.array[vt+7]=T.w,tt.array[vt+8]=R.x,tt.array[vt+9]=R.y,tt.array[vt+10]=R.z,tt.array[vt+11]=R.w,tt.array[vt+12]=x.x,tt.array[vt+13]=x.y,tt.array[vt+14]=x.z,tt.array[vt+15]=x.w,vt+=16}else if("faces"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)et=tt.value[kt[a]],y=et,T=et,R=et,tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=y.z,tt.array[vt+3]=y.w,tt.array[vt+4]=T.x,tt.array[vt+5]=T.y,tt.array[vt+6]=T.z,tt.array[vt+7]=T.w,tt.array[vt+8]=R.x,tt.array[vt+9]=R.y,tt.array[vt+10]=R.z,tt.array[vt+11]=R.w,vt+=12;for(a=0,n=Gt.length;n>a;a++)et=tt.value[Gt[a]],y=et,T=et,R=et,x=et,tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=y.z,tt.array[vt+3]=y.w,tt.array[vt+4]=T.x,tt.array[vt+5]=T.y,tt.array[vt+6]=T.z,tt.array[vt+7]=T.w,tt.array[vt+8]=R.x,tt.array[vt+9]=R.y,tt.array[vt+10]=R.z,tt.array[vt+11]=R.w,tt.array[vt+12]=x.x,tt.array[vt+13]=x.y,tt.array[vt+14]=x.z,tt.array[vt+15]=x.w,vt+=16}else if("faceVertices"===tt.boundTo){for(a=0,n=kt.length;n>a;a++)et=tt.value[kt[a]],y=et[0],T=et[1],R=et[2],tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=y.z,tt.array[vt+3]=y.w,tt.array[vt+4]=T.x,tt.array[vt+5]=T.y,tt.array[vt+6]=T.z,tt.array[vt+7]=T.w,tt.array[vt+8]=R.x,tt.array[vt+9]=R.y,tt.array[vt+10]=R.z,tt.array[vt+11]=R.w,vt+=12;for(a=0,n=Gt.length;n>a;a++)et=tt.value[Gt[a]],y=et[0],T=et[1],R=et[2],x=et[3],tt.array[vt]=y.x,tt.array[vt+1]=y.y,tt.array[vt+2]=y.z,tt.array[vt+3]=y.w,tt.array[vt+4]=T.x,tt.array[vt+5]=T.y,tt.array[vt+6]=T.z,tt.array[vt+7]=T.w,tt.array[vt+8]=R.x,tt.array[vt+9]=R.y,tt.array[vt+10]=R.z,tt.array[vt+11]=R.w,tt.array[vt+12]=x.x,tt.array[vt+13]=x.y,tt.array[vt+14]=x.z,tt.array[vt+15]=x.w,vt+=16}Nt.bindBuffer(Nt.ARRAY_BUFFER,tt.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,tt.array,i)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function R(e,t,i){var r=e.attributes,o=r.index,a=r.position,n=r.normal,s=r.uv,h=r.color,l=r.tangent;if(e.elementsNeedUpdate&&void 0!==o&&(Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,o.buffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,o.array,t)),e.verticesNeedUpdate&&void 0!==a&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,a.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,a.array,t)),e.normalsNeedUpdate&&void 0!==n&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,n.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,n.array,t)),e.uvsNeedUpdate&&void 0!==s&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,s.array,t)),e.colorsNeedUpdate&&void 0!==h&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,h.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,h.array,t)),e.tangentsNeedUpdate&&void 0!==l&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,l.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,l.array,t)),i)for(var c in e.attributes)delete e.attributes[c].array}function x(e){vi[e]||(Nt.enableVertexAttribArray(e),vi[e]=!0)}function H(){for(var e in vi)vi[e]&&(Nt.disableVertexAttribArray(e),vi[e]=!1)}function w(e,t,i){var r=e.program.attributes;if(-1!==i.morphTargetBase&&r.position>=0?(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),x(r.position),Nt.vertexAttribPointer(r.position,3,Nt.FLOAT,!1,0,0)):r.position>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglVertexBuffer),x(r.position),Nt.vertexAttribPointer(r.position,3,Nt.FLOAT,!1,0,0)),i.morphTargetForcedOrder.length)for(var o=0,a=i.morphTargetForcedOrder,n=i.morphTargetInfluences;e.numSupportedMorphTargets>o&&a.length>o;)r["morphTarget"+o]>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[a[o]]),x(r["morphTarget"+o]),Nt.vertexAttribPointer(r["morphTarget"+o],3,Nt.FLOAT,!1,0,0)),r["morphNormal"+o]>=0&&e.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[a[o]]),x(r["morphNormal"+o]),Nt.vertexAttribPointer(r["morphNormal"+o],3,Nt.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[o]=n[a[o]],o++;else{var s,h,l=[],n=i.morphTargetInfluences,c=n.length;for(h=0;c>h;h++)s=n[h],s>0&&l.push([s,h]);l.length>e.numSupportedMorphTargets?(l.sort(M),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(M):0===l.length&&l.push([0,0]);for(var u,o=0;e.numSupportedMorphTargets>o;)l[o]?(u=l[o][1],r["morphTarget"+o]>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),x(r["morphTarget"+o]),Nt.vertexAttribPointer(r["morphTarget"+o],3,Nt.FLOAT,!1,0,0)),r["morphNormal"+o]>=0&&e.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),x(r["morphNormal"+o]),Nt.vertexAttribPointer(r["morphNormal"+o],3,Nt.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[o]=n[u]):i.__webglMorphTargetInfluences[o]=0,o++}null!==e.program.uniforms.morphTargetInfluences&&Nt.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function b(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}function M(e,t){return t[0]-e[0]}function S(e,t,i){if(e.length)for(var r=0,o=e.length;o>r;r++)Xt=null,Zt=null,ti=-1,ai=-1,ni=-1,$t=-1,ei=-1,Kt=-1,qt=-1,Hi=!0,e[r].render(t,i,mi,Ei),Xt=null,Zt=null,ti=-1,ai=-1,ni=-1,$t=-1,ei=-1,Kt=-1,qt=-1,Hi=!0}function _(e,t,i,r,o,a,n,s){var h,l,c,u,p,f,d;t?(p=e.length-1,f=-1,d=-1):(p=0,f=e.length,d=1);for(var m=p;m!==f;m+=d)if(h=e[m],h.render){if(l=h.object,c=h.buffer,s)u=s;else{if(u=h[i],!u)continue;n&&Gt.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),Gt.setDepthTest(u.depthTest),Gt.setDepthWrite(u.depthWrite),st(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}Gt.setMaterialFaces(u),c instanceof THREE.BufferGeometry?Gt.renderBufferDirect(r,o,a,u,c,l):Gt.renderBuffer(r,o,a,u,c,l)}}function C(e,t,i,r,o,a,n){for(var s,h,l,c=0,u=e.length;u>c;c++)if(s=e[c],h=s.object,h.visible){if(n)l=n;else{if(l=s[t],!l)continue;a&&Gt.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),Gt.setDepthTest(l.depthTest),Gt.setDepthWrite(l.depthWrite),st(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}Gt.renderImmediateObject(i,r,o,l,h)}}function A(e){var t=e.object,i=t.material;i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)}function P(e){var t,i,r,o=e.object,a=e.buffer;r=o.material,r instanceof THREE.MeshFaceMaterial?(i=a.materialIndex,t=r.materials[i],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function D(e,t){var i,r,o,a,n,s,h={},l=e.morphTargets.length,c=e.morphNormals.length,u=t instanceof THREE.MeshFaceMaterial;for(e.geometryGroups={},i=0,r=e.faces.length;r>i;i++)o=e.faces[i],a=u?o.materialIndex:0,void 0===h[a]&&(h[a]={hash:a,counter:0}),s=h[a].hash+"_"+h[a].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:a,vertices:0,numMorphTargets:l,numMorphNormals:c}),n=o instanceof THREE.Face3?3:4,e.geometryGroups[s].vertices+n>65535&&(h[a].counter+=1,s=h[a].hash+"_"+h[a].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:a,vertices:0,numMorphTargets:l,numMorphNormals:c})),o instanceof THREE.Face3?e.geometryGroups[s].faces3.push(i):e.geometryGroups[s].faces4.push(i),e.geometryGroups[s].vertices+=n;e.geometryGroupsList=[];for(var p in e.geometryGroups)e.geometryGroups[p].id=Qt++,e.geometryGroupsList.push(e.geometryGroups[p])}function L(e,a){var n,u,p,f;if(!e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Ui)),e instanceof THREE.Mesh)if(u=e.geometry,p=e.material,u instanceof THREE.Geometry){void 0===u.geometryGroups&&D(u,p);for(n in u.geometryGroups)f=u.geometryGroups[n],f.__webglVertexBuffer||(o(f),c(f,e),u.verticesNeedUpdate=!0,u.morphTargetsNeedUpdate=!0,u.elementsNeedUpdate=!0,u.uvsNeedUpdate=!0,u.normalsNeedUpdate=!0,u.tangentsNeedUpdate=!0,u.colorsNeedUpdate=!0)}else u instanceof THREE.BufferGeometry&&E(u);else e instanceof THREE.Ribbon?(u=e.geometry,u.__webglVertexBuffer||(r(u),l(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.normalsNeedUpdate=!0)):e instanceof THREE.Line?(u=e.geometry,u.__webglVertexBuffer||(u instanceof THREE.Geometry?(i(u),h(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.lineDistancesNeedUpdate=!0):u instanceof THREE.BufferGeometry&&E(u))):e instanceof THREE.ParticleSystem&&(u=e.geometry,u.__webglVertexBuffer||(u instanceof THREE.Geometry?(t(u),s(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0):u instanceof THREE.BufferGeometry&&E(u)));if(!e.__webglActive){if(e instanceof THREE.Mesh){if(u=e.geometry,u instanceof THREE.BufferGeometry)z(a.__webglObjects,u,e);else if(u instanceof THREE.Geometry)for(n in u.geometryGroups)f=u.geometryGroups[n],z(a.__webglObjects,f,e)}else e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(u=e.geometry,z(a.__webglObjects,u,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?F(a.__webglObjectsImmediate,e):e instanceof THREE.Sprite?a.__webglSprites.push(e):e instanceof THREE.LensFlare&&a.__webglFlares.push(e);e.__webglActive=!0}}function z(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function F(e,t){e.push({object:t,opaque:null,transparent:null})}function V(e){var t,i,r,o=e.geometry;if(e instanceof THREE.Mesh)if(o instanceof THREE.BufferGeometry)(o.verticesNeedUpdate||o.elementsNeedUpdate||o.uvsNeedUpdate||o.normalsNeedUpdate||o.colorsNeedUpdate||o.tangentsNeedUpdate)&&R(o,Nt.DYNAMIC_DRAW,!o.dynamic),o.verticesNeedUpdate=!1,o.elementsNeedUpdate=!1,o.uvsNeedUpdate=!1,o.normalsNeedUpdate=!1,o.colorsNeedUpdate=!1,o.tangentsNeedUpdate=!1;else{for(var a=0,n=o.geometryGroupsList.length;n>a;a++)t=o.geometryGroupsList[a],r=u(e,t),o.buffersNeedUpdate&&c(t,e),i=r.attributes&&U(r),(o.verticesNeedUpdate||o.morphTargetsNeedUpdate||o.elementsNeedUpdate||o.uvsNeedUpdate||o.normalsNeedUpdate||o.colorsNeedUpdate||o.tangentsNeedUpdate||i)&&T(t,e,Nt.DYNAMIC_DRAW,!o.dynamic,r);o.verticesNeedUpdate=!1,o.morphTargetsNeedUpdate=!1,o.elementsNeedUpdate=!1,o.uvsNeedUpdate=!1,o.normalsNeedUpdate=!1,o.colorsNeedUpdate=!1,o.tangentsNeedUpdate=!1,o.buffersNeedUpdate=!1,r.attributes&&N(r)}else e instanceof THREE.Ribbon?(r=u(e,o),i=r.attributes&&U(r),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.normalsNeedUpdate||i)&&y(o,Nt.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.normalsNeedUpdate=!1,r.attributes&&N(r)):e instanceof THREE.Line?o instanceof THREE.BufferGeometry?((o.verticesNeedUpdate||o.colorsNeedUpdate)&&R(o,Nt.DYNAMIC_DRAW,!o.dynamic),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1):(r=u(e,o),i=r.attributes&&U(r),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.lineDistancesNeedUpdate||i)&&g(o,Nt.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.lineDistancesNeedUpdate=!1,r.attributes&&N(r)):e instanceof THREE.ParticleSystem&&(o instanceof THREE.BufferGeometry?((o.verticesNeedUpdate||o.colorsNeedUpdate)&&R(o,Nt.DYNAMIC_DRAW,!o.dynamic),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1):(r=u(e,o),i=r.attributes&&U(r),(o.verticesNeedUpdate||o.colorsNeedUpdate||e.sortParticles||i)&&v(o,Nt.DYNAMIC_DRAW,e),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,r.attributes&&N(r)))}function U(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function N(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function B(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line?I(t.__webglObjects,e):e instanceof THREE.Sprite?O(t.__webglSprites,e):e instanceof THREE.LensFlare?O(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&I(t.__webglObjectsImmediate,e),e.__webglActive=!1}function I(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function O(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function k(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function G(e,t,i,r,o){Jt=0,r.needsUpdate&&(r.program&&ji(r),Gt.initMaterial(r,t,i,o),r.needsUpdate=!1),r.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(Gt.maxMorphTargets)));var a=!1,n=r.program,s=n.uniforms,h=r.uniforms;if(n!==Xt&&(Nt.useProgram(n),Xt=n,a=!0),r.id!==qt&&(qt=r.id,a=!0),(a||e!==Zt)&&(Nt.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements),e!==Zt&&(Zt=e)),r.skinning)if(Ai&&o.useVertexTexture){if(null!==s.boneTexture){var l=et();Nt.uniform1i(s.boneTexture,l),Gt.setTexture(o.boneTexture,l)}}else null!==s.boneGlobalMatrices&&Nt.uniformMatrix4fv(s.boneGlobalMatrices,!1,o.boneMatrices);return a&&(i&&r.fog&&q(h,i),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights)&&(Hi&&(at(n,t),Hi=!1),Q(h,wi)),(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&j(h,r),r instanceof THREE.LineBasicMaterial?W(h,r):r instanceof THREE.LineDashedMaterial?(W(h,r),X(h,r)):r instanceof THREE.ParticleBasicMaterial?Y(h,r):r instanceof THREE.MeshPhongMaterial?K(h,r):r instanceof THREE.MeshLambertMaterial?Z(h,r):r instanceof THREE.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(h.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&J(h,t),tt(n,r.uniformsList),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==s.cameraPosition&&(Ri.getPositionFromMatrix(e.matrixWorld),Nt.uniform3f(s.cameraPosition,Ri.x,Ri.y,Ri.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==s.viewMatrix&&Nt.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements)),$(s,o),null!==s.modelMatrix&&Nt.uniformMatrix4fv(s.modelMatrix,!1,o.matrixWorld.elements),n}function j(e,t){e.opacity.value=t.opacity,Gt.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap),void 0!==i){var r=i.offset,o=i.repeat;e.offsetRepeat.value.set(r.x,r.y,o.x,o.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=Gt.gammaInput?t.reflectivity:t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function W(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function X(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function Y(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Ct.height/2,e.map.value=t.map}function q(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function K(e,t){e.shininess.value=t.shininess,Gt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Z(e,t){Gt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)
}function Q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function J(e,t){if(e.shadowMatrix)for(var i=0,r=0,o=t.length;o>r;r++){var a=t[r];a.castShadow&&(a instanceof THREE.SpotLight||a instanceof THREE.DirectionalLight&&!a.shadowCascade)&&(e.shadowMap.value[i]=a.shadowMap,e.shadowMapSize.value[i]=a.shadowMapSize,e.shadowMatrix.value[i]=a.shadowMatrix,e.shadowDarkness.value[i]=a.shadowDarkness,e.shadowBias.value[i]=a.shadowBias,i++)}}function $(e,t){Nt.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Nt.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function et(){var e=Jt;return e>=bi&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+bi),Jt+=1,e}function tt(e,t){var i,r,o,a,n,s,h,l,c,u,p;for(c=0,u=t.length;u>c;c++)if(a=e.uniforms[t[c][1]])if(i=t[c][0],o=i.type,r=i.value,"i"===o)Nt.uniform1i(a,r);else if("f"===o)Nt.uniform1f(a,r);else if("v2"===o)Nt.uniform2f(a,r.x,r.y);else if("v3"===o)Nt.uniform3f(a,r.x,r.y,r.z);else if("v4"===o)Nt.uniform4f(a,r.x,r.y,r.z,r.w);else if("c"===o)Nt.uniform3f(a,r.r,r.g,r.b);else if("iv1"===o)Nt.uniform1iv(a,r);else if("iv"===o)Nt.uniform3iv(a,r);else if("fv1"===o)Nt.uniform1fv(a,r);else if("fv"===o)Nt.uniform3fv(a,r);else if("v2v"===o){for(void 0===i._array&&(i._array=new Float32Array(2*r.length)),h=0,l=r.length;l>h;h++)p=2*h,i._array[p]=r[h].x,i._array[p+1]=r[h].y;Nt.uniform2fv(a,i._array)}else if("v3v"===o){for(void 0===i._array&&(i._array=new Float32Array(3*r.length)),h=0,l=r.length;l>h;h++)p=3*h,i._array[p]=r[h].x,i._array[p+1]=r[h].y,i._array[p+2]=r[h].z;Nt.uniform3fv(a,i._array)}else if("v4v"===o){for(void 0===i._array&&(i._array=new Float32Array(4*r.length)),h=0,l=r.length;l>h;h++)p=4*h,i._array[p]=r[h].x,i._array[p+1]=r[h].y,i._array[p+2]=r[h].z,i._array[p+3]=r[h].w;Nt.uniform4fv(a,i._array)}else if("m4"===o)void 0===i._array&&(i._array=new Float32Array(16)),r.flattenToArray(i._array),Nt.uniformMatrix4fv(a,!1,i._array);else if("m4v"===o){for(void 0===i._array&&(i._array=new Float32Array(16*r.length)),h=0,l=r.length;l>h;h++)r[h].flattenToArrayOffset(i._array,16*h);Nt.uniformMatrix4fv(a,!1,i._array)}else if("t"===o){if(n=r,s=et(),Nt.uniform1i(a,s),!n)continue;n.image instanceof Array&&6===n.image.length?vt(n,s):n instanceof THREE.WebGLRenderTargetCube?gt(n,s):Gt.setTexture(n,s)}else if("tv"===o){for(void 0===i._array&&(i._array=[]),h=0,l=i.value.length;l>h;h++)i._array[h]=et();for(Nt.uniform1iv(a,i._array),h=0,l=i.value.length;l>h;h++)n=i.value[h],s=i._array[h],n&&Gt.setTexture(n,s)}}function it(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function rt(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function ot(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function at(e,t){var i,r,o,a,n,s,h,l,c,u=0,p=0,f=0,d=wi,m=d.directional.colors,E=d.directional.positions,v=d.point.colors,g=d.point.positions,y=d.point.distances,T=d.spot.colors,R=d.spot.positions,x=d.spot.distances,H=d.spot.directions,w=d.spot.anglesCos,b=d.spot.exponents,M=d.hemi.skyColors,S=d.hemi.groundColors,_=d.hemi.positions,C=0,A=0,P=0,D=0,L=0,z=0,F=0,V=0,U=0,N=0,B=0,I=0;for(i=0,r=t.length;r>i;i++)if(o=t[i],!o.onlyShadow)if(a=o.color,h=o.intensity,c=o.distance,o instanceof THREE.AmbientLight){if(!o.visible)continue;Gt.gammaInput?(u+=a.r*a.r,p+=a.g*a.g,f+=a.b*a.b):(u+=a.r,p+=a.g,f+=a.b)}else if(o instanceof THREE.DirectionalLight){if(L+=1,!o.visible)continue;if(xi.getPositionFromMatrix(o.matrixWorld),Ri.getPositionFromMatrix(o.target.matrixWorld),xi.sub(Ri),xi.normalize(),0===xi.x&&0===xi.y&&0===xi.z)continue;U=3*C,E[U]=xi.x,E[U+1]=xi.y,E[U+2]=xi.z,Gt.gammaInput?rt(m,U,a,h*h):ot(m,U,a,h),C+=1}else if(o instanceof THREE.PointLight){if(z+=1,!o.visible)continue;N=3*A,Gt.gammaInput?rt(v,N,a,h*h):ot(v,N,a,h),Ri.getPositionFromMatrix(o.matrixWorld),g[N]=Ri.x,g[N+1]=Ri.y,g[N+2]=Ri.z,y[A]=c,A+=1}else if(o instanceof THREE.SpotLight){if(F+=1,!o.visible)continue;B=3*P,Gt.gammaInput?rt(T,B,a,h*h):ot(T,B,a,h),Ri.getPositionFromMatrix(o.matrixWorld),R[B]=Ri.x,R[B+1]=Ri.y,R[B+2]=Ri.z,x[P]=c,xi.copy(Ri),Ri.getPositionFromMatrix(o.target.matrixWorld),xi.sub(Ri),xi.normalize(),H[B]=xi.x,H[B+1]=xi.y,H[B+2]=xi.z,w[P]=Math.cos(o.angle),b[P]=o.exponent,P+=1}else if(o instanceof THREE.HemisphereLight){if(V+=1,!o.visible)continue;if(xi.getPositionFromMatrix(o.matrixWorld),xi.normalize(),0===xi.x&&0===xi.y&&0===xi.z)continue;I=3*D,_[I]=xi.x,_[I+1]=xi.y,_[I+2]=xi.z,n=o.color,s=o.groundColor,Gt.gammaInput?(l=h*h,rt(M,I,n,l),rt(S,I,s,l)):(ot(M,I,n,h),ot(S,I,s,h)),D+=1}for(i=3*C,r=Math.max(m.length,3*L);r>i;i++)m[i]=0;for(i=3*A,r=Math.max(v.length,3*z);r>i;i++)v[i]=0;for(i=3*P,r=Math.max(T.length,3*F);r>i;i++)T[i]=0;for(i=3*D,r=Math.max(M.length,3*V);r>i;i++)M[i]=0;for(i=3*D,r=Math.max(S.length,3*V);r>i;i++)S[i]=0;d.directional.length=C,d.point.length=A,d.spot.length=P,d.hemi.length=D,d.ambient[0]=u,d.ambient[1]=p,d.ambient[2]=f}function nt(e){e!==ci&&(Nt.lineWidth(e),ci=e)}function st(e,t,i){si!==e&&(e?Nt.enable(Nt.POLYGON_OFFSET_FILL):Nt.disable(Nt.POLYGON_OFFSET_FILL),si=e),!e||hi===t&&li===i||(Nt.polygonOffset(t,i),hi=t,li=i)}function ht(e){var t,i,r=[];for(var o in e)t=e[o],t!==!1&&(i="#define "+o+" "+t,r.push(i));return r.join("\n")}function lt(e,t,i,r,o,a,n){var s,h,l,c,u,p=[];e?p.push(e):(p.push(t),p.push(i));for(l in a)p.push(l),p.push(a[l]);for(s in n)p.push(s),p.push(n[s]);for(u=p.join(),s=0,h=jt.length;h>s;s++){var f=jt[s];if(f.code===u)return f.usedTimes++,f.program}var d="SHADOWMAP_TYPE_BASIC";n.shadowMapType===THREE.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":n.shadowMapType===THREE.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var m=ht(a);c=Nt.createProgram();var E=["precision "+At+" float;",m,Ci?"#define VERTEX_TEXTURES":"",Gt.gammaInput?"#define GAMMA_INPUT":"",Gt.gammaOutput?"#define GAMMA_OUTPUT":"",Gt.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.boneTextureWidth?"#define N_BONE_PIXEL_X "+n.boneTextureWidth.toFixed(1):"",n.boneTextureHeight?"#define N_BONE_PIXEL_Y "+n.boneTextureHeight.toFixed(1):"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),v=["precision "+At+" float;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",m,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",Gt.gammaInput?"#define GAMMA_INPUT":"",Gt.gammaOutput?"#define GAMMA_OUTPUT":"",Gt.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),g=ft("fragment",v+t),y=ft("vertex",E+i);Nt.attachShader(c,y),Nt.attachShader(c,g),Nt.linkProgram(c),Nt.getProgramParameter(c,Nt.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+Nt.getProgramParameter(c,Nt.VALIDATE_STATUS)+", gl error ["+Nt.getError()+"]"),Nt.deleteShader(g),Nt.deleteShader(y),c.uniforms={},c.attributes={};var T,R,x,H;T=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],n.useVertexTexture?T.push("boneTexture"):T.push("boneGlobalMatrices");for(R in r)T.push(R);for(ct(c,T),T=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],H=0;n.maxMorphTargets>H;H++)T.push("morphTarget"+H);for(H=0;n.maxMorphNormals>H;H++)T.push("morphNormal"+H);for(x in o)T.push(x);return ut(c,T),c.id=Wt++,jt.push({program:c,code:u,usedTimes:1}),Gt.info.memory.programs=jt.length,c}function ct(e,t){var i,r,o;for(i=0,r=t.length;r>i;i++)o=t[i],e.uniforms[o]=Nt.getUniformLocation(e,o)}function ut(e,t){var i,r,o;for(i=0,r=t.length;r>i;i++)o=t[i],e.attributes[o]=Nt.getAttribLocation(e,o)}function pt(e){for(var t=e.split("\n"),i=0,r=t.length;r>i;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function ft(e,t){var i;return"fragment"===e?i=Nt.createShader(Nt.FRAGMENT_SHADER):"vertex"===e&&(i=Nt.createShader(Nt.VERTEX_SHADER)),Nt.shaderSource(i,t),Nt.compileShader(i),Nt.getShaderParameter(i,Nt.COMPILE_STATUS)?i:(console.error(Nt.getShaderInfoLog(i)),console.error(pt(t)),null)}function dt(e){return 0===(e&e-1)}function mt(e,t,i){i?(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,Ht(t.wrapS)),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,Ht(t.wrapT)),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,Ht(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,Ht(t.minFilter))):(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,xt(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,xt(t.minFilter))),Ot&&t.type!==THREE.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Nt.texParameterf(e,Ot.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,_i)),t.__oldAnisotropy=t.anisotropy)}function Et(e,t){if(t>=e.width&&t>=e.height)return e;var i=Math.max(e.width,e.height),r=Math.floor(e.width*t/i),o=Math.floor(e.height*t/i),a=document.createElement("canvas");a.width=r,a.height=o;var n=a.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,r,o),a}function vt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.image.__webglTextureCube=Nt.createTexture(),Gt.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,r=[],o=0;6>o;o++)r[o]=Gt.autoScaleCubemaps&&!i?Et(e.image[o],Si):e.image[o];var a=r[0],n=dt(a.width)&&dt(a.height),s=Ht(e.format),h=Ht(e.type);mt(Nt.TEXTURE_CUBE_MAP,e,n);for(var o=0;6>o;o++)if(i)for(var l,c=r[o].mipmaps,u=0,p=c.length;p>u;u++)l=c[u],Nt.compressedTexImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+o,u,s,l.width,l.height,0,l.data);else Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,s,s,h,r[o]);e.generateMipmaps&&n&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function gt(e,t){Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.__webglTexture)}function yt(e,t,i){Nt.bindFramebuffer(Nt.FRAMEBUFFER,e),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function Tt(e,t){Nt.bindRenderbuffer(Nt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_COMPONENT16,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_STENCIL,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e)):Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.RGBA4,t.width,t.height)}function Rt(e){e instanceof THREE.WebGLRenderTargetCube?(Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null)):(Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_2D),Nt.bindTexture(Nt.TEXTURE_2D,null))}function xt(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Nt.NEAREST:Nt.LINEAR}function Ht(e){if(e===THREE.RepeatWrapping)return Nt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Nt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Nt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Nt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Nt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Nt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Nt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Nt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Nt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Nt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Nt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Nt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Nt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Nt.BYTE;if(e===THREE.ShortType)return Nt.SHORT;if(e===THREE.UnsignedShortType)return Nt.UNSIGNED_SHORT;if(e===THREE.IntType)return Nt.INT;if(e===THREE.UnsignedIntType)return Nt.UNSIGNED_INT;if(e===THREE.FloatType)return Nt.FLOAT;if(e===THREE.AlphaFormat)return Nt.ALPHA;if(e===THREE.RGBFormat)return Nt.RGB;if(e===THREE.RGBAFormat)return Nt.RGBA;if(e===THREE.LuminanceFormat)return Nt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Nt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Nt.FUNC_ADD;if(e===THREE.SubtractEquation)return Nt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Nt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Nt.ZERO;if(e===THREE.OneFactor)return Nt.ONE;if(e===THREE.SrcColorFactor)return Nt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Nt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Nt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Nt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Nt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Nt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Nt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Nt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Nt.SRC_ALPHA_SATURATE;if(void 0!==kt){if(e===THREE.RGB_S3TC_DXT1_Format)return kt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return kt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return kt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return kt.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function wt(e){if(Ai&&e&&e.useVertexTexture)return 1024;var t=Nt.getParameter(Nt.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),r=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(r=Math.min(e.bones.length,r),e.bones.length>r&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function bt(e){var t,i,r,o,a,n,s;for(o=a=n=s=0,t=0,i=e.length;i>t;t++)r=e[t],r.onlyShadow||(r instanceof THREE.DirectionalLight&&o++,r instanceof THREE.PointLight&&a++,r instanceof THREE.SpotLight&&n++,r instanceof THREE.HemisphereLight&&s++);return{directional:o,point:a,spot:n,hemi:s}}function Mt(e){var t,i,r,o=0;for(t=0,i=e.length;i>t;t++)r=e[t],r.castShadow&&(r instanceof THREE.SpotLight&&o++,r instanceof THREE.DirectionalLight&&!r.shadowCascade&&o++);return o}function St(){try{if(!(Nt=Ct.getContext("experimental-webgl",{alpha:Pt,premultipliedAlpha:Dt,antialias:Lt,stencil:zt,preserveDrawingBuffer:Ft})))throw"Error creating WebGL context."}catch(e){console.error(e)}Bt=Nt.getExtension("OES_texture_float"),It=Nt.getExtension("OES_standard_derivatives"),Ot=Nt.getExtension("EXT_texture_filter_anisotropic")||Nt.getExtension("MOZ_EXT_texture_filter_anisotropic")||Nt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),kt=Nt.getExtension("WEBGL_compressed_texture_s3tc")||Nt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Nt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Bt||console.log("THREE.WebGLRenderer: Float textures not supported."),It||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Ot||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),kt||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Nt.getShaderPrecisionFormat&&(Nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function _t(){Nt.clearColor(0,0,0,1),Nt.clearDepth(1),Nt.clearStencil(0),Nt.enable(Nt.DEPTH_TEST),Nt.depthFunc(Nt.LEQUAL),Nt.frontFace(Nt.CCW),Nt.cullFace(Nt.BACK),Nt.enable(Nt.CULL_FACE),Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA),Nt.clearColor(Vt.r,Vt.g,Vt.b,Ut)}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var Ct=void 0!==e.canvas?e.canvas:document.createElement("canvas"),At=void 0!==e.precision?e.precision:"highp",Pt=void 0!==e.alpha?e.alpha:!0,Dt=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Lt=void 0!==e.antialias?e.antialias:!1,zt=void 0!==e.stencil?e.stencil:!0,Ft=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Vt=void 0!==e.clearColor?new THREE.Color(e.clearColor):new THREE.Color(0),Ut=void 0!==e.clearAlpha?e.clearAlpha:0;this.domElement=Ct,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Nt,Bt,It,Ot,kt,Gt=this,jt=[],Wt=0,Xt=null,Yt=null,qt=-1,Kt=null,Zt=null,Qt=0,Jt=0,$t=-1,ei=-1,ti=-1,ii=-1,ri=-1,oi=-1,ai=-1,ni=-1,si=null,hi=null,li=null,ci=null,ui=0,pi=0,fi=0,di=0,mi=0,Ei=0,vi={},gi=new THREE.Frustum,yi=new THREE.Matrix4,Ti=new THREE.Matrix4,Ri=new THREE.Vector3,xi=new THREE.Vector3,Hi=!0,wi={ambient:[0,0,0],directional:{length:0,colors:Array(),positions:Array()},point:{length:0,colors:Array(),positions:Array(),distances:Array()},spot:{length:0,colors:Array(),positions:Array(),distances:Array(),directions:Array(),anglesCos:Array(),exponents:Array()},hemi:{length:0,skyColors:Array(),groundColors:Array(),positions:Array()}};St(),_t(),this.context=Nt;var bi=Nt.getParameter(Nt.MAX_TEXTURE_IMAGE_UNITS),Mi=Nt.getParameter(Nt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Nt.getParameter(Nt.MAX_TEXTURE_SIZE);var Si=Nt.getParameter(Nt.MAX_CUBE_MAP_TEXTURE_SIZE),_i=Ot?Nt.getParameter(Ot.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ci=Mi>0,Ai=Ci&&Bt;kt?Nt.getParameter(Nt.COMPRESSED_TEXTURE_FORMATS):[];var Pi=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_FLOAT),Di=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_FLOAT);var Li=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_FLOAT),zi=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_FLOAT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_INT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_INT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_INT);var Fi=Pi.precision>0&&Li.precision>0,Vi=Di.precision>0&&zi.precision>0;"highp"!==At||Fi||(Vi?(At="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(At="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==At||Vi||(At="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Nt},this.supportsVertexTextures=function(){return Ci},this.supportsFloatTextures=function(){return Bt},this.supportsStandardDerivatives=function(){return It},this.supportsCompressedTextureS3TC=function(){return kt},this.getMaxAnisotropy=function(){return _i},this.getPrecision=function(){return At},this.setSize=function(e,t){Ct.width=e*this.devicePixelRatio,Ct.height=t*this.devicePixelRatio,Ct.style.width=e+"px",Ct.style.height=t+"px",this.setViewport(0,0,Ct.width,Ct.height)},this.setViewport=function(e,t,i,r){ui=void 0!==e?e:0,pi=void 0!==t?t:0,fi=void 0!==i?i:Ct.width,di=void 0!==r?r:Ct.height,Nt.viewport(ui,pi,fi,di)},this.setScissor=function(e,t,i,r){Nt.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?Nt.enable(Nt.SCISSOR_TEST):Nt.disable(Nt.SCISSOR_TEST)},this.setClearColorHex=function(e,t){Vt.setHex(e),Ut=t,Nt.clearColor(Vt.r,Vt.g,Vt.b,Ut)},this.setClearColor=function(e,t){Vt.copy(e),Ut=t,Nt.clearColor(Vt.r,Vt.g,Vt.b,Ut)},this.getClearColor=function(){return Vt},this.getClearAlpha=function(){return Ut},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=Nt.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=Nt.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=Nt.STENCIL_BUFFER_BIT),Nt.clear(r)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Xt=null,ti=-1,ai=-1,ni=-1,Kt=-1,qt=-1,Hi=!0,$t=-1,ei=-1,this.shadowMapPlugin.update(e,t)};var Ui=function(e){var t=e.target;t.removeEventListener("dispose",Ui),Oi(t),Gt.info.memory.geometries--},Ni=function(e){var t=e.target;t.removeEventListener("dispose",Ni),ki(t),Gt.info.memory.textures--},Bi=function(e){var t=e.target;t.removeEventListener("dispose",Bi),Gi(t),Gt.info.memory.textures--},Ii=function(e){var t=e.target;t.removeEventListener("dispose",Ii),ji(t)},Oi=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&Nt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Nt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Nt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Nt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Nt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Nt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Nt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Nt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Nt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Nt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Nt.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var i=e.geometryGroups[t];if(void 0!==i.numMorphTargets)for(var r=0,o=i.numMorphTargets;o>r;r++)Nt.deleteBuffer(i.__webglMorphTargetsBuffers[r]);if(void 0!==i.numMorphNormals)for(var r=0,o=i.numMorphNormals;o>r;r++)Nt.deleteBuffer(i.__webglMorphNormalsBuffers[r]);a(i)}a(e)},ki=function(e){if(e.image&&e.image.__webglTextureCube)Nt.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Nt.deleteTexture(e.__webglTexture)}},Gi=function(e){if(e&&e.__webglTexture)if(Nt.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)Nt.deleteFramebuffer(e.__webglFramebuffer[t]),Nt.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Nt.deleteFramebuffer(e.__webglFramebuffer),Nt.deleteRenderbuffer(e.__webglRenderbuffer)},ji=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,r,o,a=!1;for(i=0,r=jt.length;r>i;i++)if(o=jt[i],o.program===t){o.usedTimes--,0===o.usedTimes&&(a=!0);break}if(a===!0){var n=[];for(i=0,r=jt.length;r>i;i++)o=jt[i],o.program!==t&&n.push(o);jt=n,Nt.deleteProgram(t),Gt.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Nt.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Nt.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Nt.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Nt.createBuffer()),e.hasPositions&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.positionArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.position),Nt.vertexAttribPointer(t.attributes.position,3,Nt.FLOAT,!1,0,0)),e.hasNormals){if(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===THREE.FlatShading){var r,o,a,n,s,h,l,c,u,p,f,d,m,E,v=3*e.count;for(E=0;v>E;E+=9)m=e.normalArray,n=m[E],l=m[E+1],p=m[E+2],s=m[E+3],c=m[E+4],f=m[E+5],h=m[E+6],u=m[E+7],d=m[E+8],r=(n+s+h)/3,o=(l+c+u)/3,a=(p+f+d)/3,m[E]=r,m[E+1]=o,m[E+2]=a,m[E+3]=r,m[E+4]=o,m[E+5]=a,m[E+6]=r,m[E+7]=o,m[E+8]=a}Nt.bufferData(Nt.ARRAY_BUFFER,e.normalArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.normal),Nt.vertexAttribPointer(t.attributes.normal,3,Nt.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglUvBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.uvArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.uv),Nt.vertexAttribPointer(t.attributes.uv,2,Nt.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.colorArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.color),Nt.vertexAttribPointer(t.attributes.color,3,Nt.FLOAT,!1,0,0)),Nt.drawArrays(Nt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,o,a){if(r.visible!==!1){var n,s;n=G(e,t,i,r,a),s=n.attributes;var h=!1,l=r.wireframe?1:0,c=16777215*o.id+2*n.id+l;if(c!==Kt&&(Kt=c,h=!0),h&&H(),a instanceof THREE.Mesh){var u=o.attributes.index;if(u){var p=o.offsets;p.length>1&&(h=!0);for(var f=0,d=p.length;d>f;f++){var m=p[f].index;if(h){var E=o.attributes.position,v=E.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,E.buffer),x(s.position),Nt.vertexAttribPointer(s.position,v,Nt.FLOAT,!1,0,4*m*v);var g=o.attributes.normal;if(s.normal>=0&&g){var y=g.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,g.buffer),x(s.normal),Nt.vertexAttribPointer(s.normal,y,Nt.FLOAT,!1,0,4*m*y)}var T=o.attributes.uv;if(s.uv>=0&&T){var R=T.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,T.buffer),x(s.uv),Nt.vertexAttribPointer(s.uv,R,Nt.FLOAT,!1,0,4*m*R)}var w=o.attributes.color;if(s.color>=0&&w){var b=w.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,w.buffer),x(s.color),Nt.vertexAttribPointer(s.color,b,Nt.FLOAT,!1,0,4*m*b)}var M=o.attributes.tangent;if(s.tangent>=0&&M){var S=M.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,M.buffer),x(s.tangent),Nt.vertexAttribPointer(s.tangent,S,Nt.FLOAT,!1,0,4*m*S)}Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,u.buffer)}Nt.drawElements(Nt.TRIANGLES,p[f].count,Nt.UNSIGNED_SHORT,2*p[f].start),Gt.info.render.calls++,Gt.info.render.vertices+=p[f].count,Gt.info.render.faces+=p[f].count/3}}else{if(h){var E=o.attributes.position,v=E.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,E.buffer),x(s.position),Nt.vertexAttribPointer(s.position,v,Nt.FLOAT,!1,0,0);var g=o.attributes.normal;if(s.normal>=0&&g){var y=g.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,g.buffer),x(s.normal),Nt.vertexAttribPointer(s.normal,y,Nt.FLOAT,!1,0,0)}var T=o.attributes.uv;if(s.uv>=0&&T){var R=T.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,T.buffer),x(s.uv),Nt.vertexAttribPointer(s.uv,R,Nt.FLOAT,!1,0,0)}var w=o.attributes.color;if(s.color>=0&&w){var b=w.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,w.buffer),x(s.color),Nt.vertexAttribPointer(s.color,b,Nt.FLOAT,!1,0,0)}var M=o.attributes.tangent;if(s.tangent>=0&&M){var S=M.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,M.buffer),x(s.tangent),Nt.vertexAttribPointer(s.tangent,S,Nt.FLOAT,!1,0,0)}}Nt.drawArrays(Nt.TRIANGLES,0,E.numItems/3),Gt.info.render.calls++,Gt.info.render.vertices+=E.numItems/3,Gt.info.render.faces+=E.numItems/3/3}}else if(a instanceof THREE.ParticleSystem){if(h){var E=o.attributes.position,v=E.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,E.buffer),x(s.position),Nt.vertexAttribPointer(s.position,v,Nt.FLOAT,!1,0,0);var w=o.attributes.color;if(s.color>=0&&w){var b=w.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,w.buffer),x(s.color),Nt.vertexAttribPointer(s.color,b,Nt.FLOAT,!1,0,0)}Nt.drawArrays(Nt.POINTS,0,E.numItems/3),Gt.info.render.calls++,Gt.info.render.points+=E.numItems/3}}else if(a instanceof THREE.Line&&h){var E=o.attributes.position,v=E.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,E.buffer),x(s.position),Nt.vertexAttribPointer(s.position,v,Nt.FLOAT,!1,0,0);var w=o.attributes.color;if(s.color>=0&&w){var b=w.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,w.buffer),x(s.color),Nt.vertexAttribPointer(s.color,b,Nt.FLOAT,!1,0,0)}nt(r.linewidth),Nt.drawArrays(Nt.LINE_STRIP,0,E.numItems/3),Gt.info.render.calls++,Gt.info.render.points+=E.numItems}}},this.renderBuffer=function(e,t,i,r,o,a){if(r.visible!==!1){var n,s,h,l,c,u;n=G(e,t,i,r,a),s=n.attributes;var p=!1,f=r.wireframe?1:0,d=16777215*o.id+2*n.id+f;if(d!==Kt&&(Kt=d,p=!0),p&&H(),!r.morphTargets&&s.position>=0?p&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglVertexBuffer),x(s.position),Nt.vertexAttribPointer(s.position,3,Nt.FLOAT,!1,0,0)):a.morphTargetBase&&w(r,o,a),p){if(o.__webglCustomAttributesList)for(c=0,u=o.__webglCustomAttributesList.length;u>c;c++)l=o.__webglCustomAttributesList[c],s[l.buffer.belongsToAttribute]>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,l.buffer),x(s[l.buffer.belongsToAttribute]),Nt.vertexAttribPointer(s[l.buffer.belongsToAttribute],l.size,Nt.FLOAT,!1,0,0));
s.color>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglColorBuffer),x(s.color),Nt.vertexAttribPointer(s.color,3,Nt.FLOAT,!1,0,0)),s.normal>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglNormalBuffer),x(s.normal),Nt.vertexAttribPointer(s.normal,3,Nt.FLOAT,!1,0,0)),s.tangent>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglTangentBuffer),x(s.tangent),Nt.vertexAttribPointer(s.tangent,4,Nt.FLOAT,!1,0,0)),s.uv>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglUVBuffer),x(s.uv),Nt.vertexAttribPointer(s.uv,2,Nt.FLOAT,!1,0,0)),s.uv2>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglUV2Buffer),x(s.uv2),Nt.vertexAttribPointer(s.uv2,2,Nt.FLOAT,!1,0,0)),r.skinning&&s.skinIndex>=0&&s.skinWeight>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),x(s.skinIndex),Nt.vertexAttribPointer(s.skinIndex,4,Nt.FLOAT,!1,0,0),Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),x(s.skinWeight),Nt.vertexAttribPointer(s.skinWeight,4,Nt.FLOAT,!1,0,0)),s.lineDistance>=0&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.__webglLineDistanceBuffer),x(s.lineDistance),Nt.vertexAttribPointer(s.lineDistance,1,Nt.FLOAT,!1,0,0))}a instanceof THREE.Mesh?(r.wireframe?(nt(r.wireframeLinewidth),p&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),Nt.drawElements(Nt.LINES,o.__webglLineCount,Nt.UNSIGNED_SHORT,0)):(p&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),Nt.drawElements(Nt.TRIANGLES,o.__webglFaceCount,Nt.UNSIGNED_SHORT,0)),Gt.info.render.calls++,Gt.info.render.vertices+=o.__webglFaceCount,Gt.info.render.faces+=o.__webglFaceCount/3):a instanceof THREE.Line?(h=a.type===THREE.LineStrip?Nt.LINE_STRIP:Nt.LINES,nt(r.linewidth),Nt.drawArrays(h,0,o.__webglLineCount),Gt.info.render.calls++):a instanceof THREE.ParticleSystem?(Nt.drawArrays(Nt.POINTS,0,o.__webglParticleCount),Gt.info.render.calls++,Gt.info.render.points+=o.__webglParticleCount):a instanceof THREE.Ribbon&&(Nt.drawArrays(Nt.TRIANGLE_STRIP,0,o.__webglVertexCount),Gt.info.render.calls++)}},this.render=function(e,t,i,r){if(t instanceof THREE.Camera==!1)return console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."),void 0;var o,a,n,s,h,l=e.__lights,c=e.fog;for(qt=-1,Hi=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),yi.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),gi.setFromMatrix(yi),this.autoUpdateObjects&&this.initWebGLObjects(e),S(this.renderPluginsPre,e,t),Gt.info.render.calls=0,Gt.info.render.vertices=0,Gt.info.render.faces=0,Gt.info.render.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=e.__webglObjects,o=0,a=h.length;a>o;o++)n=h[o],s=n.object,n.render=!1,s.visible&&((s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)&&s.frustumCulled&&!gi.intersectsObject(s)||(it(s,t),P(n),n.render=!0,this.sortObjects===!0&&(null!==s.renderDepth?n.z=s.renderDepth:(Ri.getPositionFromMatrix(s.matrixWorld),Ri.applyProjection(yi),n.z=Ri.z),n.id=s.id)));for(this.sortObjects&&h.sort(b),h=e.__webglObjectsImmediate,o=0,a=h.length;a>o;o++)n=h[o],s=n.object,s.visible&&(it(s,t),A(n));if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),st(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),_(e.__webglObjects,!1,"",t,l,c,!0,u),C(e.__webglObjectsImmediate,"",t,l,c,!1,u)}else{var u=null;this.setBlending(THREE.NoBlending),_(e.__webglObjects,!0,"opaque",t,l,c,!1,u),C(e.__webglObjectsImmediate,"opaque",t,l,c,!1,u),_(e.__webglObjects,!1,"transparent",t,l,c,!0,u),C(e.__webglObjectsImmediate,"transparent",t,l,c,!0,u)}S(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&Rt(i),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,i,r,o){var a=G(e,t,i,r,o);Kt=-1,Gt.setMaterialFaces(r),o.immediateRenderCallback?o.immediateRenderCallback(a,Nt,gi):o.render(function(e){Gt.renderBufferImmediate(e,a,r)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)L(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)B(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;i>t;t++)V(e.__webglObjects[t].object)},this.initMaterial=function(e,t,i,r){e.addEventListener("dispose",Ii);var o,a,n,s,h,l,c;e instanceof THREE.MeshDepthMaterial?c="depth":e instanceof THREE.MeshNormalMaterial?c="normal":e instanceof THREE.MeshBasicMaterial?c="basic":e instanceof THREE.MeshLambertMaterial?c="lambert":e instanceof THREE.MeshPhongMaterial?c="phong":e instanceof THREE.LineBasicMaterial?c="basic":e instanceof THREE.LineDashedMaterial?c="dashed":e instanceof THREE.ParticleBasicMaterial&&(c="particle_basic"),c&&k(e,THREE.ShaderLib[c]),s=bt(t),l=Mt(t),h=wt(r),n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:h,useVertexTexture:Ai&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:l,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},e.program=lt(c,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,n);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var p,f="morphTarget";for(a=0;this.maxMorphTargets>a;a++)p=f+a,u[p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var p,f="morphNormal";for(a=0;this.maxMorphNormals>a;a++)p=f+a,u[p]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(o in e.uniforms)e.uniformsList.push([e.uniforms[o],o])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Nt.disable(Nt.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),e===THREE.CullFaceBack?Nt.cullFace(Nt.BACK):e===THREE.CullFaceFront?Nt.cullFace(Nt.FRONT):Nt.cullFace(Nt.FRONT_AND_BACK),Nt.enable(Nt.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,i=e.side===THREE.BackSide;$t!==t&&(t?Nt.disable(Nt.CULL_FACE):Nt.enable(Nt.CULL_FACE),$t=t),ei!==i&&(i?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),ei=i)},this.setDepthTest=function(e){ai!==e&&(e?Nt.enable(Nt.DEPTH_TEST):Nt.disable(Nt.DEPTH_TEST),ai=e)},this.setDepthWrite=function(e){ni!==e&&(Nt.depthMask(e),ni=e)},this.setBlending=function(e,t,i,r){e!==ti&&(e===THREE.NoBlending?Nt.disable(Nt.BLEND):e===THREE.AdditiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE)):e===THREE.SubtractiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.SRC_COLOR)):e===THREE.CustomBlending?Nt.enable(Nt.BLEND):(Nt.enable(Nt.BLEND),Nt.blendEquationSeparate(Nt.FUNC_ADD,Nt.FUNC_ADD),Nt.blendFuncSeparate(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA,Nt.ONE,Nt.ONE_MINUS_SRC_ALPHA)),ti=e),e===THREE.CustomBlending?(t!==ii&&(Nt.blendEquation(Ht(t)),ii=t),(i!==ri||r!==oi)&&(Nt.blendFunc(Ht(i),Ht(r)),ri=i,oi=r)):(ii=null,ri=null,oi=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Ni),e.__webglTexture=Nt.createTexture(),Gt.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,e.flipY),Nt.pixelStorei(Nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Nt.pixelStorei(Nt.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,r=dt(i.width)&&dt(i.height),o=Ht(e.format),a=Ht(e.type);mt(Nt.TEXTURE_2D,e,r);var n,s=e.mipmaps;if(e instanceof THREE.DataTexture)if(s.length>0&&r){for(var h=0,l=s.length;l>h;h++)n=s[h],Nt.texImage2D(Nt.TEXTURE_2D,h,o,n.width,n.height,0,o,a,n.data);e.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,o,i.width,i.height,0,o,a,i.data);else if(e instanceof THREE.CompressedTexture)for(var h=0,l=s.length;l>h;h++)n=s[h],Nt.compressedTexImage2D(Nt.TEXTURE_2D,h,o,n.width,n.height,0,n.data);else if(s.length>0&&r){for(var h=0,l=s.length;l>h;h++)n=s[h],Nt.texImage2D(Nt.TEXTURE_2D,h,o,o,a,n);e.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,o,o,a,e.image);e.generateMipmaps&&r&&Nt.generateMipmap(Nt.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Bi),e.__webglTexture=Nt.createTexture(),Gt.info.memory.textures++;var i=dt(e.width)&&dt(e.height),r=Ht(e.format),o=Ht(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.__webglTexture),mt(Nt.TEXTURE_CUBE_MAP,e,i);for(var a=0;6>a;a++)e.__webglFramebuffer[a]=Nt.createFramebuffer(),e.__webglRenderbuffer[a]=Nt.createRenderbuffer(),Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,r,e.width,e.height,0,r,o,null),yt(e.__webglFramebuffer[a],e,Nt.TEXTURE_CUBE_MAP_POSITIVE_X+a),Tt(e.__webglRenderbuffer[a],e);i&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Nt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Nt.createRenderbuffer(),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),mt(Nt.TEXTURE_2D,e,i),Nt.texImage2D(Nt.TEXTURE_2D,0,r,e.width,e.height,0,r,o,null),yt(e.__webglFramebuffer,e,Nt.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e.__webglRenderbuffer):Tt(e.__webglRenderbuffer,e),i&&Nt.generateMipmap(Nt.TEXTURE_2D);t?Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null):Nt.bindTexture(Nt.TEXTURE_2D,null),Nt.bindRenderbuffer(Nt.RENDERBUFFER,null),Nt.bindFramebuffer(Nt.FRAMEBUFFER,null)}var n,s,h,l,c;e?(n=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,s=e.width,h=e.height,l=0,c=0):(n=null,s=fi,h=di,l=ui,c=pi),n!==Yt&&(Nt.bindFramebuffer(Nt.FRAMEBUFFER,n),Nt.viewport(l,c,s,h),Yt=n),mi=s,Ei=h},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,i){THREE.EventDispatcher.call(this),this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},THREE.WebGLRenderTarget.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.object=null,this.z=null},THREE.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.GeometryUtils={merge:function(e,t){var i,r,o=e.vertices.length,a=(e.faceVertexUvs[0].length,t instanceof THREE.Mesh?t.geometry:t),n=e.vertices,s=a.vertices,h=e.faces,l=a.faces,c=e.faceVertexUvs[0],u=a.faceVertexUvs[0];t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,r=new THREE.Matrix3,r.getInverse(i),r.transpose());for(var p=0,f=s.length;f>p;p++){var d=s[p],m=d.clone();i&&m.applyMatrix4(i),n.push(m)}for(p=0,f=l.length;f>p;p++){var E,v,g,y=l[p],T=y.vertexNormals,R=y.vertexColors;y instanceof THREE.Face3?E=new THREE.Face3(y.a+o,y.b+o,y.c+o):y instanceof THREE.Face4&&(E=new THREE.Face4(y.a+o,y.b+o,y.c+o,y.d+o)),E.normal.copy(y.normal),r&&E.normal.applyMatrix3(r).normalize();for(var x=0,H=T.length;H>x;x++)v=T[x].clone(),r&&v.applyMatrix3(r).normalize(),E.vertexNormals.push(v);E.color.copy(y.color);for(var x=0,H=R.length;H>x;x++)g=R[x],E.vertexColors.push(g.clone());E.materialIndex=y.materialIndex,E.centroid.copy(y.centroid),i&&E.centroid.applyMatrix4(i),h.push(E)}for(p=0,f=u.length;f>p;p++){for(var w=u[p],b=[],x=0,H=w.length;H>x;x++)b.push(new THREE.Vector2(w[x].x,w[x].y));c.push(b)}},removeMaterials:function(e,t){for(var i={},r=0,o=t.length;o>r;r++)i[t[r]]=!0;for(var a,n=[],r=0,o=e.faces.length;o>r;r++)a=e.faces[r],a.materialIndex in i||n.push(a);e.faces=n},randomPointInTriangle:function(e,t,i){var r,o,a,n=new THREE.Vector3,s=THREE.GeometryUtils.__v1;return r=THREE.GeometryUtils.random(),o=THREE.GeometryUtils.random(),r+o>1&&(r=1-r,o=1-o),a=1-r-o,n.copy(e),n.multiplyScalar(r),s.copy(t),s.multiplyScalar(o),n.add(s),s.copy(i),s.multiplyScalar(a),n.add(s),n},randomPointInFace:function(e,t,i){var r,o,a,n;if(e instanceof THREE.Face3)return r=t.vertices[e.a],o=t.vertices[e.b],a=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(r,o,a);if(e instanceof THREE.Face4){r=t.vertices[e.a],o=t.vertices[e.b],a=t.vertices[e.c],n=t.vertices[e.d];var s,h;i?e._area1&&e._area2?(s=e._area1,h=e._area2):(s=THREE.GeometryUtils.triangleArea(r,o,n),h=THREE.GeometryUtils.triangleArea(o,a,n),e._area1=s,e._area2=h):(s=THREE.GeometryUtils.triangleArea(r,o,n),h=THREE.GeometryUtils.triangleArea(o,a,n));var l=THREE.GeometryUtils.random()*(s+h);return s>l?THREE.GeometryUtils.randomPointInTriangle(r,o,n):THREE.GeometryUtils.randomPointInTriangle(o,a,n)}},randomPointsInGeometry:function(e,t){function i(e){function t(i,r){if(i>r)return i;var o=i+Math.floor((r-i)/2);return f[o]>e?t(i,o-1):e>f[o]?t(o+1,r):o}var i=t(0,f.length-1);return i}var r,o,a,n,s,h,l=e.faces,c=e.vertices,u=l.length,p=0,f=[];for(o=0;u>o;o++)r=l[o],r instanceof THREE.Face3?(a=c[r.a],n=c[r.b],s=c[r.c],r._area=THREE.GeometryUtils.triangleArea(a,n,s)):r instanceof THREE.Face4&&(a=c[r.a],n=c[r.b],s=c[r.c],h=c[r.d],r._area1=THREE.GeometryUtils.triangleArea(a,n,h),r._area2=THREE.GeometryUtils.triangleArea(n,s,h),r._area=r._area1+r._area2),p+=r._area,f[o]=p;var d,m,E=[],v={};for(o=0;t>o;o++)d=THREE.GeometryUtils.random()*p,m=i(d),E[o]=THREE.GeometryUtils.randomPointInFace(l[m],e,!0),v[m]?v[m]+=1:v[m]=1;return E},triangleArea:function(e,t,i){var r=THREE.GeometryUtils.__v1,o=THREE.GeometryUtils.__v2;return r.subVectors(t,e),o.subVectors(i,e),r.cross(o),.5*r.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new THREE.Vector3;return i.addVectors(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},normalizeUVs:function(e){for(var t=e.faceVertexUvs[0],i=0,r=t.length;r>i;i++)for(var o=t[i],a=0,n=o.length;n>a;a++)1!==o[a].x&&(o[a].x=o[a].x-Math.floor(o[a].x)),1!==o[a].y&&(o[a].y=o[a].y-Math.floor(o[a].y))},triangulateQuads:function(e){var t,i,r,o,a=[],n=[],s=[];for(t=0,i=e.faceUvs.length;i>t;t++)n[t]=[];for(t=0,i=e.faceVertexUvs.length;i>t;t++)s[t]=[];for(t=0,i=e.faces.length;i>t;t++){var h=e.faces[t];if(h instanceof THREE.Face4){var l=h.a,c=h.b,u=h.c,p=h.d,f=new THREE.Face3,d=new THREE.Face3;for(f.color.copy(h.color),d.color.copy(h.color),f.materialIndex=h.materialIndex,d.materialIndex=h.materialIndex,f.a=l,f.b=c,f.c=p,d.a=c,d.b=u,d.c=p,4===h.vertexColors.length&&(f.vertexColors[0]=h.vertexColors[0].clone(),f.vertexColors[1]=h.vertexColors[1].clone(),f.vertexColors[2]=h.vertexColors[3].clone(),d.vertexColors[0]=h.vertexColors[1].clone(),d.vertexColors[1]=h.vertexColors[2].clone(),d.vertexColors[2]=h.vertexColors[3].clone()),a.push(f,d),r=0,o=e.faceVertexUvs.length;o>r;r++)if(e.faceVertexUvs[r].length){var m=e.faceVertexUvs[r][t],E=m[0],v=m[1],g=m[2],y=m[3],T=[E.clone(),v.clone(),y.clone()],R=[v.clone(),g.clone(),y.clone()];s[r].push(T,R)}for(r=0,o=e.faceUvs.length;o>r;r++)if(e.faceUvs[r].length){var x=e.faceUvs[r][t];n[r].push(x,x)}}else{for(a.push(h),r=0,o=e.faceUvs.length;o>r;r++)n[r].push(e.faceUvs[r][t]);for(r=0,o=e.faceVertexUvs.length;o>r;r++)s[r].push(e.faceVertexUvs[r][t])}}e.faces=a,e.faceUvs=n,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,i,r){for(var o=e.faces,a=i||0,n=r||o.length-1,s=a;n>=s;s++)o[s].materialIndex=t}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.GeometryUtils.__v2=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i,r){var o=new Image,a=new THREE.Texture(o,t),n=new THREE.ImageLoader;return n.addEventListener("load",function(e){a.image=e.content,a.needsUpdate=!0,i&&i(a)}),n.addEventListener("error",function(e){r&&r(e.message)}),n.crossOrigin=this.crossOrigin,n.load(e,o),a.sourceFile=e,a},loadCompressedTexture:function(e,t,i,r){var o=new THREE.CompressedTexture;o.mapping=t;var a=new XMLHttpRequest;return a.onload=function(){var e=a.response,t=THREE.ImageUtils.parseDDS(e,!0);o.format=t.format,o.mipmaps=t.mipmaps,o.image.width=t.width,o.image.height=t.height,o.generateMipmaps=!1,o.needsUpdate=!0,i&&i(o)},a.onerror=r,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),o},loadTextureCube:function(e,t,i,r){var o=[];o.loadCount=0;var a=new THREE.Texture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1;for(var n=0,s=e.length;s>n;++n){var h=new Image;o[n]=h,h.onload=function(){o.loadCount+=1,6===o.loadCount&&(a.needsUpdate=!0,i&&i(a))},h.onerror=r,h.crossOrigin=this.crossOrigin,h.src=e[n]}return a},loadCompressedTextureCube:function(e,t,i,r){var o=[];o.loadCount=0;var a=new THREE.CompressedTexture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1,a.generateMipmaps=!1;var n=function(e,t){return function(){var r=e.response,n=THREE.ImageUtils.parseDDS(r,!0);t.format=n.format,t.mipmaps=n.mipmaps,t.width=n.width,t.height=n.height,o.loadCount+=1,6===o.loadCount&&(a.format=n.format,a.needsUpdate=!0,i&&i(a))}};if(e instanceof Array)for(var s=0,h=e.length;h>s;++s){var l={};o[s]=l;var c=new XMLHttpRequest;c.onload=n(c,l),c.onerror=r;var u=e[s];c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}else{var u=e,c=new XMLHttpRequest;c.onload=function(){var e=c.response,t=THREE.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var r=t.mipmaps.length/t.mipmapCount,n=0;r>n;n++){o[n]={mipmaps:[]};for(var s=0;t.mipmapCount>s;s++)o[n].mipmaps.push(t.mipmaps[n*t.mipmapCount+s]),o[n].format=t.format,o[n].width=t.width,o[n].height=t.height}a.format=t.format,a.needsUpdate=!0,i&&i(a)}},c.onerror=r,c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}return a},parseDDS:function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,255&e>>8,255&e>>16,255&e>>24)}var o={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},a=542327876,n=131072,s=512,h=4,l=i("DXT1"),c=i("DXT3"),u=i("DXT5"),p=31,f=0,d=1,m=2,E=3,v=4,g=7,y=20,T=21,R=28,x=new Int32Array(e,0,p);if(x[f]!==a)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),o;if(!x[y]&h)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),o;var H,w=x[T];switch(w){case l:H=8,o.format=THREE.RGB_S3TC_DXT1_Format;break;case c:H=16,o.format=THREE.RGBA_S3TC_DXT3_Format;break;case u:H=16,o.format=THREE.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",r(w)),o}o.mipmapCount=1,x[m]&n&&t!==!1&&(o.mipmapCount=Math.max(1,x[g])),o.isCubemap=x[R]&s?!0:!1,o.width=x[v],o.height=x[E];for(var b=x[d]+4,M=o.width,S=o.height,_=o.isCubemap?6:1,C=0;_>C;C++){for(var A=0;o.mipmapCount>A;A++){var P=Math.max(4,M)/4*Math.max(4,S)/4*H,D=new Uint8Array(e,b,P),L={data:D,width:M,height:S};o.mipmaps.push(L),b+=P,M=Math.max(.5*M,1),S=Math.max(.5*S,1)}M=o.width,S=o.height}return o},getNormalMap:function(e,t){var i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},o=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var a=e.width,n=e.height,s=document.createElement("canvas");s.width=a,s.height=n;var h=s.getContext("2d");h.drawImage(e,0,0);for(var l=h.getImageData(0,0,a,n).data,c=h.createImageData(a,n),u=c.data,p=0;a>p;p++)for(var f=0;n>f;f++){var d=0>f-1?0:f-1,m=f+1>n-1?n-1:f+1,E=0>p-1?0:p-1,v=p+1>a-1?a-1:p+1,g=[],y=[0,0,l[4*(f*a+p)]/255*t];g.push([-1,0,l[4*(f*a+E)]/255*t]),g.push([-1,-1,l[4*(d*a+E)]/255*t]),g.push([0,-1,l[4*(d*a+p)]/255*t]),g.push([1,-1,l[4*(d*a+v)]/255*t]),g.push([1,0,l[4*(f*a+v)]/255*t]),g.push([1,1,l[4*(m*a+v)]/255*t]),g.push([0,1,l[4*(m*a+p)]/255*t]),g.push([-1,1,l[4*(m*a+E)]/255*t]);for(var T=[],R=g.length,x=0;R>x;x++){var H=g[x],w=g[(x+1)%R];H=r(H,y),w=r(w,y),T.push(o(i(H,w)))}for(var b=[0,0,0],x=0;T.length>x;x++)b[0]+=T[x][0],b[1]+=T[x][1],b[2]+=T[x][2];b[0]/=T.length,b[1]/=T.length,b[2]/=T.length;var M=4*(f*a+p);u[M]=0|255*((b[0]+1)/2),u[M+1]=0|255*((b[1]+1)/2),u[M+2]=0|255*b[2],u[M+3]=255}return h.putImageData(c,0,0),s},generateDataTexture:function(e,t,i){for(var r=e*t,o=new Uint8Array(3*r),a=Math.floor(255*i.r),n=Math.floor(255*i.g),s=Math.floor(255*i.b),h=0;r>h;h++)o[3*h]=a,o[3*h+1]=n,o[3*h+2]=s;var l=new THREE.DataTexture(o,e,t,THREE.RGBFormat);return l.needsUpdate=!0,l}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Object3D,r=0,o=t.length;o>r;r++)i.add(new THREE.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new THREE.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;return i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,o=0,a=(e+"").split(""),n=a.length,s=[];for(t=0;n>t;t++){var h=new THREE.Path,l=this.extractGlyphPoints(a[t],i,r,o,h);o+=l.offset,s.push(l.path)}var c=o/2;return{paths:s,offset:c}},extractGlyphPoints:function(e,t,i,r,o){var a,n,s,h,l,c,u,p,f,d,m,E,v,g,y,T,R,x,H,w=[],b=t.glyphs[e]||t.glyphs["?"];if(b){if(b.o)for(h=b._cachedOutline||(b._cachedOutline=b.o.split(" ")),c=h.length,u=i,p=i,a=0;c>a;)switch(l=h[a++]){case"m":f=h[a++]*u+r,d=h[a++]*p,o.moveTo(f,d);break;case"l":f=h[a++]*u+r,d=h[a++]*p,o.lineTo(f,d);break;case"q":if(m=h[a++]*u+r,E=h[a++]*p,y=h[a++]*u+r,T=h[a++]*p,o.quadraticCurveTo(y,T,m,E),H=w[w.length-1])for(v=H.x,g=H.y,n=1,s=this.divisions;s>=n;n++){var M=n/s;THREE.Shape.Utils.b2(M,v,y,m),THREE.Shape.Utils.b2(M,g,T,E)}break;case"b":if(m=h[a++]*u+r,E=h[a++]*p,y=h[a++]*u+r,T=h[a++]*-p,R=h[a++]*u+r,x=h[a++]*-p,o.bezierCurveTo(m,E,y,T,R,x),H=w[w.length-1])for(v=H.x,g=H.y,n=1,s=this.divisions;s>=n;n++){var M=n/s;THREE.Shape.Utils.b3(M,v,y,R,m),THREE.Shape.Utils.b3(M,g,T,x,E)}}return{offset:b.ha*i,path:o}}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var i=void 0!==t.size?t.size:100,r=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",a=void 0!==t.weight?t.weight:"normal",n=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=i,THREE.FontUtils.divisions=r,THREE.FontUtils.face=o,THREE.FontUtils.weight=a,THREE.FontUtils.style=n;for(var s=THREE.FontUtils.drawText(e),h=s.paths,l=[],c=0,u=h.length;u>c;c++)Array.prototype.push.apply(l,h[c].toShapes());return l},function(e){var t=1e-10,i=function(e,t){var i=e.length;if(3>i)return null;var a,n,s,h=[],l=[],c=[];if(r(e)>0)for(n=0;i>n;n++)l[n]=n;else for(n=0;i>n;n++)l[n]=i-1-n;var u=i,p=2*u;for(n=u-1;u>2;){if(0>=p--)return console.log("Warning, unable to triangulate polygon!"),t?c:h;if(a=n,a>=u&&(a=0),n=a+1,n>=u&&(n=0),s=n+1,s>=u&&(s=0),o(e,a,n,s,u,l)){var f,d,m,E,v;for(f=l[a],d=l[n],m=l[s],h.push([e[f],e[d],e[m]]),c.push([l[a],l[n],l[s]]),E=n,v=n+1;u>v;E++,v++)l[E]=l[v];u--,p=2*u}}return t?c:h},r=function(e){for(var t=e.length,i=0,r=t-1,o=0;t>o;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return.5*i},o=function(e,i,r,o,a,n){var s,h,l,c,u,p,f,d,m;if(h=e[n[i]].x,l=e[n[i]].y,c=e[n[r]].x,u=e[n[r]].y,p=e[n[o]].x,f=e[n[o]].y,t>(c-h)*(f-l)-(u-l)*(p-h))return!1;var E,v,g,y,T,R,x,H,w,b,M,S,_,C,A;for(E=p-c,v=f-u,g=h-p,y=l-f,T=c-h,R=u-l,s=0;a>s;s++)if(s!==i&&s!==r&&s!==o&&(d=e[n[s]].x,m=e[n[s]].y,x=d-h,H=m-l,w=d-c,b=m-u,M=d-p,S=m-f,A=E*b-v*w,_=T*H-R*x,C=g*S-y*M,A>=0&&C>=0&&_>=0))return!1;return!0};return e.Triangulate=i,e.Triangulate.area=r,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],o=this.getPoint(0),a=0;for(r.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),a+=t.distanceTo(o),r.push(a),o=t;return this.cacheArcLengths=r,r},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),o=0,a=r.length;i=t?t:e*r[a-1];for(var n,s=0,h=a-1;h>=s;)if(o=Math.floor(s+(h-s)/2),n=r[o]-i,0>n)s=o+1;else{if(!(n>0)){h=o;break}h=o-1}if(o=h,r[o]==i){var l=o/(a-1);return l}var c=r[o],u=r[o+1],p=u-c,f=(i-c)/p,l=(o+f)/(a-1);return l},THREE.Curve.prototype.getTangent=function(e){var t=1e-4,i=e-t,r=e+t;0>i&&(i=0),r>1&&(r=1);var o=this.getPoint(i),a=this.getPoint(r),n=a.clone().sub(o);return n.normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t,i;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,i)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var r=new THREE.Vector2(t,i);return r.normalize(),r},THREE.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,i)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new THREE.Vector2(t,i);return r.normalize(),r},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t,i,r,o=new THREE.Vector2,a=[],n=this.points;return t=(n.length-1)*e,i=Math.floor(t),r=t-i,a[0]=0==i?i:i-1,a[1]=i,a[2]=i>n.length-2?n.length-1:i+1,a[3]=i>n.length-3?n.length-1:i+2,o.x=THREE.Curve.Utils.interpolate(n[a[0]].x,n[a[1]].x,n[a[2]].x,n[a[3]].x,r),o.y=THREE.Curve.Utils.interpolate(n[a[0]].y,n[a[1]].y,n[a[2]].y,n[a[3]].y,r),o},THREE.EllipseCurve=function(e,t,i,r,o,a,n){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=a,this.aClockwise=n
},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);var i=this.aStartAngle+e*t,r=this.aX+this.xRadius*Math.cos(i),o=this.aY+this.yRadius*Math.sin(i);return new THREE.Vector2(r,o)},THREE.ArcCurve=function(e,t,i,r,o,a){THREE.EllipseCurve.call(this,e,t,i,i,r,o,a)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,o){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*o},tangentSpline:function(e){var t=6*e*e-6*e,i=3*e*e-4*e+1,r=-6*e*e+6*e,o=3*e*e-2*e;return t+i+r+o},interpolate:function(e,t,i,r,o){var a=.5*(i-e),n=.5*(r-t),s=o*o,h=o*s;return(2*t-2*i+a+n)*h+(-3*t+3*i-2*a-n)*s+a*o+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,r;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,i,r)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t,i,r;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,i,r)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i,r,o=new THREE.Vector3,a=[],n=this.points;t=(n.length-1)*e,i=Math.floor(t),r=t-i,a[0]=0==i?i:i-1,a[1]=i,a[2]=i>n.length-2?n.length-1:i+1,a[3]=i>n.length-3?n.length-1:i+2;var s=n[a[0]],h=n[a[1]],l=n[a[2]],c=n[a[3]];return o.x=THREE.Curve.Utils.interpolate(s.x,h.x,l.x,c.x,r),o.y=THREE.Curve.Utils.interpolate(s.y,h.y,l.y,c.y,r),o.z=THREE.Curve.Utils.interpolate(s.z,h.z,l.z,c.z,r),o}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i,r,o=new THREE.Vector3,a=[],n=this.points;return t=(n.length-0)*e,i=Math.floor(t),r=t-i,i+=i>0?0:(Math.floor(Math.abs(i)/n.length)+1)*n.length,a[0]=(i-1)%n.length,a[1]=i%n.length,a[2]=(i+1)%n.length,a[3]=(i+2)%n.length,o.x=THREE.Curve.Utils.interpolate(n[a[0]].x,n[a[1]].x,n[a[2]].x,n[a[3]].x,r),o.y=THREE.Curve.Utils.interpolate(n[a[0]].y,n[a[1]].y,n[a[2]].y,n[a[3]].y,r),o.z=THREE.Curve.Utils.interpolate(n[a[0]].z,n[a[1]].z,n[a[2]].z,n[a[3]].z,r),o}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t,i,r=e*this.getLength(),o=this.getCurveLengths(),a=0;o.length>a;){if(o[a]>=r){t=o[a]-r,i=this.curves[a];var n=1-t/i.getLength();return i.getPointAt(n)}a++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;r>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,o,a,n=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=o=Number.POSITIVE_INFINITY;var s,h,l,c,u=n[0]instanceof THREE.Vector3;for(c=u?new THREE.Vector3:new THREE.Vector2,h=0,l=n.length;l>h;h++)s=n[h],s.x>e?e=s.x:r>s.x&&(r=s.x),s.y>t?t=s.y:o>s.y&&(o=s.y),u&&(s.z>i?i=s.z:a>s.z&&(a=s.z)),c.add(s);var p={minX:r,minY:o,maxX:e,maxY:t,centroid:c.divideScalar(l)};return u&&(p.maxZ=i,p.minZ=a),p},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,i=0;e.length>i;i++)t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,e[i].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,o=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;r>i;i++)o=this.getWrapPoints(o,t[i]);return o},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,o=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;r>i;i++)o=this.getWrapPoints(o,t[i]);return o},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,o,a,n,s,h=this.getBoundingBox();for(i=0,r=e.length;r>i;i++){o=e[i],a=o.x,n=o.y,s=a/h.maxX,s=t.getUtoTmapping(s,a);var l=t.getPoint(s),c=t.getNormalVector(s).multiplyScalar(n);o.x=l.x+c.x,o.y=l.y+c.y}return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,o=r[r.length-2],a=r[r.length-1],n=new THREE.LineCurve(new THREE.Vector2(o,a),new THREE.Vector2(e,t));this.curves.push(n),this.actions.push({action:THREE.PathActions.LINE_TO,args:i})},THREE.Path.prototype.quadraticCurveTo=function(e,t,i,r){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,n=a[a.length-2],s=a[a.length-1],h=new THREE.QuadraticBezierCurve(new THREE.Vector2(n,s),new THREE.Vector2(e,t),new THREE.Vector2(i,r));this.curves.push(h),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:o})},THREE.Path.prototype.bezierCurveTo=function(e,t,i,r,o,a){var n=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1],c=new THREE.CubicBezierCurve(new THREE.Vector2(h,l),new THREE.Vector2(e,t),new THREE.Vector2(i,r),new THREE.Vector2(o,a));this.curves.push(c),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:n})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],o=i[i.length-1],a=[new THREE.Vector2(r,o)];Array.prototype.push.apply(a,e);var n=new THREE.SplineCurve(a);this.curves.push(n),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,i,r,o,a){var n=this.actions[this.actions.length-1].args,s=n[n.length-2],h=n[n.length-1];this.absarc(e+s,t+h,i,r,o,a)},THREE.Path.prototype.absarc=function(e,t,i,r,o,a){this.absellipse(e,t,i,i,r,o,a)},THREE.Path.prototype.ellipse=function(e,t,i,r,o,a,n){var s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1];this.absellipse(e+h,t+l,i,r,o,a,n)},THREE.Path.prototype.absellipse=function(e,t,i,r,o,a,n){var s=Array.prototype.slice.call(arguments),h=new THREE.EllipseCurve(e,t,i,r,o,a,n);this.curves.push(h);var l=h.getPoint(n?1:0);s.push(l.x),s.push(l.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,o,a,n,s,h,l,c,u,p,f,d,m,E,v,g,y,T=[];for(i=0,r=this.actions.length;r>i;i++)switch(o=this.actions[i],a=o.action,n=o.args,a){case THREE.PathActions.MOVE_TO:T.push(new THREE.Vector2(n[0],n[1]));break;case THREE.PathActions.LINE_TO:T.push(new THREE.Vector2(n[0],n[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(s=n[2],h=n[3],u=n[0],p=n[1],T.length>0?(m=T[T.length-1],f=m.x,d=m.y):(m=this.actions[i-1].args,f=m[m.length-2],d=m[m.length-1]),E=1;e>=E;E++)v=E/e,g=THREE.Shape.Utils.b2(v,f,u,s),y=THREE.Shape.Utils.b2(v,d,p,h),T.push(new THREE.Vector2(g,y));break;case THREE.PathActions.BEZIER_CURVE_TO:for(s=n[4],h=n[5],u=n[0],p=n[1],l=n[2],c=n[3],T.length>0?(m=T[T.length-1],f=m.x,d=m.y):(m=this.actions[i-1].args,f=m[m.length-2],d=m[m.length-1]),E=1;e>=E;E++)v=E/e,g=THREE.Shape.Utils.b3(v,f,u,l,s),y=THREE.Shape.Utils.b3(v,d,p,c,h),T.push(new THREE.Vector2(g,y));break;case THREE.PathActions.CSPLINE_THRU:m=this.actions[i-1].args;var R=new THREE.Vector2(m[m.length-2],m[m.length-1]),x=[R],H=e*n[0].length;x=x.concat(n[0]);var w=new THREE.SplineCurve(x);for(E=1;H>=E;E++)T.push(w.getPointAt(E/H));break;case THREE.PathActions.ARC:var b,M=n[0],S=n[1],_=n[2],C=n[3],A=n[4],P=!!n[5],D=A-C,L=2*e;for(E=1;L>=E;E++)v=E/L,P||(v=1-v),b=C+v*D,g=M+_*Math.cos(b),y=S+_*Math.sin(b),T.push(new THREE.Vector2(g,y));break;case THREE.PathActions.ELLIPSE:var b,M=n[0],S=n[1],z=n[2],F=n[3],C=n[4],A=n[5],P=!!n[6],D=A-C,L=2*e;for(E=1;L>=E;E++)v=E/L,P||(v=1-v),b=C+v*D,g=M+z*Math.cos(b),y=S+F*Math.sin(b),T.push(new THREE.Vector2(g,y))}var V=T[T.length-1],U=1e-10;return U>Math.abs(V.x-T[0].x)&&U>Math.abs(V.y-T[0].y)&&T.splice(T.length-1,1),t&&T.push(T[0]),T},THREE.Path.prototype.toShapes=function(){var e,t,i,r,o,a=[],n=new THREE.Path;for(e=0,t=this.actions.length;t>e;e++)i=this.actions[e],o=i.args,r=i.action,r==THREE.PathActions.MOVE_TO&&0!=n.actions.length&&(a.push(n),n=new THREE.Path),n[r].apply(n,o);if(0!=n.actions.length&&a.push(n),0==a.length)return[];var s,h,l=[],c=!THREE.Shape.Utils.isClockWise(a[0].getPoints());if(1==a.length)return s=a[0],h=new THREE.Shape,h.actions=s.actions,h.curves=s.curves,l.push(h),l;if(c)for(h=new THREE.Shape,e=0,t=a.length;t>e;e++)s=a[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(h.actions=s.actions,h.curves=s.curves,l.push(h),h=new THREE.Shape):h.holes.push(s);else{for(e=0,t=a.length;t>e;e++)s=a[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(h&&l.push(h),h=new THREE.Shape,h.actions=s.actions,h.curves=s.curves):h.holes.push(s);l.push(h)}return l},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t},THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t},THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;i>t;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;i>t;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var i,r,o,a,n,s,h,l,c,u,p,f,d,m,E,v,g=e.concat(),y=g.concat(),T=[];for(n=0;t.length>n;n++){for(h=t[n],Array.prototype.push.apply(y,h),l=Number.POSITIVE_INFINITY,s=0;h.length>s;s++){p=h[s];var R=[];for(u=0;g.length>u;u++)f=g[u],c=p.distanceToSquared(f),R.push(c),l>c&&(l=c,o=s,a=u)}i=a-1>=0?a-1:g.length-1,r=o-1>=0?o-1:h.length-1;var x=[h[o],g[a],g[i]],H=THREE.FontUtils.Triangulate.area(x),w=[h[o],h[r],g[a]],b=THREE.FontUtils.Triangulate.area(w),M=1,S=-1,_=a,C=o;a+=M,o+=S,0>a&&(a+=g.length),a%=g.length,0>o&&(o+=h.length),o%=h.length,i=a-1>=0?a-1:g.length-1,r=o-1>=0?o-1:h.length-1,x=[h[o],g[a],g[i]];var A=THREE.FontUtils.Triangulate.area(x);w=[h[o],h[r],g[a]];var P=THREE.FontUtils.Triangulate.area(w);H+b>A+P&&(a=_,o=C,0>a&&(a+=g.length),a%=g.length,0>o&&(o+=h.length),o%=h.length,i=a-1>=0?a-1:g.length-1,r=o-1>=0?o-1:h.length-1),d=g.slice(0,a),m=g.slice(a),E=h.slice(o),v=h.slice(0,o);var D=[h[o],g[a],g[i]],L=[h[o],h[r],g[a]];T.push(D),T.push(L),g=d.concat(E).concat(v).concat(m)}return{shape:g,isolatedPts:T,allpoints:y}},triangulateShape:function(e,t){var i,r,o,a,n,s,h=THREE.Shape.Utils.removeHoles(e,t),l=h.shape,c=h.allpoints,u=h.isolatedPts,p=THREE.FontUtils.Triangulate(l,!1),f={};for(i=0,r=c.length;r>i;i++)n=c[i].x+":"+c[i].y,void 0!==f[n]&&console.log("Duplicate point",n),f[n]=i;for(i=0,r=p.length;r>i;i++)for(a=p[i],o=0;3>o;o++)n=a[o].x+":"+a[o].y,s=f[n],void 0!==s&&(a[o]=s);for(i=0,r=u.length;r>i;i++)for(a=u[i],o=0;3>o;o++)n=a[o].x+":"+a[o].y,s=f[n],void 0!==s&&(a[o]=s);return p.concat(u)},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){var i=1-e;return 3*i*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,o){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,o)}},THREE.AnimationHandler=function(){var e=[],t={},i={};i.update=function(t){for(var i=0;e.length>i;i++)e[i].update(t)},i.addToUpdate=function(t){-1===e.indexOf(t)&&e.push(t)},i.removeFromUpdate=function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},i.add=function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,o(e)},i.get=function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},i.parse=function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;e.bones.length>i;i++)t.push(e.bones[i]);else r(e,t);return t};var r=function(e,t){t.push(e);for(var i=0;e.children.length>i;i++)r(e.children[i],t)},o=function(e){if(e.initialized!==!0){for(var t=0;e.hierarchy.length>t;t++){for(var i=0;e.hierarchy[t].keys.length>i;i++)if(0>e.hierarchy[t].keys[i].time&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},i=0;e.hierarchy[t].keys.length>i;i++)for(var a=0;e.hierarchy[t].keys[i].morphTargets.length>a;a++){var n=e.hierarchy[t].keys[i].morphTargets[a];o[n]=-1}e.hierarchy[t].usedMorphTargets=o;for(var i=0;e.hierarchy[t].keys.length>i;i++){var s={};for(var n in o){for(var a=0;e.hierarchy[t].keys[i].morphTargets.length>a;a++)if(e.hierarchy[t].keys[i].morphTargets[a]===n){s[n]=e.hierarchy[t].keys[i].morphTargetsInfluences[a];break}a===e.hierarchy[t].keys[i].morphTargets.length&&(s[n]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=s}}for(var i=1;e.hierarchy[t].keys.length>i;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(var i=0;e.hierarchy[t].keys.length>i;i++)e.hierarchy[t].keys[i].index=i}var h=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(var t=0;e.hierarchy.length>t;t++)e.JIT.hierarchy.push(Array(h));e.initialized=!0}};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),THREE.Animation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==i?i:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var i,r,o=this.hierarchy.length;for(i=0;o>i;i++){r=this.hierarchy[i],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix);var a=r.animationCache.prevKey,n=r.animationCache.nextKey;a.pos=this.data.hierarchy[i].keys[0],a.rot=this.data.hierarchy[i].keys[0],a.scl=this.data.hierarchy[i].keys[0],n.pos=this.getNextKeyWith("pos",i,1),n.rot=this.getNextKeyWith("rot",i,1),n.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused===!0?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,i,r,o,a,n,s,h,l,c,u=["pos","rot","scl"];this.data.JIT.hierarchy;var p,f,d,m,E;this.currentTime+=e*this.timeScale,f=this.currentTime,p=this.currentTime=this.currentTime%this.data.length,c=parseInt(Math.min(p*this.data.fps,this.data.length*this.data.fps),10);for(var v=0,g=this.hierarchy.length;g>v;v++){h=this.hierarchy[v],l=h.animationCache;for(var y=0;3>y;y++){if(t=u[y],n=l.prevKey[t],s=l.nextKey[t],f>=s.time){if(f>p){if(!this.loop)return this.stop(),void 0;for(n=this.data.hierarchy[v].keys[0],s=this.getNextKeyWith(t,v,1);p>s.time;)n=s,s=this.getNextKeyWith(t,v,s.index+1)}else do n=s,s=this.getNextKeyWith(t,v,s.index+1);while(p>s.time);l.prevKey[t]=n,l.nextKey[t]=s}h.matrixAutoUpdate=!0,h.matrixWorldNeedsUpdate=!0,i=(p-n.time)/(s.time-n.time),o=n[t],a=s[t],(0>i||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+v),i=0>i?0:1),"pos"===t?(r=h.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(r.x=o[0]+(a[0]-o[0])*i,r.y=o[1]+(a[1]-o[1])*i,r.z=o[2]+(a[2]-o[2])*i):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",v,n.index-1).pos,this.points[1]=o,this.points[2]=a,this.points[3]=this.getNextKeyWith("pos",v,s.index+1).pos,i=.33*i+.33,d=this.interpolateCatmullRom(this.points,i),r.x=d[0],r.y=d[1],r.z=d[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(m=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(m[0],m[1],m[2]),this.target.sub(r),this.target.y=0,this.target.normalize(),E=Math.atan2(this.target.x,this.target.z),h.rotation.set(0,E,0)))):"rot"===t?THREE.Quaternion.slerp(o,a,h.quaternion,i):"scl"===t&&(r=h.scale,r.x=o[0]+(a[0]-o[0])*i,r.y=o[1]+(a[1]-o[1])*i,r.z=o[2]+(a[2]-o[2])*i)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i,r,o,a,n,s,h,l,c,u=[],p=[];return i=(e.length-1)*t,r=Math.floor(i),o=i-r,u[0]=0===r?r:r-1,u[1]=r,u[2]=r>e.length-2?r:r+1,u[3]=r>e.length-3?r:r+2,s=e[u[0]],h=e[u[1]],l=e[u[2]],c=e[u[3]],a=o*o,n=o*a,p[0]=this.interpolate(s[0],h[0],l[0],c[0],o,a,n),p[1]=this.interpolate(s[1],h[1],l[1],c[1],o,a,n),p[2]=this.interpolate(s[2],h[2],l[2],c[2],o,a,n),p},THREE.Animation.prototype.interpolate=function(e,t,i,r,o,a,n){var s=.5*(i-e),h=.5*(r-t);return(2*(t-i)+s+h)*n+(-3*(t-i)-2*s-h)*a+s*o+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i=r.length-1>i?i:r.length-1:i%=r.length;r.length>i;i++)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+r.length;i>=0;i--)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0!==i?i:!0;for(var r=0,o=this.hierarchy.length;o>r;r++){var a=this.data.hierarchy[r].keys,n=this.data.hierarchy[r].sids,s=this.hierarchy[r];if(a.length&&n){for(var h=0;n.length>h;h++){var l=n[h],c=this.getNextKeyWith(l,r,0);c&&c.apply(l)}s.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,r,o,a=this.hierarchy.length;for(i=0;a>i;i++){r=this.hierarchy[i],o=this.data.hierarchy[i],r.useQuaternion=!0,void 0===o.animationCache&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix);var n=this.data.hierarchy[i].keys;n.length&&(o.animationCache.prevKey=n[0],o.animationCache.nextKey=n[1],this.startTime=Math.min(n[0].time,this.startTime),this.endTime=Math.max(n[n.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;this.data.hierarchy.length>e;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var r=i.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete i.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,r,o,a,n,s,h,l=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,s=this.currentTime,n=this.currentTime=this.currentTime%this.data.length,this.startTimeMs>n&&(n=this.currentTime=this.startTimeMs+n),a=parseInt(Math.min(n*this.data.fps,this.data.length*this.data.fps),10),h=s>n,h&&!this.loop){for(var c=0,u=this.hierarchy.length;u>c;c++){var p=this.data.hierarchy[c].keys,f=this.data.hierarchy[c].sids,d=p.length-1,m=this.hierarchy[c];if(p.length){for(var E=0;f.length>E;E++){var v=f[E],g=this.getPrevKeyWith(v,c,d);g&&g.apply(v)}this.data.hierarchy[c].node.updateMatrix(),m.matrixWorldNeedsUpdate=!0}}return this.stop(),void 0}if(!(this.startTime>n)){for(var c=0,u=this.hierarchy.length;u>c;c++){r=this.hierarchy[c],o=this.data.hierarchy[c];var p=o.keys,y=o.animationCache;if(this.JITCompile&&void 0!==l[c][a])r instanceof THREE.Bone?(r.skinMatrix=l[c][a],r.matrixWorldNeedsUpdate=!1):(r.matrix=l[c][a],r.matrixWorldNeedsUpdate=!0);else if(p.length){if(this.JITCompile&&y&&(r instanceof THREE.Bone?r.skinMatrix=y.originalMatrix:r.matrix=y.originalMatrix),t=y.prevKey,i=y.nextKey,t&&i){if(s>=i.time){if(h&&this.loop)for(t=p[0],i=p[1];n>i.time;)t=i,i=p[t.index+1];else if(!h)for(var T=p.length-1;n>i.time&&i.index!==T;)t=i,i=p[t.index+1];y.prevKey=t,y.nextKey=i}i.time>=n?t.interpolate(i,n):t.interpolate(i,i.time)}this.data.hierarchy[c].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===l[0][a]){this.hierarchy[0].updateMatrixWorld(!0);for(var c=0;this.hierarchy.length>c;c++)l[c][a]=this.hierarchy[c]instanceof THREE.Bone?this.hierarchy[c].skinMatrix.clone():this.hierarchy[c].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i%=r.length;r.length>i;i++)if(r[i].hasTarget(e))return r[i];return r[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=i>=0?i:i+r.length;i>=0;i--)if(r[i].hasTarget(e))return r[i];return r[r.length-1]},THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var r=90,o=1,a=new THREE.PerspectiveCamera(r,o,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(1,0,0)),this.add(a);var n=new THREE.PerspectiveCamera(r,o,e,t);n.up.set(0,-1,0),n.lookAt(new THREE.Vector3(-1,0,0)),this.add(n);var s=new THREE.PerspectiveCamera(r,o,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var h=new THREE.PerspectiveCamera(r,o,e,t);h.up.set(0,0,-1),h.lookAt(new THREE.Vector3(0,-1,0)),this.add(h);var l=new THREE.PerspectiveCamera(r,o,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,1)),this.add(l);var c=new THREE.PerspectiveCamera(r,o,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,-1)),this.add(c),this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,r=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,a,i),i.activeCubeFace=1,e.render(t,n,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,h,i),i.activeCubeFace=4,e.render(t,l,i),i.generateMipmaps=r,i.activeCubeFace=5,e.render(t,c,i)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,i,r,o,a,n){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,a,n),this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,o),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,i=this.cameraP.near,r=this.cameraP.far,o=(i+r)/2,a=Math.tan(e/2)*o,n=2*a,s=n*t,h=s/2;a/=this.zoom,h/=this.zoom,this.cameraO.left=-h,this.cameraO.right=h,this.cameraO.top=a,this.cameraO.bottom=-a,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var i=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.AsteriskGeometry=function(e,t){THREE.Geometry.call(this);for(var i=e,r=t,o=.707*i,a=.707*r,n=[[i,0,0],[r,0,0],[-i,0,0],[-r,0,0],[0,i,0],[0,r,0],[0,-i,0],[0,-r,0],[0,0,i],[0,0,r],[0,0,-i],[0,0,-r],[o,o,0],[a,a,0],[-o,-o,0],[-a,-a,0],[o,-o,0],[a,-a,0],[-o,o,0],[-a,a,0],[o,0,o],[a,0,a],[-o,0,-o],[-a,0,-a],[o,0,-o],[a,0,-a],[-o,0,o],[-a,0,a],[0,o,o],[0,a,a],[0,-o,-o],[0,-a,-a],[0,o,-o],[0,a,-a],[0,-o,o],[0,-a,a]],s=0,h=n.length;h>s;s++){var l=n[s][0],c=n[s][1],u=n[s][2];this.vertices.push(new THREE.Vector3(l,c,u))}},THREE.AsteriskGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry=function(e,t,i,r){THREE.Geometry.call(this),e=e||50,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,t=void 0!==t?Math.max(3,t):8;var o,a=[],n=new THREE.Vector3,s=new THREE.Vector2(.5,.5);for(this.vertices.push(n),a.push(s),o=0;t>=o;o++){var h=new THREE.Vector3;h.x=e*Math.cos(i+o/t*r),h.y=e*Math.sin(i+o/t*r),this.vertices.push(h),a.push(new THREE.Vector2((h.x/e+1)/2,-(h.y/e+1)/2+1))}var l=new THREE.Vector3(0,0,-1);for(o=1;t>=o;o++){var c=o,u=o+1,p=0;this.faces.push(new THREE.Face3(c,u,p,[l,l,l])),this.faceVertexUvs[0].push([a[o],a[o+1],s])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,i,r,o,a){function n(e,t,i,r,o,a,n,h){var l,c,u,p=s.widthSegments,f=s.heightSegments,d=o/2,m=a/2,E=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?l="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(l="y",f=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(l="x",p=s.depthSegments);var v=p+1,g=f+1,y=o/p,T=a/f,R=new THREE.Vector3;for(R[l]=n>0?1:-1,u=0;g>u;u++)for(c=0;v>c;c++){var x=new THREE.Vector3;x[e]=(c*y-d)*i,x[t]=(u*T-m)*r,x[l]=n,s.vertices.push(x)}for(u=0;f>u;u++)for(c=0;p>c;c++){var H=c+v*u,w=c+v*(u+1),b=c+1+v*(u+1),M=c+1+v*u,S=new THREE.Face4(H+E,w+E,b+E,M+E);S.normal.copy(R),S.vertexNormals.push(R.clone(),R.clone(),R.clone(),R.clone()),S.materialIndex=h,s.faces.push(S),s.faceVertexUvs[0].push([new THREE.Vector2(c/p,1-u/f),new THREE.Vector2(c/p,1-(u+1)/f),new THREE.Vector2((c+1)/p,1-(u+1)/f),new THREE.Vector2((c+1)/p,1-u/f)])
}}THREE.Geometry.call(this);var s=this;this.width=e,this.height=t,this.depth=i,this.widthSegments=r||1,this.heightSegments=o||1,this.depthSegments=a||1;var h=this.width/2,l=this.height/2,c=this.depth/2;n("z","y",-1,-1,this.depth,this.height,h,0),n("z","y",1,-1,this.depth,this.height,-h,1),n("x","z",1,1,this.width,this.depth,l,2),n("x","z",1,-1,this.width,this.depth,-l,3),n("x","y",1,-1,this.width,this.height,c,4),n("x","y",-1,-1,this.width,this.height,-c,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,i,r,o,a){THREE.Geometry.call(this),e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100;var n,s,h=i/2,l=r||8,c=o||1,u=[],p=[];for(s=0;c>=s;s++){var f=[],d=[],m=s/c,E=m*(t-e)+e;for(n=0;l>=n;n++){var v=n/l,g=new THREE.Vector3;g.x=E*Math.sin(2*v*Math.PI),g.y=-m*i+h,g.z=E*Math.cos(2*v*Math.PI),this.vertices.push(g),f.push(this.vertices.length-1),d.push(new THREE.Vector2(v,1-m))}u.push(f),p.push(d)}var y,T,R=(t-e)/i;for(n=0;l>n;n++)for(0!==e?(y=this.vertices[u[0][n]].clone(),T=this.vertices[u[0][n+1]].clone()):(y=this.vertices[u[1][n]].clone(),T=this.vertices[u[1][n+1]].clone()),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*R).normalize(),T.setY(Math.sqrt(T.x*T.x+T.z*T.z)*R).normalize(),s=0;c>s;s++){var x=u[s][n],H=u[s+1][n],w=u[s+1][n+1],b=u[s][n+1],M=y.clone(),S=y.clone(),_=T.clone(),C=T.clone(),A=p[s][n].clone(),P=p[s+1][n].clone(),D=p[s+1][n+1].clone(),L=p[s][n+1].clone();this.faces.push(new THREE.Face4(x,H,w,b,[M,S,_,C])),this.faceVertexUvs[0].push([A,P,D,L])}if(!a&&e>0)for(this.vertices.push(new THREE.Vector3(0,h,0)),n=0;l>n;n++){var x=u[0][n],H=u[0][n+1],w=this.vertices.length-1,M=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,1,0),_=new THREE.Vector3(0,1,0),A=p[0][n].clone(),P=p[0][n+1].clone(),D=new THREE.Vector2(P.u,0);this.faces.push(new THREE.Face3(x,H,w,[M,S,_])),this.faceVertexUvs[0].push([A,P,D])}if(!a&&t>0)for(this.vertices.push(new THREE.Vector3(0,-h,0)),n=0;l>n;n++){var x=u[s][n+1],H=u[s][n],w=this.vertices.length-1,M=new THREE.Vector3(0,-1,0),S=new THREE.Vector3(0,-1,0),_=new THREE.Vector3(0,-1,0),A=p[s][n+1].clone(),P=p[s][n].clone(),D=new THREE.Vector2(P.u,1);this.faces.push(new THREE.Face3(x,H,w,[M,S,_])),this.faceVertexUvs[0].push([A,P,D])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){return e===void 0?(e=[],void 0):(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals(),void 0)},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;i>r;r++){var o=e[r];this.addShape(o,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function r(e,t,i){return a(e,t,i)}function o(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x),o=Math.atan2(i.y-e.y,i.x-e.x);r>o&&(o+=2*Math.PI);var a=(r+o)/2,n=-Math.cos(a),s=-Math.sin(a),h=new THREE.Vector2(n,s);return h}function a(e,t,i){var r,a,n,s,h,l,c=THREE.ExtrudeGeometry.__v1,u=THREE.ExtrudeGeometry.__v2,p=THREE.ExtrudeGeometry.__v3,f=THREE.ExtrudeGeometry.__v4,d=THREE.ExtrudeGeometry.__v5,m=THREE.ExtrudeGeometry.__v6;return c.set(e.x-t.x,e.y-t.y),u.set(e.x-i.x,e.y-i.y),r=c.normalize(),a=u.normalize(),p.set(-r.y,r.x),f.set(a.y,-a.x),d.copy(e).add(p),m.copy(e).add(f),d.equals(m)?f.clone():(d.copy(t).add(p),m.copy(i).add(f),n=r.dot(f),s=m.sub(d).dot(f),0===n&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),h=s/n,0>h?o(e,t,i):(l=r.multiplyScalar(h).add(d),l.sub(e).clone()))}function n(){if(v){var e=0,t=X*e;for(K=0;Y>K;K++)W=N[K],c(W[2]+t,W[1]+t,W[0]+t,!0);for(e=y+2*E,t=X*e,K=0;Y>K;K++)W=N[K],c(W[0]+t,W[1]+t,W[2]+t,!1)}else{for(K=0;Y>K;K++)W=N[K],c(W[2],W[1],W[0],!0);for(K=0;Y>K;K++)W=N[K],c(W[0]+X*y,W[1]+X*y,W[2]+X*y,!1)}}function s(){var e=0;for(h(B,e),e+=B.length,A=0,P=V.length;P>A;A++)C=V[A],h(C,e),e+=C.length}function h(e,t){var i,r;for(K=e.length;--K>=0;){i=K,r=K-1,0>r&&(r=e.length-1);var o=0,a=y+2*E;for(o=0;a>o;o++){var n=X*o,s=X*(o+1),h=t+i+n,l=t+r+n,c=t+r+s,p=t+i+s;u(h,l,c,p,e,o,a,i,r)}}}function l(e,t,i){D.vertices.push(new THREE.Vector3(e,t,i))}function c(i,r,o,a){i+=L,r+=L,o+=L,D.faces.push(new THREE.Face3(i,r,o,null,null,x));var n=a?w.generateBottomUV(D,e,t,i,r,o):w.generateTopUV(D,e,t,i,r,o);D.faceVertexUvs[0].push(n)}function u(i,r,o,a,n,s,h,l,c){i+=L,r+=L,o+=L,a+=L,D.faces.push(new THREE.Face4(i,r,o,a,null,null,H));var u=w.generateSideWallUV(D,e,n,t,i,r,o,a,s,h,l,c);D.faceVertexUvs[0].push(u)}var p,f=void 0!==t.amount?t.amount:100,d=void 0!==t.bevelThickness?t.bevelThickness:6,m=void 0!==t.bevelSize?t.bevelSize:d-2,E=void 0!==t.bevelSegments?t.bevelSegments:3,v=void 0!==t.bevelEnabled?t.bevelEnabled:!0,g=void 0!==t.curveSegments?t.curveSegments:12,y=void 0!==t.steps?t.steps:1,T=t.extrudePath,R=!1,x=t.material,H=t.extrudeMaterial,w=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;this.shapebb;var b,M,S,_;T&&(p=T.getSpacedPoints(y),R=!0,v=!1,b=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(T,y,!1),M=new THREE.Vector3,S=new THREE.Vector3,_=new THREE.Vector3),v||(E=0,d=0,m=0);var C,A,P,D=this,L=this.vertices.length,z=e.extractPoints(g),F=z.shape,V=z.holes,U=!THREE.Shape.Utils.isClockWise(F);if(U){for(F=F.reverse(),A=0,P=V.length;P>A;A++)C=V[A],THREE.Shape.Utils.isClockWise(C)&&(V[A]=C.reverse());U=!1}var N=THREE.Shape.Utils.triangulateShape(F,V),B=F;for(A=0,P=V.length;P>A;A++)C=V[A],F=F.concat(C);var I,O,k,G,j,W,X=F.length,Y=N.length;B.length,180/Math.PI;for(var q=[],K=0,Z=B.length,Q=Z-1,J=K+1;Z>K;K++,Q++,J++)Q===Z&&(Q=0),J===Z&&(J=0),B[K],B[Q],B[J],q[K]=r(B[K],B[Q],B[J]);var $,et=[],tt=q.concat();for(A=0,P=V.length;P>A;A++){for(C=V[A],$=[],K=0,Z=C.length,Q=Z-1,J=K+1;Z>K;K++,Q++,J++)Q===Z&&(Q=0),J===Z&&(J=0),$[K]=r(C[K],C[Q],C[J]);et.push($),tt=tt.concat($)}for(I=0;E>I;I++){for(k=I/E,G=d*(1-k),O=m*Math.sin(k*Math.PI/2),K=0,Z=B.length;Z>K;K++)j=i(B[K],q[K],O),l(j.x,j.y,-G);for(A=0,P=V.length;P>A;A++)for(C=V[A],$=et[A],K=0,Z=C.length;Z>K;K++)j=i(C[K],$[K],O),l(j.x,j.y,-G)}for(O=m,K=0;X>K;K++)j=v?i(F[K],tt[K],O):F[K],R?(S.copy(b.normals[0]).multiplyScalar(j.x),M.copy(b.binormals[0]).multiplyScalar(j.y),_.copy(p[0]).add(S).add(M),l(_.x,_.y,_.z)):l(j.x,j.y,0);var it;for(it=1;y>=it;it++)for(K=0;X>K;K++)j=v?i(F[K],tt[K],O):F[K],R?(S.copy(b.normals[it]).multiplyScalar(j.x),M.copy(b.binormals[it]).multiplyScalar(j.y),_.copy(p[it]).add(S).add(M),l(_.x,_.y,_.z)):l(j.x,j.y,f/y*it);for(I=E-1;I>=0;I--){for(k=I/E,G=d*(1-k),O=m*Math.sin(k*Math.PI/2),K=0,Z=B.length;Z>K;K++)j=i(B[K],q[K],O),l(j.x,j.y,f+G);for(A=0,P=V.length;P>A;A++)for(C=V[A],$=et[A],K=0,Z=C.length;Z>K;K++)j=i(C[K],$[K],O),R?l(j.x,j.y+p[y-1].y,p[y-1].x+G):l(j.x,j.y,f+G)}n(),s()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r,o,a){var n=e.vertices[r].x,s=e.vertices[r].y,h=e.vertices[o].x,l=e.vertices[o].y,c=e.vertices[a].x,u=e.vertices[a].y;return[new THREE.Vector2(n,s),new THREE.Vector2(h,l),new THREE.Vector2(c,u)]},generateBottomUV:function(e,t,i,r,o,a){return this.generateTopUV(e,t,i,r,o,a)},generateSideWallUV:function(e,t,i,r,o,a,n,s){var h=e.vertices[o].x,l=e.vertices[o].y,c=e.vertices[o].z,u=e.vertices[a].x,p=e.vertices[a].y,f=e.vertices[a].z,d=e.vertices[n].x,m=e.vertices[n].y,E=e.vertices[n].z,v=e.vertices[s].x,g=e.vertices[s].y,y=e.vertices[s].z;return.01>Math.abs(l-p)?[new THREE.Vector2(h,1-c),new THREE.Vector2(u,1-f),new THREE.Vector2(d,1-E),new THREE.Vector2(v,1-y)]:[new THREE.Vector2(l,1-c),new THREE.Vector2(p,1-f),new THREE.Vector2(m,1-E),new THREE.Vector2(g,1-y)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;r>i;i++)this.addShape(e[i],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i=void 0!==t.curveSegments?t.curveSegments:12,r=t.material,o=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;this.shapebb;var a,n,s,h=this.vertices.length,l=e.extractPoints(i),c=l.shape,u=l.holes,p=!THREE.Shape.Utils.isClockWise(c);if(p){for(c=c.reverse(),a=0,n=u.length;n>a;a++)s=u[a],THREE.Shape.Utils.isClockWise(s)&&(u[a]=s.reverse());p=!1}var f=THREE.Shape.Utils.triangulateShape(c,u),d=c;for(a=0,n=u.length;n>a;a++)s=u[a],c=c.concat(s);var m,E,v=c.length,g=f.length;for(d.length,a=0;v>a;a++)m=c[a],this.vertices.push(new THREE.Vector3(m.x,m.y,0));for(a=0;g>a;a++){E=f[a];var y=E[0]+h,T=E[1]+h,R=E[2]+h;this.faces.push(new THREE.Face3(y,T,R,null,null,r)),this.faceVertexUvs[0].push(o.generateBottomUV(this,e,t,y,T,R))}},THREE.LatheGeometry=function(e,t,i,r){THREE.Geometry.call(this),t=t||12,i=i||0,r=r||2*Math.PI;for(var o=1/(e.length-1),a=1/t,n=0,s=t;s>=n;n++)for(var h=i+n*a*r,l=Math.cos(h),c=Math.sin(h),u=0,p=e.length;p>u;u++){var f=e[u],d=new THREE.Vector3;d.x=l*f.x-c*f.y,d.y=c*f.x+l*f.y,d.z=f.z,this.vertices.push(d)}for(var m=e.length,n=0,s=t;s>n;n++)for(var u=0,p=e.length-1;p>u;u++){var E=u+m*n,v=E,g=E+m,l=E+1+m,y=E+1;this.faces.push(new THREE.Face4(v,g,l,y));var T=n*a,R=u*o,x=T+a,H=R+o;this.faceVertexUvs[0].push([new THREE.Vector2(T,R),new THREE.Vector2(x,R),new THREE.Vector2(x,H),new THREE.Vector2(T,H)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,i,r){THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=i||1,this.heightSegments=r||1;var o,a,n=e/2,s=t/2,h=this.widthSegments,l=this.heightSegments,c=h+1,u=l+1,p=this.width/h,f=this.height/l,d=new THREE.Vector3(0,0,1);for(a=0;u>a;a++)for(o=0;c>o;o++){var m=o*p-n,E=a*f-s;this.vertices.push(new THREE.Vector3(m,-E,0))}for(a=0;l>a;a++)for(o=0;h>o;o++){var v=o+c*a,g=o+c*(a+1),y=o+1+c*(a+1),T=o+1+c*a,R=new THREE.Face4(v,g,y,T);R.normal.copy(d),R.vertexNormals.push(d.clone(),d.clone(),d.clone(),d.clone()),this.faces.push(R),this.faceVertexUvs[0].push([new THREE.Vector2(o/h,1-a/l),new THREE.Vector2(o/h,1-(a+1)/l),new THREE.Vector2((o+1)/h,1-(a+1)/l),new THREE.Vector2((o+1)/h,1-a/l)])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,i,r,o,a,n){THREE.Geometry.call(this),this.radius=e||50,this.widthSegments=Math.max(3,Math.floor(t)||8),this.heightSegments=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,a=void 0!==a?a:0,n=void 0!==n?n:Math.PI;var s,h,l=[],c=[];for(h=0;this.heightSegments>=h;h++){var u=[],p=[];for(s=0;this.widthSegments>=s;s++){var f=s/this.widthSegments,d=h/this.heightSegments,m=new THREE.Vector3;m.x=-this.radius*Math.cos(r+f*o)*Math.sin(a+d*n),m.y=this.radius*Math.cos(a+d*n),m.z=this.radius*Math.sin(r+f*o)*Math.sin(a+d*n),this.vertices.push(m),u.push(this.vertices.length-1),p.push(new THREE.Vector2(f,1-d))}l.push(u),c.push(p)}for(h=0;this.heightSegments>h;h++)for(s=0;this.widthSegments>s;s++){var E=l[h][s+1],v=l[h][s],g=l[h+1][s],y=l[h+1][s+1],T=this.vertices[E].clone().normalize(),R=this.vertices[v].clone().normalize(),x=this.vertices[g].clone().normalize(),H=this.vertices[y].clone().normalize(),w=c[h][s+1].clone(),b=c[h][s].clone(),M=c[h+1][s].clone(),S=c[h+1][s+1].clone();Math.abs(this.vertices[E].y)===this.radius?(this.faces.push(new THREE.Face3(E,g,y,[T,x,H])),this.faceVertexUvs[0].push([w,M,S])):Math.abs(this.vertices[g].y)===this.radius?(this.faces.push(new THREE.Face3(E,v,g,[T,R,x])),this.faceVertexUvs[0].push([w,b,M])):(this.faces.push(new THREE.Face4(E,v,g,y,[T,R,x,H])),this.faceVertexUvs[0].push([w,b,M,S]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){var i=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,i,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,i,r,o){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=r||6,this.arc=o||2*Math.PI;for(var a=new THREE.Vector3,n=[],s=[],h=0;this.radialSegments>=h;h++)for(var l=0;this.tubularSegments>=l;l++){var c=l/this.tubularSegments*this.arc,u=2*h/this.radialSegments*Math.PI;a.x=this.radius*Math.cos(c),a.y=this.radius*Math.sin(c);var p=new THREE.Vector3;p.x=(this.radius+this.tube*Math.cos(u))*Math.cos(c),p.y=(this.radius+this.tube*Math.cos(u))*Math.sin(c),p.z=this.tube*Math.sin(u),this.vertices.push(p),n.push(new THREE.Vector2(l/this.tubularSegments,h/this.radialSegments)),s.push(p.clone().sub(a).normalize())}for(var h=1;this.radialSegments>=h;h++)for(var l=1;this.tubularSegments>=l;l++){var f=(this.tubularSegments+1)*h+l-1,d=(this.tubularSegments+1)*(h-1)+l-1,m=(this.tubularSegments+1)*(h-1)+l,E=(this.tubularSegments+1)*h+l,v=new THREE.Face4(f,d,m,E,[s[f],s[d],s[m],s[E]]);v.normal.add(s[f]),v.normal.add(s[d]),v.normal.add(s[m]),v.normal.add(s[E]),v.normal.normalize(),this.faces.push(v),this.faceVertexUvs[0].push([n[f].clone(),n[d].clone(),n[m].clone(),n[E].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,i,r,o,a,n){function s(e,t,i){return l.vertices.push(new THREE.Vector3(e,t,i))-1}function h(e,t,i,r,o,a){var n=Math.cos(e);Math.cos(t);var s=Math.sin(e),h=i/r*e,l=Math.cos(h),c=.5*o*(2+l)*n,u=.5*o*(2+l)*s,p=.5*a*o*Math.sin(h);return new THREE.Vector3(c,u,p)}THREE.Geometry.call(this);var l=this;this.radius=e||100,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=r||8,this.p=o||2,this.q=a||3,this.heightScale=n||1,this.grid=Array(this.radialSegments);for(var c=new THREE.Vector3,u=new THREE.Vector3,p=new THREE.Vector3,f=0;this.radialSegments>f;++f){this.grid[f]=Array(this.tubularSegments);for(var d=0;this.tubularSegments>d;++d){var m,E,v=2*(f/this.radialSegments)*this.p*Math.PI,g=2*(d/this.tubularSegments)*Math.PI,y=h(v,g,this.q,this.p,this.radius,this.heightScale),T=h(v+.01,g,this.q,this.p,this.radius,this.heightScale);c.subVectors(T,y),u.addVectors(T,y),p.crossVectors(c,u),u.crossVectors(p,c),p.normalize(),u.normalize(),m=-this.tube*Math.cos(g),E=this.tube*Math.sin(g),y.x+=m*u.x+E*p.x,y.y+=m*u.y+E*p.y,y.z+=m*u.z+E*p.z,this.grid[f][d]=s(y.x,y.y,y.z)}}for(var f=0;this.radialSegments>f;++f)for(var d=0;this.tubularSegments>d;++d){var R=(f+1)%this.radialSegments,x=(d+1)%this.tubularSegments,H=this.grid[f][d],w=this.grid[R][d],b=this.grid[R][x],M=this.grid[f][x],S=new THREE.Vector2(f/this.radialSegments,d/this.tubularSegments),_=new THREE.Vector2((f+1)/this.radialSegments,d/this.tubularSegments),C=new THREE.Vector2((f+1)/this.radialSegments,(d+1)/this.tubularSegments),A=new THREE.Vector2(f/this.radialSegments,(d+1)/this.tubularSegments);this.faces.push(new THREE.Face4(H,w,b,M)),this.faceVertexUvs[0].push([S,_,C,A])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,i,r,o,a){function n(e,t,i){return S.vertices.push(new THREE.Vector3(e,t,i))-1}THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radiusSegments=r||8,this.closed=o||!1,a&&(this.debug=new THREE.Object3D),this.grid=[];var s,h,l,c,u,p,f,d,m,E,v,g,y,T,R,x,H,w,b,M,S=this,_=this.segments+1,C=new THREE.Vector3,A=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),P=A.tangents,D=A.normals,L=A.binormals;for(this.tangents=P,this.normals=D,this.binormals=L,m=0;_>m;m++)for(this.grid[m]=[],c=m/(_-1),d=e.getPointAt(c),s=P[m],h=D[m],l=L[m],this.debug&&(this.debug.add(new THREE.ArrowHelper(s,d,i,255)),this.debug.add(new THREE.ArrowHelper(h,d,i,16711680)),this.debug.add(new THREE.ArrowHelper(l,d,i,65280))),E=0;this.radiusSegments>E;E++)u=2*(E/this.radiusSegments)*Math.PI,p=-this.radius*Math.cos(u),f=this.radius*Math.sin(u),C.copy(d),C.x+=p*h.x+f*l.x,C.y+=p*h.y+f*l.y,C.z+=p*h.z+f*l.z,this.grid[m][E]=n(C.x,C.y,C.z);for(m=0;this.segments>m;m++)for(E=0;this.radiusSegments>E;E++)v=this.closed?(m+1)%this.segments:m+1,g=(E+1)%this.radiusSegments,y=this.grid[m][E],T=this.grid[v][E],R=this.grid[v][g],x=this.grid[m][g],H=new THREE.Vector2(m/this.segments,E/this.radiusSegments),w=new THREE.Vector2((m+1)/this.segments,E/this.radiusSegments),b=new THREE.Vector2((m+1)/this.segments,(E+1)/this.radiusSegments),M=new THREE.Vector2(m/this.segments,(E+1)/this.radiusSegments),this.faces.push(new THREE.Face4(y,T,R,x)),this.faceVertexUvs[0].push([H,w,b,M]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,i){function r(){f[0]=new THREE.Vector3,d[0]=new THREE.Vector3,a=Number.MAX_VALUE,n=Math.abs(p[0].x),s=Math.abs(p[0].y),h=Math.abs(p[0].z),a>=n&&(a=n,u.set(1,0,0)),a>=s&&(a=s,u.set(0,1,0)),a>=h&&u.set(0,0,1),m.crossVectors(p[0],u).normalize(),f[0].crossVectors(p[0],m),d[0].crossVectors(p[0],f[0])}var o,a,n,s,h,l,c,u=(new THREE.Vector3,new THREE.Vector3),p=(new THREE.Vector3,[]),f=[],d=[],m=new THREE.Vector3,E=new THREE.Matrix4,v=t+1,g=1e-4;for(this.tangents=p,this.normals=f,this.binormals=d,l=0;v>l;l++)c=l/(v-1),p[l]=e.getTangentAt(c),p[l].normalize();for(r(),l=1;v>l;l++)f[l]=f[l-1].clone(),d[l]=d[l-1].clone(),m.crossVectors(p[l-1],p[l]),m.length()>g&&(m.normalize(),o=Math.acos(p[l-1].dot(p[l])),f[l].applyMatrix4(E.makeRotationAxis(m,o))),d[l].crossVectors(p[l],f[l]);if(i)for(o=Math.acos(f[0].dot(f[v-1])),o/=v-1,p[0].dot(m.crossVectors(f[0],f[v-1]))>0&&(o=-o),l=1;v>l;l++)f[l].applyMatrix4(E.makeRotationAxis(p[l],o*l)),d[l].crossVectors(p[l],f[l])},THREE.PolyhedronGeometry=function(e,t,i,r){function o(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var i=s(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-r),t}function a(e,t,i,r){if(1>r){var o=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);o.centroid.add(e).add(t).add(i).divideScalar(3),o.normal=o.centroid.clone().normalize(),c.faces.push(o);var h=s(o.centroid);c.faceVertexUvs[0].push([l(e.uv,e,h),l(t.uv,t,h),l(i.uv,i,h)])}else r-=1,a(e,n(e,t),n(e,i),r),a(n(e,t),t,n(t,i),r),a(n(e,i),n(t,i),i,r),a(n(e,t),n(t,i),n(e,i),r)}function n(e,t){f[e.index]||(f[e.index]=[]),f[t.index]||(f[t.index]=[]);var i=f[e.index][t.index];return void 0===i&&(f[e.index][t.index]=f[t.index][e.index]=i=o((new THREE.Vector3).addVectors(e,t).divideScalar(2))),i}function s(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function l(e,t,i){return 0>i&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e}THREE.Geometry.call(this),i=i||1,r=r||0;for(var c=this,u=0,p=e.length;p>u;u++)o(new THREE.Vector3(e[u][0],e[u][1],e[u][2]));for(var f=[],d=this.vertices,u=0,p=t.length;p>u;u++)a(d[t[u][0]],d[t[u][1]],d[t[u][2]],r);this.mergeVertices();for(var u=0,p=this.vertices.length;p>u;u++)this.vertices[u].multiplyScalar(i);this.computeCentroids(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],o=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,r,o,e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){var i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],r=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,i,r,e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){var i=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],r=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,i,r,e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,i,r){THREE.Geometry.call(this);var o=this.vertices,a=this.faces,n=this.faceVertexUvs[0];r=void 0===r?!1:r;var s,h,l,c,u,p=t+1;for(s=0;i>=s;s++)for(u=s/i,h=0;t>=h;h++)c=h/t,l=e(c,u),o.push(l);var f,d,m,E,v,g,y,T;for(s=0;i>s;s++)for(h=0;t>h;h++)f=s*p+h,d=s*p+h+1,m=(s+1)*p+h,E=(s+1)*p+h+1,v=new THREE.Vector2(h/t,s/i),g=new THREE.Vector2((h+1)/t,s/i),y=new THREE.Vector2(h/t,(s+1)/i),T=new THREE.Vector2((h+1)/t,(s+1)/i),r?(a.push(new THREE.Face3(f,d,m)),a.push(new THREE.Face3(d,E,m)),n.push([v,g,y]),n.push([g,T,y])):(a.push(new THREE.Face4(f,d,E,m)),n.push([v,g,T,y]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry=function(e){function t(t){var r=e[t].clone(),n=r.length();r.x+=n*a(),r.y+=n*a(),r.z+=n*a();for(var h=[],l=0;s.length>l;){var c=s[l];if(i(c,r)){for(var u=0;3>u;u++){for(var p=[c[u],c[(u+1)%3]],f=!0,d=0;h.length>d;d++)if(o(h[d],p)){h[d]=h[h.length-1],h.pop(),f=!1;break}f&&h.push(p)}s[l]=s[s.length-1],s.pop()}else l++}for(var d=0;h.length>d;d++)s.push([h[d][0],h[d][1],t])}function i(t,i){var o=e[t[0]],a=e[t[1]],n=e[t[2]],s=r(o,a,n),h=s.dot(o);return s.dot(i)>=h}function r(e,t,i){var r=new THREE.Vector3,o=new THREE.Vector3;return r.subVectors(i,t),o.subVectors(e,t),r.cross(o),r.normalize(),r}function o(e,t){return e[0]===t[1]&&e[1]===t[0]}function a(){return 1e-6*2*(Math.random()-.5)}function n(e){var t=e.length();return new THREE.Vector2(e.x/t,e.y/t)}THREE.Geometry.call(this);for(var s=[[0,1,2],[0,2,1]],h=3;e.length>h;h++)t(h);for(var l=0,c=Array(e.length),h=0;s.length>h;h++)for(var u=s[h],p=0;3>p;p++)void 0===c[u[p]]&&(c[u[p]]=l++,this.vertices.push(e[u[p]])),u[p]=c[u[p]];for(var h=0;s.length>h;h++)this.faces.push(new THREE.Face3(s[h][0],s[h][1],s[h][2]));for(var h=0;this.faces.length>h;h++){var u=this.faces[h];this.faceVertexUvs[0].push([n(this.vertices[u.a]),n(this.vertices[u.b]),n(this.vertices[u.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e||1,0,0),new THREE.Vector3,new THREE.Vector3(0,e||1,0),new THREE.Vector3,new THREE.Vector3(0,0,e||1)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,t,i,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,i,r){THREE.Object3D.call(this),void 0===i&&(i=20),void 0===r&&(r=16776960);var o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0)),o.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(o,new THREE.LineBasicMaterial({color:r})),this.add(this.line);var a=new THREE.CylinderGeometry(0,.05,.25,5,1);this.cone=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof THREE.Vector3&&(this.position=t),this.setDirection(e),this.setLength(i)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(e){var t=THREE.ArrowHelper.__v1.copy(e).normalize();if(t.y>.999)this.rotation.set(0,0,0);else if(-.999>t.y)this.rotation.set(Math.PI,0,0);else{var i=THREE.ArrowHelper.__v2.set(t.z,0,-t.x).normalize(),r=Math.acos(t.y),o=THREE.ArrowHelper.__q1.setFromAxisAngle(i,r);this.rotation.setEulerFromQuaternion(o,this.eulerOrder)}},THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.ArrowHelper.__v1=new THREE.Vector3,THREE.ArrowHelper.__v2=new THREE.Vector3,THREE.ArrowHelper.__q1=new THREE.Quaternion,THREE.CameraHelper=function(e){function t(e,t,r){i(e,r),i(t,r)}function i(e,t){r.geometry.vertices.push(new THREE.Vector3),r.geometry.colors.push(new THREE.Color(t)),void 0===r.pointMap[e]&&(r.pointMap[e]=[]),r.pointMap[e].push(r.geometry.vertices.length-1)}THREE.Line.call(this);var r=this;this.geometry=new THREE.Geometry,this.material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),this.type=THREE.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={};var o=16755200,a=16711680,n=43775,s=16777215,h=3355443;t("n1","n2",o),t("n2","n4",o),t("n4","n3",o),t("n3","n1",o),t("f1","f2",o),t("f2","f4",o),t("f4","f3",o),t("f3","f1",o),t("n1","f1",o),t("n2","f2",o),t("n3","f3",o),t("n4","f4",o),t("p","n1",a),t("p","n2",a),t("p","n3",a),t("p","n4",a),t("u1","u2",n),t("u2","u3",n),t("u3","u1",n),t("c","t",s),t("p","c",h),t("cn1","cn2",h),t("cn3","cn4",h),t("cf1","cf2",h),t("cf3","cf4",h),this.camera=e,this.update(e)},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){function e(e,i,r,o){THREE.CameraHelper.__v.set(i,r,o),THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c);var a=t.pointMap[e];if(void 0!==a)for(var n=0,s=a.length;s>n;n++)t.geometry.vertices[a[n]].copy(THREE.CameraHelper.__v)}var t=this,i=1,r=1;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-i,-r,-1),e("n2",i,-r,-1),e("n3",-i,r,-1),e("n4",i,r,-1),e("f1",-i,-r,1),e("f2",i,-r,1),e("f3",-i,r,1),e("f4",i,r,1),e("u1",.7*i,1.1*r,-1),e("u2",.7*-i,1.1*r,-1),e("u3",0,2*r,-1),e("cf1",-i,0,1),e("cf2",i,0,1),e("cf3",0,-r,1),e("cf4",0,r,1),e("cn1",-i,0,-1),e("cn2",i,0,-1),e("cn3",0,-r,-1),e("cn4",0,r,-1),this.geometry.verticesNeedUpdate=!0},THREE.CameraHelper.__projector=new THREE.Projector,THREE.CameraHelper.__v=new THREE.Vector3,THREE.CameraHelper.__c=new THREE.Camera,THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.position=e.position,this.direction=new THREE.Vector3,this.direction.subVectors(e.target.position,e.position);var i=THREE.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(i);var r=this.color.getHex(),o=new THREE.SphereGeometry(t,16,8),a=new THREE.AsteriskGeometry(1.25*t,2.25*t),n=new THREE.MeshBasicMaterial({color:r,fog:!1}),s=new THREE.LineBasicMaterial({color:r,fog:!1});if(this.lightSphere=new THREE.Mesh(o,n),this.lightRays=new THREE.Line(a,s,THREE.LinePieces),this.add(this.lightSphere),this.add(this.lightRays),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==e.target.properties.targetInverse){var h=new THREE.SphereGeometry(t,8,4),l=new THREE.MeshBasicMaterial({color:r,wireframe:!0,fog:!1});this.targetSphere=new THREE.Mesh(h,l),this.targetSphere.position=e.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=e.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var c=new THREE.LineDashedMaterial({color:r,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),u=new THREE.Geometry;u.vertices.push(this.position.clone()),u.vertices.push(this.targetSphere.position.clone()),u.computeLineDistances(),this.targetLine=new THREE.Line(u,c),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position);var e=THREE.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},THREE.HemisphereLightHelper=function(e,t,i){THREE.Object3D.call(this),this.light=e,this.position=e.position;var r=THREE.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(r);var o=this.color.getHex();this.groundColor=e.groundColor.clone(),this.groundColor.multiplyScalar(r);for(var a=this.groundColor.getHex(),n=new THREE.SphereGeometry(t,16,8,0,2*Math.PI,0,.5*Math.PI),s=new THREE.SphereGeometry(t,16,8,0,2*Math.PI,.5*Math.PI,Math.PI),h=new THREE.MeshBasicMaterial({color:o,fog:!1}),l=new THREE.MeshBasicMaterial({color:a,fog:!1}),c=0,u=n.faces.length;u>c;c++)n.faces[c].materialIndex=0;for(var c=0,u=s.faces.length;u>c;c++)s.faces[c].materialIndex=1;THREE.GeometryUtils.merge(n,s),this.lightSphere=new THREE.Mesh(n,new THREE.MeshFaceMaterial([h,l])),this.lightArrow=new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,1.1*(t+i),0),i,o),this.lightArrow.rotation.x=Math.PI,this.lightArrowGround=new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1.1*(t+i),0),i,a);var p=new THREE.Object3D;p.rotation.x=.5*-Math.PI,p.add(this.lightSphere),p.add(this.lightArrow),p.add(this.lightArrowGround),this.add(p),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0,this.target=new THREE.Vector3,this.lookAt(this.target)},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.update=function(){var e=THREE.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.groundColor.copy(this.light.groundColor),this.groundColor.multiplyScalar(e),this.lightSphere.material.materials[0].color.copy(this.color),this.lightSphere.material.materials[1].color.copy(this.groundColor),this.lightArrow.setColor(this.color.getHex()),this.lightArrowGround.setColor(this.groundColor.getHex()),this.lookAt(this.target)},THREE.PointLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.position=e.position;var i=THREE.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(i);var r=this.color.getHex(),o=new THREE.SphereGeometry(t,16,8),a=new THREE.AsteriskGeometry(1.25*t,2.25*t),n=new THREE.IcosahedronGeometry(1,2),s=new THREE.MeshBasicMaterial({color:r,fog:!1}),h=new THREE.LineBasicMaterial({color:r,fog:!1}),l=new THREE.MeshBasicMaterial({color:r,fog:!1,wireframe:!0,opacity:.1,transparent:!0});this.lightSphere=new THREE.Mesh(o,s),this.lightRays=new THREE.Line(a,h,THREE.LinePieces),this.lightDistance=new THREE.Mesh(n,l);
var c=e.distance;0===c?this.lightDistance.visible=!1:this.lightDistance.scale.set(c,c,c),this.add(this.lightSphere),this.add(this.lightRays),this.add(this.lightDistance),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0},THREE.PointLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.PointLightHelper.prototype.update=function(){var e=THREE.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightDistance.material.color.copy(this.color);var t=this.light.distance;0===t?this.lightDistance.visible=!1:(this.lightDistance.visible=!0,this.lightDistance.scale.set(t,t,t))},THREE.SpotLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.position=e.position,this.direction=new THREE.Vector3,this.direction.subVectors(e.target.position,e.position);var i=THREE.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(i);var r=this.color.getHex(),o=new THREE.SphereGeometry(t,16,8),a=new THREE.AsteriskGeometry(1.25*t,2.25*t),n=new THREE.CylinderGeometry(1e-4,1,1,8,1,!0),s=new THREE.Matrix4;s.rotateX(-Math.PI/2),s.translate(new THREE.Vector3(0,-.5,0)),n.applyMatrix(s);var h=new THREE.MeshBasicMaterial({color:r,fog:!1}),l=new THREE.LineBasicMaterial({color:r,fog:!1}),c=new THREE.MeshBasicMaterial({color:r,fog:!1,wireframe:!0,opacity:.3,transparent:!0});this.lightSphere=new THREE.Mesh(o,h),this.lightCone=new THREE.Mesh(n,c);var u=e.distance?e.distance:1e4,p=2*u*Math.tan(.5*e.angle);if(this.lightCone.scale.set(p,p,u),this.lightRays=new THREE.Line(a,l,THREE.LinePieces),this.gyroscope=new THREE.Gyroscope,this.gyroscope.add(this.lightSphere),this.gyroscope.add(this.lightRays),this.add(this.gyroscope),this.add(this.lightCone),this.lookAt(e.target.position),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==e.target.properties.targetInverse){var f=new THREE.SphereGeometry(t,8,4),d=new THREE.MeshBasicMaterial({color:r,wireframe:!0,fog:!1});this.targetSphere=new THREE.Mesh(f,d),this.targetSphere.position=e.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=e.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var m=new THREE.LineDashedMaterial({color:r,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),E=new THREE.Geometry;E.vertices.push(this.position.clone()),E.vertices.push(this.targetSphere.position.clone()),E.computeLineDistances(),this.targetLine=new THREE.Line(E,m),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position),this.lookAt(this.light.target.position);var e=this.light.distance?this.light.distance:1e4,t=2*e*Math.tan(.5*this.light.angle);this.lightCone.scale.set(t,t,e);var i=THREE.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(i),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightCone.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,i,r,o){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,o)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,i,r,o,a){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===a&&(a=1),void 0===o&&(o=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,o=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+o*t.distance,t.wantedRotation=.25*t.x*Math.PI,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r="__default",o=0,a=i-1,n=i/1;this.createAnimation(r,o,a,n),this.setAnimationWeight(r,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var o={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=o,this.animationsList.push(o)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,r={},o=this.geometry,a=0,n=o.morphTargets.length;n>a;a++){var s=o.morphTargets[a],h=s.name.match(i);if(h&&h.length>1){var l=h[1];h[2],r[l]||(r[l]={start:1/0,end:-1/0});var c=r[l];c.start>a&&(c.start=a),a>c.end&&(c.end=a),t||(t=l)}}for(var l in r){var c=r[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var r=this.animationsList[t];if(r.active){var o=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||0>r.time)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,0>r.time&&(r.time+=r.duration));var a=r.startFrame+THREE.Math.clamp(Math.floor(r.time/o),0,r.length-1),n=r.weight;a!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*n,this.morphTargetInfluences[a]=0,r.lastFrame=r.currentFrame,r.currentFrame=a);var s=r.time%o/o;r.directionBackwards&&(s=1-s),this.morphTargetInfluences[r.currentFrame]=s*n,this.morphTargetInfluences[r.lastFrame]=(1-s)*n}}},THREE.LensFlarePlugin=function(){function e(e,i){var r=t.createProgram(),o=t.createShader(t.FRAGMENT_SHADER),a=t.createShader(t.VERTEX_SHADER),n="precision "+i+" float;\n";return t.shaderSource(o,n+e.fragmentShader),t.shaderSource(a,n+e.vertexShader),t.compileShader(o),t.compileShader(a),t.attachShader(r,o),t.attachShader(r,a),t.linkProgram(r),r}var t,i,r,o={};this.init=function(a){t=a.context,i=a,r=a.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var n=0;o.vertices[n++]=-1,o.vertices[n++]=-1,o.vertices[n++]=0,o.vertices[n++]=0,o.vertices[n++]=1,o.vertices[n++]=-1,o.vertices[n++]=1,o.vertices[n++]=0,o.vertices[n++]=1,o.vertices[n++]=1,o.vertices[n++]=1,o.vertices[n++]=1,o.vertices[n++]=-1,o.vertices[n++]=1,o.vertices[n++]=0,o.vertices[n++]=1,n=0,o.faces[n++]=0,o.faces[n++]=1,o.faces[n++]=2,o.faces[n++]=0,o.faces[n++]=2,o.faces[n++]=3,o.vertexBuffer=t.createBuffer(),o.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,o.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o.faces,t.STATIC_DRAW),o.tempTexture=t.createTexture(),o.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),0>=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(o.hasVertexTexture=!1,o.program=e(THREE.ShaderFlares.lensFlare,r)):(o.hasVertexTexture=!0,o.program=e(THREE.ShaderFlares.lensFlareVertexTexture,r)),o.attributes={},o.uniforms={},o.attributes.vertex=t.getAttribLocation(o.program,"position"),o.attributes.uv=t.getAttribLocation(o.program,"uv"),o.uniforms.renderType=t.getUniformLocation(o.program,"renderType"),o.uniforms.map=t.getUniformLocation(o.program,"map"),o.uniforms.occlusionMap=t.getUniformLocation(o.program,"occlusionMap"),o.uniforms.opacity=t.getUniformLocation(o.program,"opacity"),o.uniforms.color=t.getUniformLocation(o.program,"color"),o.uniforms.scale=t.getUniformLocation(o.program,"scale"),o.uniforms.rotation=t.getUniformLocation(o.program,"rotation"),o.uniforms.screenPosition=t.getUniformLocation(o.program,"screenPosition")},this.render=function(e,r,a,n){var s=e.__webglFlares,h=s.length;if(h){var l=new THREE.Vector3,c=n/a,u=.5*a,p=.5*n,f=16/n,d=new THREE.Vector2(f*c,f),m=new THREE.Vector3(1,1,0),E=new THREE.Vector2(1,1),v=o.uniforms,g=o.attributes;t.useProgram(o.program),t.enableVertexAttribArray(o.attributes.vertex),t.enableVertexAttribArray(o.attributes.uv),t.uniform1i(v.occlusionMap,0),t.uniform1i(v.map,1),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.vertexAttribPointer(g.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(g.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var y,T,R,x,H;for(y=0;h>y;y++)if(f=16/n,d.set(f*c,f),x=s[y],l.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),l.applyMatrix4(r.matrixWorldInverse),l.applyProjection(r.projectionMatrix),m.copy(l),E.x=m.x*u+u,E.y=m.y*p+p,o.hasVertexTexture||E.x>0&&a>E.x&&E.y>0&&n>E.y)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,E.x-8,E.y-8,16,16,0),t.uniform1i(v.renderType,0),t.uniform2f(v.scale,d.x,d.y),t.uniform3f(v.screenPosition,m.x,m.y,m.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,E.x-8,E.y-8,16,16,0),t.uniform1i(v.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),x.positionScreen.copy(m),x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares(),t.uniform1i(v.renderType,2),t.enable(t.BLEND),T=0,R=x.lensFlares.length;R>T;T++)H=x.lensFlares[T],H.opacity>.001&&H.scale>.001&&(m.x=H.x,m.y=H.y,m.z=H.z,f=H.size*H.scale/n,d.x=f*c,d.y=f,t.uniform3f(v.screenPosition,m.x,m.y,m.z),t.uniform2f(v.scale,d.x,d.y),t.uniform1f(v.rotation,H.rotation),t.uniform1f(v.opacity,H.opacity),t.uniform3f(v.color,H.color.r,H.color.g,H.color.b),i.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst),i.setTexture(H.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){function e(e,t){var i=new THREE.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,o=i.pointsFrustum,a=0;8>a;a++)r[a]=new THREE.Vector3,o[a]=new THREE.Vector3;var n=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return o[0].set(-1,-1,n),o[1].set(1,-1,n),o[2].set(-1,1,n),o[3].set(1,1,n),o[4].set(-1,-1,s),o[5].set(1,-1,s),o[6].set(-1,1,s),o[7].set(1,1,s),i}function t(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],o=e.shadowCascadeFarZ[t],a=i.pointsFrustum;a[0].z=r,a[1].z=r,a[2].z=r,a[3].z=r,a[4].z=o,a[5].z=o,a[6].z=o,a[7].z=o}function i(e,t){var i=t.shadowCamera,r=t.pointsFrustum,o=t.pointsWorld;p.set(1/0,1/0,1/0),f.set(-1/0,-1/0,-1/0);for(var a=0;8>a;a++){var n=o[a];n.copy(r[a]),THREE.ShadowMapPlugin.__projector.unprojectVector(n,e),n.applyMatrix4(i.matrixWorldInverse),p.x>n.x&&(p.x=n.x),n.x>f.x&&(f.x=n.x),p.y>n.y&&(p.y=n.y),n.y>f.y&&(f.y=n.y),p.z>n.z&&(p.z=n.z),n.z>f.z&&(f.z=n.z)}i.left=p.x,i.right=f.x,i.top=f.y,i.bottom=p.y,i.updateProjectionMatrix()}function r(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}var o,a,n,s,h,l,c=new THREE.Frustum,u=new THREE.Matrix4,p=new THREE.Vector3,f=new THREE.Vector3,d=new THREE.Vector3;this.init=function(e){o=e.context,a=e;var t=THREE.ShaderLib.depthRGBA,i=THREE.UniformsUtils.clone(t.uniforms);n=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),s=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),h=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),l=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),n._shadowPass=!0,s._shadowPass=!0,h._shadowPass=!0,l._shadowPass=!0},this.render=function(e,t){a.shadowMapEnabled&&a.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(p,f){var m,E,v,g,y,T,R,x,H,w,b,M,S,_,C=[],A=0,P=null;for(o.clearColor(1,1,1,1),o.disable(o.BLEND),o.enable(o.CULL_FACE),o.frontFace(o.CCW),a.shadowMapCullFace===THREE.CullFaceFront?o.cullFace(o.FRONT):o.cullFace(o.BACK),a.setDepthTest(!0),m=0,E=p.__lights.length;E>m;m++)if(S=p.__lights[m],S.castShadow)if(S instanceof THREE.DirectionalLight&&S.shadowCascade)for(y=0;S.shadowCascadeCount>y;y++){var D;if(S.shadowCascadeArray[y])D=S.shadowCascadeArray[y];else{D=e(S,y),D.originalCamera=f;var L=new THREE.Gyroscope;L.position=S.shadowCascadeOffset,L.add(D),L.add(D.target),f.add(L),S.shadowCascadeArray[y]=D,console.log("Created virtualLight",D)}t(S,y),C[A]=D,A++}else C[A]=S,A++;for(m=0,E=C.length;E>m;m++){if(S=C[m],!S.shadowMap){var z=THREE.LinearFilter;a.shadowMapType===THREE.PCFSoftShadowMap&&(z=THREE.NearestFilter);var F={minFilter:z,magFilter:z,format:THREE.RGBAFormat};S.shadowMap=new THREE.WebGLRenderTarget(S.shadowMapWidth,S.shadowMapHeight,F),S.shadowMapSize=new THREE.Vector2(S.shadowMapWidth,S.shadowMapHeight),S.shadowMatrix=new THREE.Matrix4}if(!S.shadowCamera){if(S instanceof THREE.SpotLight)S.shadowCamera=new THREE.PerspectiveCamera(S.shadowCameraFov,S.shadowMapWidth/S.shadowMapHeight,S.shadowCameraNear,S.shadowCameraFar);else{if(!(S instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}S.shadowCamera=new THREE.OrthographicCamera(S.shadowCameraLeft,S.shadowCameraRight,S.shadowCameraTop,S.shadowCameraBottom,S.shadowCameraNear,S.shadowCameraFar)}p.add(S.shadowCamera),a.autoUpdateScene&&p.updateMatrixWorld()}for(S.shadowCameraVisible&&!S.cameraHelper&&(S.cameraHelper=new THREE.CameraHelper(S.shadowCamera),S.shadowCamera.add(S.cameraHelper)),S.isVirtual&&D.originalCamera==f&&i(f,S),T=S.shadowMap,R=S.shadowMatrix,x=S.shadowCamera,x.position.getPositionFromMatrix(S.matrixWorld),d.getPositionFromMatrix(S.target.matrixWorld),x.lookAt(d),x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),S.cameraHelper&&(S.cameraHelper.visible=S.shadowCameraVisible),S.shadowCameraVisible&&S.cameraHelper.update(),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(x.projectionMatrix),R.multiply(x.matrixWorldInverse),u.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),c.setFromMatrix(u),a.setRenderTarget(T),a.clear(),_=p.__webglObjects,v=0,g=_.length;g>v;v++)b=_[v],M=b.object,b.render=!1,M.visible&&M.castShadow&&((M instanceof THREE.Mesh||M instanceof THREE.ParticleSystem)&&M.frustumCulled&&!c.intersectsObject(M)||(M._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,M.matrixWorld),b.render=!0));var V,U,N;for(v=0,g=_.length;g>v;v++)b=_[v],b.render&&(M=b.object,H=b.buffer,V=r(M),U=M.geometry.morphTargets.length>0&&V.morphTargets,N=M instanceof THREE.SkinnedMesh&&V.skinning,w=M.customDepthMaterial?M.customDepthMaterial:N?U?l:h:U?s:n,H instanceof THREE.BufferGeometry?a.renderBufferDirect(x,p.__lights,P,w,H,M):a.renderBuffer(x,p.__lights,P,w,H,M));for(_=p.__webglObjectsImmediate,v=0,g=_.length;g>v;v++)b=_[v],M=b.object,M.visible&&M.castShadow&&(M._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,M.matrixWorld),a.renderImmediateObject(x,p.__lights,P,n,M))}var B=a.getClearColor(),I=a.getClearAlpha();o.clearColor(B.r,B.g,B.b,I),o.enable(o.BLEND),a.shadowMapCullFace===THREE.CullFaceFront&&o.cullFace(o.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){var r=i.createProgram(),o=i.createShader(i.FRAGMENT_SHADER),a=i.createShader(i.VERTEX_SHADER),n="precision "+t+" float;\n";return i.shaderSource(o,n+e.fragmentShader),i.shaderSource(a,n+e.vertexShader),i.compileShader(o),i.compileShader(a),i.attachShader(r,o),i.attachShader(r,a),i.linkProgram(r),r}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var i,r,o,a={};this.init=function(t){i=t.context,r=t,o=t.getPrecision(),a.vertices=new Float32Array(16),a.faces=new Uint16Array(6);var n=0;a.vertices[n++]=-1,a.vertices[n++]=-1,a.vertices[n++]=0,a.vertices[n++]=0,a.vertices[n++]=1,a.vertices[n++]=-1,a.vertices[n++]=1,a.vertices[n++]=0,a.vertices[n++]=1,a.vertices[n++]=1,a.vertices[n++]=1,a.vertices[n++]=1,a.vertices[n++]=-1,a.vertices[n++]=1,a.vertices[n++]=0,a.vertices[n++]=1,n=0,a.faces[n++]=0,a.faces[n++]=1,a.faces[n++]=2,a.faces[n++]=0,a.faces[n++]=2,a.faces[n++]=3,a.vertexBuffer=i.createBuffer(),a.elementBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,a.vertices,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.elementBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,a.faces,i.STATIC_DRAW),a.program=e(THREE.ShaderSprite.sprite,o),a.attributes={},a.uniforms={},a.attributes.position=i.getAttribLocation(a.program,"position"),a.attributes.uv=i.getAttribLocation(a.program,"uv"),a.uniforms.uvOffset=i.getUniformLocation(a.program,"uvOffset"),a.uniforms.uvScale=i.getUniformLocation(a.program,"uvScale"),a.uniforms.rotation=i.getUniformLocation(a.program,"rotation"),a.uniforms.scale=i.getUniformLocation(a.program,"scale"),a.uniforms.alignment=i.getUniformLocation(a.program,"alignment"),a.uniforms.color=i.getUniformLocation(a.program,"color"),a.uniforms.map=i.getUniformLocation(a.program,"map"),a.uniforms.opacity=i.getUniformLocation(a.program,"opacity"),a.uniforms.useScreenCoordinates=i.getUniformLocation(a.program,"useScreenCoordinates"),a.uniforms.sizeAttenuation=i.getUniformLocation(a.program,"sizeAttenuation"),a.uniforms.screenPosition=i.getUniformLocation(a.program,"screenPosition"),a.uniforms.modelViewMatrix=i.getUniformLocation(a.program,"modelViewMatrix"),a.uniforms.projectionMatrix=i.getUniformLocation(a.program,"projectionMatrix"),a.uniforms.fogType=i.getUniformLocation(a.program,"fogType"),a.uniforms.fogDensity=i.getUniformLocation(a.program,"fogDensity"),a.uniforms.fogNear=i.getUniformLocation(a.program,"fogNear"),a.uniforms.fogFar=i.getUniformLocation(a.program,"fogFar"),a.uniforms.fogColor=i.getUniformLocation(a.program,"fogColor"),a.uniforms.alphaTest=i.getUniformLocation(a.program,"alphaTest")},this.render=function(e,o,n,s){var h=e.__webglSprites,l=h.length;if(l){var c=a.attributes,u=a.uniforms,p=s/n,f=.5*n,d=.5*s;i.useProgram(a.program),i.enableVertexAttribArray(c.position),i.enableVertexAttribArray(c.uv),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.bindBuffer(i.ARRAY_BUFFER,a.vertexBuffer),i.vertexAttribPointer(c.position,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(c.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.elementBuffer),i.uniformMatrix4fv(u.projectionMatrix,!1,o.projectionMatrix.elements),i.activeTexture(i.TEXTURE0),i.uniform1i(u.map,0);var m=0,E=0,v=e.fog;v?(i.uniform3f(u.fogColor,v.color.r,v.color.g,v.color.b),v instanceof THREE.Fog?(i.uniform1f(u.fogNear,v.near),i.uniform1f(u.fogFar,v.far),i.uniform1i(u.fogType,1),m=1,E=1):v instanceof THREE.FogExp2&&(i.uniform1f(u.fogDensity,v.density),i.uniform1i(u.fogType,2),m=2,E=2)):(i.uniform1i(u.fogType,0),m=0,E=0);var g,y,T,R,x,H=[];for(g=0;l>g;g++)y=h[g],T=y.material,y.visible&&0!==T.opacity&&(T.useScreenCoordinates?y.z=-y.position.z:(y._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,y.matrixWorld),y.z=-y._modelViewMatrix.elements[14]));for(h.sort(t),g=0;l>g;g++)y=h[g],T=y.material,y.visible&&0!==T.opacity&&T.map&&T.map.image&&T.map.image.width&&(i.uniform1f(u.alphaTest,T.alphaTest),T.useScreenCoordinates===!0?(i.uniform1i(u.useScreenCoordinates,1),i.uniform3f(u.screenPosition,(y.position.x*r.devicePixelRatio-f)/f,(d-y.position.y*r.devicePixelRatio)/d,Math.max(0,Math.min(1,y.position.z))),H[0]=r.devicePixelRatio,H[1]=r.devicePixelRatio):(i.uniform1i(u.useScreenCoordinates,0),i.uniform1i(u.sizeAttenuation,T.sizeAttenuation?1:0),i.uniformMatrix4fv(u.modelViewMatrix,!1,y._modelViewMatrix.elements),H[0]=1,H[1]=1),x=e.fog&&T.fog?E:0,m!==x&&(i.uniform1i(u.fogType,x),m=x),R=1/(T.scaleByViewport?s:1),H[0]*=R*p*y.scale.x,H[1]*=R*y.scale.y,i.uniform2f(u.uvScale,T.uvScale.x,T.uvScale.y),i.uniform2f(u.uvOffset,T.uvOffset.x,T.uvOffset.y),i.uniform2f(u.alignment,T.alignment.x,T.alignment.y),i.uniform1f(u.opacity,T.opacity),i.uniform3f(u.color,T.color.r,T.color.g,T.color.b),i.uniform1f(u.rotation,y.rotation),i.uniform2fv(u.scale,H),r.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),r.setDepthTest(T.depthTest),r.setDepthWrite(T.depthWrite),r.setTexture(T.map,0),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE)}}},THREE.DepthPassPlugin=function(){function e(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,i,r,o,a,n,s=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(e){t=e.context,i=e;var s=THREE.ShaderLib.depthRGBA,h=THREE.UniformsUtils.clone(s.uniforms);r=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h}),o=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,morphTargets:!0}),a=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,skinning:!0}),n=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,n._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,c){var u,p,f,d,m,E,v,g=null;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),i.setDepthTest(!0),i.autoUpdateScene&&l.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),h.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),s.setFromMatrix(h),i.setRenderTarget(this.renderTarget),i.clear(),v=l.__webglObjects,u=0,p=v.length;p>u;u++)m=v[u],E=m.object,m.render=!1,E.visible&&((E instanceof THREE.Mesh||E instanceof THREE.ParticleSystem)&&E.frustumCulled&&!s.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,E.matrixWorld),m.render=!0));var y,T,R;for(u=0,p=v.length;p>u;u++)if(m=v[u],m.render){if(E=m.object,f=m.buffer,E instanceof THREE.ParticleSystem&&!E.customDepthMaterial)continue;y=e(E),y&&i.setMaterialFaces(E.material),T=E.geometry.morphTargets.length>0&&y.morphTargets,R=E instanceof THREE.SkinnedMesh&&y.skinning,d=E.customDepthMaterial?E.customDepthMaterial:R?T?n:a:T?o:r,f instanceof THREE.BufferGeometry?i.renderBufferDirect(c,l.__lights,g,d,f,E):i.renderBuffer(c,l.__lights,g,d,f,E)}for(v=l.__webglObjectsImmediate,u=0,p=v.length;p>u;u++)m=v[u],E=m.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,E.matrixWorld),i.renderImmediateObject(c,l.__lights,g,r,E));var x=i.getClearColor(),H=i.getClearAlpha();t.clearColor(x.r,x.g,x.b,H),t.enable(t.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},THREE.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},THREE.FirstPersonControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)
},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){if(!this.freeze){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),i=t-this.heightMin;this.autoSpeedFactor=e*i*this.heightCoef}else this.autoSpeedFactor=0;var r=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);var o=e*this.lookSpeed;this.activeLook||(o=0);var a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*o,this.lookVertical&&(this.lat-=this.mouseY*o*a),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var n=this.target,s=this.object.position;n.x=s.x+100*Math.sin(this.phi)*Math.cos(this.theta),n.y=s.y+100*Math.cos(this.phi),n.z=s.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(n)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",i(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",i(this,this.onKeyUp),!1),this.handleResize()},THREE.FlyControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),i=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-i)/i,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,i=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*i,this.rotationVector.y*i,this.rotationVector.z*i,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setEulerFromQuaternion(this.object.quaternion,this.object.eulerOrder)},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",i(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",i(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",i(this,this.mouseup),!1),this.domElement.addEventListener("keydown",i(this,this.keydown),!1),this.domElement.addEventListener("keyup",i(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.OrbitControls=function(e,t){function i(){return 2*Math.PI/60/60*h.autoRotateSpeed}function r(){return Math.pow(.95,h.userZoomSpeed)}function o(e){h.userRotate&&(e.preventDefault(),0===e.button||2===e.button?(x=R.ROTATE,u.set(e.clientX,e.clientY)):1===e.button&&(x=R.ZOOM,d.set(e.clientX,e.clientY)),document.addEventListener("mousemove",a,!1),document.addEventListener("mouseup",n,!1))}function a(e){e.preventDefault(),x===R.ROTATE?(p.set(e.clientX,e.clientY),f.subVectors(p,u),h.rotateLeft(2*Math.PI*f.x/c*h.userRotateSpeed),h.rotateUp(2*Math.PI*f.y/c*h.userRotateSpeed),u.copy(p)):x===R.ZOOM&&(m.set(e.clientX,e.clientY),E.subVectors(m,d),E.y>0?h.zoomIn():h.zoomOut(),d.copy(m))}function n(){h.userRotate&&(document.removeEventListener("mousemove",a,!1),document.removeEventListener("mouseup",n,!1),x=R.NONE)}function s(e){if(h.userZoom){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?h.zoomOut():h.zoomIn()}}THREE.EventDispatcher.call(this),this.object=e,this.domElement=void 0!==t?t:document,this.center=new THREE.Vector3,this.userZoom=!0,this.userZoomSpeed=1,this.userRotate=!0,this.userRotateSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0;var h=this,l=1e-6,c=1800,u=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Vector2,d=new THREE.Vector2,m=new THREE.Vector2,E=new THREE.Vector2,v=0,g=0,y=1,T=new THREE.Vector3,R={NONE:-1,ROTATE:0,ZOOM:1},x=R.NONE,H={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=i()),g-=e},this.rotateRight=function(e){void 0===e&&(e=i()),g+=e},this.rotateUp=function(e){void 0===e&&(e=i()),v-=e},this.rotateDown=function(e){void 0===e&&(e=i()),v+=e},this.zoomIn=function(e){void 0===e&&(e=r()),y/=e},this.zoomOut=function(e){void 0===e&&(e=r()),y*=e},this.update=function(){var e=this.object.position,t=e.clone().sub(this.center),r=Math.atan2(t.x,t.z),o=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(i()),r+=g,o+=v,o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(l,Math.min(Math.PI-l,o));var a=t.length()*y;a=Math.max(this.minDistance,Math.min(this.maxDistance,a)),t.x=a*Math.sin(o)*Math.sin(r),t.y=a*Math.cos(o),t.z=a*Math.sin(o)*Math.cos(r),e.copy(this.center).add(t),this.object.lookAt(this.center),g=0,v=0,y=1,T.distanceTo(this.object.position)>0&&(this.dispatchEvent(H),T.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1)},THREE.PathControls=function(e,t){function i(e){var t=e%h;return t>=0?t:t+h}function r(e){return 1>(e*=2)?.5*e*e:-.5*(--e*(e-2)-1)}function o(e,t){return function(){t.apply(e,arguments)}}function a(e,t,i,r){var o,a,n={name:i,fps:.6,length:r,hierarchy:[]},s=t.getControlPointsArray(),h=t.getLength(),l=s.length,c=0,u=0,p=l-1;for(a={parent:-1,keys:[]},a.keys[u]={time:0,pos:s[u],rot:[0,0,0,1],scl:[1,1,1]},a.keys[p]={time:r,pos:s[p],rot:[0,0,0,1],scl:[1,1,1]},o=1;l-1>o;o++)c=r*h.chunks[o]/h.total,a.keys[o]={time:c,pos:s[o]};return n.hierarchy[0]=a,THREE.AnimationHandler.add(n),new THREE.Animation(e,i,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function n(e,t){var i,r,o,a=new THREE.Geometry;for(i=0;e.points.length*t>i;i++)r=i/(e.points.length*t),o=e.getPoint(r),a.vertices[i]=new THREE.Vector3(o.x,o.y,o.z);return a}function s(e,t){var i=n(t,10),r=n(t,10),o=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),a=new THREE.Line(i,o),s=new THREE.ParticleSystem(r,new THREE.ParticleBasicMaterial({color:16755200,size:3}));a.scale.set(1,1,1),e.add(a),s.scale.set(1,1,1),e.add(s);for(var h,l=new THREE.SphereGeometry(1,16,8),c=new THREE.MeshBasicMaterial({color:65280}),u=0;t.points.length>u;u++)h=new THREE.Mesh(l,c),h.position.copy(t.points[u]),e.add(h)}this.object=e,this.domElement=void 0!==t?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookVertical=!0,this.lookHorizontal=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0;var h=2*Math.PI;this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.update=function(e){var t,o;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.phi=i(this.phi),t=this.verticalAngleMap.srcRange,o=this.verticalAngleMap.dstRange;var a=THREE.Math.mapLinear(this.phi,t[0],t[1],o[0],o[1]),n=o[1]-o[0],s=(a-o[0])/n;this.phi=r(s)*n+o[0],t=this.horizontalAngleMap.srcRange,o=this.horizontalAngleMap.dstRange;var h=THREE.Math.mapLinear(this.theta,t[0],t[1],o[0],o[1]),l=o[1]-o[0],c=(h-o[0])/l;this.theta=r(c)*l+o[0];var u=this.target.position;this.object.position,u.x=100*Math.sin(this.phi)*Math.cos(this.theta),u.y=100*Math.cos(this.phi),u.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){if(this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),i=new THREE.CubeGeometry(10,10,20),r=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(i,e);var n=new THREE.Mesh(r,t);n.position.set(0,10,0),this.animation=a(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(n)}else this.animation=a(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);this.createDebugPath&&s(this.debugPath,this.spline),this.domElement.addEventListener("mousemove",o(this,this.onMouseMove),!1)},this.handleResize()},THREE.PathControlsIdCounter=0,THREE.PointerLockControls=function(e){var t=this,i=new THREE.Object3D;i.add(e);var r=new THREE.Object3D;r.position.y=10,r.add(i);var o=!1,a=!1,n=!1,s=!1,h=!1,l=!1,c=new THREE.Vector3,u=Math.PI/2,p=function(e){if(t.enabled!==!1){var o=e.movementX||e.mozMovementX||e.webkitMovementX||0,a=e.movementY||e.mozMovementY||e.webkitMovementY||0;r.rotation.y-=.002*o,i.rotation.x-=.002*a,i.rotation.x=Math.max(-u,Math.min(u,i.rotation.x))}},f=function(e){switch(e.keyCode){case 38:case 87:o=!0;break;case 37:case 65:n=!0;break;case 40:case 83:a=!0;break;case 39:case 68:s=!0;break;case 32:l===!0&&(c.y+=10),l=!1}},d=function(e){switch(e.keyCode){case 38:case 87:o=!1;break;case 37:case 65:n=!1;break;case 40:case 83:a=!1;break;case 39:case 68:s=!1}};document.addEventListener("mousemove",p,!1),document.addEventListener("keydown",f,!1),document.addEventListener("keyup",d,!1),this.enabled=!1,this.getObject=function(){return r},this.isOnObject=function(e){h=e,l=e},this.update=function(e){t.enabled!==!1&&(e*=.1,c.x+=.08*-c.x*e,c.z+=.08*-c.z*e,c.y-=.25*e,o&&(c.z-=.12*e),a&&(c.z+=.12*e),n&&(c.x-=.12*e),s&&(c.x+=.12*e),h===!0&&(c.y=Math.max(0,c.y)),r.translateX(c.x),r.translateY(c.y),r.translateZ(c.z),10>r.position.y&&(c.y=0,r.position.y=10,l=!0))}},THREE.RollControls=function(e,t){function i(e){switch(e.keyCode){case 38:case 87:f=1;break;case 37:case 65:d=-1;break;case 40:case 83:f=-1;break;case 39:case 68:d=1;break;case 81:u=!0,p=1;break;case 69:u=!0,p=-1;break;case 82:m=1;break;case 70:m=-1}}function r(e){switch(e.keyCode){case 38:case 87:f=0;break;case 37:case 65:d=0;break;case 40:case 83:f=0;break;case 39:case 68:d=0;break;case 81:u=!1;break;case 69:u=!1;break;case 82:m=0;break;case 70:m=0}}function o(e){E=(e.clientX-g)/window.innerWidth,v=(e.clientY-y)/window.innerHeight}function a(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:f=1;break;case 2:f=-1}}function n(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:f=0;break;case 2:f=0}}this.object=e,this.domElement=void 0!==t?t:document,this.mouseLook=!0,this.autoForward=!1,this.lookSpeed=1,this.movementSpeed=1,this.rollSpeed=1,this.constrainVertical=[-.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var s=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Matrix4,u=!1,p=1,f=0,d=0,m=0,E=0,v=0,g=0,y=0;this.handleResize=function(){g=window.innerWidth/2,y=window.innerHeight/2},this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*E),this.rotateVertically(t*v)}var i=e*this.movementSpeed,r=f>0||this.autoForward&&!(0>f)?1:f;this.object.translateZ(-i*r),this.object.translateX(i*d),this.object.translateY(i*m),u&&(this.roll+=this.rollSpeed*e*p),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.constrainVertical[0]>this.forward.y&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),l.copy(this.forward),h.set(0,1,0),s.crossVectors(h,l).normalize(),h.crossVectors(l,s).normalize(),this.object.matrix.elements[0]=s.x,this.object.matrix.elements[4]=h.x,this.object.matrix.elements[8]=l.x,this.object.matrix.elements[1]=s.y,this.object.matrix.elements[5]=h.y,this.object.matrix.elements[9]=l.y,this.object.matrix.elements[2]=s.z,this.object.matrix.elements[6]=h.z,this.object.matrix.elements[10]=l.z,c.identity(),c.elements[0]=Math.cos(this.roll),c.elements[4]=-Math.sin(this.roll),c.elements[1]=Math.sin(this.roll),c.elements[5]=Math.cos(this.roll),this.object.matrix.multiply(c),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(e){this.object.position.x+=this.object.matrix.elements[0]*e,this.object.position.y+=this.object.matrix.elements[1]*e,this.object.position.z+=this.object.matrix.elements[2]*e},this.translateY=function(e){this.object.position.x+=this.object.matrix.elements[4]*e,this.object.position.y+=this.object.matrix.elements[5]*e,this.object.position.z+=this.object.matrix.elements[6]*e},this.translateZ=function(e){this.object.position.x-=this.object.matrix.elements[8]*e,this.object.position.y-=this.object.matrix.elements[9]*e,this.object.position.z-=this.object.matrix.elements[10]*e},this.rotateHorizontally=function(e){s.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),s.multiplyScalar(e),this.forward.sub(s),this.forward.normalize()},this.rotateVertically=function(e){h.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),h.multiplyScalar(e),this.forward.add(h),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",o,!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mouseup",n,!1),this.domElement.addEventListener("keydown",i,!1),this.domElement.addEventListener("keyup",r,!1),this.handleResize()},THREE.TrackballControls=function(e,t){function i(e){u.enabled!==!1&&(window.removeEventListener("keydown",i),m=d,d===p.NONE&&(e.keyCode!==u.keys[p.ROTATE]||u.noRotate?e.keyCode!==u.keys[p.ZOOM]||u.noZoom?e.keyCode!==u.keys[p.PAN]||u.noPan||(d=p.PAN):d=p.ZOOM:d=p.ROTATE))}function r(){u.enabled!==!1&&(d=m,window.addEventListener("keydown",i,!1))}function o(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),d===p.NONE&&(d=e.button),d!==p.ROTATE||u.noRotate?d!==p.ZOOM||u.noZoom?d!==p.PAN||u.noPan||(H=w=u.getMouseOnScreen(e.clientX,e.clientY)):y=T=u.getMouseOnScreen(e.clientX,e.clientY):v=g=u.getMouseProjectionOnBall(e.clientX,e.clientY),document.addEventListener("mousemove",a,!1),document.addEventListener("mouseup",n,!1))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),d!==p.ROTATE||u.noRotate?d!==p.ZOOM||u.noZoom?d!==p.PAN||u.noPan||(w=u.getMouseOnScreen(e.clientX,e.clientY)):T=u.getMouseOnScreen(e.clientX,e.clientY):g=u.getMouseProjectionOnBall(e.clientX,e.clientY))}function n(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),d=p.NONE,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",n))}function s(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),y.y+=.05*(1/t)}}function h(e){if(u.enabled!==!1)switch(e.touches.length){case 1:d=p.TOUCH_ROTATE,v=g=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:d=p.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;x=R=Math.sqrt(t*t+i*i);break;case 3:d=p.TOUCH_PAN,H=w=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:d=p.NONE}}function l(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:g=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;x=Math.sqrt(t*t+i*i);break;case 3:w=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:d=p.NONE}}function c(e){if(u.enabled!==!1){switch(e.touches.length){case 1:v=g=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:R=x=0;break;case 3:H=w=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}d=p.NONE}}THREE.EventDispatcher.call(this);var u=this,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var f=new THREE.Vector3,d=p.NONE,m=p.NONE,E=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector2,T=new THREE.Vector2,R=0,x=0,H=new THREE.Vector2,w=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var b={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2(.5*((e-u.screen.offsetLeft)/u.radius),.5*((t-u.screen.offsetTop)/u.radius))},this.getMouseProjectionOnBall=function(e,t){var i=new THREE.Vector3((e-.5*u.screen.width-u.screen.offsetLeft)/u.radius,(.5*u.screen.height+u.screen.offsetTop-t)/u.radius,0),r=i.length();r>1?i.normalize():i.z=Math.sqrt(1-r*r),E.copy(u.object.position).sub(u.target);var o=u.object.up.clone().setLength(i.y);return o.add(u.object.up.clone().cross(E).setLength(i.x)),o.add(E.setLength(i.z)),o},this.rotateCamera=function(){var e=Math.acos(v.dot(g)/v.length()/g.length());if(e){var t=(new THREE.Vector3).crossVectors(v,g).normalize(),i=new THREE.Quaternion;e*=u.rotateSpeed,i.setFromAxisAngle(t,-e),E.applyQuaternion(i),u.object.up.applyQuaternion(i),g.applyQuaternion(i),u.staticMoving?v.copy(g):(i.setFromAxisAngle(t,e*(u.dynamicDampingFactor-1)),v.applyQuaternion(i))}},this.zoomCamera=function(){if(d===p.TOUCH_ZOOM){var e=R/x;R=x,E.multiplyScalar(e)}else{var e=1+(T.y-y.y)*u.zoomSpeed;1!==e&&e>0&&(E.multiplyScalar(e),u.staticMoving?y.copy(T):y.y+=(T.y-y.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var e=w.clone().sub(H);if(e.lengthSq()){e.multiplyScalar(E.length()*u.panSpeed);var t=E.clone().cross(u.object.up).setLength(e.x);t.add(u.object.up.clone().setLength(e.y)),u.object.position.add(t),u.target.add(t),u.staticMoving?H=w:H.add(e.subVectors(w,H).multiplyScalar(u.dynamicDampingFactor))}},this.checkDistances=function(){u.noZoom&&u.noPan||(u.object.position.lengthSq()>u.maxDistance*u.maxDistance&&u.object.position.setLength(u.maxDistance),u.minDistance*u.minDistance>E.lengthSq()&&u.object.position.addVectors(u.target,E.setLength(u.minDistance)))},this.update=function(){E.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.object.position.addVectors(u.target,E),u.checkDistances(),u.object.lookAt(u.target),f.distanceToSquared(u.object.position)>0&&(u.dispatchEvent(b),f.copy(u.object.position))},this.reset=function(){d=p.NONE,m=p.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),E.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(b),f.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",c,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",r,!1),this.handleResize()},THREE.AnaglyphEffect=function(e,t,i){var r,o,a,n,s=new THREE.Matrix4,h=new THREE.Matrix4,l=125,c=new THREE.PerspectiveCamera;c.matrixAutoUpdate=!1;var u=new THREE.PerspectiveCamera;u.matrixAutoUpdate=!1;var p=new THREE.OrthographicCamera(-1,1,1,-1,0,1),f=new THREE.Scene,d={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===i&&(i=512);var m=new THREE.WebGLRenderTarget(t,i,d),E=new THREE.WebGLRenderTarget(t,i,d),v=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:m},mapRight:{type:"t",value:E}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec4 colorL, colorR;","	vec2 uv = vUv;","	colorL = texture2D( mapLeft, uv );","	colorR = texture2D( mapRight, uv );","	gl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;","}"].join("\n")}),g=new THREE.Mesh(new THREE.PlaneGeometry(2,2),v);f.add(g),this.setSize=function(t,i){m=new THREE.WebGLRenderTarget(t,i,d),E=new THREE.WebGLRenderTarget(t,i,d),v.uniforms.mapLeft.value=m,v.uniforms.mapRight.value=E,e.setSize(t,i)},this.render=function(t,i){t.updateMatrixWorld(),void 0===i.parent&&i.updateMatrixWorld();var d=r!==i.aspect||o!==i.near||a!==i.far||n!==i.fov;if(d){r=i.aspect,o=i.near,a=i.far,n=i.fov;var v,g,y=i.projectionMatrix.clone(),T=.5*(l/30),R=T*o/l,x=o*Math.tan(THREE.Math.degToRad(.5*n));s.elements[12]=T,h.elements[12]=-T,v=-x*r+R,g=x*r+R,y.elements[0]=2*o/(g-v),y.elements[8]=(g+v)/(g-v),c.projectionMatrix.copy(y),v=-x*r-R,g=x*r-R,y.elements[0]=2*o/(g-v),y.elements[8]=(g+v)/(g-v),u.projectionMatrix.copy(y)}c.matrixWorld.copy(i.matrixWorld).multiply(h),c.position.copy(i.position),c.near=i.near,c.far=i.far,e.render(t,c,m,!0),u.matrixWorld.copy(i.matrixWorld).multiply(s),u.position.copy(i.position),u.near=i.near,u.far=i.far,e.render(t,u,E,!0),e.render(f,p)}},THREE.AsciiEffect=function(e,t,i){function r(){E=Math.round(a*M),v=Math.round(n*M),H.width=E,H.height=v,g=e.domElement,g.style.backgroundColor&&(m.rows[0].cells[0].style.backgroundColor=g.style.backgroundColor,m.rows[0].cells[0].style.color=g.style.color),m.cellSpacing=0,m.cellPadding=0;var t=m.style;t.display="inline",t.width=Math.round(E/M*h)+"px",t.height=Math.round(v/M*h)+"px",t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=C+"px",t.fontFamily=R,t.fontSize=S+"px",t.lineHeight=_+"px",t.textAlign="left",t.textDecoration="none"}function o(e,t){w.clearRect(0,0,E,v),w.drawImage(x,0,0,E,v);for(var i=w.getImageData(0,0,E,v).data,r="",o=0;v>o;o+=2){for(var a=0;E>a;a++){var n,s,h=4*(o*E+a),f=i[h],d=i[h+1],m=i[h+2],g=i[h+3];s=(.3*f+.59*d+.11*m)/255,0==g&&(s=1),n=Math.floor((1-s)*(b.length-1)),p&&(n=b.length-n-1);var y=b[n];(void 0===y||" "==y)&&(y="&nbsp;"),r+=l?"<span style='color:rgb("+f+","+d+","+m+");"+(u?"background-color:rgb("+f+","+d+","+m+");":"")+(c?"opacity:"+g/255+";":"")+"'>"+y+"</span>":y}r+="<br/>"}t.innerHTML="<tr><td>"+r+"</td></tr>"}t=void 0===t?" .:-=+*#%@":t,i||(i={});var a,n,s=i.resolution?i.resolution:.15,h=i.scale?i.scale:1,l=i.color?i.color:!1,c=i.alpha?i.alpha:!1,u=i.block?i.block:!1,p=i.invert?i.invert:!1,f="low",d=document.createElement("div");d.style.cursor="default";var m=document.createElement("table");d.appendChild(m);var E,v,g;this.setSize=function(t,i){a=t,n=i,e.setSize(t,i),r()},this.render=function(t,i){e.render(t,i),o(e,m)},this.domElement=d;var y=" .,:;i1tfLCG08@".split(""),T=" CGO08@".split(""),R="courier new, monospace",x=e.domElement,H=document.createElement("canvas");if(H.getContext){var w=H.getContext("2d");if(w.getImageData){var b=l?T:y;t&&(b=t);var M=.5;switch(f){case"low":M=.25;break;case"medium":M=.5;break;case"high":M=1}s&&(M=s);var S=2/M*h,_=2/M*h,C=0;if("low"==f)switch(h){case 1:C=-1;break;case 2:case 3:C=-2.1;break;case 4:C=-3.1;break;case 5:C=-4.15}if("medium"==f)switch(h){case 1:C=0;break;case 2:C=-1;break;case 3:C=-1.04;break;case 4:case 5:C=-2.1}if("high"==f)switch(h){case 1:case 2:C=0;break;case 3:case 4:case 5:C=-1}}}},THREE.CrosseyedEffect=function(e){this.separation=10;var t,i,r=new THREE.PerspectiveCamera;r.target=new THREE.Vector3;var o=new THREE.PerspectiveCamera;o.target=new THREE.Vector3,e.autoClear=!1,this.setSize=function(r,o){t=r/2,i=o,e.setSize(r,o)},this.render=function(a,n){r.fov=n.fov,r.aspect=.5*n.aspect,r.near=n.near,r.far=n.far,r.updateProjectionMatrix(),r.position.copy(n.position),r.target.copy(n.target),r.translateX(this.separation),r.lookAt(r.target),o.near=n.near,o.far=n.far,o.projectionMatrix=r.projectionMatrix,o.position.copy(n.position),o.target.copy(n.target),o.translateX(-this.separation),o.lookAt(o.target),e.clear(),e.setViewport(0,0,t,i),e.render(a,r),e.setViewport(t,0,t,i),e.render(a,o,!1)}},THREE.ParallaxBarrierEffect=function(e){var t,i,r,o,a=new THREE.Matrix4,n=new THREE.Matrix4,s=125,h=new THREE.PerspectiveCamera;h.matrixAutoUpdate=!1;var l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1;var c=new THREE.Scene,u=new THREE.PerspectiveCamera(53,1,1,1e4);u.position.z=2,c.add(u);var p={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},f=new THREE.WebGLRenderTarget(512,512,p),d=new THREE.WebGLRenderTarget(512,512,p),m=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:f},mapRight:{type:"t",value:d}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec2 uv = vUv;","	if ( ( mod( gl_FragCoord.x, 2.0 ) ) > 1.00 ) {","		gl_FragColor = texture2D( mapLeft, uv );","	} else {","		gl_FragColor = texture2D( mapRight, uv );","	}","}"].join("\n")}),E=new THREE.Mesh(new THREE.PlaneGeometry(2,2),m);c.add(E),this.setSize=function(t,i){f=new THREE.WebGLRenderTarget(t,i,p),d=new THREE.WebGLRenderTarget(t,i,p),m.uniforms.mapLeft.value=f,m.uniforms.mapRight.value=d,e.setSize(t,i)},this.render=function(p,m){p.updateMatrixWorld(),void 0===m.parent&&m.updateMatrixWorld();var E=t!==m.aspect||i!==m.near||r!==m.far||o!==m.fov;if(E){t=m.aspect,i=m.near,r=m.far,o=m.fov;var v,g,y=m.projectionMatrix.clone(),T=.5*(s/30),R=T*i/s,x=i*Math.tan(THREE.Math.degToRad(.5*o));
a.elements[12]=T,n.elements[12]=-T,v=-x*t+R,g=x*t+R,y.elements[0]=2*i/(g-v),y.elements[8]=(g+v)/(g-v),h.projectionMatrix.copy(y),v=-x*t-R,g=x*t-R,y.elements[0]=2*i/(g-v),y.elements[8]=(g+v)/(g-v),l.projectionMatrix.copy(y)}h.matrixWorld.copy(m.matrixWorld).multiply(n),h.position.copy(m.position),h.near=m.near,h.far=m.far,e.render(p,h,f,!0),l.matrixWorld.copy(m.matrixWorld).multiply(a),l.position.copy(m.position),l.near=m.near,l.far=m.far,e.render(p,l,d,!0),c.updateMatrixWorld(),e.render(c,u)}},THREE.GeometryExporter=function(){},THREE.GeometryExporter.prototype={constructor:THREE.GeometryExporter,parse:function(e){function t(e,t,i){return i?e|1<<t:e&~(1<<t)}function i(e,t,i){var r=""+e+(""+t)+(""+i);return void 0!==l[r]?l[r]:(l[r]=h.length/3,h.push(e,t,i),l[r])}for(var r=[],o=0;e.vertices.length>o;o++){var a=e.vertices[o];r.push(a.x,a.y,a.z)}for(var n=[],s=[[]],h=[],l={},o=0;e.faces.length>o;o++){var c=e.faces[o],u=c instanceof THREE.Face3,p=void 0!==c.materialIndex;void 0!==e.faceUvs[0][o],void 0!==e.faceVertexUvs[0][o];var f=c.normal.length()>0,d=void 0!==c.vertexNormals[0];c.color,void 0!==c.vertexColors[0];var m=0;if(m=t(m,0,!u),m=t(m,4,f),m=t(m,5,d),n.push(m),u?n.push(c.a,c.b,c.c):n.push(c.a,c.b,c.c,c.d),p&&n.push(c.materialIndex),f){var E=c.normal;n.push(i(E.x,E.y,E.z))}if(d){var v=c.vertexNormals;u?n.push(i(v[0].x,v[0].y,v[0].z),i(v[1].x,v[1].y,v[1].z),i(v[2].x,v[2].y,v[2].z)):n.push(i(v[0].x,v[0].y,v[0].z),i(v[1].x,v[1].y,v[1].z),i(v[2].x,v[2].y,v[2].z),i(v[3].x,v[3].y,v[3].z))}}var g=JSON.stringify({metadata:{formatVersion:3.1,generatedBy:"GeometryExporter"},vertices:r,normals:h,uvs:s,faces:n},null,"	");return g}},THREE.ColladaLoader=function(){function e(e,i,r){var o=0;if(document.implementation&&document.implementation.createDocument){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState){if(0==a.status||200==a.status)if(a.responseXML)wt=i,t(a.responseXML,void 0,e);else if(a.responseText){wt=i;var n=new DOMParser,s=n.parseFromString(a.responseText,"application/xml");t(s,void 0,e)}else console.error("ColladaLoader: Empty or non-existing file ("+e+")")}else 3==a.readyState&&r&&(0==o&&(o=a.getResponseHeader("Content-Length")),r({total:o,loaded:a.responseText.length}))},a.open("GET",e,!0),a.send(null)}else alert("Don't know how to parse XML!")}function t(e,t,i){if(xt=e,t=t||wt,void 0!==i){var s=i.split("/");s.pop(),yt=(1>s.length?".":s.join("/"))+"/"}r(),ct(),Mt=o("//dae:library_images/dae:image",x,"image"),At=o("//dae:library_materials/dae:material",O,"material"),Pt=o("//dae:library_effects/dae:effect",X,"effect"),Ct=o("//dae:library_geometries/dae:geometry",D,"geometry"),Dt=o(".//dae:library_cameras/dae:camera",J,"camera"),_t=o("//dae:library_controllers/dae:controller",H,"controller"),St=o("//dae:library_animations/dae:animation",q,"animation"),gt=o(".//dae:library_visual_scenes/dae:visual_scene",M,"visual_scene"),Tt=[],Rt=[],Et=a(),Ht=new THREE.Object3D;for(var h=0;Et.nodes.length>h;h++)Ht.add(f(Et.nodes[h]));n();var l={scene:Ht,morphs:Tt,skins:Rt,animations:vt,dae:{images:Mt,materials:At,cameras:Dt,effects:Pt,geometries:Ct,controllers:_t,animations:St,visualScenes:gt,scene:Et}};return t&&t(l),l}function i(e){Lt=e}function r(){var e=xt.evaluate("//dae:asset",xt,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),t=e.iterateNext();if(t&&t.childNodes)for(var i=0;t.childNodes.length>i;i++){var r=t.childNodes[i];switch(r.nodeName){case"unit":var o=r.getAttribute("meter");o&&(Ft=parseFloat(o));break;case"up_axis":Vt=r.textContent.charAt(0)}}}function o(e,t,i){for(var r=xt.evaluate(e,xt,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),o={},a=r.iterateNext(),n=0;a;){var s=(new t).parse(a);s.id&&0!=s.id.length||(s.id=i+n++),o[s.id]=s,a=r.iterateNext()}return o}function a(){var e=xt.evaluate(".//dae:scene/dae:instance_visual_scene",xt,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(e){var t=e.getAttribute("url").replace(/^#/,"");return gt[t.length>0?t:"visual_scene0"]}return null}function n(){vt=[],s(Ht)}function s(e){var t=Et.getChildById(e.name,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},vt.push(i);for(var r=0,o=t.keys.length;o>r;r++)i.length=Math.max(i.length,t.keys[r].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var r=0,o=e.children.length;o>r;r++)for(var a=s(e.children[r]),n=0,h=a.hierarchy.length;h>n;n++)i.hierarchy.push({keys:[],sids:[]});return i}function h(){var e=1e6,t=-e,i=0;for(var r in St)for(var o=St[r],a=0;o.sampler.length>a;a++){var n=o.sampler[a];n.create(),e=Math.min(e,n.startTime),t=Math.max(t,n.endTime),i=Math.max(i,n.input.length)}return{start:e,end:t,frames:i}}function l(e,t){var i=t instanceof C?_t[t.url]:t;if(!i||!i.morph)return console.log("could not find morph controller!"),void 0;for(var r=i.morph,o=0;r.targets.length>o;o++){var a=r.targets[o],n=Ct[a];if(n.mesh&&n.mesh.primitives&&n.mesh.primitives.length){var s=n.mesh.primitives[0].geometry;s.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:s.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function c(e,t,i,r){if(e.world=e.world||new THREE.Matrix4,e.world.copy(e.matrix),e.channels&&e.channels.length){var o=e.channels[0],a=o.sampler.output[i];a instanceof THREE.Matrix4&&e.world.copy(a)}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var n=0;e.nodes.length>n;n++)c(e.nodes[n],t,i,e.world)}function u(e,t){for(var i=0;e.length>i;i++){var r=e[i],o=-1;if("JOINT"==r.type){for(var a=0;t.joints.length>a;a++)if(r.sid==t.joints[a]){o=a;break}if(!(o>=0))throw"ColladaLoader: Could not find joint '"+r.sid+"'.";var n=t.invBindMatrices[o];r.invBindMatrix=n,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,n),r.weights=[];for(var a=0;t.weights.length>a;a++)for(var s=0;t.weights[a].length>s;s++){var h=t.weights[a][s];h.joint==o&&r.weights.push(h)}}}}function p(e,t,i){var r=_t[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return console.log("ColladaLoader: Could not find skin controller."),void 0;if(!t.skeleton||!t.skeleton.length)return console.log("ColladaLoader: Could not find the skeleton for the skin. "),void 0;var o,a,n,s,l,p,f,d=h(),m=Et.getChildById(t.skeleton[0],!0)||Et.getChildBySid(t.skeleton[0],!0),E=new THREE.Vector3;for(o=0;e.vertices.length>o;o++)e.vertices[o].applyMatrix4(r.skin.bindShapeMatrix);for(i=0;d.frames>i;i++){var v=[],g=[];for(o=0;e.vertices.length>o;o++)g.push(new THREE.Vector3);for(c(m,v,i),u(v,r.skin),o=0;v.length>o;o++)if("JOINT"==v[o].type)for(a=0;v[o].weights.length>a;a++)n=v[o].weights[a],s=n.index,l=n.weight,p=e.vertices[s],f=g[s],E.x=p.x,E.y=p.y,E.z=p.z,E.applyMatrix4(v[o].skinningMatrix),f.x+=E.x*l,f.y+=E.y*l,f.z+=E.z*l;e.morphTargets.push({name:"target_"+i,vertices:g})}}function f(e){var t,i,r,o,a=new THREE.Object3D,n=!1;for(r=0;e.controllers.length>r;r++){var s=_t[e.controllers[r].url];switch(s.type){case"skin":if(Ct[s.skin.source]){var h=new P;h.url=s.skin.source,h.instance_material=e.controllers[r].instance_material,e.geometries.push(h),n=!0,t=e.controllers[r]}else if(_t[s.skin.source]){var c=_t[s.skin.source];if(i=c,c.morph&&Ct[c.morph.source]){var h=new P;h.url=c.morph.source,h.instance_material=e.controllers[r].instance_material,e.geometries.push(h)}}break;case"morph":if(Ct[s.morph.source]){var h=new P;h.url=s.morph.source,h.instance_material=e.controllers[r].instance_material,e.geometries.push(h),i=e.controllers[r]}console.log("ColladaLoader: Morph-controller partially supported.");default:}}var u={};for(r=0;e.geometries.length>r;r++){var d,m=e.geometries[r],E=m.instance_material,v=Ct[m.url],g={},y=[],T=0;if(v){if(!v.mesh||!v.mesh.primitives)continue;if(0==a.name.length&&(a.name=v.id),E)for(o=0;E.length>o;o++){var R=E[o],x=At[R.target],H=x.instance_effect.url,w=Pt[H].shader,b=w.material;if(v.doubleSided){if(!(b in u)){var M=b.clone();M.side=THREE.DoubleSide,u[b]=M}b=u[b]}b.opacity=b.opacity?b.opacity:1,g[R.symbol]=T,y.push(b),d=b,d.name=null==x.name||""===x.name?x.id:x.name,T++}var S,_=d||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:v.doubleSided?THREE.DoubleSide:THREE.FrontSide}),C=v.mesh.geometry3js;if(T>1)for(_=new THREE.MeshFaceMaterial(y),o=0;C.faces.length>o;o++){var A=C.faces[o];A.materialIndex=g[A.daeMaterial]}void 0!==t?(p(C,t),_.morphTargets=!0,S=new THREE.SkinnedMesh(C,_,!1),S.skeleton=t.skeleton,S.skinController=_t[t.url],S.skinInstanceController=t,S.name="skin_"+Rt.length,Rt.push(S)):void 0!==i?(l(C,i),_.morphTargets=!0,S=new THREE.Mesh(C,_),S.name="morph_"+Tt.length,Tt.push(S)):S=new THREE.Mesh(C,_),e.geometries.length>1?a.add(S):a=S}}for(r=0;e.cameras.length>r;r++){var D=e.cameras[r],L=Dt[D.url];a=new THREE.PerspectiveCamera(L.fov,L.aspect_ratio,L.znear,L.zfar)}a.name=e.name||e.id||"",a.matrix=e.matrix;var z=e.matrix.decompose();if(a.position=z[0],a.quaternion=z[1],a.useQuaternion=!0,a.scale=z[2],a.position.multiplyScalar(Ft),a.scale.multiplyScalar(Ft),zt.centerGeometry&&a.geometry){var F=THREE.GeometryUtils.center(a.geometry);F.multiply(a.scale),F.applyQuaternion(a.quaternion),a.position.sub(F)}for(r=0;e.nodes.length>r;r++)a.add(f(e.nodes[r],e));return a}function d(e){return xt.evaluate(".//dae:library_nodes//dae:node[@id='"+e+"']",xt,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function m(e){var t=[],i=1e6,r=-1e6;for(var o in St)for(var a=St[o],n=0;a.channel.length>n;n++){var s=a.channel[n],h=a.sampler[n],o=s.target.split("/")[0];o==e.id&&(h.create(),s.sampler=h,i=Math.min(i,h.startTime),r=Math.max(r,h.endTime),t.push(s))}return t.length&&(e.startTime=i,e.endTime=r),t}function E(e){if(e.channels&&e.channels.length){for(var t=[],i=[],r=0,o=e.channels.length;o>r;r++){var a,n=e.channels[r],s=n.fullSid,h=n.sampler,l=h.input,c=e.getTransformBySid(n.sid);if(n.arrIndices){a=[];for(var u=0,p=n.arrIndices.length;p>u;u++)a[u]=dt(n.arrIndices[u])}else a=mt(n.member);if(c){-1===i.indexOf(s)&&i.push(s);for(var u=0,p=l.length;p>u;u++){var f=l[u],d=h.getData(c.type,u),m=v(t,f);if(!m){m=new Q(f);var E=g(t,f);t.splice(-1==E?t.length:E,0,m)}m.addTarget(s,c,a,d)}}else console.log('Could not find transform "'+n.sid+'" in node '+e.id)}for(var r=0;i.length>r;r++)for(var T=i[r],u=0;t.length>u;u++){var m=t[u];m.hasTarget(T)||y(t,m,u,T)}e.keys=t,e.sids=i}}function v(e,t){for(var i=null,r=0,o=e.length;o>r&&null==i;r++){var a=e[r];if(a.time===t)i=a;else if(a.time>t)break}return i}function g(e,t){for(var i=-1,r=0,o=e.length;o>r&&-1==i;r++){var a=e[r];a.time>=t&&(i=r)}return i}function y(e,t,i,r){var o=R(e,r,i?i-1:0),a=T(e,r,i+1);if(o&&a){var n,s=(t.time-o.time)/(a.time-o.time),h=o.getTarget(r),l=a.getTarget(r).data,c=h.data;if("matrix"===h.type)n=c;else if(c.length){n=[];for(var u=0;c.length>u;++u)n[u]=c[u]+(l[u]-c[u])*s}else n=c+(l-c)*s;t.addTarget(r,h.transform,h.member,n)}}function T(e,t,i){for(;e.length>i;i++){var r=e[i];if(r.hasTarget(t))return r}return null}function R(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var r=e[i];if(r.hasTarget(t))return r}return null}function x(){this.id="",this.init_from=""}function H(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function w(){this.method=null,this.source=null,this.targets=null,this.weights=null}function b(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function M(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Object3D}function S(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function _(){this.sid="",this.type="",this.data=[],this.obj=null}function C(){this.url="",this.skeleton=[],this.instance_material=[]}function A(){this.symbol="",this.target=""}function P(){this.url="",this.instance_material=[]}function D(){this.id="",this.mesh=null}function L(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function z(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function F(){z.call(this),this.vcount=[]}function V(){z.call(this),this.vcount=3}function U(){this.source="",this.count=0,this.stride=0,this.params=[]}function N(){this.input={}}function B(){this.semantic="",this.offset=0,this.source="",this.set=0}function I(e){this.id=e,this.type=null}function O(){this.id="",this.name="",this.instance_effect=null}function k(){this.color=new THREE.Color(0),this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function G(e,t){this.type=e,this.effect=t,this.material=null}function j(e){this.effect=e,this.init_from=null,this.format=null}function W(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function X(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function Y(){this.url=""}function q(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function K(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function Z(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function Q(e){this.targets=[],this.time=e}function J(){this.id="",this.name="",this.technique=""}function $(){this.url=""}function et(e){var t=e.getAttribute("id");return void 0!=bt[t]?bt[t]:(bt[t]=new I(t).parse(e),bt[t])}function tt(e){return"dae"==e?"http://www.collada.org/2005/11/COLLADASchema":null}function it(e){for(var t=at(e),i=[],r=0,o=t.length;o>r;r++)i.push("true"==t[r]||"1"==t[r]?!0:!1);return i}function rt(e){for(var t=at(e),i=[],r=0,o=t.length;o>r;r++)i.push(parseFloat(t[r]));return i}function ot(e){for(var t=at(e),i=[],r=0,o=t.length;o>r;r++)i.push(parseInt(t[r],10));return i}function at(e){return e.length>0?nt(e).split(/\s+/):[]}function nt(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function st(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function ht(e,t){for(var i=xt.evaluate(t,e,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=i.iterateNext(),o=[];r;)o.push(r),r=i.iterateNext();return o}function lt(e,t){e.doubleSided=!1;var i=xt.evaluate(".//dae:extra//dae:double_sided",t,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);i&&(i=i.iterateNext(),i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0))}function ct(){if(zt.convertUpAxis&&Vt!==zt.upAxis)switch(Vt){case"X":Ut="Y"===zt.upAxis?"XtoY":"XtoZ";break;case"Y":Ut="X"===zt.upAxis?"YtoX":"YtoZ";break;case"Z":Ut="X"===zt.upAxis?"ZtoX":"ZtoY"}else Ut=null}function ut(e,t){if(zt.convertUpAxis&&Vt!==zt.upAxis)switch(Ut){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":var i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":var i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function pt(e,t){var i=[e[t],e[t+1],e[t+2]];return ut(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function ft(e){if(zt.convertUpAxis){var t=[e[0],e[4],e[8]];ut(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],ut(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],ut(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],ut(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],ut(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],ut(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],ut(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new THREE.Matrix4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function dt(e){if(e>-1&&3>e){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=mt(t[e]),e=i[e]}return e}function mt(e){if(zt.convertUpAxis)switch(e){case"X":switch(Ut){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(Ut){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(Ut){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var Et,vt,gt,yt,Tt,Rt,xt=null,Ht=null,wt=null,bt={},Mt={},St={},_t={},Ct={},At={},Pt={},Dt={},Lt=THREE.SmoothShading,zt={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Ft=1,Vt="Y",Ut=null;return x.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},H.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new b).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new w).parse(i),this.type=i.nodeName;break;default:}}return this},w.prototype.parse=function(e){var t,i={},r=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;e.childNodes.length>t;t++){var o=e.childNodes[t];if(1==o.nodeType)switch(o.nodeName){case"source":var a=(new I).parse(o);i[a.id]=a;break;case"targets":r=this.parseInputs(o);break;default:console.log(o.nodeName)}}for(t=0;r.length>t;t++){var n=r[t],a=i[n.source];switch(n.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read();break;default:}}return this},w.prototype.parseInputs=function(e){for(var t=[],i=0;e.childNodes.length>i;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":t.push((new B).parse(r));break;default:}}return t},b.prototype.parse=function(e){var t,i,r={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var o=0;e.childNodes.length>o;o++){var a=e.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"bind_shape_matrix":var n=rt(a.textContent);this.bindShapeMatrix=ft(n);break;case"source":var s=(new I).parse(a);r[s.id]=s;break;case"joints":t=a;break;case"vertex_weights":i=a;break;default:console.log(a.nodeName)}}return this.parseJoints(t,r),this.parseWeights(i,r),this},b.prototype.parseJoints=function(e,t){for(var i=0;e.childNodes.length>i;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":var o=(new B).parse(r),a=t[o.source];"JOINT"==o.semantic?this.joints=a.read():"INV_BIND_MATRIX"==o.semantic&&(this.invBindMatrices=a.read());break;default:}}},b.prototype.parseWeights=function(e,t){for(var i,r,o=[],a=0;e.childNodes.length>a;a++){var n=e.childNodes[a];if(1==n.nodeType)switch(n.nodeName){case"input":o.push((new B).parse(n));break;case"v":i=ot(n.textContent);break;case"vcount":r=ot(n.textContent);break;default:}}for(var s=0,a=0;r.length>a;a++){for(var h=r[a],l=[],c=0;h>c;c++){for(var u={},p=0;o.length>p;p++){var f=o[p],d=i[s+f.offset];switch(f.semantic){case"JOINT":u.joint=d;break;case"WEIGHT":u.weight=t[f.source].data[d];break;default:}}l.push(u),s+=o.length}for(var c=0;l.length>c;c++)l[c].index=a;this.weights.push(l)}},M.prototype.getChildById=function(e,t){for(var i=0;this.nodes.length>i;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},M.prototype.getChildBySid=function(e,t){for(var i=0;this.nodes.length>i;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},M.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new S).parse(i));break;default:}}return this},S.prototype.getChannelForTransform=function(e){for(var t=0;this.channels.length>t;t++){var i=this.channels[t],r=i.target.split("/");r.shift();var o,a,n=r.shift(),s=n.indexOf(".")>=0,h=n.indexOf("(")>=0;if(s)r=n.split("."),n=r.shift(),a=r.shift();else if(h){o=n.split("("),n=o.shift();for(var l=0;o.length>l;l++)o[l]=parseInt(o[l].replace(/\)/,""))}if(n==e)return i.info={sid:n,dotSyntax:s,arrSyntax:h,arrIndices:o},i}return null},S.prototype.getChildById=function(e,t){if(this.id==e)return this;if(t)for(var i=0;this.nodes.length>i;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},S.prototype.getChildBySid=function(e,t){if(this.sid==e)return this;if(t)for(var i=0;this.nodes.length>i;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},S.prototype.getTransformBySid=function(e){for(var t=0;this.transforms.length>t;t++)if(this.transforms[t].sid==e)return this.transforms[t];return null},S.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.type="JOINT"==this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;e.childNodes.length>i;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new S).parse(r));break;case"instance_camera":this.cameras.push((new $).parse(r));break;case"instance_controller":this.controllers.push((new C).parse(r));break;case"instance_geometry":this.geometries.push((new P).parse(r));break;case"instance_light":break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var o=d(t);o&&this.nodes.push((new S).parse(o));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new _).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=m(this),E(this),this.updateMatrix(),this},S.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;this.transforms.length>e;e++)this.transforms[e].apply(this.matrix)},_.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=rt(e.textContent),this.convert(),this},_.prototype.convert=function(){switch(this.type){case"matrix":this.obj=ft(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":ut(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":ut(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},_.prototype.apply=function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.translate(this.obj);break;case"rotate":e.rotateByAxis(this.obj,this.angle);break;case"scale":e.scale(this.obj)}},_.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},C.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":var r=xt.evaluate(".//dae:instance_material",i,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(r)for(var o=r.iterateNext();o;)this.instance_material.push((new A).parse(o)),o=r.iterateNext();break;case"extra":break;default:}}return this},A.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},P.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){var r=xt.evaluate(".//dae:instance_material",i,tt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(r)for(var o=r.iterateNext();o;)this.instance_material.push((new A).parse(o)),o=r.iterateNext();break}}return this},D.prototype.parse=function(e){this.id=e.getAttribute("id"),lt(this,e);for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new L(this).parse(i);break;case"extra":break;default:}}return this},L.prototype.parse=function(e){this.primitives=[];var t;for(t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":et(i);break;case"vertices":this.vertices=(new N).parse(i);break;case"triangles":this.primitives.push((new V).parse(i));break;case"polygons":this.primitives.push((new z).parse(i));break;case"polylist":this.primitives.push((new F).parse(i));break;default:}}this.geometry3js=new THREE.Geometry;var r=bt[this.vertices.input.POSITION.source].data;for(t=0;r.length>t;t+=3)this.geometry3js.vertices.push(pt(r,t).clone());for(t=0;this.primitives.length>t;t++){var o=this.primitives[t];o.setVertices(this.vertices),this.handlePrimitive(o,this.geometry3js)}return this.geometry3js.computeCentroids(),this.geometry3js.computeFaceNormals(),this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this.geometry3js.computeBoundingBox(),this},L.prototype.handlePrimitive=function(e,t){var i,r,o,a,n,s,h,l=e.p,c=e.inputs,u=0,p=3,f=0,d=[];for(i=0;c.length>i;i++){o=c[i];var m=o.offset+1;switch(f=m>f?m:f,o.semantic){case"TEXCOORD":d.push(o.set)}}for(var E=0;l.length>E;++E)for(var v=l[E],g=0;v.length>g;){var y=[],T=[],R=null,x=[];for(p=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:v.length/f,i=0;p>i;i++)for(r=0;c.length>r;r++)switch(o=c[r],s=bt[o.source],a=v[g+i*f+o.offset],h=s.accessor.params.length,n=a*h,o.semantic){case"VERTEX":y.push(a);break;case"NORMAL":T.push(pt(s.data,n));break;case"TEXCOORD":R=R||{},void 0===R[o.set]&&(R[o.set]=[]),R[o.set].push(new THREE.Vector2(s.data[n],s.data[n+1]));break;case"COLOR":x.push((new THREE.Color).setRGB(s.data[n],s.data[n+1],s.data[n+2]));break;default:}if(0==T.length)if(o=this.vertices.input.NORMAL){s=bt[o.source],h=s.accessor.params.length;for(var H=0,w=y.length;w>H;H++)T.push(pt(s.data,y[H]*h))}else t.calcNormals=!0;if(!R&&(R={},o=this.vertices.input.TEXCOORD)){d.push(o.set),s=bt[o.source],h=s.accessor.params.length;for(var H=0,w=y.length;w>H;H++)n=y[H]*h,void 0===R[o.set]&&(R[o.set]=[]),R[o.set].push(new THREE.Vector2(s.data[n],1-s.data[n+1]))}if(0==x.length&&(o=this.vertices.input.COLOR)){s=bt[o.source],h=s.accessor.params.length;for(var H=0,w=y.length;w>H;H++)n=y[H]*h,x.push((new THREE.Color).setRGB(s.data[n],s.data[n+1],s.data[n+2]))}var b,M,S=null,_=[];if(3===p)_.push(new THREE.Face3(y[0],y[1],y[2],T,x.length?x:new THREE.Color));else if(4===p)_.push(new THREE.Face4(y[0],y[1],y[2],y[3],T,x.length?x:new THREE.Color));else if(p>4&&zt.subdivideFaces){var C=x.length?x:new THREE.Color;for(r=1;p-1>r;)_.push(new THREE.Face3(y[0],y[r],y[r+1],[T[0],T[r++],T[r]],C))}if(_.length)for(var H=0,w=_.length;w>H;H++)for(S=_[H],S.daeMaterial=e.material,t.faces.push(S),r=0;d.length>r;r++)b=R[d[r]],M=p>4?[b[0],b[H+1],b[H+2]]:4===p?[b[0],b[1],b[2],b[3]]:[b[0],b[1],b[2]],t.faceVertexUvs[r]||(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(M);else console.log("dropped face with vcount "+p+" for geometry with id: "+t.id);g+=f*p}},z.prototype.setVertices=function(e){for(var t=0;this.inputs.length>t;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},z.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=st(e,"count",0);for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new B).parse(e.childNodes[t]));break;case"vcount":this.vcount=ot(i.textContent);break;case"p":this.p.push(ot(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:}}return this},F.prototype=Object.create(z.prototype),V.prototype=Object.create(z.prototype),U.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=st(e,"count",0),this.stride=st(e,"stride",0);for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if("param"==i.nodeName){var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},N.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;e.childNodes.length>t;t++)if("input"==e.childNodes[t].nodeName){var i=(new B).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},B.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=st(e,"set",-1),this.offset=st(e,"offset",0),"TEXCOORD"==this.semantic&&0>this.set&&(this.set=0),this},I.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=it(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=rt(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=ot(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=at(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var r=0;i.childNodes.length>r;r++)if("accessor"==i.childNodes[r].nodeName){this.accessor=(new U).parse(i.childNodes[r]);break}break;default:}}return this},I.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;this.data.length>i;i+=16){var r=this.data.slice(i,i+16),o=ft(r);e.push(o)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},O.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;e.childNodes.length>t;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new Y).parse(e.childNodes[t]);break}return this},k.prototype.isColor=function(){return null==this.texture},k.prototype.isTexture=function(){return null!=this.texture},k.prototype.parse=function(e){for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=rt(i.textContent);this.color=new THREE.Color(0),this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i);break;default:}}return this},k.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},G.prototype.parse=function(e){for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new k).parse(i);
break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=ht(i,".//dae:float");r.length>0&&(this[i.nodeName]=parseFloat(r[0].textContent));break;default:}}return this.create(),this},G.prototype.create=function(){var e={},t=void 0!==this.transparency&&1>this.transparency;for(var i in this)switch(i){case"ambient":case"emission":case"diffuse":case"specular":var r=this[i];if(r instanceof k)if(r.isTexture()){var o=r.texture,a=this.effect.sampler[o].source;if(a){var n=this.effect.surface[a],s=Mt[n.init_from];if(s){var h=THREE.ImageUtils.loadTexture(yt+s.init_from);h.wrapS=r.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.wrapT=r.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.offset.x=r.texOpts.offsetU,h.offset.y=r.texOpts.offsetV,h.repeat.x=r.texOpts.repeatU,h.repeat.y=r.texOpts.repeatV,e.map=h,"emission"===i&&(e.emissive=16777215)}}}else"diffuse"!==i&&t||("emission"===i?e.emissive=r.color.getHex():e[i]=r.color.getHex());break;case"shininess":e[i]=this[i];break;case"reflectivity":e[i]=this[i],e[i]>0&&(e.envMap=zt.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[i],1!==this[i]&&(e.envMap=zt.defaultEnvMap);break;case"transparency":t&&(e.transparent=!0,e.opacity=this[i],t=!0);break;default:}switch(e.shading=Lt,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshLambertMaterial(e)}return this.material},j.prototype.parse=function(e){for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},W.prototype.parse=function(e){for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},X.prototype.create=function(){return null==this.shader?null:void 0},X.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),lt(this,e),this.shader=null;for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i));break;default:}}return this},X.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;e.childNodes.length>i;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new j(this).parse(r);break;case"sampler2D":this.sampler[t]=new W(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},X.prototype.parseProfileCOMMON=function(e){for(var t,i=0;e.childNodes.length>i;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var o=(new x).parse(r);Mt[o.id]=o;break;case"extra":break;default:console.log(r.nodeName)}}return t},X.prototype.parseTechnique=function(e){for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new G(i.nodeName,this).parse(i);break;default:}}},Y.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},q.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var r=(new q).parse(i);for(var o in r.source)this.source[o]=r.source[o];for(var a=0;r.channel.length>a;a++)this.channel.push(r.channel[a]),this.sampler.push(r.sampler[a]);break;case"source":var o=(new I).parse(i);this.source[o.id]=o;break;case"sampler":this.sampler.push(new Z(this).parse(i));break;case"channel":this.channel.push(new K(this).parse(i));break;default:}}return this},K.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/");t.shift();var i=t.shift(),r=i.indexOf(".")>=0,o=i.indexOf("(")>=0;if(r)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(o){var a=i.split("(");this.sid=a.shift();for(var n=0;a.length>n;n++)a[n]=parseInt(a[n].replace(/\)/,""));this.arrIndices=a}else this.sid=i;return this.fullSid=i,this.dotSyntax=r,this.arrSyntax=o,this},Z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new B).parse(i));break;default:}}return this},Z.prototype.create=function(){for(var e=0;this.inputs.length>e;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;this.input.length>e;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},Z.prototype.getData=function(e,t){var i;if("matrix"===e&&16===this.strideOut)i=this.output[t];else if(this.strideOut>1){i=[],t*=this.strideOut;for(var r=0;this.strideOut>r;++r)i[r]=this.output[t+r];if(3===this.strideOut)switch(e){case"rotate":case"translate":ut(i,-1);break;case"scale":ut(i,1)}else 4===this.strideOut&&"matrix"===e&&ut(i,-1)}else i=this.output[t];return i},Q.prototype.addTarget=function(e,t,i,r){this.targets.push({sid:e,member:i,transform:t,data:r})},Q.prototype.apply=function(e){for(var t=0;this.targets.length>t;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},Q.prototype.getTarget=function(e){for(var t=0;this.targets.length>t;++t)if(this.targets[t].sid===e)return this.targets[t];return null},Q.prototype.hasTarget=function(e){for(var t=0;this.targets.length>t;++t)if(this.targets[t].sid===e)return!0;return!1},Q.prototype.interpolate=function(e,t){for(var i=0;this.targets.length>i;++i){var r,o=this.targets[i],a=e.getTarget(o.sid);if("matrix"!==o.transform.type&&a){var n=(t-this.time)/(e.time-this.time),s=a.data,h=o.data;if((0>n||n>1)&&(console.log("Key.interpolate: Warning! Scale out of bounds:"+n),n=0>n?0:1),h.length){r=[];for(var l=0;h.length>l;++l)r[l]=h[l]+(s[l]-h[l])*n}else r=h+(s-h)*n}else r=o.data;o.transform.update(r,o.member)}},J.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i);break;default:}}return this},J.prototype.parseOptics=function(e){for(var t=0;e.childNodes.length>t;t++)if("technique_common"==e.childNodes[t].nodeName)for(var i=e.childNodes[t],r=0;i.childNodes.length>r;r++)if(this.technique=i.childNodes[r].nodeName,"perspective"==this.technique)for(var o=i.childNodes[r],a=0;o.childNodes.length>a;a++){var n=o.childNodes[a];switch(n.nodeName){case"yfov":this.yfov=n.textContent;break;case"xfov":this.xfov=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}else if("orthographic"==this.technique)for(var s=i.childNodes[r],a=0;s.childNodes.length>a;a++){var n=s.childNodes[a];switch(n.nodeName){case"xmag":this.xmag=n.textContent;break;case"ymag":this.ymag=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}return this},$.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},{load:e,parse:t,setPreferredShading:i,applySkin:p,geometries:Ct,options:zt}},THREE.MTLLoader=function(e,t){THREE.EventDispatcher.call(this),this.baseUrl=e,this.options=t},THREE.MTLLoader.prototype={load:function(e){function t(t){if(200===t.target.status||0===t.target.status){var r=i.parse(t.target.responseText);i.dispatchEvent({type:"load",content:r})}else i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]",response:t.target.responseText})}var i=this,r=new XMLHttpRequest;r.addEventListener("load",t,!1),r.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),r.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.send(null)},parse:function(e){for(var t=e.split("\n"),i={},r=/\s+/,o={},a=0;t.length>a;a++){var n=t[a];if(n=n.trim(),0!==n.length&&"#"!==n.charAt(0)){var s=n.indexOf(" "),h=s>=0?n.substring(0,s):n;h=h.toLowerCase();var l=s>=0?n.substring(s+1):"";if(l=l.trim(),"newmtl"===h)i={name:l},o[l]=i;else if(i)if("ka"===h||"kd"===h||"ks"===h){var c=l.split(r,3);i[h]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else i[h]=l}}var u=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options);return u.setMaterials(o),u}},THREE.MTLLoader.MaterialCreator=function(e,t){THREE.EventDispatcher.call(this),this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],o={};t[i]=o;for(var a in r){var n=!0,s=r[a],h=a.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(n=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s);break;default:}n&&(o[h]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],i={name:e,side:this.side};for(var r in t){var o=t[r];switch(r.toLowerCase()){case"kd":i.diffuse=(new THREE.Color).setRGB(o[0],o[1],o[2]);break;case"ka":i.ambient=(new THREE.Color).setRGB(o[0],o[1],o[2]);break;case"ks":i.specular=(new THREE.Color).setRGB(o[0],o[1],o[2]);break;case"map_kd":i.map=THREE.MTLLoader.loadTexture(this.baseUrl+o),i.map.wrapS=this.wrap,i.map.wrapT=this.wrap;break;case"ns":i.shininess=o;break;case"d":1>o&&(i.transparent=!0,i.opacity=o);break;default:}}return i.diffuse&&(i.ambient||(i.ambient=i.diffuse),i.color=i.diffuse),this.materials[e]=new THREE.MeshPhongMaterial(i),this.materials[e]}},THREE.MTLLoader.loadTexture=function(e,t,i,r){var o=/\.dds$/i.test(e);if(o)var a=THREE.ImageUtils.loadCompressedTexture(e,t,i,r);else{var n=new Image,a=new THREE.Texture(n,t),s=new THREE.ImageLoader;s.addEventListener("load",function(e){a.image=THREE.MTLLoader.ensurePowerOfTwo_(e.content),a.needsUpdate=!0,i&&i(a)}),s.addEventListener("error",function(e){r&&r(e.message)}),s.crossOrigin=this.crossOrigin,s.load(e,n)}return a},THREE.MTLLoader.ensurePowerOfTwo_=function(e){if(!THREE.MTLLoader.isPowerOfTwo_(e.width)||!THREE.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");t.width=THREE.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=THREE.MTLLoader.nextHighestPowerOfTwo_(e.height);var i=t.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},THREE.MTLLoader.isPowerOfTwo_=function(e){return 0===(e&e-1)},THREE.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},THREE.OBJLoader=function(){THREE.EventDispatcher.call(this)},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t){var i=this,r=new XMLHttpRequest;r.addEventListener("load",function(e){var r=i.parse(e.target.responseText);i.dispatchEvent({type:"load",content:r}),t&&t(r)},!1),r.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),r.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.send(null)},parse:function(e){function t(e,t,i){return new THREE.Vector3(e,t,i)}function i(e,t){return new THREE.Vector2(e,t)}function r(e,t,i,r){return new THREE.Face3(e,t,i,r)}function o(e,t,i,r,o){return new THREE.Face4(e,t,i,r,o)}function a(e,t){h.vertices.length>0&&(h.mergeVertices(),h.computeCentroids(),h.computeFaceNormals(),h.computeBoundingSphere(),s.add(c),h=new THREE.Geometry,c=new THREE.Mesh(h,l),p=0),void 0!==e&&(c.name=e),void 0!==t&&(l=new THREE.MeshLambertMaterial,l.name=t,c.material=l)}e=e.replace(/\ \\\r\n/g,"");for(var n=new THREE.Object3D,s=n,h=new THREE.Geometry,l=new THREE.MeshLambertMaterial,c=new THREE.Mesh(h,l),u=[],p=0,f=[],d=[],m=/v( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/,E=/vn( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/,v=/vt( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/,g=/f( +[\d]+)( [\d]+)( [\d]+)( [\d]+)?/,y=/f( +([\d]+)\/([\d]+))( ([\d]+)\/([\d]+))( ([\d]+)\/([\d]+))( ([\d]+)\/([\d]+))?/,T=/f( +([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))?/,R=/f( +([\d]+)\/\/([\d]+))( ([\d]+)\/\/([\d]+))( ([\d]+)\/\/([\d]+))( ([\d]+)\/\/([\d]+))?/,x=e.split("\n"),H=0;x.length>H;H++){var w=x[H];w=w.trim();var b;0!==w.length&&"#"!==w.charAt(0)&&(null!==(b=m.exec(w))?u.push(t(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]))):null!==(b=E.exec(w))?f.push(t(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]))):null!==(b=v.exec(w))?d.push(i(parseFloat(b[1]),parseFloat(b[2]))):null!==(b=g.exec(w))?void 0===b[4]?(h.vertices.push(u[parseInt(b[1])-1],u[parseInt(b[2])-1],u[parseInt(b[3])-1]),h.faces.push(r(p++,p++,p++))):(h.vertices.push(u[parseInt(b[1])-1],u[parseInt(b[2])-1],u[parseInt(b[3])-1],u[parseInt(b[4])-1]),h.faces.push(o(p++,p++,p++,p++))):null!==(b=y.exec(w))?void 0===b[10]?(h.vertices.push(u[parseInt(b[2])-1],u[parseInt(b[5])-1],u[parseInt(b[8])-1]),h.faces.push(r(p++,p++,p++)),h.faceVertexUvs[0].push([d[parseInt(b[3])-1],d[parseInt(b[6])-1],d[parseInt(b[9])-1]])):(h.vertices.push(u[parseInt(b[2])-1],u[parseInt(b[5])-1],u[parseInt(b[8])-1],u[parseInt(b[11])-1]),h.faces.push(o(p++,p++,p++,p++)),h.faceVertexUvs[0].push([d[parseInt(b[3])-1],d[parseInt(b[6])-1],d[parseInt(b[9])-1],d[parseInt(b[12])-1]])):null!==(b=T.exec(w))?void 0===b[13]?(h.vertices.push(u[parseInt(b[2])-1],u[parseInt(b[6])-1],u[parseInt(b[10])-1]),h.faces.push(r(p++,p++,p++,[f[parseInt(b[4])-1],f[parseInt(b[8])-1],f[parseInt(b[12])-1]])),h.faceVertexUvs[0].push([d[parseInt(b[3])-1],d[parseInt(b[7])-1],d[parseInt(b[11])-1]])):(h.vertices.push(u[parseInt(b[2])-1],u[parseInt(b[6])-1],u[parseInt(b[10])-1],u[parseInt(b[14])-1]),h.faces.push(o(p++,p++,p++,p++,[f[parseInt(b[4])-1],f[parseInt(b[8])-1],f[parseInt(b[12])-1],f[parseInt(b[16])-1]])),h.faceVertexUvs[0].push([d[parseInt(b[3])-1],d[parseInt(b[7])-1],d[parseInt(b[11])-1],d[parseInt(b[15])-1]])):null!==(b=R.exec(w))?void 0===b[10]?(h.vertices.push(u[parseInt(b[2])-1],u[parseInt(b[5])-1],u[parseInt(b[8])-1]),h.faces.push(r(p++,p++,p++,[f[parseInt(b[3])-1],f[parseInt(b[6])-1],f[parseInt(b[9])-1]]))):(h.vertices.push(u[parseInt(b[2])-1],u[parseInt(b[5])-1],u[parseInt(b[8])-1],u[parseInt(b[11])-1]),h.faces.push(o(p++,p++,p++,p++,[f[parseInt(b[3])-1],f[parseInt(b[6])-1],f[parseInt(b[9])-1],f[parseInt(b[12])-1]]))):/^o /.test(w)?(s=new THREE.Object3D,s.name=w.substring(2).trim(),n.add(s)):/^g /.test(w)?a(w.substring(2).trim(),void 0):/^usemtl /.test(w)?a(void 0,w.substring(7).trim()):/^mtllib /.test(w)||/^s /.test(w))}return a(void 0,void 0),n}},THREE.OBJMTLLoader=function(){THREE.EventDispatcher.call(this)},THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(e,t,i){function r(i){if("load"===i.type)if(i.content instanceof THREE.MTLLoader.MaterialCreator)o=!0,n=i.content,n.preload();else if(200===i.target.status||0===i.target.status){var r=i.target.responseText;a=t?s.parse(r):s.parse(r,function(e){o=!1,l.load(l.baseUrl+e)})}else s.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]",response:i.target.responseText});else"error"===i.type&&(o=!0);o&&a&&(n&&a.traverse(function(e){if(e instanceof THREE.Mesh&&e.material.name){var t=n.create(e.material.name);t&&(e.material=t)}}),s.dispatchEvent({type:"load",content:a}))}var o,a,n,s=this,h=new XMLHttpRequest,l=new THREE.MTLLoader(e.substr(0,e.lastIndexOf("/")+1),i);l.addEventListener("load",r),l.addEventListener("error",r),t?(l.load(t),o=!1):o=!0,h.addEventListener("load",r,!1),h.addEventListener("progress",function(e){s.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),h.addEventListener("error",function(){s.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),h.open("GET",e,!0),h.send(null)},parse:function(e,t){function i(e,t,i){return new THREE.Vector3(e,t,i)}function r(e,t){return new THREE.Vector2(e,t)}function o(e,t,i,r){return new THREE.Face3(e,t,i,r)}function a(e,t,i,r,o){return new THREE.Face4(e,t,i,r,o)}function n(e,t){l.vertices.length>0&&(l.mergeVertices(),l.computeCentroids(),l.computeFaceNormals(),l.computeBoundingSphere(),h.add(u),l=new THREE.Geometry,u=new THREE.Mesh(l,c),f=0),void 0!==e&&(u.name=e),void 0!==t&&(c=new THREE.MeshLambertMaterial,c.name=t,u.material=c)}e=e.replace(/\ \\\r\n/g,"");for(var s=new THREE.Object3D,h=s,l=new THREE.Geometry,c=new THREE.MeshLambertMaterial,u=new THREE.Mesh(l,c),p=[],f=0,d=[],m=[],E=/v( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/,v=/vn( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/,g=/vt( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/,y=/f( +[\d]+)( [\d]+)( [\d]+)( [\d]+)?/,T=/f( +([\d]+)\/([\d]+))( ([\d]+)\/([\d]+))( ([\d]+)\/([\d]+))( ([\d]+)\/([\d]+))?/,R=/f( +([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))?/,x=/f( +([\d]+)\/\/([\d]+))( ([\d]+)\/\/([\d]+))( ([\d]+)\/\/([\d]+))( ([\d]+)\/\/([\d]+))?/,H=e.split("\n"),w=0;H.length>w;w++){var b=H[w];b=b.trim();var M;if(0!==b.length&&"#"!==b.charAt(0))if(null!==(M=E.exec(b)))p.push(i(parseFloat(M[1]),parseFloat(M[2]),parseFloat(M[3])));else if(null!==(M=v.exec(b)))d.push(i(parseFloat(M[1]),parseFloat(M[2]),parseFloat(M[3])));else if(null!==(M=g.exec(b)))m.push(r(parseFloat(M[1]),parseFloat(M[2])));else if(null!==(M=y.exec(b)))void 0===M[4]?(l.vertices.push(p[parseInt(M[1])-1],p[parseInt(M[2])-1],p[parseInt(M[3])-1]),l.faces.push(o(f++,f++,f++))):(l.vertices.push(p[parseInt(M[1])-1],p[parseInt(M[2])-1],p[parseInt(M[3])-1],p[parseInt(M[4])-1]),l.faces.push(a(f++,f++,f++,f++)));else if(null!==(M=T.exec(b)))void 0===M[10]?(l.vertices.push(p[parseInt(M[2])-1],p[parseInt(M[5])-1],p[parseInt(M[8])-1]),l.faces.push(o(f++,f++,f++)),l.faceVertexUvs[0].push([m[parseInt(M[3])-1],m[parseInt(M[6])-1],m[parseInt(M[9])-1]])):(l.vertices.push(p[parseInt(M[2])-1],p[parseInt(M[5])-1],p[parseInt(M[8])-1],p[parseInt(M[11])-1]),l.faces.push(a(f++,f++,f++,f++)),l.faceVertexUvs[0].push([m[parseInt(M[3])-1],m[parseInt(M[6])-1],m[parseInt(M[9])-1],m[parseInt(M[12])-1]]));else if(null!==(M=R.exec(b)))void 0===M[13]?(l.vertices.push(p[parseInt(M[2])-1],p[parseInt(M[6])-1],p[parseInt(M[10])-1]),l.faces.push(o(f++,f++,f++,[d[parseInt(M[4])-1],d[parseInt(M[8])-1],d[parseInt(M[12])-1]])),l.faceVertexUvs[0].push([m[parseInt(M[3])-1],m[parseInt(M[7])-1],m[parseInt(M[11])-1]])):(l.vertices.push(p[parseInt(M[2])-1],p[parseInt(M[6])-1],p[parseInt(M[10])-1],p[parseInt(M[14])-1]),l.faces.push(a(f++,f++,f++,f++,[d[parseInt(M[4])-1],d[parseInt(M[8])-1],d[parseInt(M[12])-1],d[parseInt(M[16])-1]])),l.faceVertexUvs[0].push([m[parseInt(M[3])-1],m[parseInt(M[7])-1],m[parseInt(M[11])-1],m[parseInt(M[15])-1]]));else if(null!==(M=x.exec(b)))void 0===M[10]?(l.vertices.push(p[parseInt(M[2])-1],p[parseInt(M[5])-1],p[parseInt(M[8])-1]),l.faces.push(o(f++,f++,f++,[d[parseInt(M[3])-1],d[parseInt(M[6])-1],d[parseInt(M[9])-1]]))):(l.vertices.push(p[parseInt(M[2])-1],p[parseInt(M[5])-1],p[parseInt(M[8])-1],p[parseInt(M[11])-1]),l.faces.push(a(f++,f++,f++,f++,[d[parseInt(M[3])-1],d[parseInt(M[6])-1],d[parseInt(M[9])-1],d[parseInt(M[12])-1]])));else if(/^o /.test(b))h=new THREE.Object3D,h.name=b.substring(2).trim(),s.add(h);else if(/^g /.test(b))n(b.substring(2).trim(),void 0);else if(/^usemtl /.test(b))n(void 0,b.substring(7).trim());else if(/^mtllib /.test(b)){if(t){var S=b.substring(7);S=S.trim(),t(S)}}else/^s /.test(b)||console.log("THREE.OBJMTLLoader: Unhandled line "+b)}return n(void 0,void 0),s}},THREE.STLLoader=function(){THREE.EventDispatcher.call(this)},THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(e,t){var i=this,r=new XMLHttpRequest;r.addEventListener("load",function(e){var r;r=i.parse(e.target.response),i.dispatchEvent({type:"load",content:r}),t&&t(r)},!1),r.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),r.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.responseType="arraybuffer",r.send(null)},bin2str:function(e){for(var t=new Uint8Array(e),i="",r=0;e.byteLength>r;r++)i+=String.fromCharCode(t[r]);return i},isASCII:function(e){for(var t=new DataView(e),i="",r=0;5>r;r++)i+=String.fromCharCode(t.getUint8(r,!0));return"solid"===i.toLowerCase()},parse:function(e){if(this.isASCII(e)){var t=this.bin2str(e);return this.parseASCII(t)}return this.parseBinary(e)},parseASCII:function(e){for(var t,i=new THREE.Geometry,r=/facet([\s\S]*?)endfacet/g;null!=(t=r.exec(e));){for(var o=t[0],a=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g;null!=(t=a.exec(o));)var n=new THREE.Vector3(parseFloat(t[1]),parseFloat(t[3]),parseFloat(t[5]));for(var s=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g;null!=(t=s.exec(o));)i.vertices.push(new THREE.Vector3(parseFloat(t[1]),parseFloat(t[3]),parseFloat(t[5])));var h=i.vertices.length;i.faces.push(new THREE.Face3(h-3,h-2,h-1,n))}return i.computeCentroids(),i.computeBoundingSphere(),i},parseBinary:function(e){for(var t=new THREE.Geometry,i=80,r=84,o=50,a=!0,n=new DataView(e,i,4),s=n.getUint32(0,a),h=0;s>h;h++){for(var l=new DataView(e,r+h*o,o),c=new THREE.Vector3(l.getFloat32(0,a),l.getFloat32(4,a),l.getFloat32(8,a)),u=3;12>u;u+=3)t.vertices.push(new THREE.Vector3(l.getFloat32(4*u,a),l.getFloat32(4*(u+1),a),l.getFloat32(4*(u+2),a)));var p=t.vertices.length;t.faces.push(new THREE.Face3(p-3,p-2,p-1,c))}return t.computeCentroids(),t.computeBoundingSphere(),t}},THREE.UTF8Loader=function(){},THREE.UTF8Loader.prototype.load=function(e,t,i){this.downloadModelJson(e,i,t)},THREE.UTF8Loader.BufferGeometryCreator=function(){},THREE.UTF8Loader.BufferGeometryCreator.prototype.create=function(e,t){var i,r,o,a,n,s,h,l,c=t.length/3,u=new THREE.BufferGeometry,p=new Float32Array(9*c),f=new Float32Array(9*c),d=new Float32Array(6*c),m=e.length,E=8;for(r=0,o=0,i=o;m>i;i+=E)a=e[i],n=e[i+1],s=e[i+2],p[r++]=a,p[r++]=n,p[r++]=s;for(r=0,o=3,i=o;m>i;i+=E)h=e[i],l=e[i+1],d[r++]=h,d[r++]=l;for(r=0,o=5,i=o;m>i;i+=E)a=e[i],n=e[i+1],s=e[i+2],f[r++]=a,f[r++]=n,f[r++]=s;var v=u.attributes;return v.index={itemSize:1,array:t,numItems:t.length},v.position={itemSize:3,array:p,numItems:p.length},v.normal={itemSize:3,array:f,numItems:f.length},v.uv={itemSize:2,array:d,numItems:d.length},u.offsets=[{start:0,count:t.length,index:0}],u.computeBoundingSphere(),u},THREE.UTF8Loader.GeometryCreator=function(){},THREE.UTF8Loader.GeometryCreator.prototype={create:function(e,t){var i=new THREE.Geometry;this.init_vertices(i,e,8,0);var r=this.init_uvs(e,8,3),o=this.init_normals(e,8,5);return this.init_faces(i,o,r,t),i.computeCentroids(),i.computeFaceNormals(),i},init_vertices:function(e,t,i,r){var o,a,n,s,h=t.length;for(o=r;h>o;o+=i)a=t[o],n=t[o+1],s=t[o+2],this.addVertex(e,a,n,s)},init_normals:function(e,t,i){var r,o,a,n,s=[],h=e.length;for(r=i;h>r;r+=t)o=e[r],a=e[r+1],n=e[r+2],s.push(o,a,n);return s},init_uvs:function(e,t,i){var r,o,a,n=[],s=e.length;for(r=i;s>r;r+=t)o=e[r],a=e[r+1],n.push(o,a);return n},init_faces:function(e,t,i,r){var o,a,n,s,h,l,c,u,p,f,d=r.length,m=0;for(o=0;d>o;o+=3)a=r[o],n=r[o+1],s=r[o+2],this.f3n(e,t,a,n,s,m,a,n,s),h=i[2*a],l=i[2*a+1],c=i[2*n],u=i[2*n+1],p=i[2*s],f=i[2*s+1],this.uv3(e.faceVertexUvs[0],h,l,c,u,p,f)},addVertex:function(e,t,i,r){e.vertices.push(new THREE.Vector3(t,i,r))},f3n:function(e,t,i,r,o,a,n,s,h){var l=t[3*n],c=t[3*n+1],u=t[3*n+2],p=t[3*s],f=t[3*s+1],d=t[3*s+2],m=t[3*h],E=t[3*h+1],v=t[3*h+2],g=new THREE.Vector3(l,c,u),y=new THREE.Vector3(p,f,d),T=new THREE.Vector3(m,E,v);e.faces.push(new THREE.Face3(i,r,o,[g,y,T],null,a))},uv3:function(e,t,i,r,o,a,n){var s=[];s.push(new THREE.Vector2(t,i)),s.push(new THREE.Vector2(r,o)),s.push(new THREE.Vector2(a,n)),e.push(s)}};var DEFAULT_DECODE_PARAMS={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};THREE.UTF8Loader.prototype.decompressAttribsInner_=function(e,t,i,r,o,a,n,s){for(var h=0,l=t;i>l;l++){var c=e.charCodeAt(l);h+=c>>1^-(1&c),r[o]=s*(h+n),o+=a}},THREE.UTF8Loader.prototype.decompressIndices_=function(e,t,i,r,o){for(var a=0,n=0;i>n;n++){var s=e.charCodeAt(t++);r[o++]=a-s,0===s&&a++}},THREE.UTF8Loader.prototype.decompressAABBs_=function(e,t,i,r,o){for(var a=6*i,n=t+a,s=0,h=new Float32Array(a),l=t;n>l;l+=6){var c=e.charCodeAt(l+0)+r[0],u=e.charCodeAt(l+1)+r[1],p=e.charCodeAt(l+2)+r[2],f=e.charCodeAt(l+3)+1>>1,d=e.charCodeAt(l+4)+1>>1,m=e.charCodeAt(l+5)+1>>1;h[s++]=o[0]*(c+f),h[s++]=o[1]*(u+d),h[s++]=o[2]*(p+m),h[s++]=o[0]*f,h[s++]=o[1]*d,h[s++]=o[2]*m}return h},THREE.UTF8Loader.prototype.decompressMesh=function(e,t,i,r,o,a){for(var n=i.decodeScales.length,s=i.decodeOffsets,h=i.decodeScales,l=t.attribRange[0],c=t.attribRange[1],u=l,p=new Float32Array(n*c),f=0;n>f;f++){var d=u+c,m=h[f];m&&this.decompressAttribsInner_(e,u,d,p,f,n,s[f],m),u=d}t.indexRange[0];var E=3*t.indexRange[1],v=new Uint16Array(E);this.decompressIndices_(e,u,E,v,0);var g=void 0,y=t.bboxes;y&&(g=this.decompressAABBs_(e,y,t.names.length,s,h)),a(r,o,p,v,g,t)},THREE.UTF8Loader.prototype.copyAttrib=function(e,t,i,r){for(var o=0;e>o;o++)i[o]=t[e*r+o]},THREE.UTF8Loader.prototype.decodeAttrib2=function(e,t,i,r,o,a,n,s,h,l){for(var c=0;5>c;c++){var u=e.charCodeAt(o+a*c+l),p=u>>1^-(1&u);h[c]+=p,s[t*l+c]=h[c],n[t*l+c]=r[c]*(h[c]+i[c])}},THREE.UTF8Loader.prototype.accumulateNormal=function(e,t,i,r,o){var a=r[8*e],n=r[8*e+1],s=r[8*e+2],h=r[8*t],l=r[8*t+1],c=r[8*t+2],u=r[8*i],p=r[8*i+1],f=r[8*i+2];h-=a,l-=n,c-=s,u-=a,p-=n,f-=s,a=l*f-c*p,n=c*u-h*f,s=h*p-l*u,o[3*e]+=a,o[3*e+1]+=n,o[3*e+2]+=s,o[3*t]+=a,o[3*t+1]+=n,o[3*t+2]+=s,o[3*i]+=a,o[3*i+1]+=n,o[3*i+2]+=s},THREE.UTF8Loader.prototype.decompressMesh2=function(e,t,i,r,o,a){var n=96,s=i.decodeScales.length,h=i.decodeOffsets,l=i.decodeScales,c=t.attribRange[0],u=t.attribRange[1],p=t.codeRange[0];t.codeRange[1];for(var f=3*t.codeRange[2],d=new Uint16Array(f),m=new Int32Array(3*u),E=new Uint16Array(s),v=new Uint16Array(s*u),g=new Float32Array(s*u),y=0,T=0,R=0;f>R;R+=3){var x=e.charCodeAt(p++),H=Math.min(R,n);if(H>x){var w,b,M,S=x%3,_=R-(x-S);switch(S){case 0:w=d[_+2],b=d[_+1],M=d[_+0];break;case 1:w=d[_+0],b=d[_+2],M=d[_+1];break;case 2:w=d[_+1],b=d[_+0],M=d[_+2]}d[T++]=w,d[T++]=b,x=e.charCodeAt(p++);var C=y-x;if(d[T++]=C,0===x){for(var A=0;5>A;A++){var P=e.charCodeAt(c+u*A+y),D=(P>>1^-(1&P))+v[s*w+A]+v[s*b+A]-v[s*M+A];E[A]=D,v[s*y+A]=D,g[s*y+A]=l[A]*(D+h[A])}y++}else this.copyAttrib(s,v,E,C);this.accumulateNormal(w,b,C,v,m)}else{var L=y-(x-H);d[T++]=L,x===H?this.decodeAttrib2(e,s,h,l,c,u,g,v,E,y++):this.copyAttrib(s,v,E,L),x=e.charCodeAt(p++);var z=y-x;d[T++]=z,0===x?this.decodeAttrib2(e,s,h,l,c,u,g,v,E,y++):this.copyAttrib(s,v,E,z),x=e.charCodeAt(p++);var F=y-x;if(d[T++]=F,0===x){for(var A=0;5>A;A++)E[A]=(v[s*L+A]+v[s*z+A])/2;this.decodeAttrib2(e,s,h,l,c,u,g,v,E,y++)}else this.copyAttrib(s,v,E,F);this.accumulateNormal(L,z,F,v,m)}}for(var R=0;u>R;R++){var V=m[3*R],U=m[3*R+1],N=m[3*R+2],B=511/Math.sqrt(V*V+U*U+N*N),I=e.charCodeAt(c+5*u+R),O=e.charCodeAt(c+6*u+R),k=e.charCodeAt(c+7*u+R);g[s*R+5]=B*V+(I>>1^-(1&I)),g[s*R+6]=B*U+(O>>1^-(1&O)),g[s*R+7]=B*N+(k>>1^-(1&k))}a(r,o,g,d,void 0,t)},THREE.UTF8Loader.prototype.downloadMesh=function(e,t,i,r,o){function a(e){for(;i.length>s;){var a=i[s],h=a.indexRange;if(h){var l=h[0]+3*h[1];if(l>e.responseText.length)break;n.decompressMesh(e.responseText,a,r,t,s,o)}else{var c=a.codeRange,l=c[0]+c[1];if(l>e.responseText.length)break;n.decompressMesh2(e.responseText,a,r,t,s,o)}++s}}var n=this,s=0;getHttpRequest(e,function(e,t){(200===e.status||0===e.status)&&a(e,t)},a)},THREE.UTF8Loader.prototype.downloadMeshes=function(e,t,i,r){for(var o in t){var a=t[o];this.downloadMesh(e+o,o,a,i,r)}},THREE.UTF8Loader.prototype.createMeshCallback=function(e,t,i){var r=0,o=0,a={},n={},s={},h=t.urls;for(var l in h)a[l]=h[l].length,n[l]=0,o++,s[l]=new THREE.Object3D;var c=new THREE.Object3D,u=new THREE.MTLLoader.MaterialCreator(e,t.options);u.setMaterials(t.materials),u.preload();var p=new THREE.UTF8Loader.GeometryCreator,f=new THREE.UTF8Loader.BufferGeometryCreator,d=function(e,h,l,d,m,E){var v=void 0!==t.options.useBuffers?t.options.useBuffers:!0;if(v)var g=f.create(l,d);else var g=p.create(l,d);var y=u.create(E.material),T=new THREE.Mesh(g,y);s[e].add(T),n[e]++,n[e]===a[e]&&(r++,c.add(s[e]),r===o&&i(c))};return d},THREE.UTF8Loader.prototype.downloadModel=function(e,t,i,r){var o=this.createMeshCallback(t,i,r);this.downloadMeshes(e,i.urls,i.decodeParams,o)},THREE.UTF8Loader.prototype.downloadModelJson=function(e,t,i){getJsonRequest(e,function(r){r.decodeParams||(r.decodeParams=t&&t.decodeParams?t.decodeParams:DEFAULT_DECODE_PARAMS),r.options=t;var o=e.substr(0,e.lastIndexOf("/")+1),a=o;t&&t.geometryBase&&(o=t.geometryBase,"/"!==o.charAt(o.length-1)&&(o+="/")),t&&t.materialBase&&(a=t.materialBase,"/"!==a.charAt(a.length-1)&&(a+="/")),this.downloadModel(o,a,r,i)}.bind(this))},THREE.VTKLoader=function(){THREE.EventDispatcher.call(this)},THREE.VTKLoader.prototype={constructor:THREE.VTKLoader,load:function(e,t){var i=this,r=new XMLHttpRequest;r.addEventListener("load",function(e){var r=i.parse(e.target.responseText);i.dispatchEvent({type:"load",content:r}),t&&t(r)},!1),r.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),r.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.send(null)},parse:function(e){function t(e,t,i){n.vertices.push(new THREE.Vector3(e,t,i))}function i(e,t,i){n.faces.push(new THREE.Face3(e,t,i))
}function r(e,t,i,r){n.faces.push(new THREE.Face4(e,t,i,r))}var o,a,n=new THREE.Geometry;for(o=/([\+|\-]?[\d]+[\.][\d|\-|e]+)[ ]+([\+|\-]?[\d]+[\.][\d|\-|e]+)[ ]+([\+|\-]?[\d]+[\.][\d|\-|e]+)/g;null!=(a=o.exec(e));)t(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));for(o=/3[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)/g;null!=(a=o.exec(e));)i(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]));for(o=/4[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)/g;null!=(a=o.exec(e));)r(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseInt(a[4]));return n.computeCentroids(),n.computeFaceNormals(),n.computeVertexNormals(),n.computeBoundingSphere(),n}};var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0},LZMA.OutWindow.prototype.create=function(e){this._buffer&&this._windowSize===e||(this._buffer=[]),this._windowSize=e,this._pos=0,this._streamPos=0},LZMA.OutWindow.prototype.flush=function(){var e=this._pos-this._streamPos;if(0!==e){for(;e--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},LZMA.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},LZMA.OutWindow.prototype.setStream=function(e){this.releaseStream(),this._stream=e},LZMA.OutWindow.prototype.init=function(e){e||(this._streamPos=0,this._pos=0)},LZMA.OutWindow.prototype.copyBlock=function(e,t){var i=this._pos-e-1;for(0>i&&(i+=this._windowSize);t--;)i>=this._windowSize&&(i=0),this._buffer[this._pos++]=this._buffer[i++],this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.putByte=function(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.getByte=function(e){var t=this._pos-e-1;return 0>t&&(t+=this._windowSize),this._buffer[t]},LZMA.RangeDecoder=function(){},LZMA.RangeDecoder.prototype.setStream=function(e){this._stream=e},LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null},LZMA.RangeDecoder.prototype.init=function(){var e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()},LZMA.RangeDecoder.prototype.decodeDirectBits=function(e){for(var t,i=0,r=e;r--;)this._range>>>=1,t=this._code-this._range>>>31,this._code-=this._range&t-1,i=i<<1|1-t,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return i},LZMA.RangeDecoder.prototype.decodeBit=function(e,t){var i=e[t],r=(this._range>>>11)*i;return(2147483648^r)>(2147483648^this._code)?(this._range=r,e[t]+=2048-i>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=r,this._code-=r,e[t]-=i>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},LZMA.initBitModels=function(e,t){for(;t--;)e[t]=1024},LZMA.BitTreeDecoder=function(e){this._models=[],this._numBitLevels=e},LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.decode=function(e){for(var t=1,i=this._numBitLevels;i--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.reverseDecode=function(e){for(var t,i=1,r=0,o=0;this._numBitLevels>o;++o)t=e.decodeBit(this._models,i),i=i<<1|t,r|=t<<o;return r},LZMA.reverseDecode2=function(e,t,i,r){for(var o,a=1,n=0,s=0;r>s;++s)o=i.decodeBit(e,t+a),a=a<<1|o,n|=o<<s;return n},LZMA.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new LZMA.BitTreeDecoder(8),this._numPosStates=0},LZMA.LenDecoder.prototype.create=function(e){for(;e>this._numPosStates;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)},LZMA.LenDecoder.prototype.init=function(){var e=this._numPosStates;for(LZMA.initBitModels(this._choice,2);e--;)this._lowCoder[e].init(),this._midCoder[e].init();this._highCoder.init()},LZMA.LenDecoder.prototype.decode=function(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)},LZMA.Decoder2=function(){this._decoders=[]},LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)},LZMA.Decoder2.prototype.decodeNormal=function(e){var t=1;do t=t<<1|e.decodeBit(this._decoders,t);while(256>t);return 255&t},LZMA.Decoder2.prototype.decodeWithMatchByte=function(e,t){var i,r,o=1;do if(i=1&t>>7,t<<=1,r=e.decodeBit(this._decoders,(1+i<<8)+o),o=o<<1|r,i!==r){for(;256>o;)o=o<<1|e.decodeBit(this._decoders,o);break}while(256>o);return 255&o},LZMA.LiteralDecoder=function(){},LZMA.LiteralDecoder.prototype.create=function(e,t){var i;if(!this._coders||this._numPrevBits!==t||this._numPosBits!==e)for(this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[],i=1<<this._numPrevBits+this._numPosBits;i--;)this._coders[i]=new LZMA.Decoder2},LZMA.LiteralDecoder.prototype.init=function(){for(var e=1<<this._numPrevBits+this._numPosBits;e--;)this._coders[e].init()},LZMA.LiteralDecoder.prototype.getDecoder=function(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]},LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow,this._rangeDecoder=new LZMA.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new LZMA.BitTreeDecoder(4),this._lenDecoder=new LZMA.LenDecoder,this._repLenDecoder=new LZMA.LenDecoder,this._literalDecoder=new LZMA.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)},LZMA.Decoder.prototype.setDictionarySize=function(e){return 0>e?!1:(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},LZMA.Decoder.prototype.setLcLpPb=function(e,t,i){var r=1<<i;return e>8||t>4||i>4?!1:(this._literalDecoder.create(t,e),this._lenDecoder.create(r),this._repLenDecoder.create(r),this._posStateMask=r-1,!0)},LZMA.Decoder.prototype.init=function(){var e=4;for(this._outWindow.init(!1),LZMA.initBitModels(this._isMatchDecoders,192),LZMA.initBitModels(this._isRep0LongDecoders,192),LZMA.initBitModels(this._isRepDecoders,12),LZMA.initBitModels(this._isRepG0Decoders,12),LZMA.initBitModels(this._isRepG1Decoders,12),LZMA.initBitModels(this._isRepG2Decoders,12),LZMA.initBitModels(this._posDecoders,114),this._literalDecoder.init();e--;)this._posSlotDecoder[e].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},LZMA.Decoder.prototype.decode=function(e,t,i){var r,o,a,n,s,h,l=0,c=0,u=0,p=0,f=0,d=0,m=0;for(this._rangeDecoder.setStream(e),this._outWindow.setStream(t),this.init();0>i||i>d;)if(r=d&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(l<<4)+r))o=this._literalDecoder.getDecoder(d++,m),m=l>=7?o.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(c)):o.decodeNormal(this._rangeDecoder),this._outWindow.putByte(m),l=4>l?0:l-(10>l?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,l))a=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,l)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(l<<4)+r)&&(l=7>l?9:11,a=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,l)?n=u:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,l)?n=p:(n=f,f=p),p=u),u=c,c=n),0===a&&(a=2+this._repLenDecoder.decode(this._rangeDecoder,r),l=7>l?8:11);else if(f=p,p=u,u=c,a=2+this._lenDecoder.decode(this._rangeDecoder,r),l=7>l?7:10,s=this._posSlotDecoder[5>=a?a-2:3].decode(this._rangeDecoder),s>=4){if(h=(s>>1)-1,c=(2|1&s)<<h,14>s)c+=LZMA.reverseDecode2(this._posDecoders,c-s-1,this._rangeDecoder,h);else if(c+=this._rangeDecoder.decodeDirectBits(h-4)<<4,c+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>c){if(-1===c)break;return!1}}else c=s;if(c>=d||c>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(c,a),d+=a,m=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},LZMA.Decoder.prototype.setDecoderProperties=function(e){var t,i,r,o,a;return 5>e.size?!1:(t=e.readByte(),i=t%9,t=~~(t/9),r=t%5,o=~~(t/5),this.setLcLpPb(i,r,o)?(a=e.readByte(),a|=e.readByte()<<8,a|=e.readByte()<<16,a+=16777216*e.readByte(),this.setDictionarySize(a)):!1)},LZMA.decompress=function(e,t,i,r){var o=new LZMA.Decoder;if(!o.setDecoderProperties(e))throw"Incorrect stream properties";if(!o.decode(t,i,r))throw"Error in data stream";return!0};var CTM=CTM||{};CTM.CompressionMethod={RAW:5718354,MG1:3229517,MG2:3295053},CTM.Flags={NORMALS:1},CTM.File=function(e){this.load(e)},CTM.File.prototype.load=function(e){this.header=new CTM.FileHeader(e),this.body=new CTM.FileBody(this.header),this.getReader().read(e,this.body)},CTM.File.prototype.getReader=function(){var e;switch(this.header.compressionMethod){case CTM.CompressionMethod.RAW:e=new CTM.ReaderRAW;break;case CTM.CompressionMethod.MG1:e=new CTM.ReaderMG1;break;case CTM.CompressionMethod.MG2:e=new CTM.ReaderMG2}return e},CTM.FileHeader=function(e){e.readInt32(),this.fileFormat=e.readInt32(),this.compressionMethod=e.readInt32(),this.vertexCount=e.readInt32(),this.triangleCount=e.readInt32(),this.uvMapCount=e.readInt32(),this.attrMapCount=e.readInt32(),this.flags=e.readInt32(),this.comment=e.readString()},CTM.FileHeader.prototype.hasNormals=function(){return this.flags&CTM.Flags.NORMALS},CTM.FileBody=function(e){var t=3*e.triangleCount,i=3*e.vertexCount,r=e.hasNormals()?3*e.vertexCount:0,o=2*e.vertexCount,a=4*e.vertexCount,n=0,s=new ArrayBuffer(4*(t+i+r+o*e.uvMapCount+a*e.attrMapCount));if(this.indices=new Uint32Array(s,0,t),this.vertices=new Float32Array(s,4*t,i),e.hasNormals()&&(this.normals=new Float32Array(s,4*(t+i),r)),e.uvMapCount)for(this.uvMaps=[],n=0;e.uvMapCount>n;++n)this.uvMaps[n]={uv:new Float32Array(s,4*(t+i+r+n*o),o)};if(e.attrMapCount)for(this.attrMaps=[],n=0;e.attrMapCount>n;++n)this.attrMaps[n]={attr:new Float32Array(s,4*(t+i+r+o*e.uvMapCount+n*a),a)}},CTM.FileMG2Header=function(e){e.readInt32(),this.vertexPrecision=e.readFloat32(),this.normalPrecision=e.readFloat32(),this.lowerBoundx=e.readFloat32(),this.lowerBoundy=e.readFloat32(),this.lowerBoundz=e.readFloat32(),this.higherBoundx=e.readFloat32(),this.higherBoundy=e.readFloat32(),this.higherBoundz=e.readFloat32(),this.divx=e.readInt32(),this.divy=e.readInt32(),this.divz=e.readInt32(),this.sizex=(this.higherBoundx-this.lowerBoundx)/this.divx,this.sizey=(this.higherBoundy-this.lowerBoundy)/this.divy,this.sizez=(this.higherBoundz-this.lowerBoundz)/this.divz},CTM.ReaderRAW=function(){},CTM.ReaderRAW.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},CTM.ReaderRAW.prototype.readIndices=function(e,t){e.readInt32(),e.readArrayInt32(t)},CTM.ReaderRAW.prototype.readVertices=function(e,t){e.readInt32(),e.readArrayFloat32(t)},CTM.ReaderRAW.prototype.readNormals=function(e,t){e.readInt32(),e.readArrayFloat32(t)},CTM.ReaderRAW.prototype.readUVMaps=function(e,t){for(var i=0;t.length>i;++i)e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString(),e.readArrayFloat32(t[i].uv)},CTM.ReaderRAW.prototype.readAttrMaps=function(e,t){for(var i=0;t.length>i;++i)e.readInt32(),t[i].name=e.readString(),e.readArrayFloat32(t[i].attr)},CTM.ReaderMG1=function(){},CTM.ReaderMG1.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},CTM.ReaderMG1.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length),CTM.restoreIndices(t,t.length)},CTM.ReaderMG1.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,1);LZMA.decompress(e,e,i,i.data.length)},CTM.ReaderMG1.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length)},CTM.ReaderMG1.prototype.readUVMaps=function(e,t){for(var i=0;t.length>i;++i){e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString(),e.readInt32();var r=new CTM.InterleavedStream(t[i].uv,2);LZMA.decompress(e,e,r,r.data.length)}},CTM.ReaderMG1.prototype.readAttrMaps=function(e,t){for(var i=0;t.length>i;++i){e.readInt32(),t[i].name=e.readString(),e.readInt32();var r=new CTM.InterleavedStream(t[i].attr,4);LZMA.decompress(e,e,r,r.data.length)}},CTM.ReaderMG2=function(){},CTM.ReaderMG2.prototype.read=function(e,t){this.MG2Header=new CTM.FileMG2Header(e),this.readVertices(e,t.vertices),this.readIndices(e,t.indices),t.normals&&this.readNormals(e,t),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},CTM.ReaderMG2.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length);var r=this.readGridIndices(e,t);CTM.restoreVertices(t,this.MG2Header,r,this.MG2Header.vertexPrecision)},CTM.ReaderMG2.prototype.readGridIndices=function(e,t){e.readInt32(),e.readInt32();var i=new Uint32Array(t.length/3),r=new CTM.InterleavedStream(i,1);return LZMA.decompress(e,e,r,r.data.length),CTM.restoreGridIndices(i,i.length),i},CTM.ReaderMG2.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length),CTM.restoreIndices(t,t.length)},CTM.ReaderMG2.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t.normals,3);LZMA.decompress(e,e,i,i.data.length);var r=CTM.calcSmoothNormals(t.indices,t.vertices);CTM.restoreNormals(t.normals,r,this.MG2Header.normalPrecision)},CTM.ReaderMG2.prototype.readUVMaps=function(e,t){for(var i=0;t.length>i;++i){e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString();var r=e.readFloat32();e.readInt32();var o=new CTM.InterleavedStream(t[i].uv,2);LZMA.decompress(e,e,o,o.data.length),CTM.restoreMap(t[i].uv,2,r)}},CTM.ReaderMG2.prototype.readAttrMaps=function(e,t){for(var i=0;t.length>i;++i){e.readInt32(),t[i].name=e.readString();var r=e.readFloat32();e.readInt32();var o=new CTM.InterleavedStream(t[i].attr,4);LZMA.decompress(e,e,o,o.data.length),CTM.restoreMap(t[i].attr,4,r)}},CTM.restoreIndices=function(e,t){var i=3;for(t>0&&(e[2]+=e[0]);t>i;i+=3)e[i]+=e[i-3],e[i+1]+=e[i]===e[i-3]?e[i-2]:e[i],e[i+2]+=e[i]},CTM.restoreGridIndices=function(e,t){for(var i=1;t>i;++i)e[i]+=e[i-1]},CTM.restoreVertices=function(e,t,i,r){for(var o,a,n,s,h,l=new Uint32Array(e.buffer,e.byteOffset,e.length),c=t.divx,u=c*t.divy,p=2147483647,f=0,d=0,m=0,E=i.length;E>d;m+=3)n=o=i[d++],h=~~(n/u),n-=~~(h*u),s=~~(n/c),n-=~~(s*c),a=l[m],o===p&&(a+=f),e[m]=t.lowerBoundx+n*t.sizex+r*a,e[m+1]=t.lowerBoundy+s*t.sizey+r*l[m+1],e[m+2]=t.lowerBoundz+h*t.sizez+r*l[m+2],p=o,f=a},CTM.restoreNormals=function(e,t,i){for(var r,o,a,n,s,h,l,c,u,p,f=new Uint32Array(e.buffer,e.byteOffset,e.length),d=0,m=e.length,E=1.5707963267948966;m>d;d+=3)r=f[d]*i,o=f[d+1],0===o?(e[d]=t[d]*r,e[d+1]=t[d+1]*r,e[d+2]=t[d+2]*r):(a=4>=o?(f[d+2]-2)*E:(4*f[d+2]/o-2)*E,o*=i*E,n=r*Math.sin(o),s=n*Math.cos(a),h=n*Math.sin(a),l=r*Math.cos(o),u=t[d+1],c=t[d]-t[d+2],p=Math.sqrt(2*u*u+c*c),p>1e-20&&(c/=p,u/=p),e[d]=t[d]*l+(t[d+1]*u-t[d+2]*c)*h-u*s,e[d+1]=t[d+1]*l-(t[d+2]+t[d])*u*h+c*s,e[d+2]=t[d+2]*l+(t[d]*c+t[d+1]*u)*h+u*s)},CTM.restoreMap=function(e,t,i){for(var r,o,a,n=new Uint32Array(e.buffer,e.byteOffset,e.length),s=0,h=e.length;t>s;++s)for(r=0,a=s;h>a;a+=t)o=n[a],r+=1&o?-(o+1>>1):o>>1,e[a]=r*i},CTM.calcSmoothNormals=function(e,t){var i,r,o,a,n,s,h,l,c,u,p,f,d,m,E,v=new Float32Array(t.length);for(m=0,E=e.length;E>m;)i=3*e[m++],r=3*e[m++],o=3*e[m++],h=t[r]-t[i],u=t[o]-t[i],l=t[r+1]-t[i+1],p=t[o+1]-t[i+1],c=t[r+2]-t[i+2],f=t[o+2]-t[i+2],a=l*f-c*p,n=c*u-h*f,s=h*p-l*u,d=Math.sqrt(a*a+n*n+s*s),d>1e-10&&(a/=d,n/=d,s/=d),v[i]+=a,v[i+1]+=n,v[i+2]+=s,v[r]+=a,v[r+1]+=n,v[r+2]+=s,v[o]+=a,v[o+1]+=n,v[o+2]+=s;for(m=0,E=v.length;E>m;m+=3)d=Math.sqrt(v[m]*v[m]+v[m+1]*v[m+1]+v[m+2]*v[m+2]),d>1e-10&&(v[m]/=d,v[m+1]/=d,v[m+2]/=d);return v},CTM.isLittleEndian=function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),i=new Uint16Array(e);return t[0]=1,1===i[0]}(),CTM.InterleavedStream=function(e,t){this.data=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.offset=CTM.isLittleEndian?3:0,this.count=4*t,this.len=this.data.length},CTM.InterleavedStream.prototype.writeByte=function(e){this.data[this.offset]=e,this.offset+=this.count,this.offset>=this.len&&(this.offset-=this.len-4,this.offset>=this.count&&(this.offset-=this.count+(CTM.isLittleEndian?1:-1)))},CTM.Stream=function(e){this.data=e,this.offset=0},CTM.Stream.prototype.TWO_POW_MINUS23=Math.pow(2,-23),CTM.Stream.prototype.TWO_POW_MINUS126=Math.pow(2,-126),CTM.Stream.prototype.readByte=function(){return 255&this.data.charCodeAt(this.offset++)},CTM.Stream.prototype.readInt32=function(){var e=this.readByte();return e|=this.readByte()<<8,e|=this.readByte()<<16,e|this.readByte()<<24},CTM.Stream.prototype.readFloat32=function(){var e=this.readByte();e+=this.readByte()<<8;var t=this.readByte(),i=this.readByte();e+=(127&t)<<16;var r=(127&i)<<1|(128&t)>>>7,o=128&i?-1:1;return 255===r?0!==e?0/0:1/0*o:r>0?o*(1+e*this.TWO_POW_MINUS23)*Math.pow(2,r-127):0!==e?o*e*this.TWO_POW_MINUS126:0*o},CTM.Stream.prototype.readString=function(){var e=this.readInt32();return this.offset+=e,this.data.substr(this.offset-e,e)},CTM.Stream.prototype.readArrayInt32=function(e){for(var t=0,i=e.length;i>t;)e[t++]=this.readInt32();return e},CTM.Stream.prototype.readArrayFloat32=function(e){for(var t=0,i=e.length;i>t;)e[t++]=this.readFloat32();return e},THREE.CTMLoader=function(e){THREE.Loader.call(this,e)},THREE.CTMLoader.prototype=Object.create(THREE.Loader.prototype),THREE.CTMLoader.prototype.loadParts=function(e,t,i){var r=this,o=new XMLHttpRequest,a=i.basePath?i.basePath:this.extractUrlBase(e);o.onreadystatechange=function(){function e(e){l+=1,h.push(e),l===n.offsets.length&&t(h,s)}if(4===o.readyState&&(200===o.status||0===o.status)){for(var n=JSON.parse(o.responseText),s=[],h=[],l=0,c=0;n.materials.length>c;c++)s[c]=THREE.Loader.prototype.createMaterial(n.materials[c],a);var u=a+n.data,p={useWorker:i.useWorker,useBuffers:i.useBuffers,offsets:n.offsets};r.load(u,e,p)}},o.open("GET",e,!0),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},THREE.CTMLoader.prototype.load=function(e,t,i){var r=this,o=void 0!==i.offsets?i.offsets:[0],a=void 0!==i.useBuffers?i.useBuffers:!0,n=new XMLHttpRequest,s=null,h=0;n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status){var l=n.responseText;if(i.useWorker){var c=new Worker("js/loaders/ctm/CTMWorker.js");c.onmessage=function(e){for(var i=e.data,o=0;i.length>o;o++){var n=i[o];a?r.createModelBuffers(n,t):r.createModelClassic(n,t)}},c.postMessage({data:l,offsets:o})}else for(var u=0;o.length>u;u++){var p=new CTM.Stream(l);p.offset=o[u];var f=new CTM.File(p);a?r.createModelBuffers(f,t):r.createModelClassic(f,t)}}else console.error("Couldn't load ["+e+"] ["+n.status+"]");else 3===n.readyState?s&&(0===h&&(h=n.getResponseHeader("Content-Length")),s({total:h,loaded:n.responseText.length})):2===n.readyState&&(h=n.getResponseHeader("Content-Length"))},n.overrideMimeType("text/plain; charset=x-user-defined"),n.open("GET",e,!0),n.send(null)},THREE.CTMLoader.prototype.createModelBuffers=function(e,t){var i=function(){function t(e){if(void 0===v[e]){v[e]=g;var t=3*e,i=3*e+1,r=3*e+2,n=3*g,p=3*g+1,d=3*g+2;f[n]=s[t],f[p]=s[i],f[d]=s[r],h&&(l[n]=h[t],l[p]=h[i],l[d]=h[r]),o&&(c[2*g]=o[2*e],c[2*g+1]=o[2*e+1]),a&&(u[4*g]=a[4*e],u[4*g+1]=a[4*e+1],u[4*g+2]=a[4*e+2],u[4*g+3]=a[4*e+3]),g+=1}}var i=this,r=!0;i.materials=[],THREE.BufferGeometry.call(this);var o,a,n=e.body.indices,s=e.body.vertices,h=e.body.normals;if(void 0!==e.body.uvMaps&&e.body.uvMaps.length>0&&(o=e.body.uvMaps[0].uv),void 0!==e.body.attrMaps&&e.body.attrMaps.length>0&&"Color"===e.body.attrMaps[0].name&&(a=e.body.attrMaps[0].attr),r){var l,c,u,p=new Uint32Array(n.length),f=new Float32Array(s.length);h&&(l=new Float32Array(h.length)),o&&(c=new Float32Array(o.length)),a&&(u=new Float32Array(a.length));for(var d,m,E,v={},g=0,y=0;n.length>y;y+=3)d=n[y],m=n[y+1],E=n[y+2],t(d),t(m),t(E),p[y]=v[d],p[y+1]=v[m],p[y+2]=v[E];n=p,s=f,h&&(h=l),o&&(o=c),a&&(a=u)}i.offsets=[];for(var T=n,R=0,x=s.length,H=0,w=x,y=0;T.length>y;){for(var b=0;3>b;++b){var M=T[y++];x>M&&(x=M),M>H&&(H=M)}if(H-x>65535){y-=3;for(var S=R;y>S;++S)T[S]-=w;i.offsets.push({start:R,count:y-R,index:w}),R=y,x=s.length,H=0}w=x}for(var S=R;y>S;++S)T[S]-=w;i.offsets.push({start:R,count:y-R,index:w});var _=new Uint16Array(n),C=i.attributes;C.index={itemSize:1,array:_,numItems:_.length},C.position={itemSize:3,array:s,numItems:s.length},void 0!==h&&(C.normal={itemSize:3,array:h,numItems:h.length}),void 0!==o&&(C.uv={itemSize:2,array:o,numItems:o.length}),void 0!==a&&(C.color={itemSize:4,array:a,numItems:a.length})};i.prototype=Object.create(THREE.BufferGeometry.prototype);var r=new i;void 0===r.attributes.normal&&r.computeVertexNormals(),t(r)},THREE.CTMLoader.prototype.createModelClassic=function(e,t){function i(e,t,i,r){e.vertices.push(new THREE.Vector3(t,i,r))}function r(e,t,i,r,o){var a=new THREE.Face3(t,i,r,null,null,o);return e.faces.push(a),a}function o(e,t,i,r,o,a,n,s,h){var l=t[3*n],c=t[3*n+1],u=t[3*n+2],p=t[3*s],f=t[3*s+1],d=t[3*s+2],m=t[3*h],E=t[3*h+1],v=t[3*h+2],g=new THREE.Vector3(l,c,u),y=new THREE.Vector3(p,f,d),T=new THREE.Vector3(m,E,v),R=new THREE.Face3(i,r,o,[g,y,T],null,a);return e.faces.push(R),R}function a(e,t,i,r,o,a,n){var s=[];s.push(new THREE.Vector2(t,i)),s.push(new THREE.Vector2(r,o)),s.push(new THREE.Vector2(a,n)),e.push(s)}var n=function(){function t(e){var t,r,o,a,n=e.length;for(a=0;n>a;a+=3)t=e[a],r=e[a+1],o=e[a+2],i(c,t,r,o)}function n(e){var t,i,r,o,a=e.length;for(o=0;a>o;o+=3)t=e[o],i=e[o+1],r=e[o+2],u.push(t,i,r)}function s(e){var t,i,r,o,a,n=e.length;for(a=0;n>a;a+=4){t=e[a],i=e[a+1],r=e[a+2],o=e[a+3];var s=new THREE.Color;s.setRGB(t,i,r),f.push(s)}}function h(e){var t,i,r,o=e.length;for(r=0;o>r;r+=2)t=e[r],i=e[r+1],p.push(t,i)}function l(e){var t,i,n,s,h,l,v,g,y,T,R,x,H=e.length;for(T=0,x=0;H>x;x+=3)t=e[x],i=e[x+1],n=e[x+2],R=d?o(c,u,t,i,n,T,t,i,n):r(c,t,i,n,T),E&&(R.vertexColors[0]=f[t],R.vertexColors[1]=f[i],R.vertexColors[2]=f[n]),m&&(s=p[2*t],h=p[2*t+1],l=p[2*i],v=p[2*i+1],g=p[2*n],y=p[2*n+1],a(c.faceVertexUvs[0],s,h,l,v,g,y))}var c=this;c.materials=[],THREE.Geometry.call(this);var u=[],p=[],f=[];t(e.body.vertices),void 0!==e.body.normals&&n(e.body.normals),void 0!==e.body.uvMaps&&e.body.uvMaps.length>0&&h(e.body.uvMaps[0].uv),void 0!==e.body.attrMaps&&e.body.attrMaps.length>0&&"Color"===e.body.attrMaps[0].name&&s(e.body.attrMaps[0].attr);var d=u.length>0?!0:!1,m=p.length>0?!0:!1,E=f.length>0?!0:!1;l(e.body.indices),this.computeCentroids(),this.computeFaceNormals()};n.prototype=Object.create(THREE.Geometry.prototype),t(new n)},THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var i=window.innerWidth||1,r=window.innerHeight||1,o={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};t=new THREE.WebGLRenderTarget(i,r,o)}this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var t,i,r=!1,o=this.passes.length;for(i=0;o>i;i++)if(t=this.passes[i],t.enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}t instanceof THREE.MaskPass?r=!0:t instanceof THREE.ClearMaskPass&&(r=!1)}},reset:function(e){void 0===e&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var i=this.renderTarget1.clone();i.width=e,i.height=t,this.reset(i)}},THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),THREE.EffectComposer.scene=new THREE.Scene,THREE.EffectComposer.scene.add(THREE.EffectComposer.quad),THREE.BloomPass=function(e,t,i,r){e=void 0!==e?e:1,t=void 0!==t?t:25,i=void 0!==i?i:4,r=void 0!==r?r:256;var o={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.renderTargetX=new THREE.WebGLRenderTarget(r,r,o),this.renderTargetY=new THREE.WebGLRenderTarget(r,r,o),void 0===THREE.CopyShader&&console.error("THREE.BloomPass relies on THREE.CopyShader");var a=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(a.uniforms),this.copyUniforms.opacity.value=e,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0}),void 0===THREE.ConvolutionShader&&console.error("THREE.BloomPass relies on THREE.ConvolutionShader");var n=THREE.ConvolutionShader;this.convolutionUniforms=THREE.UniformsUtils.clone(n.uniforms),this.convolutionUniforms.uImageIncrement.value=THREE.BloomPass.blurx,this.convolutionUniforms.cKernel.value=THREE.ConvolutionShader.buildKernel(i),this.materialConvolution=new THREE.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.enabled=!0,this.needsSwap=!1,this.clear=!1},THREE.BloomPass.prototype={render:function(e,t,i,r,o){o&&e.context.disable(e.context.STENCIL_TEST),THREE.EffectComposer.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=i,this.convolutionUniforms.uImageIncrement.value=THREE.BloomPass.blurX,e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX,this.convolutionUniforms.uImageIncrement.value=THREE.BloomPass.blurY,e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTargetY,!0),THREE.EffectComposer.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY,o&&e.context.enable(e.context.STENCIL_TEST),e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,i,this.clear)}},THREE.BloomPass.blurX=new THREE.Vector2(.001953125,0),THREE.BloomPass.blurY=new THREE.Vector2(0,.001953125),THREE.DotScreenPass=function(e,t,i){void 0===THREE.DotScreenShader&&console.error("THREE.DotScreenPass relies on THREE.DotScreenShader");var r=THREE.DotScreenShader;this.uniforms=THREE.UniformsUtils.clone(r.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==i&&(this.uniforms.scale.value=i),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.DotScreenPass.prototype={render:function(e,t,i){this.uniforms.tDiffuse.value=i,this.uniforms.tSize.value.set(i.width,i.height),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}},THREE.FilmPass=function(e,t,i,r){void 0===THREE.FilmShader&&console.error("THREE.FilmPass relies on THREE.FilmShader");var o=THREE.FilmShader;this.uniforms=THREE.UniformsUtils.clone(o.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),void 0!==r&&(this.uniforms.grayscale.value=r),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==i&&(this.uniforms.sCount.value=i),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.FilmPass.prototype={render:function(e,t,i,r){this.uniforms.tDiffuse.value=i,this.uniforms.time.value+=r,THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}},THREE.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype={render:function(e,t,i){var r=e.context;r.colorMask(!1,!1,!1,!1),r.depthMask(!1);var o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.enable(r.STENCIL_TEST),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),r.stencilFunc(r.ALWAYS,o,4294967295),r.clearStencil(a),e.render(this.scene,this.camera,i,this.clear),e.render(this.scene,this.camera,t,this.clear),r.colorMask(!0,!0,!0,!0),r.depthMask(!0),r.stencilFunc(r.EQUAL,1,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},THREE.ClearMaskPass=function(){this.enabled=!0},THREE.ClearMaskPass.prototype={render:function(e){var t=e.context;t.disable(t.STENCIL_TEST)}},THREE.RenderPass=function(e,t,i,r,o){this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=void 0!==o?o:1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(e,t,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,i,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}},THREE.SavePass=function(e){void 0===THREE.CopyShader&&console.error("THREE.SavePass relies on THREE.CopyShader");var t=THREE.CopyShader;this.textureID="tDiffuse",this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters)),this.enabled=!0,this.needsSwap=!1,this.clear=!1},THREE.SavePass.prototype={render:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),THREE.EffectComposer.quad.material=this.material,e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTarget,this.clear)}},THREE.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1
},THREE.ShaderPass.prototype={render:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,this.clear)}},THREE.TexturePass=function(e,t){void 0===THREE.CopyShader&&console.error("THREE.TexturePass relies on THREE.CopyShader");var i=THREE.CopyShader;this.uniforms=THREE.UniformsUtils.clone(i.uniforms),this.uniforms.opacity.value=void 0!==t?t:1,this.uniforms.tDiffuse.value=e,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),this.enabled=!0,this.needsSwap=!1},THREE.TexturePass.prototype={render:function(e,t,i){THREE.EffectComposer.quad.material=this.material,e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,i)}},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.element.style.WebkitTransformStyle="preserve-3d",this.element.style.MozTransformStyle="preserve-3d",this.element.style.oTransformStyle="preserve-3d",this.element.style.transformStyle="preserve-3d"},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DRenderer=function(){console.log("THREE.CSS3DRenderer",THREE.REVISION);var e,t,i,r,o=new THREE.Projector,a=new THREE.Matrix4;this.domElement=document.createElement("div"),this.domElement.style.overflow="hidden",this.domElement.style.WebkitTransformStyle="preserve-3d",this.domElement.style.WebkitPerspectiveOrigin="50% 50%",this.domElement.style.MozTransformStyle="preserve-3d",this.domElement.style.MozPerspectiveOrigin="50% 50%",this.domElement.style.oTransformStyle="preserve-3d",this.domElement.style.oPerspectiveOrigin="50% 50%",this.domElement.style.transformStyle="preserve-3d",this.domElement.style.perspectiveOrigin="50% 50%",this.cameraElement=document.createElement("div"),this.cameraElement.style.WebkitTransformStyle="preserve-3d",this.cameraElement.style.MozTransformStyle="preserve-3d",this.cameraElement.style.oTransformStyle="preserve-3d",this.cameraElement.style.transformStyle="preserve-3d",this.domElement.appendChild(this.cameraElement),this.setSize=function(o,a){e=o,t=a,i=e/2,r=t/2,this.domElement.style.width=o+"px",this.domElement.style.height=a+"px",this.cameraElement.style.width=o+"px",this.cameraElement.style.height=a+"px"};var n=function(e){return 1e-6>Math.abs(e)?0:e},s=function(e){var t=e.elements;return"matrix3d("+n(t[0])+","+n(-t[1])+","+n(t[2])+","+n(t[3])+","+n(t[4])+","+n(-t[5])+","+n(t[6])+","+n(t[7])+","+n(t[8])+","+n(-t[9])+","+n(t[10])+","+n(t[11])+","+n(t[12])+","+n(-t[13])+","+n(t[14])+","+n(t[15])+")"},h=function(e){var t=e.elements;return"translate3d(-50%,-50%,0) matrix3d("+n(t[0])+","+n(t[1])+","+n(t[2])+","+n(t[3])+","+n(-t[4])+","+n(-t[5])+","+n(-t[6])+","+n(-t[7])+","+n(t[8])+","+n(t[9])+","+n(t[10])+","+n(t[11])+","+n(t[12])+","+n(t[13])+","+n(t[14])+","+n(t[15])+")"};this.render=function(e,n){var l=.5/Math.tan(THREE.Math.degToRad(.5*n.fov))*t;this.domElement.style.WebkitPerspective=l+"px",this.domElement.style.MozPerspective=l+"px",this.domElement.style.oPerspective=l+"px",this.domElement.style.perspective=l+"px";var c=o.projectScene(e,n,!1).objects,u="translate3d(0,0,"+l+"px)"+s(n.matrixWorldInverse)+" translate3d("+i+"px,"+r+"px, 0)";this.cameraElement.style.WebkitTransform=u,this.cameraElement.style.MozTransform=u,this.cameraElement.style.oTransform=u,this.cameraElement.style.transform=u;for(var p=0,f=c.length;f>p;p++){var d=c[p].object;if(d instanceof THREE.CSS3DObject){var m=d.element;d instanceof THREE.CSS3DSprite?(a.copy(n.matrixWorldInverse),a.transpose(),a.extractPosition(d.matrixWorld),a.scale(d.scale),a.elements[3]=0,a.elements[7]=0,a.elements[11]=0,a.elements[15]=1,u=h(a)):u=h(d.matrixWorld),m.style.WebkitTransform=u,m.style.MozTransform=u,m.style.oTransform=u,m.style.transform=u,m.parentNode!==this.cameraElement&&this.cameraElement.appendChild(m)}}}},THREE.SVGRenderer=function(){function e(e){var t,i,r,o;for(L.setRGB(0,0,0),z.setRGB(0,0,0),F.setRGB(0,0,0),t=0,i=e.length;i>t;t++)r=e[t],o=r.color,r instanceof THREE.AmbientLight?(L.r+=o.r,L.g+=o.g,L.b+=o.b):r instanceof THREE.DirectionalLight?(z.r+=o.r,z.g+=o.g,z.b+=o.b):r instanceof THREE.PointLight&&(F.r+=o.r,F.g+=o.g,F.b+=o.b)}function t(e,t,i,r){for(var o=0,a=e.length;a>o;o++){var n=e[o],s=n.color;if(n instanceof THREE.DirectionalLight){var h=V.getPositionFromMatrix(n.matrixWorld).normalize(),l=i.dot(h);if(0>=l)continue;l*=n.intensity,r.r+=s.r*l,r.g+=s.g*l,r.b+=s.b*l}else if(n instanceof THREE.PointLight){var h=V.getPositionFromMatrix(n.matrixWorld),l=i.dot(V.subVectors(h,t).normalize());if(0>=l)continue;if(l*=0==n.distance?1:1-Math.min(t.distanceTo(h)/n.distance,1),0==l)continue;l*=n.intensity,r.r+=s.r*l,r.g+=s.g*l,r.b+=s.b*l}}}function i(){}function r(e,t,i,r){T=n(H++),T.setAttribute("x1",e.positionScreen.x),T.setAttribute("y1",e.positionScreen.y),T.setAttribute("x2",t.positionScreen.x),T.setAttribute("y2",t.positionScreen.y),r instanceof THREE.LineBasicMaterial&&(T.setAttribute("style","fill: none; stroke: "+r.color.getStyle()+"; stroke-width: "+r.linewidth+"; stroke-opacity: "+r.opacity+"; stroke-linecap: "+r.linecap+"; stroke-linejoin: "+r.linejoin),M.appendChild(T))}function o(e,i,r,o,a){if(w.info.render.vertices+=3,w.info.render.faces++,T=s(R++),T.setAttribute("d","M "+e.positionScreen.x+" "+e.positionScreen.y+" L "+i.positionScreen.x+" "+i.positionScreen.y+" L "+r.positionScreen.x+","+r.positionScreen.y+"z"),a instanceof THREE.MeshBasicMaterial)A.copy(a.color),a.vertexColors===THREE.FaceColors&&A.multiply(o.color);else if(a instanceof THREE.MeshLambertMaterial)P.copy(a.color),D.copy(a.emissive),a.vertexColors===THREE.FaceColors&&P.multiply(o.color),C?(A.copy(L),t(c,o.centroidModel,o.normalModel,A),A.multiply(P).add(D)):A.copy(P);else if(a instanceof THREE.MeshDepthMaterial)y=1-a.__2near/(a.__farPlusNear-o.z*a.__farMinusNear),A.setRGB(y,y,y);else if(a instanceof THREE.MeshNormalMaterial){var n=o.normalModelView;A.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5)}a.wireframe?T.setAttribute("style","fill: none; stroke: "+A.getStyle()+"; stroke-width: "+a.wireframeLinewidth+"; stroke-opacity: "+a.opacity+"; stroke-linecap: "+a.wireframeLinecap+"; stroke-linejoin: "+a.wireframeLinejoin):T.setAttribute("style","fill: "+A.getStyle()+"; fill-opacity: "+a.opacity),M.appendChild(T)}function a(e,i,r,o,a,n){if(w.info.render.vertices+=4,w.info.render.faces++,T=s(R++),T.setAttribute("d","M "+e.positionScreen.x+" "+e.positionScreen.y+" L "+i.positionScreen.x+" "+i.positionScreen.y+" L "+r.positionScreen.x+","+r.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),n instanceof THREE.MeshBasicMaterial)A.copy(n.color),n.vertexColors===THREE.FaceColors&&A.multiply(a.color);else if(n instanceof THREE.MeshLambertMaterial)P.copy(n.color),D.copy(n.emissive),n.vertexColors===THREE.FaceColors&&P.multiply(a.color),C?(A.copy(L),t(c,a.centroidModel,a.normalModel,A),A.multiply(P).add(D)):A.copy(P);else if(n instanceof THREE.MeshDepthMaterial)y=1-n.__2near/(n.__farPlusNear-a.z*n.__farMinusNear),A.setRGB(y,y,y);else if(n instanceof THREE.MeshNormalMaterial){var h=a.normalModelView;A.setRGB(h.x,h.y,h.z).multiplyScalar(.5).addScalar(.5)}n.wireframe?T.setAttribute("style","fill: none; stroke: "+A.getStyle()+"; stroke-width: "+n.wireframeLinewidth+"; stroke-opacity: "+n.opacity+"; stroke-linecap: "+n.wireframeLinecap+"; stroke-linejoin: "+n.wireframeLinejoin):T.setAttribute("style","fill: "+A.getStyle()+"; fill-opacity: "+n.opacity),M.appendChild(T)}function n(e){return null==N[e]?(N[e]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==B&&N[e].setAttribute("shape-rendering","crispEdges"),N[e]):N[e]}function s(e){return null==U[e]?(U[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==B&&U[e].setAttribute("shape-rendering","crispEdges"),U[e]):U[e]}console.log("THREE.SVGRenderer",THREE.REVISION);var h,l,c,u,p,f,d,m,E,v,g,y,T,R,x,H,w=this,b=new THREE.Projector,M=document.createElementNS("http://www.w3.org/2000/svg","svg"),S=new THREE.Box2,_=new THREE.Box2,C=!1,A=new THREE.Color,P=new THREE.Color,D=new THREE.Color,L=new THREE.Color,z=new THREE.Color,F=new THREE.Color,V=new THREE.Vector3,U=[],N=[],B=1;this.domElement=M,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":B=1;break;case"low":B=0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t){u=e,p=t,f=u/2,d=p/2,M.setAttribute("viewBox",-f+" "+-d+" "+u+" "+p),M.setAttribute("width",u),M.setAttribute("height",p),S.min.set(-f,-d),S.max.set(f,d)},this.clear=function(){for(;M.childNodes.length>0;)M.removeChild(M.childNodes[0])},this.render=function(t,n){if(n instanceof THREE.Camera==!1)return console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera."),void 0;var s,u,p,y;for(this.autoClear&&this.clear(),w.info.render.vertices=0,w.info.render.faces=0,h=b.projectScene(t,n,this.sortObjects,this.sortElements),l=h.elements,c=h.lights,R=0,x=0,H=0,C=c.length>0,C&&e(c),s=0,u=l.length;u>s;s++)if(p=l[s],y=p.material,void 0!==y&&y.visible!==!1)if(_.makeEmpty(),p instanceof THREE.RenderableParticle)m=p,m.x*=f,m.y*=-d,i(m,p,y,t);else if(p instanceof THREE.RenderableLine)m=p.v1,E=p.v2,m.positionScreen.x*=f,m.positionScreen.y*=-d,E.positionScreen.x*=f,E.positionScreen.y*=-d,_.setFromPoints([m.positionScreen,E.positionScreen]),S.isIntersectionBox(_)===!0&&r(m,E,p,y,t);else if(p instanceof THREE.RenderableFace3){if(m=p.v1,E=p.v2,v=p.v3,-1>m.positionScreen.z||m.positionScreen.z>1)continue;if(-1>E.positionScreen.z||E.positionScreen.z>1)continue;if(-1>v.positionScreen.z||v.positionScreen.z>1)continue;m.positionScreen.x*=f,m.positionScreen.y*=-d,E.positionScreen.x*=f,E.positionScreen.y*=-d,v.positionScreen.x*=f,v.positionScreen.y*=-d,_.setFromPoints([m.positionScreen,E.positionScreen,v.positionScreen]),o(m,E,v,p,y,t)}else if(p instanceof THREE.RenderableFace4){if(m=p.v1,E=p.v2,v=p.v3,g=p.v4,-1>m.positionScreen.z||m.positionScreen.z>1)continue;if(-1>E.positionScreen.z||E.positionScreen.z>1)continue;if(-1>v.positionScreen.z||v.positionScreen.z>1)continue;if(-1>g.positionScreen.z||g.positionScreen.z>1)continue;m.positionScreen.x*=f,m.positionScreen.y*=-d,E.positionScreen.x*=f,E.positionScreen.y*=-d,v.positionScreen.x*=f,v.positionScreen.y*=-d,g.positionScreen.x*=f,g.positionScreen.y*=-d,_.setFromPoints([m.positionScreen,E.positionScreen,v.positionScreen,g.positionScreen]),a(m,E,v,g,p,y,t)}}},THREE.BasicShader={uniforms:{},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},THREE.BleachBypassShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},THREE.BlendShader={uniforms:{tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},mixRatio:{type:"f",value:.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},THREE.BokehShader={uniforms:{tColor:{type:"t",value:null},tDepth:{type:"t",value:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:.025},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},THREE.BrightnessContrastShader={uniforms:{tDiffuse:{type:"t",value:null},brightness:{type:"f",value:0},contrast:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n")},THREE.ColorCorrectionShader={uniforms:{tDiffuse:{type:"t",value:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );","}"].join("\n")},THREE.ColorifyShader={uniforms:{tDiffuse:{type:"t",value:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-(e*e)/(2*t*t))}var i,r,o,a,n=25,s=2*Math.ceil(3*e)+1;for(s>n&&(s=n),a=.5*(s-1),r=Array(s),o=0,i=0;s>i;++i)r[i]=t(i-a,e),o+=r[i];for(i=0;s>i;++i)r[i]/=o;return r}},THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.DOFMipMapShader={uniforms:{tColor:{type:"t",value:null},tDepth:{type:"t",value:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n")},THREE.DotScreenShader={uniforms:{tDiffuse:{type:"t",value:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},THREE.FilmShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},THREE.FocusShader={uniforms:{tDiffuse:{type:"t",value:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:.94},waveFactor:{type:"f",value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );","vec3 rgbM  = rgbaM.xyz;","float opacity  = rgbaM.w;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec3 rgbA = 0.5 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","vec3 rgbB = rgbA * 0.5 + 0.25 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );","float lumaB = dot( rgbB, luma );","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = vec4( rgbA, opacity );","} else {","gl_FragColor = vec4( rgbB, opacity );","}","}"].join("\n")},THREE.HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},THREE.HorizontalTiltShiftShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512},r:{type:"f",value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},THREE.HueSaturationShader={uniforms:{tDiffuse:{type:"t",value:null},hue:{type:"f",value:0},saturation:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n")},THREE.LuminosityShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},THREE.NormalMapShader={uniforms:{heightMap:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},THREE.SepiaShader={uniforms:{tDiffuse:{type:"t",value:null},amount:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},THREE.SSAOShader={uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},onlyAO:{type:"i",value:0},aoClamp:{type:"f",value:.3},lumInfluence:{type:"f",value:.9}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 8;","const float radius = 5.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const vec3 onlyAOColor = vec3( 1.0, 0.7, 0.5 );","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},THREE.TriangleBlurShader={uniforms:{texture:{type:"t",value:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","float random( vec3 scale, float seed ) {","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );","}","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")},THREE.UnpackDepthRGBAShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","void main() {","float depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );","}"].join("\n")},THREE.VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},THREE.VerticalTiltShiftShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512},r:{type:"f",value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},THREE.VignetteShader={uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},THREE.AudioObject=function(e,t,i,r){function o(e){var t=new XMLHttpRequest;
t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){E.source.buffer=E.context.createBuffer(t.response,!0),E.source.noteOn(0)},t.send()}if(THREE.Object3D.call(this),void 0===i&&(i=1),void 0===t&&(t=1),void 0===r&&(r=!0),!this.context)try{this.context=new webkitAudioContext}catch(a){return console.warn("THREE.AudioObject: webkitAudioContext not found"),this}this.directionalSource=!1,this.listener=this.context.listener,this.panner=this.context.createPanner(),this.source=this.context.createBufferSource(),this.masterGainNode=this.context.createGainNode(),this.dryGainNode=this.context.createGainNode(),this.masterGainNode.gain.value=t,this.dryGainNode.gain.value=3,this.source.connect(this.panner),this.panner.connect(this.dryGainNode),this.dryGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.source.playbackRate.value=i,this.source.loop=r,o(e);var n=new THREE.Vector3,s=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,E=this;this.setVolume=function(e){this.masterGainNode.gain.value=e},this.update=function(e){h.copy(n),l.copy(s),n.getPositionFromMatrix(this.matrixWorld),s.getPositionFromMatrix(e.matrixWorld),c.subVectors(n,h),u.subVectors(s,l),m.copy(e.up),f.set(0,0,-1),e.matrixWorld.rotateAxis(f),f.normalize(),this.listener.setPosition(s.x,s.y,s.z),this.listener.setVelocity(u.x,u.y,u.z),this.listener.setOrientation(f.x,f.y,f.z,m.x,m.y,m.z),this.panner.setPosition(n.x,n.y,n.z),this.panner.setVelocity(c.x,c.y,c.z),this.directionalSource&&(p.set(0,0,-1),this.matrixWorld.rotateAxis(p),p.normalize(),d.copy(this.up),this.panner.setOrientation(p.x,p.y,p.z,d.x,d.y,d.z))}},THREE.AudioObject.prototype=Object.create(THREE.Object3D.prototype),THREE.AudioObject.prototype.context=null,THREE.AudioObject.prototype.type=null,THREE.Car=function(){function e(e,t){o.bodyGeometry=e,o.bodyMaterials=t,i()}function t(e,t){o.wheelGeometry=e,o.wheelMaterials=t,i()}function i(){if(o.bodyGeometry&&o.wheelGeometry){if(o.autoWheelGeometry){o.wheelGeometry.computeBoundingBox();var e=o.wheelGeometry.boundingBox;o.wheelOffset.addVectors(e.min,e.max),o.wheelOffset.multiplyScalar(.5),o.wheelDiameter=e.max.y-e.min.y,THREE.GeometryUtils.center(o.wheelGeometry)}var t=o.modelScale,i=new THREE.Vector3,r=new THREE.MeshFaceMaterial(o.bodyMaterials),a=new THREE.MeshFaceMaterial(o.wheelMaterials);o.bodyMesh=new THREE.Mesh(o.bodyGeometry,r),o.bodyMesh.scale.set(t,t,t),o.root.add(o.bodyMesh),i.multiplyVectors(o.wheelOffset,new THREE.Vector3(t,t,t)),o.frontLeftWheelRoot.position.add(i),o.frontLeftWheelMesh=new THREE.Mesh(o.wheelGeometry,a),o.frontLeftWheelMesh.scale.set(t,t,t),o.frontLeftWheelRoot.add(o.frontLeftWheelMesh),o.root.add(o.frontLeftWheelRoot),i.multiplyVectors(o.wheelOffset,new THREE.Vector3(-t,t,t)),o.frontRightWheelRoot.position.add(i),o.frontRightWheelMesh=new THREE.Mesh(o.wheelGeometry,a),o.frontRightWheelMesh.scale.set(t,t,t),o.frontRightWheelMesh.rotation.z=Math.PI,o.frontRightWheelRoot.add(o.frontRightWheelMesh),o.root.add(o.frontRightWheelRoot),i.multiplyVectors(o.wheelOffset,new THREE.Vector3(t,t,-t)),i.z-=o.backWheelOffset,o.backLeftWheelMesh=new THREE.Mesh(o.wheelGeometry,a),o.backLeftWheelMesh.position.add(i),o.backLeftWheelMesh.scale.set(t,t,t),o.root.add(o.backLeftWheelMesh),i.multiplyVectors(o.wheelOffset,new THREE.Vector3(-t,t,-t)),i.z-=o.backWheelOffset,o.backRightWheelMesh=new THREE.Mesh(o.wheelGeometry,a),o.backRightWheelMesh.position.add(i),o.backRightWheelMesh.scale.set(t,t,t),o.backRightWheelMesh.rotation.z=Math.PI,o.root.add(o.backRightWheelMesh),o.meshes=[o.bodyMesh,o.frontLeftWheelMesh,o.frontRightWheelMesh,o.backLeftWheelMesh,o.backRightWheelMesh],o.loaded=!0,o.callback&&o.callback(o)}}function r(e){return 1===e?1:-Math.pow(2,-10*e)+1}var o=this;this.modelScale=1,this.backWheelOffset=2,this.autoWheelGeometry=!0,this.wheelOffset=new THREE.Vector3,this.wheelDiameter=1,this.MAX_SPEED=2200,this.MAX_REVERSE_SPEED=-1500,this.MAX_WHEEL_ROTATION=.6,this.FRONT_ACCELERATION=1250,this.BACK_ACCELERATION=1500,this.WHEEL_ANGULAR_ACCELERATION=1.5,this.FRONT_DECCELERATION=750,this.WHEEL_ANGULAR_DECCELERATION=1,this.STEERING_RADIUS_RATIO=.0023,this.MAX_TILT_SIDES=.05,this.MAX_TILT_FRONTBACK=.015,this.speed=0,this.acceleration=0,this.wheelOrientation=0,this.carOrientation=0,this.root=new THREE.Object3D,this.frontLeftWheelRoot=new THREE.Object3D,this.frontRightWheelRoot=new THREE.Object3D,this.bodyMesh=null,this.frontLeftWheelMesh=null,this.frontRightWheelMesh=null,this.backLeftWheelMesh=null,this.backRightWheelMesh=null,this.bodyGeometry=null,this.wheelGeometry=null,this.bodyMaterials=null,this.wheelMaterials=null,this.loaded=!1,this.meshes=[],this.enableShadows=function(e){for(var t=0;this.meshes.length>t;t++)this.meshes[t].castShadow=e,this.meshes[t].receiveShadow=e},this.setVisible=function(e){for(var t=0;this.meshes.length>t;t++)this.meshes[t].visible=e,this.meshes[t].visible=e},this.loadPartsJSON=function(i,r){var o=new THREE.JSONLoader;o.load(i,function(t,i){e(t,i)}),o.load(r,function(e,i){t(e,i)})},this.loadPartsBinary=function(i,r){var o=new THREE.BinaryLoader;o.load(i,function(t,i){e(t,i)}),o.load(r,function(e,i){t(e,i)})},this.updateCarModel=function(e,t){if(t.moveForward&&(this.speed=THREE.Math.clamp(this.speed+e*this.FRONT_ACCELERATION,this.MAX_REVERSE_SPEED,this.MAX_SPEED),this.acceleration=THREE.Math.clamp(this.acceleration+e,-1,1)),t.moveBackward&&(this.speed=THREE.Math.clamp(this.speed-e*this.BACK_ACCELERATION,this.MAX_REVERSE_SPEED,this.MAX_SPEED),this.acceleration=THREE.Math.clamp(this.acceleration-e,-1,1)),t.moveLeft&&(this.wheelOrientation=THREE.Math.clamp(this.wheelOrientation+e*this.WHEEL_ANGULAR_ACCELERATION,-this.MAX_WHEEL_ROTATION,this.MAX_WHEEL_ROTATION)),t.moveRight&&(this.wheelOrientation=THREE.Math.clamp(this.wheelOrientation-e*this.WHEEL_ANGULAR_ACCELERATION,-this.MAX_WHEEL_ROTATION,this.MAX_WHEEL_ROTATION)),!t.moveForward&&!t.moveBackward)if(this.speed>0){var i=r(this.speed/this.MAX_SPEED);this.speed=THREE.Math.clamp(this.speed-i*e*this.FRONT_DECCELERATION,0,this.MAX_SPEED),this.acceleration=THREE.Math.clamp(this.acceleration-i*e,0,1)}else{var i=r(this.speed/this.MAX_REVERSE_SPEED);this.speed=THREE.Math.clamp(this.speed+i*e*this.BACK_ACCELERATION,this.MAX_REVERSE_SPEED,0),this.acceleration=THREE.Math.clamp(this.acceleration+i*e,-1,0)}t.moveLeft||t.moveRight||(this.wheelOrientation=this.wheelOrientation>0?THREE.Math.clamp(this.wheelOrientation-e*this.WHEEL_ANGULAR_DECCELERATION,0,this.MAX_WHEEL_ROTATION):THREE.Math.clamp(this.wheelOrientation+e*this.WHEEL_ANGULAR_DECCELERATION,-this.MAX_WHEEL_ROTATION,0));var o=this.speed*e;this.carOrientation+=o*this.STEERING_RADIUS_RATIO*this.wheelOrientation,this.root.position.x+=Math.sin(this.carOrientation)*o,this.root.position.z+=Math.cos(this.carOrientation)*o,this.root.rotation.y=this.carOrientation,this.loaded&&(this.bodyMesh.rotation.z=this.MAX_TILT_SIDES*this.wheelOrientation*(this.speed/this.MAX_SPEED),this.bodyMesh.rotation.x=-this.MAX_TILT_FRONTBACK*this.acceleration);var a=1/(this.modelScale*(this.wheelDiameter/2)),n=o*a;this.loaded&&(this.frontLeftWheelMesh.rotation.x+=n,this.frontRightWheelMesh.rotation.x+=n,this.backLeftWheelMesh.rotation.x+=n,this.backRightWheelMesh.rotation.x+=n),this.frontLeftWheelRoot.rotation.y=this.wheelOrientation,this.frontRightWheelRoot.rotation.y=this.wheelOrientation}},THREE.Curves={},THREE.Curves.GrannyKnot=THREE.Curve.create(function(){},function(e){e=2*Math.PI*e;var t=-.22*Math.cos(e)-1.28*Math.sin(e)-.44*Math.cos(3*e)-.78*Math.sin(3*e),i=-.1*Math.cos(2*e)-.27*Math.sin(2*e)+.38*Math.cos(4*e)+.46*Math.sin(4*e),r=.7*Math.cos(3*e)-.4*Math.sin(3*e);return new THREE.Vector3(t,i,r).multiplyScalar(20)}),THREE.Curves.HeartCurve=THREE.Curve.create(function(e){this.scale=void 0===e?5:e},function(e){e*=2*Math.PI;var t=16*Math.pow(Math.sin(e),3),i=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e),r=0;return new THREE.Vector3(t,i,r).multiplyScalar(this.scale)}),THREE.Curves.VivianiCurve=THREE.Curve.create(function(e){this.radius=e},function(e){e=4*e*Math.PI;var t=this.radius/2,i=t*(1+Math.cos(e)),r=t*Math.sin(e),o=2*t*Math.sin(e/2);return new THREE.Vector3(i,r,o)}),THREE.Curves.KnotCurve=THREE.Curve.create(function(){},function(e){e*=2*Math.PI;var t=10,i=50,r=i*Math.sin(e),o=Math.cos(e)*(t+i*Math.cos(e)),a=Math.sin(e)*(t+i*Math.cos(e));return new THREE.Vector3(r,o,a)}),THREE.Curves.HelixCurve=THREE.Curve.create(function(){},function(e){var t=30,i=150,r=2*Math.PI*e*i/30,o=Math.cos(r)*t,a=Math.sin(r)*t,n=i*e;return new THREE.Vector3(o,a,n)}),THREE.Curves.TrefoilKnot=THREE.Curve.create(function(e){this.scale=void 0===e?10:e},function(e){e*=2*Math.PI;var t=(2+Math.cos(3*e))*Math.cos(2*e),i=(2+Math.cos(3*e))*Math.sin(2*e),r=Math.sin(3*e);return new THREE.Vector3(t,i,r).multiplyScalar(this.scale)}),THREE.Curves.TorusKnot=THREE.Curve.create(function(e){this.scale=void 0===e?10:e},function(e){var t=3,i=4;e*=2*Math.PI;var r=(2+Math.cos(i*e))*Math.cos(t*e),o=(2+Math.cos(i*e))*Math.sin(t*e),a=Math.sin(i*e);return new THREE.Vector3(r,o,a).multiplyScalar(this.scale)}),THREE.Curves.CinquefoilKnot=THREE.Curve.create(function(e){this.scale=void 0===e?10:e},function(e){var t=2,i=5;e*=2*Math.PI;var r=(2+Math.cos(i*e))*Math.cos(t*e),o=(2+Math.cos(i*e))*Math.sin(t*e),a=Math.sin(i*e);return new THREE.Vector3(r,o,a).multiplyScalar(this.scale)}),THREE.Curves.TrefoilPolynomialKnot=THREE.Curve.create(function(e){this.scale=void 0===e?10:e},function(e){e=4*e-2;var t=Math.pow(e,3)-3*e,i=Math.pow(e,4)-4*e*e,r=.2*Math.pow(e,5)-2*e;return new THREE.Vector3(t,i,r).multiplyScalar(this.scale)});var scaleTo=function(e,t,i){var r=t-e;return i*r+e};THREE.Curves.FigureEightPolynomialKnot=THREE.Curve.create(function(e){this.scale=void 0===e?1:e},function(e){e=scaleTo(-4,4,e);var t=.4*e*(e*e-7)*(e*e-10),i=Math.pow(e,4)-13*e*e,r=.1*e*(e*e-4)*(e*e-9)*(e*e-12);return new THREE.Vector3(t,i,r).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot4a=THREE.Curve.create(function(e){this.scale=void 0===e?40:e},function(e){e*=2*Math.PI;var t=Math.cos(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),i=Math.sin(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),r=.35*Math.sin(5*e);return new THREE.Vector3(t,i,r).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot4b=THREE.Curve.create(function(e){this.scale=void 0===e?40:e},function(e){var t=2*e*Math.PI,i=Math.cos(2*t)*(1+.45*Math.cos(3*t)+.4*Math.cos(9*t)),r=Math.sin(2*t)*(1+.45*Math.cos(3*t)+.4*Math.cos(9*t)),o=.2*Math.sin(9*t);return new THREE.Vector3(i,r,o).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot5a=THREE.Curve.create(function(e){this.scale=void 0===e?40:e},function(e){var t=2*e*Math.PI,i=Math.cos(3*t)*(1+.3*Math.cos(5*t)+.5*Math.cos(10*t)),r=Math.sin(3*t)*(1+.3*Math.cos(5*t)+.5*Math.cos(10*t)),o=.2*Math.sin(20*t);return new THREE.Vector3(i,r,o).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot5c=THREE.Curve.create(function(e){this.scale=void 0===e?40:e},function(e){var t=2*e*Math.PI,i=Math.cos(4*t)*(1+.5*(Math.cos(5*t)+.4*Math.cos(20*t))),r=Math.sin(4*t)*(1+.5*(Math.cos(5*t)+.4*Math.cos(20*t))),o=.35*Math.sin(15*t);return new THREE.Vector3(i,r,o).multiplyScalar(this.scale)}),THREE.MarchingCubes=function(e,t,i,r){THREE.ImmediateRenderObject.call(this),this.material=t,this.enableUvs=void 0!==i?i:!1,this.enableColors=void 0!==r?r:!1,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.vlist=new Float32Array(36),this.nlist=new Float32Array(36),this.firstDraw=!0,this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.lerp=function(e,t,i){return e+(t-e)*i},this.VIntX=function(e,t,i,r,o,a,n,s,h,l){var c=(o-h)/(l-h),u=this.normal_cache;t[r]=a+c*this.delta,t[r+1]=n,t[r+2]=s,i[r]=this.lerp(u[e],u[e+3],c),i[r+1]=this.lerp(u[e+1],u[e+4],c),i[r+2]=this.lerp(u[e+2],u[e+5],c)},this.VIntY=function(e,t,i,r,o,a,n,s,h,l){var c=(o-h)/(l-h),u=this.normal_cache;t[r]=a,t[r+1]=n+c*this.delta,t[r+2]=s;var p=e+3*this.yd;i[r]=this.lerp(u[e],u[p],c),i[r+1]=this.lerp(u[e+1],u[p+1],c),i[r+2]=this.lerp(u[e+2],u[p+2],c)},this.VIntZ=function(e,t,i,r,o,a,n,s,h,l){var c=(o-h)/(l-h),u=this.normal_cache;t[r]=a,t[r+1]=n,t[r+2]=s+c*this.delta;var p=e+3*this.zd;i[r]=this.lerp(u[e],u[p],c),i[r+1]=this.lerp(u[e+1],u[p+1],c),i[r+2]=this.lerp(u[e+2],u[p+2],c)},this.compNorm=function(e){var t=3*e;0===this.normal_cache[t]&&(this.normal_cache[t]=this.field[e-1]-this.field[e+1],this.normal_cache[t+1]=this.field[e-this.yd]-this.field[e+this.yd],this.normal_cache[t+2]=this.field[e-this.zd]-this.field[e+this.zd])},this.polygonize=function(e,t,i,r,o,a){var n=r+1,s=r+this.yd,h=r+this.zd,l=n+this.yd,c=n+this.zd,u=r+this.yd+this.zd,p=n+this.yd+this.zd,f=0,d=this.field[r],m=this.field[n],E=this.field[s],v=this.field[l],g=this.field[h],y=this.field[c],T=this.field[u],R=this.field[p];o>d&&(f|=1),o>m&&(f|=2),o>E&&(f|=8),o>v&&(f|=4),o>g&&(f|=16),o>y&&(f|=32),o>T&&(f|=128),o>R&&(f|=64);var x=THREE.edgeTable[f];if(0===x)return 0;var H=this.delta,w=e+H,b=t+H,M=i+H;1&x&&(this.compNorm(r),this.compNorm(n),this.VIntX(3*r,this.vlist,this.nlist,0,o,e,t,i,d,m)),2&x&&(this.compNorm(n),this.compNorm(l),this.VIntY(3*n,this.vlist,this.nlist,3,o,w,t,i,m,v)),4&x&&(this.compNorm(s),this.compNorm(l),this.VIntX(3*s,this.vlist,this.nlist,6,o,e,b,i,E,v)),8&x&&(this.compNorm(r),this.compNorm(s),this.VIntY(3*r,this.vlist,this.nlist,9,o,e,t,i,d,E)),16&x&&(this.compNorm(h),this.compNorm(c),this.VIntX(3*h,this.vlist,this.nlist,12,o,e,t,M,g,y)),32&x&&(this.compNorm(c),this.compNorm(p),this.VIntY(3*c,this.vlist,this.nlist,15,o,w,t,M,y,R)),64&x&&(this.compNorm(u),this.compNorm(p),this.VIntX(3*u,this.vlist,this.nlist,18,o,e,b,M,T,R)),128&x&&(this.compNorm(h),this.compNorm(u),this.VIntY(3*h,this.vlist,this.nlist,21,o,e,t,M,g,T)),256&x&&(this.compNorm(r),this.compNorm(h),this.VIntZ(3*r,this.vlist,this.nlist,24,o,e,t,i,d,g)),512&x&&(this.compNorm(n),this.compNorm(c),this.VIntZ(3*n,this.vlist,this.nlist,27,o,w,t,i,m,y)),1024&x&&(this.compNorm(l),this.compNorm(p),this.VIntZ(3*l,this.vlist,this.nlist,30,o,w,b,i,v,R)),2048&x&&(this.compNorm(s),this.compNorm(u),this.VIntZ(3*s,this.vlist,this.nlist,33,o,e,b,i,E,T)),f<<=4;for(var S,_,C,A=0,P=0;-1!=THREE.triTable[f+P];)S=f+P,_=S+1,C=S+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[S],3*THREE.triTable[_],3*THREE.triTable[C],a),P+=3,A++;return A},this.posnormtriv=function(e,t,i,r,o,a){var n=3*this.count;if(this.positionArray[n]=e[i],this.positionArray[n+1]=e[i+1],this.positionArray[n+2]=e[i+2],this.positionArray[n+3]=e[r],this.positionArray[n+4]=e[r+1],this.positionArray[n+5]=e[r+2],this.positionArray[n+6]=e[o],this.positionArray[n+7]=e[o+1],this.positionArray[n+8]=e[o+2],this.normalArray[n]=t[i],this.normalArray[n+1]=t[i+1],this.normalArray[n+2]=t[i+2],this.normalArray[n+3]=t[r],this.normalArray[n+4]=t[r+1],this.normalArray[n+5]=t[r+2],this.normalArray[n+6]=t[o],this.normalArray[n+7]=t[o+1],this.normalArray[n+8]=t[o+2],this.enableUvs){var s=2*this.count;this.uvArray[s]=e[i],this.uvArray[s+1]=e[i+2],this.uvArray[s+2]=e[r],this.uvArray[s+3]=e[r+2],this.uvArray[s+4]=e[o],this.uvArray[s+5]=e[o+2]}this.enableColors&&(this.colorArray[n]=e[i],this.colorArray[n+1]=e[i+1],this.colorArray[n+2]=e[i+2],this.colorArray[n+3]=e[r],this.colorArray[n+4]=e[r+1],this.colorArray[n+5]=e[r+2],this.colorArray[n+6]=e[o],this.colorArray[n+7]=e[o+1],this.colorArray[n+8]=e[o+2]),this.count+=3,this.count>=this.maxCount-3&&(this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),a(this))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(e){if(0!==this.count){for(var t=3*this.count;this.positionArray.length>t;t++)this.positionArray[t]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),e(this)}},this.addBall=function(e,t,i,r,o){var a=this.size*Math.sqrt(r/o),n=i*this.size,s=t*this.size,h=e*this.size,l=Math.floor(n-a);1>l&&(l=1);var c=Math.floor(n+a);c>this.size-1&&(c=this.size-1);var u=Math.floor(s-a);1>u&&(u=1);var p=Math.floor(s+a);p>this.size-1&&(p=this.size-1);var f=Math.floor(h-a);1>f&&(f=1);var d=Math.floor(h+a);d>this.size-1&&(d=this.size-1);var m,E,v,g,y,T,R,x,H,w,b;for(v=l;c>v;v++)for(y=this.size2*v,x=v/this.size-i,H=x*x,E=u;p>E;E++)for(g=y+this.size*E,R=E/this.size-t,w=R*R,m=f;d>m;m++)T=m/this.size-e,b=r/(1e-6+T*T+w+H)-o,b>0&&(this.field[g+m]+=b)},this.addPlaneX=function(e,t){var i,r,o,a,n,s,h,l=this.size,c=this.yd,u=this.zd,p=this.field,f=l*Math.sqrt(e/t);for(f>l&&(f=l),i=0;f>i;i++)if(s=i/l,a=s*s,n=e/(1e-4+a)-t,n>0)for(r=0;l>r;r++)for(h=i+r*c,o=0;l>o;o++)p[u*o+h]+=n},this.addPlaneY=function(e,t){var i,r,o,a,n,s,h,l,c=this.size,u=this.yd,p=this.zd,f=this.field,d=c*Math.sqrt(e/t);for(d>c&&(d=c),r=0;d>r;r++)if(s=r/c,a=s*s,n=e/(1e-4+a)-t,n>0)for(h=r*u,i=0;c>i;i++)for(l=h+i,o=0;c>o;o++)f[p*o+l]+=n},this.addPlaneZ=function(e,t){var i,r,o,a,n,s,h,l,c=this.size,u=this.yd,p=this.zd,f=this.field,d=c*Math.sqrt(e/t);for(d>c&&(d=c),o=0;d>o;o++)if(s=o/c,a=s*s,n=e/(1e-4+a)-t,n>0)for(h=p*o,r=0;c>r;r++)for(l=h+r*u,i=0;c>i;i++)f[l+i]+=n},this.reset=function(){var e;for(e=0;this.size3>e;e++)this.normal_cache[3*e]=0,this.field[e]=0},this.render=function(e){this.begin();var t,i,r,o,a,n,s,h,l,c=this.size-2;for(o=1;c>o;o++)for(l=this.size2*o,s=(o-this.halfsize)/this.halfsize,r=1;c>r;r++)for(h=l+this.size*r,n=(r-this.halfsize)/this.halfsize,i=1;c>i;i++)a=(i-this.halfsize)/this.halfsize,t=h+i,this.polygonize(a,n,s,t,this.isolation,e);this.end(e)},this.generateGeometry=function(){var e=0,t=new THREE.Geometry,i=[],r=function(r){var o,a,n,s,h,l,c,u,p,f,d,m,E,v;for(o=0;r.count>o;o++)u=3*o,p=u+1,f=u+2,a=r.positionArray[u],n=r.positionArray[p],s=r.positionArray[f],h=new THREE.Vector3(a,n,s),a=r.normalArray[u],n=r.normalArray[p],s=r.normalArray[f],l=new THREE.Vector3(a,n,s),l.normalize(),t.vertices.push(h),i.push(l);for(v=r.count/3,o=0;v>o;o++)u=3*(e+o),p=u+1,f=u+2,d=i[u],m=i[p],E=i[f],c=new THREE.Face3(u,p,f,[d,m,E]),t.faces.push(c);e+=v,r.count=0};return this.render(r),t},this.init(e)},THREE.MarchingCubes.prototype=Object.create(THREE.ImmediateRenderObject.prototype),THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),THREE.MD2Character=function(){function e(e,t){for(var r=new THREE.UVMapping,o=[],a=0;t.length>a;a++)o[a]=THREE.ImageUtils.loadTexture(e+t[a],r,i),o[a].name=t[a];return o}function t(e,t){e.computeMorphNormals();var i=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(16777215)),o=new THREE.MeshPhongMaterial({color:16755200,specular:1118481,shininess:50,wireframe:!0,shading:THREE.SmoothShading,map:i,morphTargets:!0,morphNormals:!0,metal:!1}),a=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50,wireframe:!1,shading:THREE.SmoothShading,map:t,morphTargets:!0,morphNormals:!0,metal:!1});a.wrapAround=!0;var n=new THREE.MorphAnimMesh(e,a);return n.rotation.y=-Math.PI/2,n.castShadow=!0,n.receiveShadow=!0,n.materialTexture=a,n.materialWireframe=o,n.parseAnimations(),n.playAnimation(e.firstAnimation,r.animationFPS),n.baseDuration=n.duration,n}function i(){r.loadCounter-=1,0===r.loadCounter&&r.onLoadComplete()}var r=this;this.scale=1,this.animationFPS=6,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(o){this.loadCounter=2*o.weapons.length+o.skins.length+1;for(var a=[],n=0;o.weapons.length>n;n++)a[n]=o.weapons[n][1];this.skinsBody=e(o.baseUrl+"skins/",o.skins),this.skinsWeapon=e(o.baseUrl+"skins/",a);var s=new THREE.JSONLoader;s.load(o.baseUrl+o.body,function(e){e.computeBoundingBox(),r.root.position.y=-r.scale*e.boundingBox.min.y;var o=t(e,r.skinsBody[0]);o.scale.set(r.scale,r.scale,r.scale),r.root.add(o),r.meshBody=o,r.activeAnimation=e.firstAnimation,i()});for(var h=function(e,o){return function(a){var n=t(a,r.skinsWeapon[e]);
n.scale.set(r.scale,r.scale,r.scale),n.visible=!1,n.name=o,r.root.add(n),r.weapons[e]=n,r.meshWeapon=n,i()}},n=0;o.weapons.length>n;n++)s.load(o.baseUrl+o.weapons[n][0],h(n,o.weapons[n][0]))},this.setPlaybackRate=function(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(e){for(var t=0;this.weapons.length>t;t++)this.weapons[t].visible=!1;var i=this.weapons[e];i&&(i.visible=!0,this.meshWeapon=i,i.playAnimation(this.activeAnimation,this.animationFPS),this.meshWeapon.baseDuration=this.meshWeapon.duration,this.meshWeapon.time=this.meshBody.time,this.meshWeapon.duration=this.meshBody.duration)},this.setAnimation=function(e){this.meshBody&&(this.meshBody.playAnimation(e,this.animationFPS),this.meshBody.baseDuration=this.meshBody.duration),this.meshWeapon&&(this.meshWeapon.playAnimation(e,this.animationFPS),this.meshWeapon.baseDuration=this.meshWeapon.duration,this.meshWeapon.time=this.meshBody.time),this.activeAnimation=e},this.update=function(e){this.meshBody&&this.meshBody.updateAnimation(1e3*e),this.meshWeapon&&this.meshWeapon.updateAnimation(1e3*e)}},THREE.MD2CharacterComplex=function(){function e(e,t){for(var r=new THREE.UVMapping,o=[],a=0;t.length>a;a++)o[a]=THREE.ImageUtils.loadTexture(e+t[a],r,i),o[a].name=t[a];return o}function t(e,t){e.computeMorphNormals();var i=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(16777215)),r=new THREE.MeshPhongMaterial({color:16755200,specular:1118481,shininess:50,wireframe:!0,shading:THREE.SmoothShading,map:i,morphTargets:!0,morphNormals:!0,metal:!0}),a=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50,wireframe:!1,shading:THREE.SmoothShading,map:t,morphTargets:!0,morphNormals:!0,metal:!0});a.wrapAround=!0;var n=new THREE.MorphBlendMesh(e,a);return n.rotation.y=-Math.PI/2,n.materialTexture=a,n.materialWireframe=r,n.autoCreateAnimations(o.animationFPS),n}function i(){o.loadCounter-=1,0===o.loadCounter&&o.onLoadComplete()}function r(e){return 1===e?1:-Math.pow(2,-10*e)+1}var o=this;this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=.5*this.maxSpeed,this.activeAnimation=null,this.oldAnimation=null,this.enableShadows=function(e){for(var t=0;this.meshes.length>t;t++)this.meshes[t].castShadow=e,this.meshes[t].receiveShadow=e},this.setVisible=function(e){for(var t=0;this.meshes.length>t;t++)this.meshes[t].visible=e,this.meshes[t].visible=e},this.shareParts=function(e){this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.skinsBody=e.skinsBody,this.skinsWeapon=e.skinsWeapon;var i=t(e.meshBody.geometry,this.skinsBody[0]);i.scale.set(this.scale,this.scale,this.scale),this.root.position.y=e.root.position.y,this.root.add(i),this.meshBody=i,this.meshes.push(i);for(var r=0;e.weapons.length>r;r++){var o=t(e.weapons[r].geometry,this.skinsWeapon[r]);o.scale.set(this.scale,this.scale,this.scale),o.visible=!1,o.name=e.weapons[r].name,this.root.add(o),this.weapons[r]=o,this.meshWeapon=o,this.meshes.push(o)}},this.loadParts=function(r){this.animations=r.animations,this.walkSpeed=r.walkSpeed,this.crouchSpeed=r.crouchSpeed,this.loadCounter=2*r.weapons.length+r.skins.length+1;for(var a=[],n=0;r.weapons.length>n;n++)a[n]=r.weapons[n][1];this.skinsBody=e(r.baseUrl+"skins/",r.skins),this.skinsWeapon=e(r.baseUrl+"skins/",a);var s=new THREE.JSONLoader;s.load(r.baseUrl+r.body,function(e){e.computeBoundingBox(),o.root.position.y=-o.scale*e.boundingBox.min.y;var r=t(e,o.skinsBody[0]);r.scale.set(o.scale,o.scale,o.scale),o.root.add(r),o.meshBody=r,o.meshes.push(r),i()});for(var h=function(e,r){return function(a){var n=t(a,o.skinsWeapon[e]);n.scale.set(o.scale,o.scale,o.scale),n.visible=!1,n.name=r,o.root.add(n),o.weapons[e]=n,o.meshWeapon=n,o.meshes.push(n),i()}},n=0;r.weapons.length>n;n++)s.load(r.baseUrl+r.weapons[n][0],h(n,r.weapons[n][0]))},this.setPlaybackRate=function(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[e],this.currentSkin=e)},this.setWeapon=function(e){for(var t=0;this.weapons.length>t;t++)this.weapons[t].visible=!1;var i=this.weapons[e];i&&(i.visible=!0,this.meshWeapon=i,this.activeAnimation&&(i.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))},this.setAnimation=function(e){e!==this.activeAnimation&&e&&(this.meshBody&&(this.meshBody.setAnimationWeight(e,0),this.meshBody.playAnimation(e),this.oldAnimation=this.activeAnimation,this.activeAnimation=e,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(e,0),this.meshWeapon.playAnimation(e)))},this.update=function(e){this.controls&&this.updateMovementModel(e),this.animations&&(this.updateBehaviors(e),this.updateAnimations(e))},this.updateAnimations=function(e){var t=1;this.blendCounter>0&&(t=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(e),this.meshBody.setAnimationWeight(this.activeAnimation,t),this.meshBody.setAnimationWeight(this.oldAnimation,1-t)),this.meshWeapon&&(this.meshWeapon.update(e),this.meshWeapon.setAnimationWeight(this.activeAnimation,t),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-t))},this.updateBehaviors=function(){var e,t,i=this.controls,r=this.animations;i.crouch?(e=r.crouchMove,t=r.crouchIdle):(e=r.move,t=r.idle),i.jump&&(e=r.jump,t=r.jump),i.attack&&(i.crouch?(e=r.crouchAttack,t=r.crouchAttack):(e=r.attack,t=r.attack)),(i.moveForward||i.moveBackward||i.moveLeft||i.moveRight)&&this.activeAnimation!==e&&this.setAnimation(e),.2*this.maxSpeed>Math.abs(this.speed)&&!(i.moveLeft||i.moveRight||i.moveForward||i.moveBackward)&&this.activeAnimation!==t&&this.setAnimation(t),i.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),i.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))},this.updateMovementModel=function(e){var t=this.controls;this.maxSpeed=t.crouch?this.crouchSpeed:this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,t.moveForward&&(this.speed=THREE.Math.clamp(this.speed+e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveBackward&&(this.speed=THREE.Math.clamp(this.speed-e*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));var i=1;if(t.moveLeft&&(this.bodyOrientation+=e*this.angularSpeed,this.speed=THREE.Math.clamp(this.speed+i*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveRight&&(this.bodyOrientation-=e*this.angularSpeed,this.speed=THREE.Math.clamp(this.speed+i*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!t.moveForward&&!t.moveBackward)if(this.speed>0){var o=r(this.speed/this.maxSpeed);this.speed=THREE.Math.clamp(this.speed-o*e*this.frontDecceleration,0,this.maxSpeed)}else{var o=r(this.speed/this.maxReverseSpeed);this.speed=THREE.Math.clamp(this.speed+o*e*this.backAcceleration,this.maxReverseSpeed,0)}var a=this.speed*e;this.root.position.x+=Math.sin(this.bodyOrientation)*a,this.root.position.z+=Math.cos(this.bodyOrientation)*a,this.root.rotation.y=this.bodyOrientation}},THREE.ParametricGeometries={klein:function(e,t){t*=Math.PI,e*=2*Math.PI,t=2*t;var i,r,o;return Math.PI>t?(i=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(t)*Math.cos(e),o=-8*Math.sin(t)-2*(1-Math.cos(t)/2)*Math.sin(t)*Math.cos(e)):(i=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(e+Math.PI),o=-8*Math.sin(t)),r=-2*(1-Math.cos(t)/2)*Math.sin(e),new THREE.Vector3(i,r,o)},plane:function(e,t){return function(i,r){var o=i*e,a=0,n=r*t;return new THREE.Vector3(o,a,n)}},mobius:function(e,t){e-=.5;var i,r,o,a=2*Math.PI*t,n=2;return i=Math.cos(a)*(n+e*Math.cos(a/2)),r=Math.sin(a)*(n+e*Math.cos(a/2)),o=e*Math.sin(a/2),new THREE.Vector3(i,r,o)},mobius3d:function(e,t){e*=Math.PI,t*=2*Math.PI,e=2*e;var i,r,o,a=e/2,n=2.25,s=.125,h=.65;return i=s*Math.cos(t)*Math.cos(a)-h*Math.sin(t)*Math.sin(a),o=s*Math.cos(t)*Math.sin(a)+h*Math.sin(t)*Math.cos(a),r=(n+i)*Math.sin(e),i=(n+i)*Math.cos(e),new THREE.Vector3(i,r,o)}},THREE.ParametricGeometries.TubeGeometry=function(e,t,i,r,o,a){this.path=e,this.segments=t||64,this.radius=i||1,this.segmentsRadius=r||8,this.closed=o||!1,a&&(this.debug=new THREE.Object3D);var n,s,h,l,c,u,p,f=this,d=this.segments+1,m=new THREE.Vector3,E=new THREE.TubeGeometry.FrenetFrames(e,t,o),v=E.tangents,g=E.normals,y=E.binormals;this.tangents=v,this.normals=g,this.binormals=y;var T=function(t,r){return r*=2*Math.PI,p=t*(d-1),p=Math.floor(p),u=e.getPointAt(t),n=v[p],s=g[p],h=y[p],f.debug&&(f.debug.add(new THREE.ArrowHelper(n,u,i,255)),f.debug.add(new THREE.ArrowHelper(s,u,i,16711680)),f.debug.add(new THREE.ArrowHelper(h,u,i,65280))),l=-f.radius*Math.cos(r),c=f.radius*Math.sin(r),m.copy(u),m.x+=l*s.x+c*h.x,m.y+=l*s.y+c*h.y,m.z+=l*s.z+c*h.z,m.clone()};THREE.ParametricGeometry.call(this,T,t,r)},THREE.ParametricGeometries.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.TorusKnotGeometry=function(e,t,i,r,o,a,n){this.radius=e||200,this.tube=t||40,this.segmentsR=i||64,this.segmentsT=r||8,this.p=o||2,this.q=a||3,this.heightScale=n||1;var s=THREE.Curve.create(function(){},function(t){t*=2*Math.PI;var i=.5,r=(1+i*Math.cos(a*t))*Math.cos(o*t),s=(1+i*Math.cos(a*t))*Math.sin(o*t),h=i*Math.sin(a*t);return new THREE.Vector3(r,s*n,h).multiplyScalar(e)}),h=i,l=r,c=new s;THREE.ParametricGeometries.TubeGeometry.call(this,c,h,t,l,!0,!1)},THREE.ParametricGeometries.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.SphereGeometry=function(e,t,i){function r(t,i){t*=Math.PI,i*=2*Math.PI;var r=e*Math.sin(t)*Math.cos(i),o=e*Math.sin(t)*Math.sin(i),a=e*Math.cos(t);return new THREE.Vector3(r,o,a)}THREE.ParametricGeometry.call(this,r,t,i,!!0)},THREE.ParametricGeometries.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.PlaneGeometry=function(e,t,i,r){function o(i,r){var o=i*e,a=0,n=r*t;return new THREE.Vector3(o,a,n)}THREE.ParametricGeometry.call(this,o,i,r)},THREE.ParametricGeometries.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShaderGodRays={godrays_generate:{uniforms:{tInput:{type:"t",value:null},fStepSize:{type:"f",value:1},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_combine:{uniforms:{tColors:{type:"t",value:null},tGodRays:{type:"t",value:null},fGodRayIntensity:{type:"f",value:.69},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_fake_sun:{uniforms:{vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)},fAspect:{type:"f",value:1},sunColor:{type:"c",value:new THREE.Color(16772608)},bgColor:{type:"c",value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n")}},THREE.ShaderSkin={skinSimple:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableBump:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:null},tBeckmann:{type:"t",value:null},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uOpacity:{type:"f",value:1},uRoughness:{type:"f",value:.15},uSpecularBrightness:{type:"f",value:.75},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},specularMap:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},uWrapRGB:{type:"v3",value:new THREE.Vector3(.75,.375,.1875)}}]),fragmentShader:["#define USE_BUMPMAP","#extension GL_OES_standard_derivatives : enable","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uOpacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","gl_FragColor = gl_FragColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 specularTotal = vec3( 0.0 );","#if MAX_POINT_LIGHTS > 0","vec3 pointTotal = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewPosition, uRoughness, uSpecularBrightness );","pointTotal    += lDistance * uDiffuseColor * pointLightColor[ i ] * pointDiffuseWeight;","specularTotal += lDistance * uSpecularColor * pointLightColor[ i ] * pointSpecularWeight * specularStrength;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirTotal = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight =  KS_Skin_Specular( normal, dirVector, viewPosition, uRoughness, uSpecularBrightness );","dirTotal 	   += uDiffuseColor * directionalLightColor[ i ] * dirDiffuseWeight;","specularTotal += uSpecularColor * directionalLightColor[ i ] * dirSpecularWeight * specularStrength;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiTotal = vec3( 0.0 );","for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiTotal += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewPosition, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewPosition, uRoughness, uSpecularBrightness );","specularTotal += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * specularStrength;","}","#endif","vec3 totalLight = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalLight += dirTotal;","#endif","#if MAX_POINT_LIGHTS > 0","totalLight += pointTotal;","#endif","#if MAX_HEMI_LIGHTS > 0","totalLight += hemiTotal;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * ( totalLight + ambientLightColor * uAmbientColor ) + specularTotal;",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},skin:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{passID:{type:"i",value:0},tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},tBlur1:{type:"t",value:null},tBlur2:{type:"t",value:null},tBlur3:{type:"t",value:null},tBlur4:{type:"t",value:null},tBeckmann:{type:"t",value:null},uNormalScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uOpacity:{type:"f",value:1},uRoughness:{type:"f",value:.15},uSpecularBrightness:{type:"f",value:.75}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uOpacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",THREE.ShaderChunk.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","gl_FragColor = vec4( 1.0 );","vec4 mColor = vec4( uDiffuseColor, uOpacity );","vec4 mSpecular = vec4( uSpecularColor, uOpacity );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","gl_FragColor = gl_FragColor * colDiffuse;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 specularTotal = vec3( 0.0 );","#if MAX_POINT_LIGHTS > 0","vec4 pointTotal = vec4( vec3( 0.0 ), 1.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( vPointLight[ i ].xyz );","float pointDistance = vPointLight[ i ].w;","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","pointTotal  += pointDistance * vec4( pointLightColor[ i ], 1.0 ) * ( mColor * pointDiffuseWeight );","if ( passID == 1 )","specularTotal += pointDistance * mSpecular.xyz * pointLightColor[ i ] * KS_Skin_Specular( normal, pointVector, viewPosition, uRoughness, uSpecularBrightness );","}","#endif","#if MAX_DIR_LIGHTS > 0","vec4 dirTotal = vec4( vec3( 0.0 ), 1.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","dirTotal  += vec4( directionalLightColor[ i ], 1.0 ) * ( mColor * dirDiffuseWeight );","if ( passID == 1 )","specularTotal += mSpecular.xyz * directionalLightColor[ i ] * KS_Skin_Specular( normal, dirVector, viewPosition, uRoughness, uSpecularBrightness );","}","#endif","vec4 totalLight = vec4( vec3( 0.0 ), uOpacity );","#if MAX_DIR_LIGHTS > 0","totalLight += dirTotal;","#endif","#if MAX_POINT_LIGHTS > 0","totalLight += pointTotal;","#endif","gl_FragColor = gl_FragColor * totalLight;","if ( passID == 0 ) {","gl_FragColor = vec4( sqrt( gl_FragColor.xyz ), gl_FragColor.w );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt( gl_FragColor.xyz );","#else","vec3 nonblurColor = gl_FragColor.xyz;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","gl_FragColor = vec4( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color",", gl_FragColor.w );","gl_FragColor.xyz *= pow( colDiffuse.xyz, vec3( 0.5 ) );","gl_FragColor.xyz += ambientLightColor * uAmbientColor * colDiffuse.xyz + specularTotal;","#ifndef VERSION1","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif","}",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif","}"].join("\n"),vertexShaderUV:["attribute vec4 tangent;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n")},beckmann:{uniforms:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n")}},THREE.ShaderTerrain={terrain:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new THREE.Vector2(1,1)},uRepeatOverlay:{type:"v2",value:new THREE.Vector2(1,1)},uOffset:{type:"v2",value:new THREE.Vector2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","#endif","gl_FragColor = gl_FragColor * mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},THREE.ShaderToon={toon1:{uniforms:{uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uBaseColor:{type:"c",value:new THREE.Color(16777215)}},vertexShader:["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n")},toon2:{uniforms:{uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uBaseColor:{type:"c",value:new THREE.Color(15658734)},uLineColor1:{type:"c",value:new THREE.Color(8421504)},uLineColor2:{type:"c",value:new THREE.Color(0)},uLineColor3:{type:"c",value:new THREE.Color(0)},uLineColor4:{type:"c",value:new THREE.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n")},hatching:{uniforms:{uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uBaseColor:{type:"c",value:new THREE.Color(16777215)},uLineColor1:{type:"c",value:new THREE.Color(0)},uLineColor2:{type:"c",value:new THREE.Color(0)},uLineColor3:{type:"c",value:new THREE.Color(0)},uLineColor4:{type:"c",value:new THREE.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n")},dotted:{uniforms:{uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uBaseColor:{type:"c",value:new THREE.Color(16777215)},uLineColor1:{type:"c",value:new THREE.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n")}},THREE.DeferredShaderChunk={unpackFloat:["vec3 float_to_vec3( float data ) {","vec3 uncompressed;","uncompressed.x = fract( data );","float zInt = floor( data / 255.0 );","uncompressed.z = fract( zInt / 255.0 );","uncompressed.y = fract( floor( data - ( zInt * 255.0 ) ) / 255.0 );","return uncompressed;","}"].join("\n"),computeVertexPositionVS:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );","vec4 normalDepth = texture2D( samplerNormalDepth, texCoord );","float z = normalDepth.w;","if ( z == 0.0 ) discard;","vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, z, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),computeNormal:["vec3 normal = normalDepth.xyz * 2.0 - 1.0;"].join("\n"),unpackColorMap:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 albedo = float_to_vec3( abs( colorMap.x ) );","vec3 specularColor = float_to_vec3( abs( colorMap.y ) );","float shininess = abs( colorMap.z );","float wrapAround = sign( colorMap.z );","float additiveSpecular = sign( colorMap.y );"].join("\n"),computeDiffuse:["float dotProduct = dot( normal, lightVector );","float diffuseFull = max( dotProduct, 0.0 );","vec3 diffuse;","if ( wrapAround < 0.0 ) {","float diffuseHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","const vec3 wrapRGB = vec3( 1.0, 1.0, 1.0 );","diffuse = mix( vec3( diffuseFull ), vec3( diffuseHalf ), wrapRGB );","} else {","diffuse = vec3( diffuseFull );","}"].join("\n"),computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( lightVector, halfVector ), 5.0 );","vec3 specular = schlick * max( pow( dotNormalHalf, shininess ), 0.0 ) * diffuse * specularNormalization;"].join("\n"),combine:["vec3 light = lightIntensity * lightColor;","gl_FragColor = vec4( light * ( albedo * diffuse + specular ), attenuation );"].join("\n")},THREE.ShaderDeferred={color:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapAround:{type:"f",value:1},additiveSpecular:{type:"f",value:1},samplerNormalDepth:{type:"t",value:null},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform vec3 emissive;","uniform float shininess;","uniform float wrapAround;","uniform float additiveSpecular;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,"#ifdef USE_ENVMAP","varying vec3 vWorldPosition;","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","uniform bool useRefract;","uniform float refractionRatio;","uniform sampler2D samplerNormalDepth;","uniform float viewHeight;","uniform float viewWidth;","#endif",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"const float unit = 255.0/256.0;","float vec3_to_float( vec3 data ) {","highp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","return compressed;","}","void main() {","const float opacity = 1.0;","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,"#ifdef USE_ENVMAP","vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );","vec4 normalDepth = texture2D( samplerNormalDepth, texCoord );","vec3 normal = normalDepth.xyz * 2.0 - 1.0;","vec3 reflectVec;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"const float compressionScale = 0.999;","vec3 diffuseMapColor;","#ifdef USE_MAP","diffuseMapColor = texelColor.xyz;","#else","diffuseMapColor = vec3( 1.0 );","#endif","gl_FragColor.x = vec3_to_float( compressionScale * gl_FragColor.xyz );","if ( additiveSpecular < 0.0 ) {","gl_FragColor.y = vec3_to_float( compressionScale * specular );","} else {","gl_FragColor.y = vec3_to_float( compressionScale * specular * diffuseMapColor );","}","gl_FragColor.y *= additiveSpecular;","gl_FragColor.z = wrapAround * shininess;","#ifdef USE_COLOR","gl_FragColor.w = vec3_to_float( compressionScale * emissive * diffuseMapColor * vColor );","#else","gl_FragColor.w = vec3_to_float( compressionScale * emissive * diffuseMapColor );","#endif","}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"#ifdef USE_ENVMAP","varying vec3 vWorldPosition;","#endif","void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"#ifdef USE_ENVMAP","vWorldPosition = worldPosition.xyz;","#endif","}"].join("\n")},normalDepth:{uniforms:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)}},fragmentShader:["#ifdef USE_BUMPMAP","#extension GL_OES_standard_derivatives : enable\n","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.bumpmap_pars_fragment,"#endif","varying vec3 normalView;","varying vec4 clipPos;","void main() {","vec3 normal = normalize( normalView );","#ifdef USE_BUMPMAP","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","gl_FragColor.xyz = normal * 0.5 + 0.5;","gl_FragColor.w = clipPos.z / clipPos.w;","}"].join("\n"),vertexShader:["varying vec3 normalView;","varying vec4 clipPos;","#ifdef USE_BUMPMAP","varying vec2 vUv;","varying vec3 vViewPosition;","uniform vec4 offsetRepeat;","#endif",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"normalView = normalize( normalMatrix * objectNormal );","#ifdef USE_BUMPMAP","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","vViewPosition = -mvPosition.xyz;","#endif","clipPos = gl_Position;","}"].join("\n")},composite:{uniforms:{samplerLight:{type:"t",value:null},brightness:{type:"f",value:1}},fragmentShader:["varying vec2 texCoord;","uniform sampler2D samplerLight;","uniform float brightness;","#ifdef TONEMAP_UNCHARTED","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float W = 11.2;","vec3 Uncharted2Tonemap( vec3 x ) {","return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","#endif","void main() {","vec3 inColor = texture2D( samplerLight, texCoord ).xyz;","inColor *= brightness;","vec3 outColor;","#if defined( TONEMAP_SIMPLE )","outColor = sqrt( inColor );","#elif defined( TONEMAP_LINEAR )","outColor = pow( inColor, vec3( 1.0 / 2.2 ) );","#elif defined( TONEMAP_REINHARD )","inColor = inColor / ( 1.0 + inColor );","outColor = pow( inColor, vec3( 1.0 / 2.2 ) );","#elif defined( TONEMAP_FILMIC )","vec3 x = max( vec3( 0.0 ), inColor - 0.004 );","outColor = ( x * ( 6.2 * x + 0.5 ) ) / ( x * ( 6.2 * x + 1.7 ) + 0.06 );","#elif defined( TONEMAP_UNCHARTED )","float ExposureBias = 2.0;","vec3 curr = Uncharted2Tonemap( ExposureBias * inColor );","vec3 whiteScale = vec3( 1.0 ) / Uncharted2Tonemap( vec3( W ) );","vec3 color = curr * whiteScale;","outColor = pow( color, vec3( 1.0 / 2.2 ) );","#else","outColor = inColor;","#endif","gl_FragColor = vec4( outColor, 1.0 );","}"].join("\n"),vertexShader:["varying vec2 texCoord;","void main() {","vec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","texCoord = pos.xy * vec2( 0.5 ) + 0.5;","gl_Position = pos;","}"].join("\n")},pointLight:{uniforms:{samplerNormalDepth:{type:"t",value:null},samplerColor:{type:"t",value:null},matProjInverse:{type:"m4",value:new THREE.Matrix4},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600},lightPositionVS:{type:"v3",value:new THREE.Vector3(0,0,0)},lightColor:{type:"c",value:new THREE.Color(0)},lightIntensity:{type:"f",value:1},lightRadius:{type:"f",value:1}},fragmentShader:["uniform sampler2D samplerColor;","uniform sampler2D samplerNormalDepth;","uniform float lightRadius;","uniform float lightIntensity;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform mat4 matProjInverse;",THREE.DeferredShaderChunk.unpackFloat,"void main() {",THREE.DeferredShaderChunk.computeVertexPositionVS,"vec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","float distance = length( lightVector );","if ( distance > lightRadius ) discard;",THREE.DeferredShaderChunk.computeNormal,THREE.DeferredShaderChunk.unpackColorMap,"lightVector = normalize( lightVector );",THREE.DeferredShaderChunk.computeDiffuse,THREE.DeferredShaderChunk.computeSpecular,"float cutoff = 0.3;","float denom = distance / lightRadius + 1.0;","float attenuation = 1.0 / ( denom * denom );","attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","attenuation = max( attenuation, 0.0 );","attenuation *= attenuation;",THREE.DeferredShaderChunk.combine,"}"].join("\n"),vertexShader:["void main() { ","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},spotLight:{uniforms:{samplerNormalDepth:{type:"t",value:null},samplerColor:{type:"t",value:null},matProjInverse:{type:"m4",value:new THREE.Matrix4},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600},lightPositionVS:{type:"v3",value:new THREE.Vector3(0,1,0)},lightDirectionVS:{type:"v3",value:new THREE.Vector3(0,1,0)},lightColor:{type:"c",value:new THREE.Color(0)},lightIntensity:{type:"f",value:1},lightDistance:{type:"f",value:1},lightAngle:{type:"f",value:1}},fragmentShader:["uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform sampler2D samplerColor;","uniform sampler2D samplerNormalDepth;","uniform float viewHeight;","uniform float viewWidth;","uniform float lightAngle;","uniform float lightIntensity;","uniform vec3 lightColor;","uniform mat4 matProjInverse;",THREE.DeferredShaderChunk.unpackFloat,"void main() {",THREE.DeferredShaderChunk.computeVertexPositionVS,THREE.DeferredShaderChunk.computeNormal,THREE.DeferredShaderChunk.unpackColorMap,"vec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","float rho = dot( lightDirectionVS, lightVector );","float rhoMax = cos( lightAngle * 0.5 );","if ( rho <= rhoMax ) discard;","float theta = rhoMax + 0.0001;","float phi = rhoMax + 0.05;","float falloff = 4.0;","float spot = 0.0;","if ( rho >= phi ) {","spot = 1.0;","} else if ( rho <= theta ) {","spot = 0.0;","} else { ","spot = pow( ( rho - theta ) / ( phi - theta ), falloff );","}",THREE.DeferredShaderChunk.computeDiffuse,"diffuse *= spot;",THREE.DeferredShaderChunk.computeSpecular,"const float attenuation = 1.0;",THREE.DeferredShaderChunk.combine,"}"].join("\n"),vertexShader:["void main() { ","gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n")},directionalLight:{uniforms:{samplerNormalDepth:{type:"t",value:null},samplerColor:{type:"t",value:null},matProjInverse:{type:"m4",value:new THREE.Matrix4},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600},lightDirectionVS:{type:"v3",value:new THREE.Vector3(0,1,0)},lightColor:{type:"c",value:new THREE.Color(0)},lightIntensity:{type:"f",value:1}},fragmentShader:["uniform sampler2D samplerColor;","uniform sampler2D samplerNormalDepth;","uniform float lightRadius;","uniform float lightIntensity;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform mat4 matProjInverse;",THREE.DeferredShaderChunk.unpackFloat,"void main() {",THREE.DeferredShaderChunk.computeVertexPositionVS,THREE.DeferredShaderChunk.computeNormal,THREE.DeferredShaderChunk.unpackColorMap,"vec3 lightVector = lightDirectionVS;",THREE.DeferredShaderChunk.computeDiffuse,THREE.DeferredShaderChunk.computeSpecular,"const float attenuation = 1.0;",THREE.DeferredShaderChunk.combine,"}"].join("\n"),vertexShader:["void main() { ","gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n")},hemisphereLight:{uniforms:{samplerNormalDepth:{type:"t",value:null},samplerColor:{type:"t",value:null},matProjInverse:{type:"m4",value:new THREE.Matrix4},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600},lightDirectionVS:{type:"v3",value:new THREE.Vector3(0,1,0)},lightColorSky:{type:"c",value:new THREE.Color(0)},lightColorGround:{type:"c",value:new THREE.Color(0)},lightIntensity:{type:"f",value:1}},fragmentShader:["uniform sampler2D samplerColor;","uniform sampler2D samplerNormalDepth;","uniform float lightRadius;","uniform float lightIntensity;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColorSky;","uniform vec3 lightColorGround;","uniform vec3 lightDirectionVS;","uniform mat4 matProjInverse;",THREE.DeferredShaderChunk.unpackFloat,"void main() {",THREE.DeferredShaderChunk.computeVertexPositionVS,THREE.DeferredShaderChunk.computeNormal,THREE.DeferredShaderChunk.unpackColorMap,"vec3 lightVector = lightDirectionVS;","float dotProduct = dot( normal, lightVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( lightColorGround, lightColorSky, hemiDiffuseWeight );","vec3 diffuse = hemiColor;","vec3 hemiHalfVectorSky = normalize( lightVector - vertexPositionVS.xyz );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lightVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround - vertexPositionVS.xyz );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( lightVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","vec3 specular = hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","gl_FragColor = vec4( lightIntensity * ( albedo * diffuse + specular ), 1.0 );","}"].join("\n"),vertexShader:["void main() { ","gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n")},areaLight:{uniforms:{samplerNormalDepth:{type:"t",value:null},samplerColor:{type:"t",value:null},matProjInverse:{type:"m4",value:new THREE.Matrix4},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600},lightPositionVS:{type:"v3",value:new THREE.Vector3(0,1,0)},lightNormalVS:{type:"v3",value:new THREE.Vector3(0,-1,0)},lightRightVS:{type:"v3",value:new THREE.Vector3(1,0,0)},lightUpVS:{type:"v3",value:new THREE.Vector3(1,0,0)},lightColor:{type:"c",value:new THREE.Color(0)},lightIntensity:{type:"f",value:1},lightWidth:{type:"f",value:1},lightHeight:{type:"f",value:1},constantAttenuation:{type:"f",value:1.5},linearAttenuation:{type:"f",value:.5},quadraticAttenuation:{type:"f",value:.1}},fragmentShader:["uniform vec3 lightPositionVS;","uniform vec3 lightNormalVS;","uniform vec3 lightRightVS;","uniform vec3 lightUpVS;","uniform sampler2D samplerColor;","uniform sampler2D samplerNormalDepth;","uniform float lightWidth;","uniform float lightHeight;","uniform float constantAttenuation;","uniform float linearAttenuation;","uniform float quadraticAttenuation;","uniform float lightIntensity;","uniform vec3 lightColor;","uniform float viewHeight;","uniform float viewWidth;","uniform mat4 matProjInverse;",THREE.DeferredShaderChunk.unpackFloat,"vec3 projectOnPlane( vec3 point, vec3 planeCenter, vec3 planeNorm ) {","return point - dot( point - planeCenter, planeNorm ) * planeNorm;","}","bool sideOfPlane( vec3 point, vec3 planeCenter, vec3 planeNorm ) {","return ( dot( point - planeCenter, planeNorm ) >= 0.0 );","}","vec3 linePlaneIntersect( vec3 lp, vec3 lv, vec3 pc, vec3 pn ) {","return lp + lv * ( dot( pn, pc - lp ) / dot( pn, lv ) );","}","float calculateAttenuation( float dist ) {","return ( 1.0 / ( constantAttenuation + linearAttenuation * dist + quadraticAttenuation * dist * dist ) );","}","void main() {",THREE.DeferredShaderChunk.computeVertexPositionVS,THREE.DeferredShaderChunk.computeNormal,THREE.DeferredShaderChunk.unpackColorMap,"float w = lightWidth;","float h = lightHeight;","vec3 proj = projectOnPlane( vertexPositionVS.xyz, lightPositionVS, lightNormalVS );","vec3 dir = proj - lightPositionVS;","vec2 diagonal = vec2( dot( dir, lightRightVS ), dot( dir, lightUpVS ) );","vec2 nearest2D = vec2( clamp( diagonal.x, -w, w ), clamp( diagonal.y, -h, h ) );","vec3 nearestPointInside = vec3( lightPositionVS ) + ( lightRightVS * nearest2D.x + lightUpVS * nearest2D.y );","vec3 lightDir = normalize( nearestPointInside - vertexPositionVS.xyz );","float NdotL = max( dot( lightNormalVS, -lightDir ), 0.0 );","float NdotL2 = max( dot( normal, lightDir ), 0.0 );","if ( NdotL2 * NdotL > 0.0 ) {","vec3 diffuse = vec3( sqrt( NdotL * NdotL2 ) );","vec3 specular = vec3( 0.0 );","vec3 R = reflect( normalize( -vertexPositionVS.xyz ), normal );","vec3 E = linePlaneIntersect( vertexPositionVS.xyz, R, vec3( lightPositionVS ), lightNormalVS );","float specAngle = dot( R, lightNormalVS );","if ( specAngle > 0.0 ) {","vec3 dirSpec = E - vec3( lightPositionVS );","vec2 dirSpec2D = vec2( dot( dirSpec, lightRightVS ), dot( dirSpec, lightUpVS ) );","vec2 nearestSpec2D = vec2( clamp( dirSpec2D.x, -w, w ), clamp( dirSpec2D.y, -h, h ) );","float specFactor = 1.0 - clamp( length( nearestSpec2D - dirSpec2D ) * 0.05 * shininess, 0.0, 1.0 );","specular = specularColor * specFactor * specAngle * diffuse;","}","float dist = distance( vertexPositionVS.xyz, nearestPointInside );","float attenuation = calculateAttenuation( dist );",THREE.DeferredShaderChunk.combine,"} else {","discard;","}","}"].join("\n"),vertexShader:["void main() {","gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n")},emissiveLight:{uniforms:{samplerColor:{type:"t",value:null},viewWidth:{type:"f",value:800},viewHeight:{type:"f",value:600}},fragmentShader:["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",THREE.DeferredShaderChunk.unpackFloat,"void main() {","vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );","vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 emissiveColor = float_to_vec3( abs( colorMap.w ) );","gl_FragColor = vec4( emissiveColor, 1.0 );","}"].join("\n"),vertexShader:["void main() { ","gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n")}};
var SPARKS={};SPARKS.Emitter=function(e){this._counter=e?e:new SPARKS.SteadyCounter(10),this._particles=[],this._initializers=[],this._actions=[],this._activities=[],this._handlers=[],this.callbacks={}},SPARKS.Emitter.prototype={_TIMESTEP:15,_timer:null,_lastTime:null,_timerStep:10,_velocityVerlet:!0,start:function(){this._lastTime=Date.now(),this._timer=setTimeout(this.step,this._timerStep,this),this._isRunning=!0},stop:function(){this._isRunning=!1,clearTimeout(this._timer)},isRunning:function(){return this._isRunning&!0},step:function(e){var t=Date.now(),i=t-e._lastTime;if(this._velocityVerlet)e.update(i/1e3),e._lastTime=t;else{var r=20*e._TIMESTEP;for(i>=r&&(i=r);i>=e._TIMESTEP;)e.update(e._TIMESTEP/1e3),i-=e._TIMESTEP;e._lastTime=t-i}e._isRunning&&setTimeout(e.step,e._timerStep,e)},update:function(e){var t,i,r=this._counter.updateEmitter(this,e);for(t=0;r>t;t++)this.createParticle();for(r=this._activities.length,t=0;r>t;t++)this._activities[t].update(this,e);r=this._actions.length;var o,a,n=this._particles.length;for(i=0;r>i;i++)for(a=this._actions[i],t=0;n>t;++t)o=this._particles[t],a.update(this,o,e);for(t=n;t--;)o=this._particles[t],o.isDead?(this._particles.splice(t,1),this.dispatchEvent("dead",o),SPARKS.VectorPool.release(o.position),SPARKS.VectorPool.release(o.velocity)):this.dispatchEvent("updated",o);this.dispatchEvent("loopUpdated")},createParticle:function(){var e,t=new SPARKS.Particle,i=this._initializers.length;for(e=0;i>e;e++)this._initializers[e].initialize(this,t);return this._particles.push(t),this.dispatchEvent("created",t),t},addInitializer:function(e){this._initializers.push(e)},addAction:function(e){this._actions.push(e)},removeInitializer:function(e){var t=this._initializers.indexOf(e);t>-1&&this._initializers.splice(t,1)},removeAction:function(e){var t=this._actions.indexOf(e);t>-1&&this._actions.splice(t,1)},addCallback:function(e,t){this.callbacks[e]=t},dispatchEvent:function(e,t){var i=this.callbacks[e];i&&i(t)}},SPARKS.EVENT_PARTICLE_CREATED="created",SPARKS.EVENT_PARTICLE_UPDATED="updated",SPARKS.EVENT_PARTICLE_DEAD="dead",SPARKS.EVENT_LOOP_UPDATED="loopUpdated",SPARKS.SteadyCounter=function(e){this.rate=e,this.leftover=0},SPARKS.SteadyCounter.prototype.updateEmitter=function(e,t){var i=t*this.rate+this.leftover,r=Math.floor(i);return this.leftover=i-r,r},SPARKS.ShotCounter=function(e){this.particles=e,this.used=!1},SPARKS.ShotCounter.prototype.updateEmitter=function(){return this.used?0:(this.used=!0,this.particles)},SPARKS.Particle=function(){this.lifetime=0,this.age=0,this.energy=1,this.isDead=!1,this.target=null,this.position=SPARKS.VectorPool.get().set(0,0,0),this.velocity=SPARKS.VectorPool.get().set(0,0,0),this._oldvelocity=SPARKS.VectorPool.get().set(0,0,0)},SPARKS.Action=function(){this._priority=0},SPARKS.Age=function(e){this._easing=null==e?TWEEN.Easing.Linear.None:e},SPARKS.Age.prototype.update=function(e,t,i){if(t.age+=i,t.age>=t.lifetime)t.energy=0,t.isDead=!0;else{var r=this._easing(t.age/t.lifetime);t.energy=-1*r+1}},SPARKS.Move=function(){},SPARKS.Move.prototype.update=function(e,t,i){var r=t.position,o=t.velocity,a=t._oldvelocity;this._velocityVerlet?(r.x+=.5*(o.x+a.x)*i,r.y+=.5*(o.y+a.y)*i,r.z+=.5*(o.z+a.z)*i):(r.x+=o.x*i,r.y+=o.y*i,r.z+=o.z*i)},SPARKS.DeathZone=function(e){this.zone=e},SPARKS.DeathZone.prototype.update=function(e,t){this.zone.contains(t.position)&&(t.isDead=!0)},SPARKS.ActionZone=function(e,t){this.action=e,this.zone=t},SPARKS.ActionZone.prototype.update=function(e,t,i){this.zone.contains(t.position)&&this.action.update(e,t,i)},SPARKS.Accelerate=function(e,t,i){return e instanceof THREE.Vector3?(this.acceleration=e,void 0):(this.acceleration=new THREE.Vector3(e,t,i),void 0)},SPARKS.Accelerate.prototype.update=function(e,t,i){var r=this.acceleration,o=t.velocity;t._oldvelocity.set(o.x,o.y,o.z),o.x+=r.x*i,o.y+=r.y*i,o.z+=r.z*i},SPARKS.AccelerateFactor=function(e){this.factor=e},SPARKS.AccelerateFactor.prototype.update=function(e,t,i){var r,o=this.factor,a=t.velocity,n=a.length();n>0&&(r=o*i/n,r+=1,a.multiplyScalar(r))},SPARKS.AccelerateVelocity=function(e){this.factor=e},SPARKS.AccelerateVelocity.prototype.update=function(e,t){var i=this.factor,r=t.velocity;r.z+=-r.x*i,r.y+=r.z*i,r.x+=r.y*i},SPARKS.RandomDrift=function(e,t,i){return e instanceof THREE.Vector3?(this.drift=e,void 0):(this.drift=new THREE.Vector3(e,t,i),void 0)},SPARKS.RandomDrift.prototype.update=function(e,t,i){var r=this.drift,o=t.velocity;o.x+=(Math.random()-.5)*r.x*i,o.y+=(Math.random()-.5)*r.y*i,o.z+=(Math.random()-.5)*r.z*i},SPARKS.Zone=function(){},SPARKS.PointZone=function(e){this.pos=e},SPARKS.PointZone.prototype.getLocation=function(){return this.pos},SPARKS.PointZone=function(e){this.pos=e},SPARKS.PointZone.prototype.getLocation=function(){return this.pos},SPARKS.LineZone=function(e,t){this.start=e,this.end=t,this._length=t.clone().sub(e)},SPARKS.LineZone.prototype.getLocation=function(){var e=this._length.clone();return e.multiplyScalar(Math.random()),e.add(this.start)},SPARKS.ParallelogramZone=function(e,t,i){this.corner=e,this.side1=t,this.side2=i},SPARKS.ParallelogramZone.prototype.getLocation=function(){var e=this.side1.clone().multiplyScalar(Math.random()),t=this.side2.clone().multiplyScalar(Math.random());return e.add(t),e.add(this.corner)},SPARKS.CubeZone=function(e,t,i,r){this.position=e,this.x=t,this.y=i,this.z=r},SPARKS.CubeZone.prototype.getLocation=function(){var e=this.position.clone();return e.x+=Math.random()*this.x,e.y+=Math.random()*this.y,e.z+=Math.random()*this.z,e},SPARKS.CubeZone.prototype.contains=function(e){var t=this.position.x,i=this.position.y,r=this.position.z,o=this.x,a=this.y,n=this.z;0>o&&(t+=o,o=Math.abs(o)),0>a&&(i+=a,a=Math.abs(a)),0>n&&(r+=n,n=Math.abs(n));var s=e.x-t,h=e.y-i,l=e.z-r;return s>0&&o>s&&h>0&&a>h&&l>0&&n>l?!0:!1},SPARKS.SphereCapZone=function(e,t,i,r,o,a){this.x=e,this.y=t,this.z=i,this.minr=r,this.maxr=o,this.angle=a},SPARKS.SphereCapZone.prototype.getLocation=function(){var e=2*Math.PI*SPARKS.Utils.random(),t=SPARKS.Utils.random(),i=SPARKS.VectorPool.get().set(t*Math.cos(e),-1/Math.tan(this.angle*SPARKS.Utils.DEGREE_TO_RADIAN),t*Math.sin(e)),r=this.minr-(this.minr-this.maxr)*Math.random();return i.multiplyScalar(r),i.__markedForReleased=!0,i},SPARKS.Lifetime=function(e,t){this._min=e,this._max=t?t:e},SPARKS.Lifetime.prototype.initialize=function(e,t){t.lifetime=this._min+SPARKS.Utils.random()*(this._max-this._min)},SPARKS.Position=function(e){this.zone=e},SPARKS.Position.prototype.initialize=function(e,t){var i=this.zone.getLocation();t.position.set(i.x,i.y,i.z)},SPARKS.Velocity=function(e){this.zone=e},SPARKS.Velocity.prototype.initialize=function(e,t){var i=this.zone.getLocation();t.velocity.set(i.x,i.y,i.z),i.__markedForReleased&&(SPARKS.VectorPool.release(i),i.__markedForReleased=!1)},SPARKS.Target=function(e,t){this.target=e,this.callback=t},SPARKS.Target.prototype.initialize=function(e,t){t.target=this.callback?this.callback():this.target},SPARKS.VectorPool={__pools:[],get:function(){return this.__pools.length>0?this.__pools.pop():this._addToPool()},release:function(e){this.__pools.push(e)},_addToPool:function(){for(var e=0,t=100;t>e;e++)this.__pools.push(new THREE.Vector3);return new THREE.Vector3}},SPARKS.Utils={random:function(){return Math.random()},DEGREE_TO_RADIAN:Math.PI/180,TWOPI:2*Math.PI,getPerpendiculars:function(e){var t=this.getPerpendicular(e),i=e.cross(t);return i.normalize(),[t,i]},getPerpendicular:function(e){if(0==e.x)return new THREE.Vector3D(1,0,0);var t=new THREE.Vector3(e.y,-e.x,0);return t.normalize()}},THREE.UVsUtils={},THREE.UVsUtils.CylinderUVGenerator=function(){this.uRepeat=1,this.targetGeometry=null,this.lengthCache=null},THREE.UVsUtils.CylinderUVGenerator.prototype={generateTopUV:THREE.ExtrudeGeometry.WorldUVGenerator.generateTopUV,generateBottomUV:THREE.ExtrudeGeometry.WorldUVGenerator.generateBottomUV,generateSideWallUV:function(e,t,i,r,o,a,n,s,h,l,c,u){this.targetGeometry!==e&&this.prepare(e,i);var p=this.lengthCache,f=h/l,d=(h+1)/l,m=p[c],E=p[u];return E>m&&(m+=1),m*=this.uRepeat,E*=this.uRepeat,[new THREE.Vector2(m,f),new THREE.Vector2(E,f),new THREE.Vector2(E,d),new THREE.Vector2(m,d)]},prepare:function(e,t){for(var i,r,o=[],a=0,n=t.length,s=0;n>s;s++){i=t[s],r=t[(s+1)%n];var h=i.x-r.x,l=i.y-r.y,c=Math.sqrt(h*h+l*l);o.push(a),a+=c}this.normalizeArray(o,a),this.targetGeometry=e,this.lengthCache=o},normalizeArray:function(e,t){for(var i=e.length,r=0;i>r;r++)e[r]/=t;return e}},THREE.UVsDebug=function(e){var t=(e.vertices,e.faces),i=e.faceVertexUvs[0];console.log("debugging geometry",e);var r=document.createElement("canvas"),o=1024,a=1024;r.width=o,r.height=a;var n=r.getContext("2d");n.lineWidth=1,n.strokeStyle="rgba(0,0,0,0.8)",n.fillStyle="rgba(255,255,255, 1.0)",n.fillRect(0,0,o,a);var s,h,l,c,u,p,f="abcd",d=new THREE.Vector2,m=new THREE.Vector2;for(l=0,c=i.length;c>l;l++){for(s=i[l],n.beginPath(),d.set(0,0),u=0,p=s.length;p>u;u++)h=s[u],d.x+=h.x,d.y+=h.y,0==u?n.moveTo(h.x*o,h.y*a):n.lineTo(h.x*o,h.y*a);for(n.closePath(),n.stroke(),d.divideScalar(p),n.font="12pt Arial bold",n.fillStyle="rgba(0,0,0,0.8)",n.fillText(l,d.x*o,d.y*a),n.font="8pt Arial bold",n.fillStyle="rgba(30,30,0,0.8)",u=0,p=s.length;p>u;u++)h=s[u],m.set(h.x,h.y).sub(d).divideScalar(4),m.x=h.x-m.x,m.y=h.y-m.y,n.fillText(f[u]+":"+t[l][f[u]],m.x*o,m.y*a)}return r};var ImprovedNoise=function(){function e(e){return e*e*e*(e*(6*e-15)+10)}function t(e,t,i){return t+e*(i-t)}function i(e,t,i,r){var o=15&e,a=8>o?t:i,n=4>o?i:12==o||14==o?t:r;return(0==(1&o)?a:-a)+(0==(2&o)?n:-n)}for(var r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],o=0;256>o;o++)r[256+o]=r[o];return{noise:function(o,a,n){var s=~~o,h=~~a,l=~~n,c=255&s,u=255&h,p=255&l;o-=s,a-=h,n-=l;var f=o-1,d=a-1,m=n-1,E=e(o),v=e(a),g=e(n),y=r[c]+u,T=r[y]+p,R=r[y+1]+p,x=r[c+1]+u,H=r[x]+p,w=r[x+1]+p;return t(g,t(v,t(E,i(r[T],o,a,n),i(r[H],f,a,n)),t(E,i(r[R],o,d,n),i(r[w],f,d,n))),t(v,t(E,i(r[T+1],o,a,m),i(r[H+1],f,a,n-1)),t(E,i(r[R+1],o,d,m),i(r[w+1],f,d,m))))}}},SimplexNoise=function(e){void 0==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;256>t;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(var t=0;512>t;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(e,t,i){return e[0]*t+e[1]*i},SimplexNoise.prototype.dot3=function(e,t,i,r){return e[0]*t+e[1]*i+e[2]*r},SimplexNoise.prototype.dot4=function(e,t,i,r,o){return e[0]*t+e[1]*i+e[2]*r+e[3]*o},SimplexNoise.prototype.noise=function(e,t){var i,r,o,a,n,s=.5*(Math.sqrt(3)-1),h=(e+t)*s,l=Math.floor(e+h),c=Math.floor(t+h),u=(3-Math.sqrt(3))/6,p=(l+c)*u,f=l-p,d=c-p,m=e-f,E=t-d;m>E?(a=1,n=0):(a=0,n=1);var v=m-a+u,g=E-n+u,y=m-1+2*u,T=E-1+2*u,R=255&l,x=255&c,H=this.perm[R+this.perm[x]]%12,w=this.perm[R+a+this.perm[x+n]]%12,b=this.perm[R+1+this.perm[x+1]]%12,M=.5-m*m-E*E;0>M?i=0:(M*=M,i=M*M*this.dot(this.grad3[H],m,E));var S=.5-v*v-g*g;0>S?r=0:(S*=S,r=S*S*this.dot(this.grad3[w],v,g));var _=.5-y*y-T*T;return 0>_?o=0:(_*=_,o=_*_*this.dot(this.grad3[b],y,T)),70*(i+r+o)},SimplexNoise.prototype.noise3d=function(e,t,i){var r,o,a,n,s,h,l,c,u,p,f=1/3,d=(e+t+i)*f,m=Math.floor(e+d),E=Math.floor(t+d),v=Math.floor(i+d),g=1/6,y=(m+E+v)*g,T=m-y,R=E-y,x=v-y,H=e-T,w=t-R,b=i-x;H>=w?w>=b?(s=1,h=0,l=0,c=1,u=1,p=0):H>=b?(s=1,h=0,l=0,c=1,u=0,p=1):(s=0,h=0,l=1,c=1,u=0,p=1):b>w?(s=0,h=0,l=1,c=0,u=1,p=1):b>H?(s=0,h=1,l=0,c=0,u=1,p=1):(s=0,h=1,l=0,c=1,u=1,p=0);var M=H-s+g,S=w-h+g,_=b-l+g,C=H-c+2*g,A=w-u+2*g,P=b-p+2*g,D=H-1+3*g,L=w-1+3*g,z=b-1+3*g,F=255&m,V=255&E,U=255&v,N=this.perm[F+this.perm[V+this.perm[U]]]%12,B=this.perm[F+s+this.perm[V+h+this.perm[U+l]]]%12,I=this.perm[F+c+this.perm[V+u+this.perm[U+p]]]%12,O=this.perm[F+1+this.perm[V+1+this.perm[U+1]]]%12,k=.6-H*H-w*w-b*b;0>k?r=0:(k*=k,r=k*k*this.dot3(this.grad3[N],H,w,b));var G=.6-M*M-S*S-_*_;0>G?o=0:(G*=G,o=G*G*this.dot3(this.grad3[B],M,S,_));var j=.6-C*C-A*A-P*P;0>j?a=0:(j*=j,a=j*j*this.dot3(this.grad3[I],C,A,P));var W=.6-D*D-L*L-z*z;return 0>W?n=0:(W*=W,n=W*W*this.dot3(this.grad3[O],D,L,z)),32*(r+o+a+n)},SimplexNoise.prototype.noise4d=function(e,t,i,r){var o,a,n,s,h,l,c,u,p,f,d,m,E,v,g,y,T,R=this.grad4,x=this.simplex,H=this.perm,w=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,M=(e+t+i+r)*w,S=Math.floor(e+M),_=Math.floor(t+M),C=Math.floor(i+M),A=Math.floor(r+M),P=(S+_+C+A)*b,D=S-P,L=_-P,z=C-P,F=A-P,V=e-D,U=t-L,N=i-z,B=r-F,I=V>U?32:0,O=V>N?16:0,k=U>N?8:0,G=V>B?4:0,j=U>B?2:0,W=N>B?1:0,X=I+O+k+G+j+W;l=x[X][0]>=3?1:0,c=x[X][1]>=3?1:0,u=x[X][2]>=3?1:0,p=x[X][3]>=3?1:0,f=x[X][0]>=2?1:0,d=x[X][1]>=2?1:0,m=x[X][2]>=2?1:0,E=x[X][3]>=2?1:0,v=x[X][0]>=1?1:0,g=x[X][1]>=1?1:0,y=x[X][2]>=1?1:0,T=x[X][3]>=1?1:0;var Y=V-l+b,q=U-c+b,K=N-u+b,Z=B-p+b,Q=V-f+2*b,J=U-d+2*b,$=N-m+2*b,et=B-E+2*b,tt=V-v+3*b,it=U-g+3*b,rt=N-y+3*b,ot=B-T+3*b,at=V-1+4*b,nt=U-1+4*b,st=N-1+4*b,ht=B-1+4*b,lt=255&S,ct=255&_,ut=255&C,pt=255&A,ft=H[lt+H[ct+H[ut+H[pt]]]]%32,dt=H[lt+l+H[ct+c+H[ut+u+H[pt+p]]]]%32,mt=H[lt+f+H[ct+d+H[ut+m+H[pt+E]]]]%32,Et=H[lt+v+H[ct+g+H[ut+y+H[pt+T]]]]%32,vt=H[lt+1+H[ct+1+H[ut+1+H[pt+1]]]]%32,gt=.6-V*V-U*U-N*N-B*B;0>gt?o=0:(gt*=gt,o=gt*gt*this.dot4(R[ft],V,U,N,B));var yt=.6-Y*Y-q*q-K*K-Z*Z;0>yt?a=0:(yt*=yt,a=yt*yt*this.dot4(R[dt],Y,q,K,Z));var Tt=.6-Q*Q-J*J-$*$-et*et;0>Tt?n=0:(Tt*=Tt,n=Tt*Tt*this.dot4(R[mt],Q,J,$,et));var Rt=.6-tt*tt-it*it-rt*rt-ot*ot;0>Rt?s=0:(Rt*=Rt,s=Rt*Rt*this.dot4(R[Et],tt,it,rt,ot));var xt=.6-at*at-nt*nt-st*st-ht*ht;return 0>xt?h=0:(xt*=xt,h=xt*xt*this.dot4(R[vt],at,nt,st,ht)),27*(o+a+n+s+h)};var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,i,r;e=e||{},t=void 0!==e.parent?e.parent:document.body,i=void 0!==e.id?e.id:"oldie",r=Detector.getWebGLErrorMessage(),r.id=i,t.appendChild(r)}};
// Export the THREE object for **Node.js**, with
// backwards-compatibility for the old `require()` API. If we're in
// the browser, add `_` as a global object via a string identifier,
// for Closure Compiler "advanced" mode.
if (typeof exports !== 'undefined') {
  if (typeof module !== 'undefined' && module.exports) {
    exports = module.exports = THREE;
  }
  exports.THREE = THREE;
} else {
  this['THREE'] = THREE;
}
